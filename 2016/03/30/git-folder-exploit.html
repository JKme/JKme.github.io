<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Git folder exploit | 😊#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="gitback.py

当部署线上项目的时候可能会把git代码仓库一起部署上去，造成的结果就是.git文件夹泄漏，由此可以根据.git/index来知道对应的压缩文件名字，下载之后解压缩即可得到源代码。这个程序是根据lijiejie的githack更改过来的。
因为githack使用的是socket直接read(）之后解压缩，如果文件太大会造成卡死。不管是githack还是rip-git，在下载文件的时候，如果文件不存在，而且服务器设置了302跳转的话，就会下载跳转那个页面，最后会导致下载好多重复文件。
所以我在源代码的基础上更改了下，先下载git压缩文件，然后再解压缩到对应的名称，如果文件不存在，服务器跳转，就pass。中间碰到几个问题如下：
使用requests碰到的问题timeout()
stackoverflow
官方文档
Issue

 简单来说，Timeouts可以是一个元组，第一个数值代表的是connect的timeout，第二个数值表示read的timeout，在这里read的timeout表示的是is the     number of seconds the client will wait for the     server to send a response,(Specifically, it’s the     number of seconds that the client will wait     between bytes sent from the server. In practice,     this is the time before the server sends the first     byte)
下载大文件使用requests，所以下载的时候不需要担心steam=True的情况，直接使用。"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Git folder exploit"/>
  <meta property="og:site_name" content="😊#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="😊#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">😊#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Git folder exploit</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <ul>
<li><a target="_blank" rel="noopener" href="https://github.com/JKme/gitback">gitback.py</a></li>
</ul>
<p>当部署线上项目的时候可能会把git代码仓库一起部署上去，造成的结果就是<code>.git</code>文件夹泄漏，由此可以根据<code>.git/index</code>来知道对应的压缩文件名字，下载之后解压缩即可得到源代码。这个程序是根据lijiejie的<a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">githack</a>更改过来的。</p>
<p>因为<code>githack</code>使用的是socket直接read(）之后解压缩，如果文件太大会造成卡死。不管是<code>githack</code>还是<code>rip-git</code>，在下载文件的时候，如果文件不存在，而且服务器设置了302跳转的话，就会下载跳转那个页面，最后会导致下载好多重复文件。</p>
<p>所以我在源代码的基础上更改了下，先下载git压缩文件，然后再解压缩到对应的名称，如果文件不存在，服务器跳转，就pass。中间碰到几个问题如下：</p>
<h2 id="使用requests碰到的问题"><a href="#使用requests碰到的问题" class="headerlink" title="使用requests碰到的问题"></a>使用requests碰到的问题</h2><h4 id="timeout"><a href="#timeout" class="headerlink" title="timeout()"></a>timeout()</h4><ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/17782142/why-doesnt-requests-get-return-what-is-the-default-timeout-that-requests-get">stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kevinburke/requests/blob/connect-timeout/docs/user/advanced.rst#timeouts">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kennethreitz/requests/pull/1801">Issue</a></li>
</ul>
<p> 简单来说，<code>Timeouts</code>可以是一个元组，第一个数值代表的是<code>connect</code>的<code>timeout</code>，第二个数值表示<code>read</code>的<code>timeout</code>，在这里<code>read</code>的<code>timeout</code>表示的是<strong>is the     number of seconds the client will wait for the     server to send a response,(Specifically, it’s the     number of seconds that the client will wait     between bytes sent from the server. In practice,     this is the time before the server sends the first     byte)</strong></p>
<h4 id="下载大文件"><a href="#下载大文件" class="headerlink" title="下载大文件"></a>下载大文件</h4><p>使用requests，所以下载的时候不需要担心steam=True的情况，直接使用。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/16694907/how-to-download-large-file-in-python-with-requests-py">stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kennethreitz/requests/pull/1935/files">Issue</a></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>local_filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    
    <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span>iter_conteCnt<span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> chunk<span class="token punctuation">:</span>               <span class="token comment"># filter out keep-alive new chunks</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
            <span class="token comment">#f.flush() commented by recommendation from J.F.Sebastian</span>
    <span class="token keyword">return</span> local_filename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="zlib解压缩"><a href="#zlib解压缩" class="headerlink" title="zlib解压缩"></a>zlib解压缩</h4><p> 在原有代码的基础上，使用<code>zlib.decompress(requests.reponse.raw.read())</code>来解压缩文件,本身设想把socket当作file来操作，但是未搞定。<br> 最后采用先下载压缩文件到本地，然后解压缩到对应文件。</p>
<h4 id="Socket流程"><a href="#Socket流程" class="headerlink" title="Socket流程"></a>Socket流程</h4><p>由于<code>gitback</code>在两个地方碰到了socket的问题：</p>
<ul>
<li>请求服务器发生<code>readtimeout</code>异常</li>
<li><code>zlib.decopress</code>解压缩是否可以解压缩socket，将socket作为文件来读</li>
</ul>
<p>首先来看以下socket的流程：首先服务端调用<code>socket()</code>创建一个socket，再将这个socket绑定<code>bind()</code>，绑定一个端口，调用listen来限制等待连接的队列容量，最后在循环中不停调用<code>accept()</code>来接收请求。</p>
<p>客户端通过<code>socket()</code>创建socket，再调用<code>connect()</code>连接到服务端bind的端口，这个时候如果等待连接的客户端超过<code>listen()</code>的设置，就会被拒绝，否则服务器接收这个<code>accept()</code>请求，并建立连接。<code>accet()</code>会返回新的socket，服务端和客户端都可以通过这个socket，调用<code>send()/recv()</code>或<code>write()/read()</code>进行通信。</p>
<p>来源：<a target="_blank" rel="noopener" href="http://www.keakon.net/2011/09/28/%E5%85%B3%E4%BA%8Esocket%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%9D%E6%AD%A5%E7%A0%94%E7%A9%B6">http://www.keakon.net/2011/09/28/%E5%85%B3%E4%BA%8Esocket%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%9D%E6%AD%A5%E7%A0%94%E7%A9%B6</a></p>
<h4 id="阻塞与非阻塞"><a href="#阻塞与非阻塞" class="headerlink" title="阻塞与非阻塞"></a>阻塞与非阻塞</h4><p>阻塞(blocking)，简单来说就是**sleep(休眠)**的技术术语，由于CPU的速度比较快，寄存器、CPU缓存和内存还能跟上这个速度，但是换成硬盘、网络等访问时间在毫秒以上，造成CPU长时间空闲等待，于是造成阻塞。<br>如果在这些耗费时间较长的I/O访问时，CPU处理完之后立即返回处理其他事情，让设备自行连接、传输。并在结束后让CPU完成善后，这样就是非阻塞(non-blocking)，在C语言中可以通过<code>fcntl()</code>和<code>ioctl()</code>将socket设为非阻塞。</p>
<p>在非阻塞状态下，服务器可以异步处理I/O，最简单的就是死循环中遍历所有socket，此时如果试着读取non-blocking的socket，<strong>如果socket没有内容的时候，返回-1，并将errno设置为<code>EWOULDBLOCK</code></strong></p>
<p><code>select()</code>授予你同时监视多个socket的权利，它会告诉你哪里资料可以读取，那些可以写入，哪些触发了例外。</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#include    &lt;sys&#x2F;time.h&gt; 
#include    &lt;sys&#x2F;types.h&gt; 
#include    &lt;unistd.h&gt; 

int select (int numfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout); <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>readfds</code>，<code>writefds</code>, <code>excepfds</code>分别表示要监视的那一组file descriptor set。</p>
<p>至于<code>epoll</code>，异步IO这些以后再慢慢学，先留个概念。</p>
<p>来源:<a target="_blank" rel="noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;hl=zh-CN&amp;prev=search&amp;rurl=translate.google.com.sg&amp;sl=zh-TW&amp;u=http://beej-zhtw.netdpi.net/07-advanced-technology/7-2-select&amp;usg=ALkJrhg0zwDET71E2ri1ObOL_Xb3et8b8w">https://translate.googleusercontent.com/translate_c?depth=1&amp;hl=zh-CN&amp;prev=search&amp;rurl=translate.google.com.sg&amp;sl=zh-TW&amp;u=http://beej-zhtw.netdpi.net/07-advanced-technology/7-2-select&amp;usg=ALkJrhg0zwDET71E2ri1ObOL_Xb3et8b8w</a></p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	<span id="/2016/03/30/git-folder-exploit.html" class="leancloud-visitors view" data-flag-title="Git folder exploit">
		<em class="post-meta-item-text"> Page View </em> <i class="leancloud-visitors-count"></i>
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2016/04/13/clear-ssh-history.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a type="button" class="btn btn-default disabled">Next<i class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-03-30 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Python/">Python<span>5</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%BD%BF%E7%94%A8requests%E7%A2%B0%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-article-text">使用requests碰到的问题</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#timeout"><span class="toc-article-text">timeout()</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E4%B8%8B%E8%BD%BD%E5%A4%A7%E6%96%87%E4%BB%B6"><span class="toc-article-text">下载大文件</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#zlib%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="toc-article-text">zlib解压缩</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#Socket%E6%B5%81%E7%A8%8B"><span class="toc-article-text">Socket流程</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E9%98%BB%E5%A1%9E%E4%B8%8E%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="toc-article-text">阻塞与非阻塞</span></a></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
