<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>IOSé€†å‘å…¥é—¨ | ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="æœ€åæ‰¾åˆ°äº†åŠ å¯†çš„ç§˜é’¥ï¼Œæ‰¾åˆ°ä¹‹åå‘ç°æ•´ä¸ªæµç¨‹å¥½ç®€å•ã€‚ä¹‹å‰æ‰¾ä¸åˆ°é¦–å…ˆä¸ç†Ÿæ‚‰Object-Cçš„è¯­æ³•ï¼Œå…¶æ¬¡å°±æ˜¯armæŒ‡ä»¤ï¼Œè®°å½•å¦‚ä¸‹ï¼š
0x01 å·¥å…·é¦–å…ˆæ˜¯è¦ç”¨åˆ°çš„å·¥å…·ï¼Œä¸­é—´ä¸»è¦ç”¨äº†idaï¼Œhopperå’Œlldb

dumpdecrypted: å°†è‹¹æœåŠ å¯†è¿‡çš„appç ¸å£³
class-dump: å¯¼å‡ºMachOæ–‡ä»¶é‡ŒObjCç±»åŠæ–¹æ³•å®šä¹‰
CydiaSubstrate: å°†ç¬¬ä¸‰æ–¹åŠ¨æ€åº“æ³¨å…¥è¿›ç¨‹
Cycript: ç”¨jsè¯­æ³•å†™ObjCæ–¹æ³•
Theos: è¶Šç‹±æ’ä»¶å¼€å‘å·¥å…·
IDA: åæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·
Hopper: OSXåæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·
Debugserver + LLDB: åŠ¨æ€è°ƒè¯•å™¨

0x02 ARMæŒ‡ä»¤armæ˜¯RISCç»“æ„ï¼Œæ•°æ®ä»å†…å­˜åˆ°CPUä¹‹é—´ç§»åŠ¨åªèƒ½é€šè¿‡L&amp;#x2F;SæŒ‡ä»¤æ¥å®Œæˆï¼Œå°±æ˜¯ldr&amp;#x2F;stræŒ‡ä»¤
ldr æŠŠæ•°æ®ä»å†…å­˜ç§»åˆ°cpu
str æŠŠcpuçš„æ•°æ®æ•°æ®è½¬ç§»åˆ°å†…å­˜
lldbè¯»å–å†…å­˜çš„æ•°æ®ï¼Œmemory read &amp;lt;start&amp;gt; &amp;lt;end&amp;gt;
ldr r0, 0x12345678   &amp;#x2F;&amp;#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€ä¸­çš„å€¼å­˜æ”¾åˆ°r0ä¸­
ldr r0, &amp;#x3D;0x12345678  &amp;#x2F;&amp;#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€å†™åˆ°r0ä¸­
ä¾‹å­ï¼š
COUNT EQU 0x40003100 &amp;#x2F;&amp;#x2F;å®šä¹‰ä¸€ä¸ªCOUNTå˜é‡ï¼Œåœ°å€æ˜¯0x40003100
...
LDR R1,&amp;#x3D;COUNT       &amp;#x2F;&amp;#x2F;å°†COUNTè¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯0x40003100æ”¾åˆ°R1ä¸­
MOV R0,#0           &amp;#x2F;&amp;#x2F;å°†ç«‹å³æ•°0æ”¾åˆ°R0ä¸­
STR R0,[R1]         &amp;#x2F;&amp;#x2F;å°†R0ä¸­çš„å€¼æ”¾åˆ°ä»¥R1ä¸­çš„å€¼ä¸ºåœ°å€çš„å­˜å‚¨å•å…ƒå»




B è·³è½¬æŒ‡ä»¤
BL å¸¦è¿”å›çš„è·³è½¬æŒ‡ä»¤
BLX å¸¦è¿”å›å’ŒçŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤
BX  å¸¦çŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤

BLXæŒ‡ä»¤ä»ARMæŒ‡ä»¤é›†è·³è½¬åˆ°æŒ‡ä»¤ä¸­æ‰€æŒ‡å®šçš„ç›®æ ‡åœ°å€ï¼Œå¹¶å°†å¤„ç†å™¨çš„å·¥ä½œçŠ¶æ€ä»ARMåˆ‡æ¢åˆ°ThumbçŠ¶æ€ï¼Œè¯¥æŒ‡ä»¤åŒæ—¶å°†PCçš„å½“å‰å†…å®¹ä¿å­˜åˆ°å¯„å­˜å™¨R14ï¼Œå› æ­¤ï¼Œå½“å­ç¨‹åºä½¿ç”¨ThumbæŒ‡ä»¤é›†ï¼Œè€Œè°ƒç”¨è€…è€…ä½¿ç”¨ARMæŒ‡ä»¤é›†ï¼Œå¯ä»¥é€šè¿‡BLXæŒ‡ä»¤å®ç°å­ç¨‹åºçš„è°ƒç”¨å’Œå¤„ç†å™¨å·¥ä½œçŠ¶æ€åˆ‡æ¢ï¼ŒåŒæ—¶ï¼Œå­ç¨‹åºçš„è¿”å›å¯ä»¥é€šè¿‡å°†å¯„å­˜å™¨R14çš„å€¼å¤åˆ¶åˆ°PCä¸­æ¥å®Œæˆã€‚
ã€€R0-R3:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”¨äºå‡½æ•°å‚æ•°åŠè¿”å›å€¼çš„ä¼ é€’ï¼Œè¶…è¿‡4ä¸ªå‚æ•°ï¼Œå…¶å®ƒå‚æ•°å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ARMä¸­æ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼ŒR0è¿˜å¯ä»¥ä½œä¸ºè¿”å›å€¼ã€‚
ã€€ã€€R4-R6, R8, R10-R11:ã€€æ²¡æœ‰ç‰¹æ®Šè§„å®šï¼Œå°±æ˜¯æ™®é€šçš„é€šç”¨å¯„å­˜å™¨
ã€€ã€€R7:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ ˆå¸§æŒ‡é’ˆï¼ŒæŒ‡å‘æ¯å‡½æ•°ä¸è¢«è°ƒç”¨å­å‡½æ•°åœ¨æ ˆä¸­çš„äº¤ç•Œã€‚
ã€€ã€€R9:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åœ¨iOS3.0è¢«æ“ä½œç³»ç»Ÿä¿ç•™
ã€€ã€€R12:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ å†…éƒ¨è¿‡ç¨‹è°ƒç”¨å¯„å­˜å™¨ï¼ŒåŠ¨æ€é“¾æ¥æ—¶ä¼šç”¨åˆ°ï¼Œä¸å¿…æ·±ç©¶
ã€€ã€€R13:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ SP(stack pointer)ï¼Œæ˜¯æ ˆé¡¶æŒ‡é’ˆ
ã€€ã€€R14:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ LR(link register)ï¼Œå­˜æ”¾å‡½æ•°çš„è¿”å›åœ°å€ã€‚
ã€€ã€€R15:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ PC(program counter)ï¼ŒæŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ã€‚
ADC ã€€ã€€ å¸¦è¿›ä½çš„åŠ æ³•
ã€€ã€€ADD ã€€ã€€ åŠ æ³•
ã€€ã€€AND ã€€ã€€ é€»è¾‘ä¸
ã€€ã€€B ã€€ã€€ã€€  åˆ†æ”¯è·³è½¬ï¼Œå¾ˆå°‘å•ç‹¬ä½¿ç”¨
ã€€ã€€BL          åˆ†æ”¯è·³è½¬ï¼Œè·³è½¬åè¿”å›åœ°å€å­˜å…¥r14
ã€€ã€€BX          åˆ†æ”¯è·³è½¬ï¼Œå¹¶åˆ‡æ¢æŒ‡ä»¤æ¨¡å¼ï¼ˆThumb&amp;#x2F;ARMï¼‰
ã€€ã€€CMP        æ¯”è¾ƒå€¼ï¼Œç»“æœå­˜åœ¨ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼Œä¸€èˆ¬ç”¨äºåˆ†æ”¯åˆ¤æ–­
ã€€ã€€BEQ        ç»“æœä¸º0åˆ™è·³è½¬
ã€€ã€€BNE        ç»“æœä¸ä¸º0è·³è½¬
ã€€ã€€LDR        åŠ è½½å¯„å­˜å™¨ï¼Œä»å†…å­˜åŠ è½½åˆ°å¯„å­˜å™¨
ã€€ã€€LDRB      è£…è½½å­—èŠ‚åˆ°å¯„å­˜å™¨
ã€€ã€€LDRH      è£…è½½åŠå­—åˆ°å¯„å­˜å™¨ï¼ˆä¸€ä¸ªå­—æ˜¯32ä½ï¼‰
ã€€ã€€LSL         é€»è¾‘å·¦ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€LSR         é€»è¾‘å³ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€MOV        ä¼ é€å€¼&amp;#x2F;å¯„å­˜å™¨åˆ°ä¸€ä¸ªå¯„å­˜å™¨ 
ã€€ã€€STR         å­˜å‚¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å€¼å­˜åˆ°å†…å­˜
ã€€ã€€STRB       å­˜å‚¨ä¸€ä¸ªå­—èŠ‚
ã€€ã€€STRH       å­˜å‚¨ä¸€ä¸ªåŠå­—
ã€€ã€€SUB         å‡æ³•
ã€€ã€€PUSH POP å †æ ˆæ“ä½œ

æœ‰æ—¶å€™éœ€è¦

db  ï¼›å®šä¹‰å­—èŠ‚ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—èŠ‚æ•°æ®å ä¸€ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªåç§»é‡åŠ 1
dw  ï¼›å®šä¹‰å­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—æ•°æ®å 2ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 2
dd  ï¼›å®šä¹‰åŒå­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªåŒå­—æ•°æ®å 4ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 4

IDAç»™æŸä¸ªä½ç½®å‘½åçš„æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è¯¥ä½ç½®çš„è™šæ‹Ÿåœ°å€å’Œè¡¨ç¤ºä¸€ä¸ªè¯¥åœ°å€çš„ç±»å‹çš„å‰ç¼€è¿›è¡Œå‘½åï¼š
sub_xxx  ï¼›åœ°å€xxxå¤„çš„å­ä¾‹ç¨‹
loc_xxx  ï¼›åœ°å€xxxå¤„çš„ä¸€ä¸ªæŒ‡ä»¤
byte_xxx ï¼›ä½ç½®xxxå¤„çš„8ä½æ•°æ®
word_xxx ;ä½ç½®xxxå¤„çš„16ä½æ•°æ®
dword_xxx ;ä½ç½®xxxå¤„çš„32ä½æ•°æ®
unk_xxx   ;ä½ç½®xxxå¤„å¤§å°æœªçŸ¥çš„æ•°æ®

å…³äºspï¼Œbpç­‰æ ˆå¯„å­˜å™¨çš„è§£é‡Šï¼š

SP is stack pointer. The stack is generally used to hold &amp;quot;automatic&amp;quot; variables and context&amp;#x2F;parameters across function calls. Conceptually you can think of the &amp;quot;stack&amp;quot; as a place where you &amp;quot;pile&amp;quot; your data. You keep &amp;quot;stacking&amp;quot; one piece of data over the other and the stack pointer tells you how &amp;quot;high&amp;quot; your &amp;quot;stack&amp;quot; of data is. You can remove data from the &amp;quot;top&amp;quot; of the &amp;quot;stack&amp;quot; and make it shorter.


&amp;lt;https:&amp;#x2F;&amp;#x2F;www.zybuluo.com&amp;#x2F;oro-oro&amp;#x2F;note&amp;#x2F;137244&amp;gt;
&amp;lt;http:&amp;#x2F;&amp;#x2F;cryptroix.com&amp;#x2F;2016&amp;#x2F;10&amp;#x2F;16&amp;#x2F;journey-to-the-stack&amp;#x2F;&amp;gt;
&amp;lt;http:&amp;#x2F;&amp;#x2F;en.citizendium.org&amp;#x2F;wiki&amp;#x2F;Stack_frame&amp;gt;
è™½ç„¶æ˜¯è‹±æ–‡ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¦æ¯”ä¸­æ–‡æ˜“æ‡‚

idaé‡Œé¢æœ‰ä¸‰ç§é¢œè‰²çš„ç®­å¤´:

è“è‰²ï¼Œé¡ºåºæ‰§è¡Œ
ç»¿è‰²ï¼Œæ¡ä»¶ä¸º(YES)
çº¢è‰²ï¼Œæ¡ä»¶ä¸ºï¼ˆNOï¼‰"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="IOSé€†å‘å…¥é—¨"/>
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> IOSé€†å‘å…¥é—¨</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>æœ€åæ‰¾åˆ°äº†åŠ å¯†çš„ç§˜é’¥ï¼Œæ‰¾åˆ°ä¹‹åå‘ç°æ•´ä¸ªæµç¨‹å¥½ç®€å•ã€‚ä¹‹å‰æ‰¾ä¸åˆ°é¦–å…ˆä¸ç†Ÿæ‚‰Object-Cçš„è¯­æ³•ï¼Œå…¶æ¬¡å°±æ˜¯armæŒ‡ä»¤ï¼Œè®°å½•å¦‚ä¸‹ï¼š</p>
<h2 id="0x01-å·¥å…·"><a href="#0x01-å·¥å…·" class="headerlink" title="0x01 å·¥å…·"></a>0x01 å·¥å…·</h2><p>é¦–å…ˆæ˜¯è¦ç”¨åˆ°çš„å·¥å…·ï¼Œä¸­é—´ä¸»è¦ç”¨äº†idaï¼Œhopperå’Œlldb</p>
<ul>
<li>dumpdecrypted: å°†è‹¹æœåŠ å¯†è¿‡çš„appç ¸å£³</li>
<li>class-dump: å¯¼å‡ºMachOæ–‡ä»¶é‡ŒObjCç±»åŠæ–¹æ³•å®šä¹‰</li>
<li>CydiaSubstrate: å°†ç¬¬ä¸‰æ–¹åŠ¨æ€åº“æ³¨å…¥è¿›ç¨‹</li>
<li>Cycript: ç”¨jsè¯­æ³•å†™ObjCæ–¹æ³•</li>
<li>Theos: è¶Šç‹±æ’ä»¶å¼€å‘å·¥å…·</li>
<li>IDA: åæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Hopper: OSXåæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Debugserver + LLDB: åŠ¨æ€è°ƒè¯•å™¨</li>
</ul>
<h2 id="0x02-ARMæŒ‡ä»¤"><a href="#0x02-ARMæŒ‡ä»¤" class="headerlink" title="0x02 ARMæŒ‡ä»¤"></a>0x02 ARMæŒ‡ä»¤</h2><pre class="line-numbers language-none"><code class="language-none">armæ˜¯RISCç»“æ„ï¼Œæ•°æ®ä»å†…å­˜åˆ°CPUä¹‹é—´ç§»åŠ¨åªèƒ½é€šè¿‡L&#x2F;SæŒ‡ä»¤æ¥å®Œæˆï¼Œå°±æ˜¯ldr&#x2F;stræŒ‡ä»¤
ldr æŠŠæ•°æ®ä»å†…å­˜ç§»åˆ°cpu
str æŠŠcpuçš„æ•°æ®æ•°æ®è½¬ç§»åˆ°å†…å­˜
lldbè¯»å–å†…å­˜çš„æ•°æ®ï¼Œmemory read &lt;start&gt; &lt;end&gt;
ldr r0, 0x12345678   &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€ä¸­çš„å€¼å­˜æ”¾åˆ°r0ä¸­
ldr r0, &#x3D;0x12345678  &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€å†™åˆ°r0ä¸­
ä¾‹å­ï¼š
COUNT EQU 0x40003100 &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªCOUNTå˜é‡ï¼Œåœ°å€æ˜¯0x40003100
...
LDR R1,&#x3D;COUNT       &#x2F;&#x2F;å°†COUNTè¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯0x40003100æ”¾åˆ°R1ä¸­
MOV R0,#0           &#x2F;&#x2F;å°†ç«‹å³æ•°0æ”¾åˆ°R0ä¸­
STR R0,[R1]         &#x2F;&#x2F;å°†R0ä¸­çš„å€¼æ”¾åˆ°ä»¥R1ä¸­çš„å€¼ä¸ºåœ°å€çš„å­˜å‚¨å•å…ƒå»




B è·³è½¬æŒ‡ä»¤
BL å¸¦è¿”å›çš„è·³è½¬æŒ‡ä»¤
BLX å¸¦è¿”å›å’ŒçŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤
BX  å¸¦çŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤

BLXæŒ‡ä»¤ä»ARMæŒ‡ä»¤é›†è·³è½¬åˆ°æŒ‡ä»¤ä¸­æ‰€æŒ‡å®šçš„ç›®æ ‡åœ°å€ï¼Œå¹¶å°†å¤„ç†å™¨çš„å·¥ä½œçŠ¶æ€ä»ARMåˆ‡æ¢åˆ°ThumbçŠ¶æ€ï¼Œè¯¥æŒ‡ä»¤åŒæ—¶å°†PCçš„å½“å‰å†…å®¹ä¿å­˜åˆ°å¯„å­˜å™¨R14ï¼Œå› æ­¤ï¼Œå½“å­ç¨‹åºä½¿ç”¨ThumbæŒ‡ä»¤é›†ï¼Œè€Œè°ƒç”¨è€…è€…ä½¿ç”¨ARMæŒ‡ä»¤é›†ï¼Œå¯ä»¥é€šè¿‡BLXæŒ‡ä»¤å®ç°å­ç¨‹åºçš„è°ƒç”¨å’Œå¤„ç†å™¨å·¥ä½œçŠ¶æ€åˆ‡æ¢ï¼ŒåŒæ—¶ï¼Œå­ç¨‹åºçš„è¿”å›å¯ä»¥é€šè¿‡å°†å¯„å­˜å™¨R14çš„å€¼å¤åˆ¶åˆ°PCä¸­æ¥å®Œæˆã€‚
ã€€R0-R3:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”¨äºå‡½æ•°å‚æ•°åŠè¿”å›å€¼çš„ä¼ é€’ï¼Œè¶…è¿‡4ä¸ªå‚æ•°ï¼Œå…¶å®ƒå‚æ•°å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ARMä¸­æ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼ŒR0è¿˜å¯ä»¥ä½œä¸ºè¿”å›å€¼ã€‚
ã€€ã€€R4-R6, R8, R10-R11:ã€€æ²¡æœ‰ç‰¹æ®Šè§„å®šï¼Œå°±æ˜¯æ™®é€šçš„é€šç”¨å¯„å­˜å™¨
ã€€ã€€R7:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ ˆå¸§æŒ‡é’ˆï¼ŒæŒ‡å‘æ¯å‡½æ•°ä¸è¢«è°ƒç”¨å­å‡½æ•°åœ¨æ ˆä¸­çš„äº¤ç•Œã€‚
ã€€ã€€R9:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åœ¨iOS3.0è¢«æ“ä½œç³»ç»Ÿä¿ç•™
ã€€ã€€R12:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ å†…éƒ¨è¿‡ç¨‹è°ƒç”¨å¯„å­˜å™¨ï¼ŒåŠ¨æ€é“¾æ¥æ—¶ä¼šç”¨åˆ°ï¼Œä¸å¿…æ·±ç©¶
ã€€ã€€R13:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ SP(stack pointer)ï¼Œæ˜¯æ ˆé¡¶æŒ‡é’ˆ
ã€€ã€€R14:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ LR(link register)ï¼Œå­˜æ”¾å‡½æ•°çš„è¿”å›åœ°å€ã€‚
ã€€ã€€R15:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ PC(program counter)ï¼ŒæŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ã€‚
ADC ã€€ã€€ å¸¦è¿›ä½çš„åŠ æ³•
ã€€ã€€ADD ã€€ã€€ åŠ æ³•
ã€€ã€€AND ã€€ã€€ é€»è¾‘ä¸
ã€€ã€€B ã€€ã€€ã€€  åˆ†æ”¯è·³è½¬ï¼Œå¾ˆå°‘å•ç‹¬ä½¿ç”¨
ã€€ã€€BL          åˆ†æ”¯è·³è½¬ï¼Œè·³è½¬åè¿”å›åœ°å€å­˜å…¥r14
ã€€ã€€BX          åˆ†æ”¯è·³è½¬ï¼Œå¹¶åˆ‡æ¢æŒ‡ä»¤æ¨¡å¼ï¼ˆThumb&#x2F;ARMï¼‰
ã€€ã€€CMP        æ¯”è¾ƒå€¼ï¼Œç»“æœå­˜åœ¨ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼Œä¸€èˆ¬ç”¨äºåˆ†æ”¯åˆ¤æ–­
ã€€ã€€BEQ        ç»“æœä¸º0åˆ™è·³è½¬
ã€€ã€€BNE        ç»“æœä¸ä¸º0è·³è½¬
ã€€ã€€LDR        åŠ è½½å¯„å­˜å™¨ï¼Œä»å†…å­˜åŠ è½½åˆ°å¯„å­˜å™¨
ã€€ã€€LDRB      è£…è½½å­—èŠ‚åˆ°å¯„å­˜å™¨
ã€€ã€€LDRH      è£…è½½åŠå­—åˆ°å¯„å­˜å™¨ï¼ˆä¸€ä¸ªå­—æ˜¯32ä½ï¼‰
ã€€ã€€LSL         é€»è¾‘å·¦ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€LSR         é€»è¾‘å³ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€MOV        ä¼ é€å€¼&#x2F;å¯„å­˜å™¨åˆ°ä¸€ä¸ªå¯„å­˜å™¨ 
ã€€ã€€STR         å­˜å‚¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å€¼å­˜åˆ°å†…å­˜
ã€€ã€€STRB       å­˜å‚¨ä¸€ä¸ªå­—èŠ‚
ã€€ã€€STRH       å­˜å‚¨ä¸€ä¸ªåŠå­—
ã€€ã€€SUB         å‡æ³•
ã€€ã€€PUSH POP å †æ ˆæ“ä½œ

æœ‰æ—¶å€™éœ€è¦

db  ï¼›å®šä¹‰å­—èŠ‚ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—èŠ‚æ•°æ®å ä¸€ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªåç§»é‡åŠ 1
dw  ï¼›å®šä¹‰å­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—æ•°æ®å 2ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 2
dd  ï¼›å®šä¹‰åŒå­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªåŒå­—æ•°æ®å 4ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 4

IDAç»™æŸä¸ªä½ç½®å‘½åçš„æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è¯¥ä½ç½®çš„è™šæ‹Ÿåœ°å€å’Œè¡¨ç¤ºä¸€ä¸ªè¯¥åœ°å€çš„ç±»å‹çš„å‰ç¼€è¿›è¡Œå‘½åï¼š
sub_xxx  ï¼›åœ°å€xxxå¤„çš„å­ä¾‹ç¨‹
loc_xxx  ï¼›åœ°å€xxxå¤„çš„ä¸€ä¸ªæŒ‡ä»¤
byte_xxx ï¼›ä½ç½®xxxå¤„çš„8ä½æ•°æ®
word_xxx ;ä½ç½®xxxå¤„çš„16ä½æ•°æ®
dword_xxx ;ä½ç½®xxxå¤„çš„32ä½æ•°æ®
unk_xxx   ;ä½ç½®xxxå¤„å¤§å°æœªçŸ¥çš„æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…³äºspï¼Œbpç­‰æ ˆå¯„å­˜å™¨çš„è§£é‡Šï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
SP is stack pointer. The stack is generally used to hold &quot;automatic&quot; variables and context&#x2F;parameters across function calls. Conceptually you can think of the &quot;stack&quot; as a place where you &quot;pile&quot; your data. You keep &quot;stacking&quot; one piece of data over the other and the stack pointer tells you how &quot;high&quot; your &quot;stack&quot; of data is. You can remove data from the &quot;top&quot; of the &quot;stack&quot; and make it shorter.


&lt;https:&#x2F;&#x2F;www.zybuluo.com&#x2F;oro-oro&#x2F;note&#x2F;137244&gt;
&lt;http:&#x2F;&#x2F;cryptroix.com&#x2F;2016&#x2F;10&#x2F;16&#x2F;journey-to-the-stack&#x2F;&gt;
&lt;http:&#x2F;&#x2F;en.citizendium.org&#x2F;wiki&#x2F;Stack_frame&gt;
è™½ç„¶æ˜¯è‹±æ–‡ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¦æ¯”ä¸­æ–‡æ˜“æ‡‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>idaé‡Œé¢æœ‰ä¸‰ç§é¢œè‰²çš„ç®­å¤´:</p>
<ol>
<li>è“è‰²ï¼Œé¡ºåºæ‰§è¡Œ</li>
<li>ç»¿è‰²ï¼Œæ¡ä»¶ä¸º(YES)</li>
<li>çº¢è‰²ï¼Œæ¡ä»¶ä¸ºï¼ˆNOï¼‰</li>
</ol>
<h2 id="0x03-lldbä½¿ç”¨æ–¹æ³•"><a href="#0x03-lldbä½¿ç”¨æ–¹æ³•" class="headerlink" title="0x03 lldbä½¿ç”¨æ–¹æ³•"></a>0x03 lldbä½¿ç”¨æ–¹æ³•</h2><pre class="line-numbers language-none"><code class="language-none">lldbæ“ä½œç›¸å…³æŒ‡ä»¤
image list -o -f æŸ¥çœ‹è¿›ç¨‹åœ¨è™šæ‹Ÿå†…å­˜ä¸­ç›¸å¯¹æ¨¡å—åŸºåœ°å€
br s -a [addr]  æ‰“æ–­ç‚¹
breakpoint delete &lt;breakpoint&gt; åˆ é™¤æ–­ç‚¹
s&#x2F;n  æ˜¯é’ˆå¯¹æºä»£ç 
br list åˆ—å‡ºæ‰€æœ‰æ–­ç‚¹
br dis 1  ç¦ç”¨åºå·ä¸º1çš„æ–­ç‚¹
jump &lt;address&gt; è·³è½¬åˆ°æ–°åœ°å€

ni   æ–­ç‚¹çš„å•æ­¥ä¹‹è¡Œ, netxi(next instructionç®€å†™:ni)
si   stepi(step instruction ç®€å†™:si)
display &#x2F;10i $pc-16  æ˜¾ç¤ºå½“å‰PCé™„è¿‘çš„10æ¡æŒ‡ä»¤

siä¼šè¿›å…¥å‡½æ•°ä¹‹è¡Œï¼Œniæ‰§è¡Œå®Œä½†æ˜¯ä¸ä¼šè¿›å…¥å‡½æ•°å†…ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥åˆ©ç”¨display &#x2F;i $pcæ¥çœ‹ä¸‹ä¸€ä¸ªæ‰§è¡Œçš„instructionæ˜¯ä»€ä¹ˆ

c  æ”¾å¼€æ‰§è¡Œè¯¥æ–­ç‚¹
p  è¾“å‡ºæŸä¸ªå¯„å­˜å™¨çš„å€¼
p $r0  è¾“å‡ºå¯„å­˜å™¨çš„å†…å®¹
ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªåœ°å€æ‰€å­˜æ”¾çš„å€¼è¿›è¡Œæ‰“å°
p&#x2F;x $sp å°±æ˜¯è¾“å‡º$spæŒ‡é’ˆæ‰€æŒ‡çš„åœ°å€å¤„å­˜æ”¾çš„å€¼ï¼Œä»¥16è¿›åˆ¶è¡¨ç¤º
po (char *)$r2   poæ‰“å°Object-Cå¯¹è±¡
register read --all  è¯»å–æ‰€æœ‰çš„å¯„å­˜å™¨å†…å®¹
thread list ï¼ï¼æ‰“å°æ‰€æœ‰çº¿ç¨‹
thread select  ï¼ï¼è·³åˆ°æŸä¸ªçº¿ç¨‹
thread info ï¼ï¼è¾“å‡ºå½“å‰çº¿ç¨‹ä¿¡æ¯
frame variable  ï¼ï¼æ‰“å°å½“å‰æ ˆæ‰€æœ‰å˜é‡
frame variable &#39;å˜é‡å&#39; ï¼ï¼æ‰“å°æŸä¸ªå˜é‡
frame info æŸ¥çœ‹å½“å‰å¸§æ ˆä¿¡æ¯
frame select è·³åˆ°æŒ‡å®šå¸§æ ˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://images2015.cnblogs.com/blog/545446/201608/545446-20160803092245918-95608722.png"><br><img src="https://images2015.cnblogs.com/blog/545446/201608/545446-20160803092702793-231598231.png"></p>
<p>fridaçš„å¸¸è§ç”¨æ³•ï¼š</p>
<ul>
<li>hookå‡½æ•°(IOSä¸­theoså…·å¤‡çš„åŠŸèƒ½ï¼‰</li>
<li>è®°å½•å‡½æ•°æ‰§è¡Œæ—¥è‡³(IOSä¸­theoså…·å¤‡çš„åŠŸèƒ½ï¼‰</li>
<li>è°ƒç”¨å‡½æ•°ï¼ˆIOSä¸­cycriptå…·å¤‡çš„åŠŸèƒ½ï¼‰</li>
<li>è¯»å†™å†…å­˜ï¼ˆç±»ä¼¼è°ƒè¯•å™¨çš„åŠŸèƒ½ï¼‰</li>
</ul>
<p>lldb:</p>
<ul>
<li>lldbåœ¨object-cç±»å¯¹è±¡æ‰€æœ‰å‡½æ•°è®¾ç½®æ–­ç‚¹: <code>breakpoint set -r &#39;\[ClassName .*\]$&#39;</code></li>
</ul>
<p>å¸¸ç”¨ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">breakpoint set --name &lt;method-name&gt;
    &quot;set a breakpoint on a given function name, globally. eg.
     breakpoint set --name viewDidLoad
     or
     breakpoint set --name &quot;-[UIView setFrame:]&quot;
     
break set --selector &lt;selector-name&gt;
    &quot;set a breakpoint on a selector, globally. e.g.,
    breakpoint set --selector dealloc
bt  &#x2F;&#x2F;æŸ¥çœ‹å †æ ˆ
frame select &lt;framenum&gt;
thread list 
expression $r6 &#x2F;&#x2F;æŸ¥çœ‹r6å¯„å­˜å™¨çš„å€¼
1. åŠ å‚æ•°å¯ä»¥æ›´æ”¹æ˜¾ç¤ºæ–¹å¼ï¼Œå¦‚&#x2F;xåå…­è¿›åˆ¶æ‰“å°
2. poä¸€èˆ¬ç”¨ä½œæŸ¥çœ‹å¯¹è±¡ä¿¡æ¯
3. poçš„å‘½ä»¤æ˜¯â€œexpression -O -&quot;å‘½ä»¤çš„åˆ«å

ç¬¬ä¸€æ¬¡ä½¿ç”¨malloc_infoéœ€è¦åœ¨lldé‡Œé¢å¯¼å…¥lldb.macosx.heap
malloc_info -s &lt;address&gt;
memory read &lt;start_address&gt; &lt;end_address&gt; è¯»å–å†…å­˜çš„å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="0x04-HopperåŸºæœ¬ä½¿ç”¨"><a href="#0x04-HopperåŸºæœ¬ä½¿ç”¨" class="headerlink" title="0x04 HopperåŸºæœ¬ä½¿ç”¨"></a>0x04 HopperåŸºæœ¬ä½¿ç”¨</h2><p>hopperå’ŒLLDBæ‰€é€‰æ‹©çš„ARMæ¶æ„ä½æ•°å¾—ä¸€è‡´ï¼Œè¦ä¹ˆæ˜¯32ä½ï¼Œè¦ä¹ˆéƒ½æ˜¯64ä½ï¼Œè®¡ç®—å…¬å¼ï¼š<br>hopperé‡Œé¢æ˜¾ç¤ºçš„éƒ½æ˜¯â€æ¨¡å—åç§»å‰åŸºåœ°å€â€,è€Œlldbè¦æ“ä½œçš„éƒ½æ˜¯â€æ¨¡å—åç§»åçš„åŸºåœ°å€â€ï¼Œæ‰€ä»¥ä»hopperåˆ°lldbè¦åšä¸€ä¸ªåœ°å€åç§»é‡çš„è½¬æ¢ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">åç§»åæ¨¡å—åŸºåœ°å€ ï¼  åç§»å‰æ¨¡å—åœ°å€ + ALSR<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åç§»å‰åœ°å€ä»Hopperçœ‹:</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1584204-69b7b8c603bc3d25.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p>
<p>ALSRåç§»åœ°å€ä»LLDBçœ‹:</p>
<p><img src="https://upload-images.jianshu.io/upload_images/1584204-3140f0b7d73ad6b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p>
<p>ç”±ä¸Šå›¾å¯çŸ¥ASLRåç§»ï¼š30000<br>åç§»ååŸºåœ°å€ä¸ºï¼š34000</p>
<p>(ä»hopperçš„loginæœç´¢æ‰¾åˆ°æ–¹æ³•ï¼»WCAccountPhoneLoginControlLogic initWithData:]ï¼š<br>æŸ¥çœ‹åç§»åŸºåœ°å€ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1584204-b0503afcf07798ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"><br>åˆ™åç§»åçš„åœ°å€ï¼š 14B6A66 + 30000 = 14E6A66<br>è®¾ç½®æ–­ç‚¹åŠ¨æ€è°ƒè¯•ï¼Œä½¿ç”¨ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">br s -a 0x 14E6A66<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="0x05-Cycript"><a href="#0x05-Cycript" class="headerlink" title="0x05 Cycript"></a>0x05 Cycript</h3><p>å®‰è£…Cycript</p>
<pre class="line-numbers language-none"><code class="language-none">dpkg -i cycript_0.9.461_iphoneos-arm.deb  
dpkg -i libffi_1-3.0.10-5_iphoneos-arm.deb 

cycript -p &lt;pid&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ­¥éª¤ï¼š</p>
<p>å®‰è£…cydiaä¹‹åçš„sshï¼Œç„¶åmacæœ¬æœºï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">brew install usbmuxd 
iproxy 2222 22   &#x2F;&#x2F;iphoneçš„22ç«¯å£è½¬å‘åˆ°æœ¬æœºçš„2222
ssh root@localhost -p 2222  &#x2F;&#x2F;é»˜è®¤å¯†ç  alpine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">cycript:
[UIApp description]
[[UIApp keyWindow] recursiveDescription].toString() &#x2F;&#x2F;è¾“å‡ºå¦‚ä¸‹
&lt;UIView: 0x18b1bd60; frame &#x3D; (10 0; 20 50); layer &#x3D; &lt;CALayer: 0x18b1be20&gt;&gt;
   |    |    |    |    |    |    |    |    | &lt;UIImageView: 0x18b1bf90; frame &#x3D; (30 13.5; 10 10); opaque &#x3D; NO; userInteractionEnabled &#x3D; NO; layer &#x3D; &lt;CALayer: 0x18b1b5f0&gt;&gt;
   |    |    |    |    |    |    |    |    | &lt;UITableViewLabel: 0x18b1c070; frame &#x3D; (44 10; 218 17); text &#x3D; &#39;UIView&#39;; userInteractionEnabled &#x3D; NO; layer &#x3D; &lt;_UILabelLayer: 0x18b1c190&gt;&gt;


&#x2F;&#x2F;æŸ¥çœ‹æŸä¸ªUIï¼š
[#0x18b1c070 _ivarDescription].toString()
[#0x15baf520 nextResponder] æŸä¸ªåœ°å€çš„è°ƒç”¨æ–¹æ³•

[[UIApp keyWindow] _autolayoutTrace].toString()
&#x2F;&#x2F;chooseä¼ é€’ä¸€ä¸ªç±»ï¼Œå¯ä»¥åœ¨å†…å­˜ä¸­æ‰¾å‡ºå±äºè¿™ä¸ªç±»çš„å¯¹è±¡
ï¼ï¼è¾“å‡ºå¯¹è±¡çš„å±æ€§ï¼š
æ–¹æ³•1ï¼š ç®€å•åŸºæœ¬è·å–æ–¹æ³•ã€‚
*controllerï¼ˆç›´æ¥åœ¨å¯¹è±¡å‰é¢åŠ ä¸ª*ï¼‰

æ–¹æ³•2ï¼šæ–¹æ³•ä¸€æ— æ³•è·å–ï¼Œå°±ä½¿ç”¨æ–¹æ³•2
[i for (i in *UIApp)]

æ–¹æ³•3ï¼šå»ºè®®æ–¹æ³•ä¸‰ï¼Œæ–¹æ³•ä¸‰èƒ½è·å–åˆ°æ›´å¤š
function tryPrintIvars(a)&#123; var x&#x3D;&#123;&#125;; for(i in *a)&#123; try&#123; x[i] &#x3D; (*a)[i]; &#125; catch(e)&#123;&#125; &#125; return x; &#125;



function printMethods(className, isa) &#123;
  var count &#x3D; new new Type(&quot;I&quot;);
  var classObj &#x3D; (isa !&#x3D; undefined) ? objc_getClass(className)-&gt;isa : objc_getClass(className);
  var methods &#x3D; class_copyMethodList(classObj, count);
  var methodsArray &#x3D; [];
  for(var i &#x3D; 0; i &lt; *count; i++) &#123;
    var method &#x3D; methods[i];
    methodsArray.push(&#123;selector:method_getName(method), implementation:method_getImplementation(method)&#125;);
  &#125;
  free(methods);
  return methodsArray;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">cycript -p Springboard æˆ– cycript -p pid

#åœ¨å†…å­˜ä¸­æ‰¾ä¸€ä¸ªMD5Signaterç±»çš„å®ä¾‹å¯¹è±¡
choose(MD5Signater)

#è°ƒç”¨0x166b4fb0å¤„çš„å¯¹è±¡çš„showå‡½æ•°
ï¼»#0x166b4fb0 show]

#å¯¹showå‡½æ•°ä¼ å…¥å‚æ•°3344
[#0x166b4fb0 show:3344]

#æ–°å»ºä¸€ä¸ªMD5Signaterç±»çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒçš„setSecretå‡½æ•°ï¼Œä¼ å…¥å‚æ•°1
obj &#x3D; [MD5Signater alloc]
[#0x146f1a30 setSecret:1]

åœ¨Objective-Cä¸­ï¼Œï¼»someObject somemethod]çš„åº•å±‚å®ç°ï¼Œå®é™…ä¸Šæ˜¯objc_msgSendï¼ˆsomeObject,someMethodï¼‰,å…¶ä¸­å‰ä¸€ä¸ªæ˜¯Objective-Cå¯¹è±¡ï¼Œåè€…åˆ™å¯ä»¥å¼ºåˆ¶è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="0x06-è°ƒè¯•æµç¨‹"><a href="#0x06-è°ƒè¯•æµç¨‹" class="headerlink" title="0x06 è°ƒè¯•æµç¨‹"></a>0x06 è°ƒè¯•æµç¨‹</h3><p>å¦‚æœè¦ä½¿ç”¨lldbè°ƒè¯•è¶Šç‹±è®¾å¤‡ä¸Šçš„è¿›ç¨‹ï¼Œéœ€è¦å…ˆå°†connectçš„ç«¯å£æ˜ å°„åˆ°æœ¬åœ°ï¼Œä»¥1234ç«¯å£ä¸ºä¾‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">iproxy 1234 1234
ç„¶åæ‰“å¼€lldbï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
process connect connect:&#x2F;&#x2F;localhost:1234
è¿æ¥è¶Šç‹±è®¾å¤‡ï¼Œè¾“å…¥ï¼š
debugserver *:1234 -a &lt;pid&gt;
åªè¦è¶Šç‹±è®¾å¤‡ä¸Šçš„debugserverï¼ˆé‡ç­¾åè¿‡çš„ï¼‰æ­£å¸¸è¿è¡Œï¼Œå°±å¯ä»¥é€šè¿‡lldbè¿›è¡Œè¿œç¨‹è°ƒè¯•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¶Šç‹±è®¾å¤‡ç¬¬ä¸€æ¬¡è¿æ¥xcodeçš„æ—¶å€™ä¼šåœ¨/Developer/usr/binç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªdebugserverï¼Œè¿™ä¸ªdebugserveråœ¨iosé‡Œé¢è¿è¡Œä¼šå¤±è´¥éœ€è¦ä½¿ç”¨ldidç­¾åï¼Œéœ€è¦ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<ul>
<li><p>ldid   <a target="_blank" rel="noopener" href="http://7xibfi.com1.z0.glb.clouddn.com/uploads/default/668/c134605bb19a433f.xml">http://7xibfi.com1.z0.glb.clouddn.com/uploads/default/668/c134605bb19a433f.xml</a></p>
</li>
<li><p>xmlï¼ˆæ–‡ä»¶ï¼‰ <a target="_blank" rel="noopener" href="http://joedj.net/ldid">http://joedj.net/ldid</a></p>
</li>
</ul>
<p> xmlæ–‡ä»¶ä¿å­˜ä¸º<code>ent.xml</code>ï¼Œç„¶åç­¾åï¼š</p>
 <pre class="line-numbers language-none"><code class="language-none">ldid -Sent.xml debugserver<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> ç„¶åå›ä¼ åˆ°iosä¸Šé¢å³å¯ï¼Œä½¿ç”¨wgetæˆ–è€…scpï¼ˆscpå¤±è´¥ï¼Œè¿™é‡Œæ˜¯ç”¨çš„æ˜¯wgetï¼‰</p>
 <pre class="line-numbers language-none"><code class="language-none">debugserver 0.0.0.0:1234 &quot;SpringBoard&quot;
(lldb)process connect connect:&#x2F;&#x2F;&lt;ios&gt;:&lt;port&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="Object-C-çš„ä¸€äº›åŸºç¡€çŸ¥è¯†"><a href="#Object-C-çš„ä¸€äº›åŸºç¡€çŸ¥è¯†" class="headerlink" title="Object-C çš„ä¸€äº›åŸºç¡€çŸ¥è¯†"></a>Object-C çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</h3><p>åœ¨Objective-Cä¸­çš„â€œæ–¹æ³•è°ƒç”¨â€å…¶å®åº”è¯¥å«åšæ¶ˆæ¯ä¼ é€’ã€‚<br>ä»¥objc_msgSendå‡½æ•°ä¸ºä¾‹å­ï¼Œ</p>
<pre class="line-numbers language-none"><code class="language-none">[person sayHello] 
å¯ä»¥è§£é‡Šä¸ºè°ƒç”¨personå¯¹è±¡çš„sayHelloæ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä»Object-Cçš„Runtimeè§’åº¦æ¥è¯´ï¼Œè¿™ä¸ªä»£ç ä¸–çºªæ˜¯åœ¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªä»£ç ï¼Œç¼–è¯‘å™¨æ—¶æœºä¼šå°†å®ƒè½¬æ¢æˆè¿™æ ·ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼š
objc_msgSend(person,@selector(sayHello))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦å‘é€æ¶ˆæ¯çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯personå¯¹è±¡ã€‚objc_msgSendä¼šå…ˆæŸ¥è¯¢å®ƒçš„methodListæ–¹æ³•åˆ—è¡¨ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°sayHello</p>
<pre class="line-numbers language-none"><code class="language-none">è‹¹æœæ–‡æ¡£è¿™æ ·å†™çš„
id objc_msgSend(id self, SEL _cmd, ...)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å°†ä¸€ä¸ªæ¶ˆæ¯å‘é€ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå€¼ã€‚å…¶ä¸­ï¼Œselfæ˜¯æ¶ˆæ¯çš„æ¥å—è€…ï¼Œ<code>_cmd</code>æ˜¯selectorï¼Œâ€¦ æ˜¯å¯å˜å‚æ•°åˆ—è¡¨ã€‚</p>
<p>åœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹ä¼šè¢«åˆ†é…ä¸€ä¸ªstackï¼Œå½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨ï¼Œä¸€ä¸ªstack frameï¼ˆå¸§æ ˆ)å°±ä¼šè¢«å‹åˆ°stacké‡Œï¼Œé‡Œé¢åŒ…å«è¿™ä¸ªå‡½æ•°è®¾è®¡çš„å‚æ•°ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿”å›åœ°å€ç­‰ç›¸å…³ä¿¡æ¯ã€‚å½“å‡½æ•°è¿”å›è¿™ä¸ªå¸§æ ˆä¹‹åï¼Œè¿™ä¸ªå¸§æ ˆå°±ä¼šè¢«é”€æ¯ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">- (double)pi;
 
 æ–¹æ³•åå°±æ˜¯pi

- (int)square:(int)num;

 å¸¦å‚æ•°çš„æ–¹æ³•åæœ‰ç‚¹ç‰¹æ®Šï¼Œå†’å·åé¢ä¸€å®šæ˜¯å‚æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œæœ‰å‡ ä¸ªå†’å·å°±æœ‰å‡ ä¸ªå‚æ•°ï¼ŒæŠŠç©ºæ ¼åé¢åˆ°å‚æ•°å‰é¢çš„å†…å®¹æ‹¼èµ·æ¥å°±æ˜¯æ–¹æ³•åã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•åæ˜¯square:ï¼ˆæ³¨æ„å†’å·ï¼‰

ï¼ (int)addNum1:(int)num1 addNum2:(int)num2;
 
 æ ¹æ®ä¸Šé¢çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åæ˜¯addNum1:addNum2:
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰€ä»¥æ ¹æ®ä¸Šé¢æ–¹æ³•åçš„é—®é¢˜ï¼Œåœ¨cycripté‡Œé¢è°ƒç”¨çš„æ—¶å€™ï¼Œæ˜¯è¿™æ ·ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">cy# choose(PARSEPedometerInfo)
 [#&quot;PARSPedometerInfo&lt;0x12f22cd60&gt;: \n integration&#x3D;1541 \n iPhone&#x3D;1541 \n watch&#x3D;0 \n heartRat&#x3D;0\n at:2017-12-26 16:00:00 +0000&quot;,#&quot;PARSPedometerInfo&lt;0x12f406c90&gt;: \n integration&#x3D;1541 \n iPhone&#x3D;1541 \n watch&#x3D;0 \n heartRat&#x3D;0\n at:2017-12-26 16:00:00 +0000&quot;]
    ä¹Ÿå³æ‰¾åˆ°ä¸¤ä¸ªPARSPedometerInfoç±»çš„å¯¹è±¡,éšä¾¿ç”¨å…¶ä¸­ä¸€ä¸ªå³å¯
[#0x12f22cd60 setIntegratedSteps:66666]

 setIntegratedStepsæ˜¯å‡å·å¼€å¤´çš„å‡½æ•°ï¼Œå¦‚æœæ˜¯+å·å¼€å¤´çš„å‡½æ•°ç”¨æ³•åˆ™[className funcName:6666]ï¼Œå¦‚ä¸‹é¢çš„å‡½æ•°æ˜¯+å·å¼€å¤´çš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„å‡½æ•°ï¼Œè€Œä¸ç”¨åˆ›å»ºè¿™ä¸ªç±»çš„å®ä¾‹ï¼š
cy# [PARSCryptDataUtils encryptWithServerTimestamp:&quot;18013790233&quot;]

å¸¦å‡å·çš„å‡½æ•°ï¼Œè¦å®ä¾‹åŒ–ä¹‹åæ‰å¯ä»¥è°ƒç”¨
å¸¦åŠ å·çš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">_text:0001D76A MOV R0, #(selRefHTTPMethod - 0x1C776) ; selRef_HTTPMethod
_text:0001D772 ADD R0, PC ; selRefHTTPMethod
__text:0001D774 LDR R1, [R0] ; &quot;HTTPMethod&quot;
__text:0001D776 MOV R0, R10
_text:0001D778 STR R1, [SP,#0xAC+varA0]
_text:0001D77A BLX _objcmsgSend
__text:0001D77E MOV R7, R7
_text:0001D780 BLX _objcretainAutoreleasedReturnValue
__text:0001D784 MOV R4, R0
_text:0001D786 MOV R0, #(selRefsetRequestMethod_ - 0x1C794) ; selRef_setRequestMethod_
__text:0001D78E MOV R2, R4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>0001D77Aå¤„çš„selectorä¸ºHTTPMethodï¼Œåœ¨functions windowsé‡Œå¯ä»¥æœåˆ°è¿™ä¸ªå‡½æ•°ï¼Œå‡½æ•°åœ¨æ‰§è¡Œå‰æŠŠè°ƒç”¨çš„å¯¹è±¡å­˜å‚¨åœ¨R0ä¸­ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">__text:0001D774 LDR R1, [R0] ; &quot;HTTPMethod&quot;   ï¼ï¼æŠŠæ–¹æ³•åæ”¾åˆ°R1ä¸­
__text:0001D776 MOV R0, R10                    &#x2F;&#x2F;R0èµ‹å€¼ä¸ºR10æ‰€åœ¨çš„å€¼ï¼Œæ­¤å¤„R10ä½HTTPMethodè¿™ä¸ªæ–¹æ³•å½’å±çš„ç±»çš„æŒ‡é’ˆä¹‹ç±»ã€‚
ä¸Šé¢ä¸¤æ¡æŒ‡ä»¤ç¡®å®šäº†è°ƒç”¨çš„å‡½æ•°ï¼Œè°ƒç”¨å®Œæ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œä¼šæ›´æ–°åœ¨R0ï¼Œå¤§äºä¸€ä¸ªè¿”å›å€¼ï¼Œå°±ä¼šé€šè¿‡æ ˆæ¥è¿”å›å€¼ã€‚ï¼ˆæ„æ€æ˜¯å¦‚æœå‡½æ•°ä¸æ­¢ä¸€ä¸ªè¿”å›å€¼ï¼Œå°±ä¼šé€šè¿‡æ ˆæ¥è¿”å›ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">NSString *string1 &#x3D; @&quot;test 1&quot;;
NSString *string2 &#x3D; @&quot;test 2&quot;;
(lldb) po string1
test 1
(lldb) p string1
(NSString *) $2 &#x3D; 0x0000000100003af0 @&quot;test 1&quot;
(lldb) p string2
(NSString *) $3 &#x3D; 0x0000000100003b10 @&quot;test 2&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li><a target="_blank" rel="noopener" href="https://objccn.io/issue-19-2/">https://objccn.io/issue-19-2/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zybuluo.com/qidiandasheng/note/349994">https://www.zybuluo.com/qidiandasheng/note/349994</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/13e5774759a2">https://www.jianshu.com/p/13e5774759a2</a></li>
<li><a target="_blank" rel="noopener" href="http://bbs.iosre.com/t/ida--objc-msgsend/166">http://bbs.iosre.com/t/ida--objc-msgsend/166</a></li>
<li><a target="_blank" rel="noopener" href="http://cryptroix.com/2016/10/16/journey-to-the-stack/">http://cryptroix.com/2016/10/16/journey-to-the-stack/</a></li>
<li><a target="_blank" rel="noopener" href="http://en.citizendium.org/wiki/Stack_frame">http://en.citizendium.org/wiki/Stack_frame</a></li>
</ul>

	</div>

	
	<span id="/2017/02/02/mac-re.html" class="leancloud-visitors view" data-flag-title="IOSé€†å‘å…¥é—¨">
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2017/02/16/ssh-port-forward.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2017/01/07/n0js-case-postMessage-xss.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-02-02 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/PWN/">PWN<span>2</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x01-%E5%B7%A5%E5%85%B7"><span class="toc-article-text">0x01 å·¥å…·</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x02-ARM%E6%8C%87%E4%BB%A4"><span class="toc-article-text">0x02 ARMæŒ‡ä»¤</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x03-lldb%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-article-text">0x03 lldbä½¿ç”¨æ–¹æ³•</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x04-Hopper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-article-text">0x04 HopperåŸºæœ¬ä½¿ç”¨</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#0x05-Cycript"><span class="toc-article-text">0x05 Cycript</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#0x06-%E8%B0%83%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-article-text">0x06 è°ƒè¯•æµç¨‹</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Object-C-%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-article-text">Object-C çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
